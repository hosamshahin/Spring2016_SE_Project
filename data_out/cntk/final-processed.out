parallelforwardbackward parallel implement lattic forward backward implement current cuda

seid hansu

defin secur warn secur avail platform file give variabl warn

best gpu cpuonli
latticearch implement part lattic
simpl array
simplesenonehmm model
ssematrix matric
cudalattic
latticefunctionskernel emul
cudalatticeop
numer debug
cudalib
basic

defin channel hansu
msra cuda

ifndef cpuonli
pragma comment math cuda built cntk math cuda project


msra lattic

emul support
dim3

size
dim3 size size size





dim3 block idx grid dim thread idx block dim

func
forceinlin emulatecuda dim3 dim3 func

grid dim
block dim
block idx block idx grid dim block idx
block idx block idx grid dim block idx
block idx block idx grid dim block idx
thread idx thread idx block dim thread idx
thread idx thread idx block dim thread idx
thread idx thread idx block dim thread idx



setvaluej vector thisvector valu size nelem

size block dim block dim total thread block
size jinblock thread idx thread idx block dim
size jinblock block idx
nelem note caus issu ever synctread

msra lattic latticefunctionskernel setvaluej thisvector valu



expdiffj vector eframescorrectbuf log eframescorrecttot size nelem vector log eframescorrect

size block dim block dim total thread block
size jinblock thread idx thread idx block dim
size jinblock block idx
nelem note caus issu ever synctread

log eframescorrect eframescorrectbuf log eframescorrecttot


must ident actual cuda kernel input type vectorref vector
edgealignmentj vector lrhmmdef hmm vector lr3tran p tran ps size spalignunitid size silalignunitid
vector msra lattic nodeinfo node vector msra lattic edgeinfowithscor edg
vector msra lattic aligninfo align
msra math ssematrixbas log l ls vector alignoffset
vector backptrstorag vector size backptroffset
vector alignresult vector edgeacscor

identifi element grid pass actual stuff
comput check rang
size block dim block dim total thread block
size jinblock thread idx thread idx block dim
size jinblock block idx
edg size note caus issu ever synctread

msra lattic latticefunctionskernel edgealignmentj hmm tran ps spalignunitid silalignunitid log l ls node edg align
alignoffset backptrstorag backptroffset alignresult edgeacscor



forwardlatticej size batchsiz size startindex vector edgeacscor
size spalignunitid size silalignunitid
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector msra lattic aligninfo align
vector align vector alignmentoffset
vector logalpha boostingfactor
vector uid vector senone2classmap return eframescorrect
vector logframescorrectedg vector logaccalpha

size shufflemod
size msra lattic latticefunctionskernel shuffl thread idx block dim thread idx block dim block idx grid dim shufflemod
batchsiz note caus issu ever synctread forwardlatticej

msra lattic latticefunctionskernel forwardlatticej startindex edgeacscor spalignunitid silalignunitid edg node align align alignmentoffset
logalpha boostingfactor uid senone2classmap return eframescorrect logframescorrectedg logaccalpha



backwardlatticej size batchsiz size startindex vector edgeacscor
size spalignunitid size silalignunitid
vector msra lattic edgeinfowithscor edg
vector msra lattic nodeinfo node
vector msra lattic aligninfo align totalfwscor
vector logpp vector logalpha vector logbeta
boostingfactor return eframescorrect vector logframescorrectedg
vector logaccalpha vector eframescorrectbuf vector logaccbeta

size block dim block dim total thread block
size jinblock thread idx thread idx block dim
size jinblock block idx
batchsiz note caus issu ever synctread backwardlatticej

msra lattic latticefunctionskernel backwardlatticej startindex edgeacscor spalignunitid silalignunitid
edg node align totalfwscor logpp logalpha
logbeta boostingfactor return eframescorrect logframescorrectedg
logaccalpha eframescorrectbuf logaccbeta



s mb rerrorsignalj vector alignstateid vector alignoffset
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector logpp vector log eframescorrect
log eframescorrecttot msra math ssematrixbas errorsign msra math ssematrixbas errorsignalneg

size shufflemod
size msra lattic latticefunctionskernel shuffl thread idx block dim thread idx block dim block idx grid dim shufflemod
edg size note caus issu ever synctread

msra lattic latticefunctionskernel s mb rerrorsignalj alignstateid alignoffset edg node logpp log eframescorrect log eframescorrecttot
errorsign errorsignalneg



stateposteriorsj vector alignstateid vector alignoffset
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector logq msra math ssematrixbas logacc

size shufflemod
size msra lattic latticefunctionskernel shuffl thread idx block dim thread idx block dim block idx grid dim shufflemod
edg size note caus issu ever synctread

msra lattic latticefunctionskernel stateposteriorsj alignstateid alignoffset edg node logq logacc



checkshuffl vector checkvector1 vector checkvector2 size shufflemod

size msra lattic latticefunctionskernel shuffl thread idx block dim thread idx block dim block idx grid dim shufflemod
checkvector1 size

checkvector1

checkvector2 size

checkvector2



errorcomputationi msra math ssematrixbas errorsign msra math ssematrixbas errorsignalneg

size thread idx block idx block dim
errorsign row

clear column
size errorsign col
size
errorsign expf errorsign expf errorsignalneg


weightedcomponentexpproduct msra math ssematrixbas loggamma msra math ssematrixbas log eframescorrect
log eframecorrecttot kappa msra math ssematrixbas errorsign

size thread idx block idx block dim
errorsign row

msra lattic latticefunctionskernel comput mb rerrorsign loggamma log eframescorrect log eframecorrecttot kappa errorsign



behav cuda counterpart take side vector everyth
must ident cuda kernel launch input type vectorref vector
emulateedgealign vector lrhmmdef hmm vector lr3tran p tran ps size spalignunitid size silalignunitid
vector msra lattic nodeinfo node vector msra lattic edgeinfowithscor edg
vector msra lattic aligninfo align
msra math ssematrixbas log l ls vector alignoffset
vector backptrstorag vector size backptroffset
vector alignresult vector edgeacscor

todo thi determin parallel layout
size numedg edg size
dim3
size
dim3 numedg
emulatecuda

edgealignmentj hmm tran ps spalignunitid silalignunitid node edg align log l ls alignoffset backptrstorag backptroffset alignresult edgeacscor



emulateforwardbackwardlattic size batchsizeforward size batchsizebackward
size numlaunchforward size numlaunchbackward
size spalignunitid size silalignunitid
vector edgeacscor
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector msra lattic aligninfo align
vector align vector alignoffset
vector logpp vector logalpha vector logbeta
boostingfactor return eframescorrect
vector uid vector senone2classmap
vector logaccalpha vector logaccbeta vector logframescorrectedg
vector log eframescorrect vector eframescorrectbuf log eframescorrecttot

eframescorrectbuf todo remov hansu
dim3
size
dim3 logalpha size
emulatecuda

setvaluej logalpha logzero logalpha size

emulatecuda

setvaluej logbeta logzero logbeta size

emulatecuda

setvaluej logaccalpha logzero logaccalpha size

emulatecuda

setvaluej logaccbeta logzero logaccbeta size


logalpha front
logbeta node size

forward

size startindex
size numlaunchforward

dim3 batchsizeforward
emulatecuda

forwardlatticej batchsizeforward startindex edgeacscor spalignunitid silalignunitid edg node align align alignoffset
logalpha boostingfactor uid senone2classmap return eframescorrect logframescorrectedg logaccalpha

startindex batchsizeforward

totalfwscor logalpha node size
totalfwacc
return eframescorrect

totalfwacc logaccalpha node size
totalfwacc totalfwscor


backward
startindex edg size
size numlaunchbackward

dim3 batchsizebackward
emulatecuda

backwardlatticej batchsizebackward startindex batchsizebackward edgeacscor
spalignunitid silalignunitid edg node align
totalfwscor logpp logalpha logbeta boostingfactor
return eframescorrect logframescorrectedg logaccalpha log eframescorrect logaccbeta

startindex batchsizebackward

totalbwscor logbeta front
return eframescorrect
log eframescorrecttot logaccbeta front totalbwscor

check match
difffwbw totalfwscor totalbwscor
absdifffwbw difffwbw difffwbw difffwbw

absdifffwbw node size
fprintf stderr forwardbackward warn lattic score node edg totalfwscor totalbwscor node size edg size

totalfwscor

behav cuda conterpart take side vector everyth
must ident cuda kernel launch input type vectorref vector
emul mb rerrorsign vector alignstateid vector alignoffset
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector logpp
vector log eframescorrect log eframescorrecttot
msra math ssematrixbas errorsign msra math ssematrixbas errorsignalneg


size numedg edg size
dim3
size
coord errorsign
errorsign errorsignalneg logzero
dim3 numedg
emulatecuda

s mb rerrorsignalj alignstateid alignoffset edg node logpp log eframescorrect log eframescorrecttot errorsign errorsignalneg

dim3 errorsign row
emulatecuda

errorcomputationi errorsign errorsignalneg



behav cuda conterpart take side vector everyth
must ident cuda kernel launch input type vectorref vector
emulatemmierrorsign vector alignstateid vector alignoffset
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector logpp msra math ssematrixbas errorsign

size numedg edg size
dim3
size
coord errorsign
errorsign logzero
dim3 numedg
emulatecuda

stateposteriorsj alignstateid alignoffset edg node logpp errorsign

coord errorsign
errorsign expf errorsign


behav cuda conterpart take side vector everyth
must ident cuda kernel launch input type vectorref vector
emulatestateposterior vector alignstateid vector alignoffset
vector msra lattic edgeinfowithscor edg vector msra lattic nodeinfo node
vector logq msra math ssematrixbas logacc

coord logacc
logacc logzero
size numedg edg size
dim3
size
dim3 numedg
emulatecuda

stateposteriorsj alignstateid alignoffset edg node logq logacc




parallelst impl hold variabl cuda access


parallelstateimpl

emul
size deviceid
parallelstateimpl size deviceid
deviceid deviceid emul chang emul
model
lr3tran pgpu msra cuda newlr3tran pvector deviceid
hmmsgpu msra cuda newlrhmmdefvector deviceid
spalignunitid size
silalignunitid size
current lattic log l ls valu
edgesgpu msra cuda newedgeinfovector deviceid
nodesgpu msra cuda newnodeinfovector deviceid
aligngpu msra cuda newaligninfovector deviceid
alignresult msra cuda newushortvector deviceid
alignoffsetsgpu msra cuda newuintvector deviceid
edgeacscoresgpu msra cuda newfloatvector deviceid
cudalog l ls microsoft cntk matrix deviceid
logppsgpu msra cuda newdoublevector deviceid
logalphasgpu msra cuda newdoublevector deviceid
logbetasgpu msra cuda newdoublevector deviceid
logaccalphasgpu msra cuda newdoublevector deviceid
logaccbetasgpu msra cuda newdoublevector deviceid
logframescorrectedgegpu msra cuda newdoublevector deviceid
eframescorrectbufgpu msra cuda newdoublevector deviceid
log eframescorrectgpu msra cuda newdoublevector deviceid
uidsgpu msra cuda newushortvector deviceid
senone2classmapgpu msra cuda newushortvector deviceid
errorsignalgpu microsoft cntk matrix deviceid
errorsignalneggpu microsoft cntk matrix deviceid
errorsignalgpustorag microsoft cntk matrix deviceid
errorsignalneggpustorag microsoft cntk matrix deviceid
backptrstoragegpu msra cuda newushortvector deviceid
backptroffsetsgpu msra cuda newsizetvector deviceid



size getdevic

deviceid


model

uniqu lr3tran pvector lr3tran pgpu
uniqu lrhmmdefvector hmmsgpu

lr3tran pvector lr3tran pgpu
lrhmmdefvector hmmsgpu
size spalignunitid
size silalignunitid
model emul
vector msra lattic lrhmmdef hmmscpuforgpu
vector lr3tran p lr3tran pcpuforgpu
vector senone2classmapcpuforgpu

cach model
lr3tran p unexpect size lr3tran p
tood give proper name
lrhmmdef unexpect size lrhmmdef
cachehset msra simplesenonehmm hset mbrclassdefinit mbrclassdef

copi
todo cach check whether differ model pass
lr3tran pgpu size
logic error cachehset cannot bind multipl model set

tran ps
lr3tran pcpuforgpu resiz hset tran ps size
vector msra simplesenonehmm tran p tran ps hset tran ps
spalignunitid hset gethmmid
silalignunitid hset gethmmid

index tran ps

size numstat tran ps getnumst

lr3tran pcpuforgpu numstat numstat
numstat


numstat

lr3tran pcpuforgpu loga tran ps




lr3tran pgpu assign lr3tran pcpuforgpu

mbrclassdef monophon

sphmm hset gethmm spalignunitid
silhmm hset gethmm silalignunitid
size numsenon hset getnumsenon
senone2classmapcpuforgpu resiz numsenon
size numsenon

hset statebelongstohmm sphmm hset statebelongstohmm silhmm
senone2classmapcpuforgpu silhmm tran pindex

senone2classmapcpuforgpu hset senonetran p

senone2classmapgpu assign senone2classmapcpuforgpu


mbrclassdefinit senon map

def
hmmscpuforgpu resiz hset hmm size
vector msra simplesenonehmm hmm hset hmm
index hmmscpuforgpu

hmmscpuforgpu numstat hmm getnumst
hmmscpuforgpu numstat hmm getnumst
logic error parallelforwardbackwardalign hmm numstat rang

size hmmscpuforgpu numstat

hmmscpuforgpu senoneid hmm getsenoneid
hmmscpuforgpu senoneid hmm getsenoneid
logic error parallelforwardbackwardalign hmm numstat rang


hmmscpuforgpu tran pindex hmm gettran pindex
hmmscpuforgpu tran pindex hmm gettran pindex
logic error parallelforwardbackwardalign hmm tran pindex rang

hmmsgpu assign hmmscpuforgpu sync need sync free memori right much async

emul side copi save memori
emul

lr3tran pcpuforgpu clear
senone2classmapcpuforgpu clear
hmmscpuforgpu clear

ifdef forbid invalid path
fprintf stderr forbid invalid path hansu might inappropri conveni


check model right
validatehset msra simplesenonehmm hset

hmmsgpu size hset hmm size lr3tran pgpu size hset tran ps size
logic error validatehset bound hset wrong hset


current lattic
uniqu edgeinfowithscoresvector edgesgpu
uniqu nodeinfovector nodesgpu
uniqu aligninfovector aligngpu
uniqu ushortvector alignresult concaten align edg align start offset alignoffset
uniqu msra cuda uintvector alignoffsetsgpu
uniqu floatvector edgeacscoresgpu
uniqu microsoft cntk matrix cudalog l ls

uniqu doublevector logppsgpu
uniqu doublevector logalphasgpu
uniqu doublevector logbetasgpu
uniqu doublevector logaccalphasgpu
uniqu doublevector logaccbetasgpu

uniqu doublevector logframescorrectedgegpu
uniqu doublevector eframescorrectbufgpu
uniqu doublevector log eframescorrectgpu

uniqu ushortvector backptrstoragegpu
uniqu sizetvector backptroffsetsgpu

uniqu ushortvector uidsgpu
uniqu ushortvector senone2classmapgpu

uniqu microsoft cntk matrix errorsignalgpustorag
uniqu microsoft cntk matrix errorsignalneggpustorag
uniqu microsoft cntk matrix errorsignalgpu
uniqu microsoft cntk matrix errorsignalneggpu

cach current lattic
thi weird lattic
edgestyp nodestyp aligntyp edgealign backpoint
setutterancedata edgestyp edg nodestyp node aligntyp align
msra math ssematrixbas log l ls vector edgeacscor
edgealign edg align backpoint back pointer

lattic
edgesgpu assign edg
nodesgpu assign node
aligngpu assign align
alignoffsetsgpu assign edg align getalignoffset
backptrstoragegpu alloc back pointer getbackptrstorages
backptroffsetsgpu assign back pointer getbackptroffset

ifndef parallel
alignresult assign edg align getalignmentsbuff
edgeacscoresgpu assign edgeacscor

alignresult alloc edg align getalignbuffers
edgeacscoresgpu alloc edg size
edgeacscor refer make compilor happi



zhaorui
cudalog l ls alloc log l ls row log l ls col
cudalog l ls assign log l ls row log l ls col log l ls log l ls getcolstrid last measur time better mayb remov later

elem type
setlogl microsoft cntk matrix logll

cudalog l ls set valu logll

getgamma microsoft cntk matrix logll

logll set valu errorsignalgpu

edgealign
copyalign edgealign edg align

alignresult fetch edg align getalignmentsbuff


hansu alloc memori vector relat forward backward
allocateaccvector impli eframecorrect
edgestyp nodestyp
allocfwbwvector edgestyp edg nodestyp node vector uid
allocateframescorrect copyuid allocateaccvector

logppsgpu alloc edg size
ifndef channel
size alphabetanoderatio

size alphabetanoderatio

logalphasgpu alloc alphabetanoderatio node size
logbetasgpu alloc alphabetanoderatio node size

allocateframescorrect
logframescorrectedgegpu alloc edg size

copyuid
uidsgpu assign uid

allocateaccvector

logaccalphasgpu alloc alphabetanoderatio node size
logaccbetasgpu alloc alphabetanoderatio node size

eframescorrectbufgpu alloc edg size
log eframescorrectgpu alloc edg size



check gpumatrixstorag support size cpumatrix alloc gpumatrix part gpumatrixstorag
thi check size errorsignalgpustorag set errorsignalgpu columnslic
result encompas entir matrix becaus view underli storag
errorsignalgpustorag must clear errorsignalgpu resiz errorsignalgpustorag after resiz
reset errorsignalgpu result
cacheerrorsign msra math ssematrixbas errorsign cacheerrsignalneg

errorsignalgpustorag get num row errorsignalgpustorag get num row errorsign row
logic error gpumatrixstorag row shall alloc
errorsignalgpustorag get num col errorsign col

note thi requir otherwis errorsignalgpustorag view storag
errorsignalgpustorag thuse resiz thi perhap optim
matric exist
errorsignalgpu nullptr
errorsignalgpustorag resiz errorsign row errorsign col

errorsignalgpu make uniqu microsoft cntk matrix errorsignalgpustorag column slice errorsign col

cacheerrsignalneg

errorsignalneggpustorag get num row errorsignalneggpustorag get num row errorsign row
logic error gpumatrixstorag row shall alloc
errorsignalneggpustorag get num col errorsign col

same
errorsignalneggpu nullptr
errorsignalneggpustorag resiz errorsign row errorsign col

errorsignalneggpu make uniqu microsoft cntk matrix errorsignalneggpustorag column slice errorsign col



getedgeacscor vector edgeacscor

edgeacscor resiz edgeacscoresgpu size
edgeacscoresgpu fetch edgeacscor


getedgealign vector edgealign

edgealign resiz alignresult size
alignresult fetch edgealign



lattic parallelst setdevic size deviceid

pcpumod deviceid cpudevic
pcpumod

pimpl parallelstateimpl deviceid



pimpl
pimpl

leav


size lattic parallelst getdevic

pimpl getdevic


lattic parallelst releas pcpumod

pcpumod

pimpl

pimpl
pimpl



lattic parallelst parallelst

pimpl nullptr

lattic parallelst parallelst

pimpl

lattic parallelst entercomput msra simplesenonehmm hset mbrclassdefinit mbrclassdef

pimpl cachehset hset mbrclassdef
model todo rethink name
lattic parallelst copyalign edgealign edgealign

pimpl copyalign edgealign

size lattic parallelst getsilunitid

pimpl silalignunitid

lattic parallelst getedgeacscor vector edgeacscor

pimpl getedgeacscor edgeacscor

lattic parallelst getedgealign vector edgealign

pimpl getedgealign edgealign

elem type
lattic parallelst setlogl microsoft cntk matrix logll

pimpl setlogl logll


todo overload enabl compil doubl precis though current unsupport
lattic parallelst setlogl microsoft cntk matrix logll

logic error doubl precis support sequenc train


lattic parallelst getgamma microsoft cntk matrix logll

pimpl getgamma logll


todo overload enabl compil doubl precis though current unsupport
lattic parallelst getgamma microsoft cntk matrix logll

logic error doubl precis support sequenc train



parallel implement process step


parallelforwardbackwardalign comput statelevel gamma viterbi align
lattic parallelforwardbackwardalign parallelst parallelst
msra simplesenonehmm hset msra math ssematrixbas log l ls
vector edgeacscor edgealign edgealign backpoint backpoint

parallelst validatehset hset model correctli cach alreadi

parallelst emul

move lattic
parallelst setutterancedata edg node align log l ls input
edgeacscor edgealign backpoint inout

launch kernel
uniqu latticefunct latticefunct msra cuda newlatticefunct parallelst getdevic
latticefunct edgealign parallelst hmmsgpu parallelst lr3tran pgpu
parallelst spalignunitid parallelst silalignunitid
parallelst cudalog l ls parallelst nodesgpu
parallelst edgesgpu parallelst aligngpu
parallelst alignoffsetsgpu
parallelst backptrstoragegpu parallelst backptroffsetsgpu
parallelst alignresult parallelst edgeacscoresgpu



parallelst hmmscpuforgpu size
logic error longer support emul edgealign pleas copi hmmscpuforgpu lr3tran pcpuforgpu want
edgeacscor resiz edg size
emulateedgealign parallelst hmmscpuforgpu parallelst lr3tran pcpuforgpu parallelst spalignunitid
parallelst silalignunitid
node edg align log l ls edgealign getalignoffset
backpoint getbackptrbuff backpoint getbackptroffset
edgealign getalignmentsbuff edgeacscor
emul version save result back
parallelst alignresult assign edgealign getalignmentsbuff
parallelst edgeacscoresgpu assign edgeacscor



parallelforwardbackwardlattic comput latticelevel logpp forwardbackward
lattic parallelforwardbackwardlattic parallelst parallelst vector edgeacscor
edgealign thisedgealign
boostingfactor vector logpp
vector logalpha vector logbeta return eframescorrect
size uid vector log eframescorrect
vector eframescorrectbuf log eframescorrecttot
todo remov
vector size batchsizeforward record batch size exclud depend forward
vector size batchsizebackward record batch size exclud depend backward

size endindexforward edg
size countbatchforward

size endindexbackward edg back
size countbatchbackward
index edg comput batch size info kernel launch

edg endindexforward
countbatchforward note check forward order node assur


batchsizeforward push back countbatchforward
countbatchforward
endindexforward edg

size backj edg size
edg backj endindexbackward

countbatchbackward
endindexbackward edg backj
endindexbackward edg backj



batchsizebackward push back countbatchbackward
countbatchbackward
endindexbackward edg backj


batchsizeforward push back countbatchforward
batchsizebackward push back countbatchbackward

vector uidsuint uid size actual shall take much time leav
index uidsuint
uidsuint uid

totalfwscor
parallelst emul

verbos
fprintf stderr parallelforwardbackwardlattic launch forward launch backward batchsizeforward size batchsizebackward size

allocateframescorrect return eframescorrect boostingfactor
copyuid return eframescorrect boostingfactor
allocateaccvector return eframescorrect
parallelst allocfwbwvector edg node uidsuint allocateframescorrect copyuid allocateaccvector

uniqu latticefunct latticefunct msra cuda newlatticefunct parallelst getdevic cuda call
latticefunct forwardbackwardlattic batchsizeforward batchsizebackward batchsizeforward size batchsizebackward size
parallelst spalignunitid parallelst silalignunitid
parallelst edgeacscoresgpu parallelst edgesgpu
parallelst nodesgpu parallelst aligngpu
parallelst alignresult parallelst alignoffsetsgpu
parallelst logppsgpu parallelst logalphasgpu
parallelst logbetasgpu boostingfactor
return eframescorrect parallelst uidsgpu parallelst senone2classmapgpu
parallelst logaccalphasgpu parallelst logaccbetasgpu
parallelst logframescorrectedgegpu parallelst log eframescorrectgpu
parallelst eframescorrectbufgpu log eframescorrecttot totalfwscor

emul

ifndef channel
fprintf stderr forbid invalid path
size alphabetanoderatio

size alphabetanoderatio

logpp resiz edg size
logalpha resiz alphabetanoderatio node size
logbeta resiz alphabetanoderatio node size

vector logaccalpha
vector logaccbeta
vector logframescorrectedg
logframescorrectedg resiz edg size

return eframescorrect

logaccalpha resiz alphabetanoderatio node size
logaccbeta resiz alphabetanoderatio node size

log eframescorrect resiz edg size
eframescorrectbuf resiz edg size


totalfwscor emulateforwardbackwardlattic batchsizeforward batchsizebackward
batchsizeforward size batchsizebackward size
parallelst spalignunitid parallelst silalignunitid
edgeacscor edg node align
thisedgealign getalignmentsbuff thisedgealign getalignoffset
logpp logalpha logbeta boostingfactor return eframescorrect uidsuint parallelst senone2classmapcpuforgpu
logaccalpha logaccbeta logframescorrectedg log eframescorrect eframescorrectbuf log eframescorrecttot

totalfwscor



parallel implement s mbr error updat step

lattic parallel mb rerrorsign parallelst parallelst edgealign thisedgealign
vector logpp vector log eframescorrect
log eframescorrecttot msra math ssematrixbas errorsign msra math ssematrixbas errorsignalneg

time measur cuda
cudaerrorcopyto 058592
cudaerrorsignalsync 356998
cudaerrorcopyback 983703

time measur emul
emuresettozero 979899
emuerrorsign 407459

parallelst emul

alloc buffer
cacheerrorsignalneg
parallelst cacheerrorsign errorsign cacheerrorsignalneg

uniqu latticefunct latticefunct msra cuda newlatticefunct parallelst getdevic
latticefunct s mb rerrorsign parallelst alignresult parallelst alignoffsetsgpu parallelst edgesgpu
parallelst nodesgpu parallelst logppsgpu parallelst log eframescorrectgpu
log eframescorrecttot
parallelst errorsignalgpu parallelst errorsignalneggpu

errorsign row errorsign col

parallelst errorsignalgpu copi section errorsign row errorsign col errorsign errorsign getcolstrid




emul mb rerrorsign thisedgealign getalignmentsbuff thisedgealign getalignoffset edg node logpp log eframescorrect log eframescorrecttot errorsign errorsignalneg




parallel implement error updat step

lattic parallelmmierrorsign parallelst parallelst edgealign thisedgealign
vector logpp msra math ssematrixbas errorsign

parallelst emul

cacheerrorsignalneg need mode
parallelst cacheerrorsign errorsign cacheerrorsignalneg

uniqu latticefunct latticefunct msra cuda newlatticefunct parallelst getdevic
latticefunct mmierrorsign parallelst alignresult parallelst alignoffsetsgpu parallelst edgesgpu
parallelst nodesgpu parallelst logppsgpu parallelst errorsignalgpu

parallelst errorsignalgpu fetch errorsign row errorsign col errorsign errorsign getcolstrid



emulatemmierrorsign thisedgealign getalignmentsbuff thisedgealign getalignoffset edg node logpp errorsign




latticearch manag lattic archiv

seid hansu

ifndef secur warn
defin secur warn secur avail platform file give variabl warn


basic
simpl array
latticearch
simplesenonehmm model
ssematrix matric
latticestorag
unord

stdexcept



defin virginlogzero logzero use print statist unseen state
verif

ifdef win32
msra numa node numahelp


msra lattic


helper alloc lot small matric free


littlematrixheap

size chunksiz
msra math ssematrixfrombuff matrixfrombuff
vector heap
size allocatedinlast last heap element
size totalalloc
vector matrixfrombuff matric


littlematrixheap size estimatednumentri
totalalloc allocatedinlast

matric reserv estimatednumentri

msra math ssematrixbas newmatrix size row size col

size elementsneed matrixfrombuff elementsneed row col
heap heap back size allocatedinlast elementsneed

size nelem chunksiz elementsneed align
heap push back vector nelem
allocatedinlast
make sure start element align demand
size offelem size heap back allocatedinlast
offelem
allocatedinlast offelem

buffer heap back
elementsneed heap back size allocatedinlast
logic error newmatrix alloc logic screw
buffer handi vector like thingi
vecbuff buffer allocatedinlast elementsneed
alloc current heap locat
matric resiz matric size
matric size matric capac
logic error newmatrix littlematrixheap cannot grow construct small eement
matrix matric back
matrix matrixfrombuff vecbuff row col
allocatedinlast elementsneed
totalalloc elementsneed
matrix



size littlematrixheap chunksiz 1024


helper domain addit


ifndef logzero
defin logzero 1e30f


logadd loga logb loga loga logb
logaddratio loga diff

diff
mantissa 24th
loga logf expf diff

logaddratio loga diff

diff
mantissa 53th
loga diff

loga loga logb loga logb loga loga logb loga
float
logadd float loga float logb

logb loga smaller bigger
swap loga logb
loga logzero

logaddratio loga logb loga

float
logmax float loga float logb test approx

logb loga
loga logb


float
float expdiff float float test







float
islogzero float

logzero
consid


helper


helper reconstruct phonet transcript
lattic gettranscript aligninfo unit msra simplesenonehmm hset

tran
index unit exploit unit boundari


tran push back
tran append hset gethmm unit unit getnam

tran



forwardbackwardedg perform state level forward backward singl lattic edg

result
gamma valid time rang remain area initi
valu edg acoust score
gamma matrix must extra column buffer


lattic forwardbackwardedg aligninfo unit msra simplesenonehmm hset msra math ssematrixbas log l ls
msra math ssematrixbas loggamma size edgeindex

alpha beta store place insid loggamma matrix shift column
loggamma col log l ls col
msra math ssematrixstriperef msra math ssematrixbas logalpha loggamma log l ls col shift view gamma alpha beta
msra math ssematrixstriperef msra math ssematrixbas logbeta loggamma log l ls col

alpha store path includ state time includ log ll
beta store path exit state time includ log ll
gamma alpha beta total ll

backward token pass
size logbeta col
size logbeta row
bwscore backward score
size unit size

hset gethmm unit unit
size getnumst
tran p gettran p
size unit frame time current unit
size rang state indic

transit score
transit last frame transit
exitscor 1e30f someth imposs
transit

exitscor bwscore tran p

expand last state

size possibl

size origin trelli node
logbeta bwscore tran p



expand state time includ time
size note cannot test possibl

size

size sourc trelli node
size getsenoneid senon state posit
ac ll log l ls
islogzero ac ll
fprintf stderr forwardbackwardedg warn edg unit frame score zero
edgeindex getnam

logbeta row logbeta col gettranscript unit hset
betajt logbeta path exit
betajtpl betajt ac ll incorpor acoust score

size transit entri state

size target trelli node
pathscor betajtpl tran p

logbeta propag preced frame pathscor

logadd logbeta propag preced frame pathscor

transit entri state

pathscor betajtpl tran p

exitscor pathscor

logadd exitscor pathscor propag preced unit




bwscore exitscor
islogzero bwscore
fprintf stderr forwardbackwardedg warn edg unit frame score zero
edgeindex getnam logbeta row logbeta col gettranscript unit hset





totalbwscor bwscore

forward regular viterbi
thi also comput gamma right away
size start frame unit
size first index unit
fwscore score pass across phone boundari
index unit exploit unit boundari

hset gethmm unit unit
size getnumst
tran p gettran p
size unit frame time current unit
size rang state indic

expand state time includ time
size note enter frame unit tee

size

size target trelli node
size getsenoneid
ac ll log l ls
alphajtnol logzero
enter score

pathscor fwscore tran p
alphajtnol pathscor


size enter possibl

size origin trelli node
alphaitm1 logalpha previou frame
pathscor alphaitm1 tran p
logadd alphajtnol pathscor

logalpha alphajtnol ac ll

updat gamma frame beta overwritten alpha share memori
size

islogzero totalbwscor
loggamma logalpha logbeta totalbwscor
problem occur score go softmax
loggamma logzero


transit last frame transit
exitscor
transit

exitscor fwscore tran p

expand last state

exitscor logzero
size possibl

size origin trelli node
alphaitm1 logalpha newli comput path score transit
pathscor alphaitm1 tran p
logadd exitscor pathscor


fwscore exitscor score pass unit



logalpha row logalpha col
totalfwscor fwscore

extrem case prob lead path score divis subtract logzero
these case must handl separ whole path prob path point skip lattic
islogzero totalbwscor islogzero totalfwscor
fprintf stderr forwardbackwardedg warn edg score
edgeindex totalfwscor totalbwscor gettranscript unit hset
islogzero totalbwscor

fprintf stderr forwardbackwardedg warn edg zero score
edgeindex gettranscript unit hset
logzero


fabsf totalfwscor totalbwscor
fprintf stderr forwardbackwardedg warn edg score
edgeindex totalfwscor totalbwscor gettranscript unit hset

full path score
totalfwscor



alignedg perform viterbi align singl edg

thi altern forwardbackwardedg use best path
result
returnsenoneid binari gamma valid time rang remain area initi compat
returnsenoneid loggamma contain senon directli instead s mbr mode
valu edg acoust score
gamma matrix must extra column buffer


lattic alignedg aligninfo unit msra simplesenonehmm hset msra math ssematrixbas log l ls
msra math ssematrixbas loggamma size edgeindex diagnost messag returnsenoneid
thisedgealignmentsj

alpha beta store place insid loggamma matrix shift column
loggamma col log l ls col
msra math ssematrixstriperef msra math ssematrixbas backpoint loggamma log l ls col
msra math ssematrixstriperef msra math ssematrixbas pathscor loggamma log l ls col

pathscor store path includ state time includ log ll
backpoint rel state came
gamma best path otherwis

invalidbp

viterbi align
size start frame unit
size first index unit
fwscore score pass across phone boundari
fwbackpoint pass across phone boundari mean start utter
index unit exploit unit boundari

hset gethmm unit unit
size getnumst
tran p gettran p
size unit frame time current unit
size getnumst rang state indic

expand state time includ time
size note enter frame unit tee

size

size rel state
size getsenoneid
pathscor logzero
backpoint invalidbp
enter score

pathscor fwscore tran p
pathscor pathscor
backpoint fwbackpoint


size

size
alphaitm1 pathscor previou frame
pathscor alphaitm1 tran p
pathscor pathscor

pathscor pathscor
backpoint


ac ll log l ls
pathscor ac ll


transit last frame transit
exitscor logzero
exitbackpoint invalidbp
transit

exitscor fwscore tran p
exitbackpoint fwbackpoint

expand last state

size

size
alphaitm1 pathscor newli comput path score transit
pathscor alphaitm1 tran p
pathscor exitscor

exitscor pathscor
exitbackpoint



exitbackpoint invalidbp
logic error exitbackpoint came
fwscore exitscor score pass unit
fwbackpoint exitbackpoint accompani backpoint



pathscor row pathscor col

extrem case prob lead path score divis subtract logzero
these case must handl separ whole path prob path point skip lattic
islogzero fwscore

fprintf stderr alignedg warn edg zero score
edgeindex gettranscript unit hset
logzero


traceback gamma updat
size backpoint col
size backpoint row
fwbackpoint
size unit size unit also need clear column

hset gethmm unit unit
size unit frame time current unit
size getnumst rang state indic
size


logic error invalid backpoint result state index rang

backpoint save backpoint overwrit gamma backpoint alias
thisedgealignmentsj getsenoneid
returnsenoneid binari gamma mode compat softalignmod
size
loggamma logzero
senon s mbr note compat softalignmod call code must know
thisedgealignmentsj getsenoneid

invalidbp
logic error deltabackpoint initi
trace back step






logic error invalid backpoint result reach start utter trace back


full path score
fwscore



forwardbackwardlattic lattic level forward backward

thi comput word posterior also return node alpha beta
edg acoust score pass
intend multipl place differ score
specif also determin prune threshold base
origin lattic score even bother comput
score


lattic forwardbackwardlattic vector edgeacscor parallelst parallelst vector logpp
vector logalpha vector logbeta
boostingfactor s mb rmode
size uid edgealign thisedgealign
vector log eframescorrect vector eframescorrectbuf log eframescorrecttot
todo remov
hand parallel cuda implement avail
parallelst enabl

totalfwscor parallelforwardbackwardlattic parallelst edgeacscor thisedgealign boostingfactor logpp logalpha logbeta s mb rmode uid log eframescorrect eframescorrectbuf log eframescorrecttot

totalfwscor

cuda good

alloc valu
logpp resiz edg size primari valu

todo valu well realli anymor use older baselin code want compar
logalpha assign node size logzero
logalpha front
logbeta assign node size logzero
logbeta back

s mbr version

s mb rmode

log eframescorrect resiz edg size
eframescorrectbuf resiz edg size

vector logaccalpha node size logzero expect frame correct count path start node
vector logaccbeta node size logzero likewis
vector logframescorrectedg edg size count correct frame edg

forward
index edg

islogzero edgeacscor indic edg prune

edg
inscor logalpha
edgescor edgeacscor
pathscor inscor edgescor
logadd logalpha pathscor

size node
size node
size framescorrect count correct frame
size
framescorrect thisedgealign uid
logframescorrectedg framescorrect framescorrect logzero rememb backward
loginacc logaccalpha logalpha
logadd loginacc logframescorrectedg
logpathacc loginacc logalpha edgescor
logadd logaccalpha logpathacc

index logaccalpha
logaccalpha logalpha

totalfwscor logalpha back
totalfwacc logaccalpha back
islogzero totalfwscor

fprintf stderr forwardbackward warn path found lattic node edg node size edg size
logzero fail result matrix


backward comput state condit frame correct count
size edg size

islogzero edgeacscor indic edg prune

edg
inscor logbeta
edgescor edgeacscor
pathscor inscor edgescor
logadd logbeta pathscor

loginacc logaccbeta logbeta
logadd loginacc logframescorrectedg
logpathacc loginacc logbeta edgescor
logadd logaccbeta logpathacc

expect frame correct count state edg sinc assum hard state align
logpp logalpha edgescor logbeta totalfwscor
logpp
fprintf stderr forwardbackward warn edg posterior logpp
logpp
logpp
logpp logpp
tmplogeframecorrect logframescorrectedg
logadd tmplogeframecorrect logaccalpha
logadd tmplogeframecorrect logaccbeta logbeta
eframescorrectbuf tmplogeframecorrect

index logaccbeta
logaccbeta logbeta
totalbwscor logbeta front
totalbwacc logaccbeta front
fab totalfwscor totalbwscor info numfram
fprintf stderr forwardbackward warn lattic score node edg totalfwscor totalbwscor node size edg size

fab totalfwacc totalbwacc info numfram
fprintf stderr forwardbackwardlattic mbr warn lattic acc node edg totalfwacc totalbwacc node size edg size

log eframescorrecttot totalbwacc
totalbwscor


version

forward
index edg

edg
inscor logalpha
edgescor edgeacscor note edgeacscor logzero edg prune
pathscor inscor edgescor
logadd logalpha pathscor

totalfwscor logalpha back
islogzero totalfwscor

fprintf stderr forwardbackward warn path found lattic node edg node size edg size
logzero fail result matrix


backward
also comput word posterior sinc
size edg size

edg
inscor logbeta
edgescor edgeacscor
pathscor inscor edgescor
logadd logbeta pathscor

comput lattic posterior sinc
logpp logalpha edgescor logbeta totalfwscor
logpp
fprintf stderr forwardbackward warn edg posterior logpp
logpp
logpp
logpp logpp


totalbwscor logbeta front
fab totalfwscor totalbwscor info numfram
fprintf stderr forwardbackward warn lattic score node edg totalfwscor totalbwscor node size edg size

totalfwscor



forwardbackwardlattic mbr comput expect frame accuraci count
condit correspond povey thesi
s mbr criterion optim

output
eframescorrect expect frame correct count condit state edg
current assum hard state align with valu turn
ident state edg store edg
valu expect frame correct count entir lattic

call forwardbackwardlattic first comput logalpha beta


lattic forwardbackwardlattic mbr vector edgeacscor msra simplesenonehmm hset
vector logalpha vector logbeta
size uid
edgealign thisedgealign vector eframescorrect

vector accalpha node size expect frame correct count path start node
vector accbeta node size likewis
vector size maxcorrect node size correct frame node oracl

vector framescorrectedg edg size count correct frame edg

vector backpointersformaxcorr node size keep track backpoint corr
backpointersformaxcorr front

forward
index edg

islogzero edgeacscor indic edg prune

edg
inacc accalpha
size node
size node

size framescorrect count correct frame
size
framescorrect thisedgealign uid
framescorrectedg framescorrect rememb backward

edgescor edgeacscor
contribut node path start node plu edg correct count weight divid
pathacc inacc framescorrectedg logalpha edgescor logalpha
accalpha pathacc
also keep track accuraci find whether lattic contain correct path
size oracleframescorrect maxcorrect framescorrect keep track correct path edg
oracleframescorrect maxcorrect

maxcorrect oracleframescorrect
backpointersformaxcorr size


totalfwacc accalpha back

hset refer

report ground truth path
todo later code add path need
size oracleframeacc maxcorrect back
oracleframeacc info numfram
fprintf stderr forwardbackwardlattic mbr ground truth path miss lattic correct path frame correct oracleframeacc info numfram

backward comput state condit frame correct count
size edg size

islogzero edgeacscor indic edg prune

edg
inacc accbeta
edgescor edgeacscor
pathacc inacc framescorrectedg logbeta edgescor logbeta
accbeta pathacc

expect frame correct count state edg sinc assum hard state align
eframescorrect accalpha accbeta framescorrectedg


totalbwacc accbeta front

fab totalfwacc totalbwacc info numfram
fprintf stderr forwardbackwardlattic mbr warn lattic acc node edg totalfwacc totalbwacc node size edg size

totalbwacc



bestpathlattic lattic level forward backward return
best path form word posterior like
real lattic level forward backward would
realli contrast experi


lattic bestpathlattic vector edgeacscor vector logpp


forward sortned regular viterbi
vector logalpha node size logzero
vector backpoint node size
logalpha front
backpoint front
index edg

edg
inscor logalpha
edgescor edgeacscor note edgeacscor logzero edg prune
pathscor inscor edgescor
pathscor logalpha

logalpha pathscor
backpoint



totalfwscor logalpha back
islogzero totalfwscor

fprintf stderr bestpathlattic warn path found lattic node edg node size edg size
logzero fail result matrix


traceback
encod result store edg best path
make natur compat softalign mode
logpp resiz edg size
index edg
logpp logzero

backpo backpoint node size
backpo

logpp backpo edg best path
backpo backpoint edg backpo

backpo

totalfwscor



forwardbackwardalign comput statelevel gamma viterbi align
first phase lattic forwardbackward

output

lattic forwardbackwardalign parallelst parallelst
msra simplesenonehmm hset softalignst
minlogpp vector origlogpp
vector msra math ssematrixbas abc littlematrixheap matrixheap
returnsenoneid
vector edgeacscor msra math ssematrixbas log l ls
edgealign thisedgealign backpoint thisbackpoint size uid size bound
note remov replac proper represent align someday
forward backward align edg basi thi give
edg gamma edg forwardbackward edg align thisedgealign align
edg acoust score
size silunitid hset gethmmid shall parallelst getsilunitid
parallelsil
cpuverif

ifndef parallel defin make mark
parallelsil

ifdef verif
cpuverif


phase abc alloc
parallelst enabl parallelsil cpuverif alloc abc parallelst enabl mode enabl parallel silenc need alloc cpuverf

abc resiz edg size edg index alpha beta gamma matric edg
size countskip prune count mani edg prune

index edg

determin frame
todo effici block diagon like structur rest exploit boundari
size edgefram node edg node edg
edgefram dummi edg lattic

size edg size
runtim error forwardbackwardalign unxpect frame edg allow
note abc alreadi initi protect accident



determin state edg
aligntoken getaligninfo align token
size edgest

edgehassil
index aligntoken
aligntoken unit silunitid
edgehassil

cpuverif edgehassil parallelst enabl cpuverif parallel alloc

abc



index aligntoken
edgest hset gethmm aligntoken unit getnumst

alloc matrix
minlogpp logzero origlogpp minlogpp
countskip

abc matrixheap newmatrix edgest edgefram extra column beta gamma


minlogpp logzero
fprintf stderr forwardbackwardalign edg prune countskip edg size


phase align
parallelst enabl parallelsil silenc edg shall process separ cuda parallel

softalignst
logic error forwardbackwardalign parallel version current handl hard align
minlogpp logzero
fprintf stderr forwardbackwardalign prune support need
edgeacscor resiz edg size
size edg size

aligntoken getaligninfo align token
aligntoken size

edgehassil
index aligntoken

aligntoken unit silunitid
edgehassil

edgehassil process

edgeinfowithscor edg
size node
size node
edg l ls msra math ssematrixstriperef msra math ssematrixbas cast msra math ssematrixbas log l ls
edgeacscor alignedg aligntoken hset edg l ls abc thisedgealign



phase align
parallelst enabl
parallelforwardbackwardalign parallelst hset log l ls edgeacscor thisedgealign thisbackpoint

zhaorui align refer
bound size

size framenum bound size

msra math ssematrixbas refabc
size


vector aligninfo refinfo
vector refalign framenum

aligninfo refunit refinfo
refedgealignmentsj refalign framenum

framenum

found phone boundari

framenum bound



make phone unit
size phoneid bound
refunit unit phoneid
refunit frame

size edgest hset gethmm phoneid getnumst
littlematrixheap refmatrixheap abc
refabc refmatrixheap newmatrix edgest
edg l ls msra math ssematrixstriperef msra math ssematrixbas cast msra math ssematrixbas log l ls
align
alignedg aligninfo refunit hset edg l ls refabc refedgealignmentsj



uid size refedgealignmentsj





phase align forwardbackward parallel mode verif

parallelst enabl cpuverif parallel mode verif

edgeacscor resiz edg size
vector edgeacscoresgpu
edgealign thisedgealignmentsgpu thisedgealign
cpuverif

parallelst getedgeacscor edgeacscoresgpu
parallelst copyalign thisedgealignmentsgpu

index edg

edgeinfowithscor edg
size node
size node
dummi edg
edgeacscor


aligntoken getaligninfo align token
edg l ls msra math ssematrixstriperef msra math ssematrixbas cast msra math ssematrixbas log l ls
minlogpp logzero origlogpp minlogpp
edgeacscor logzero kill word level forwardbackward hypothesi
softalignst
edgeacscor forwardbackwardedg aligntoken hset edg l ls abc

edgeacscor alignedg aligntoken hset edg l ls abc returnsenoneid thisedgealign

cpuverif

aligntoken getaligninfo align token
edgehassil
index aligntoken

aligntoken unit silunitid
edgehassil

fab edgeacscor edgeacscoresgpu

fprintf stderr edg edgeacscor edgeacscoresgpu mismatch diff
edgehassil edgeacscor edgeacscoresgpu
edgeacscor edgeacscoresgpu
fprintf stderr aligntoken
index aligntoken
fprintf stderr aligntoken unit
fprintf stderr

size

thisedgealign thisedgealignmentsgpu
fprintf stderr edg time align alignmentgpu mismatch edgehassil thisedgealign thisedgealignmentsgpu






comput error signal s mbr mode
lattic s mb rerrorsign parallelst parallelst
msra math ssematrixbas errorsign msra math ssematrixbas errorsignalneg output
vector logpp
minlogpp vector origlogpp vector log eframescorrect
log eframescorrecttot edgealign thisedgealign

parallelst enabl parallel version

time measur parallel s mb rerrorsign
errorsignalcomput 871935 cuda 711444
minlogpp logzero
fprintf stderr s mb rerrorsign prune support need
parallel mb rerrorsign parallelst thisedgealign logpp log eframescorrect log eframescorrecttot errorsign errorsignalneg



linear mode
coord errorsign
errorsign note actual anyth numgamma
index edg

edg
node node happen dummi edg file

minlogpp logzero origlogpp minlogpp prune


size node
size node

diff log eframescorrect log eframescorrecttot
note contribut state edg senon state
comput without hard align
logpp edg posterior
edgecorrect diff
size

size thisedgealign
errorsign edgecorrect




comput error signal mode
lattic mmierrorsign parallelst parallelst minlogpp vector origlogpp
vector msra math ssematrixbas abc softalignst
vector logpp msra simplesenonehmm hset
edgealign thisedgealign msra math ssematrixbas errorsign

parallelst enabl

minlogpp logzero
fprintf stderr mmierrorsign prune support need
softalignst
logic error mmierrorsign parallel version softalignst mode support
parallelmmierrorsign parallelst thisedgealign logpp errorsign



size errorsign col
size errorsign row
errorsign virginlogzero zero note place log l ls overwritten

size warn hansu check code search comment relat code
index edg

edg
node node happen dummi edg file

minlogpp logzero origlogpp minlogpp prune


aligntoken getaligninfo align token
loggamma abc

edgelog p logpp
islogzero edgelog p prob


accumul edg gamma matrix target posterior
size tedg node
size time index gamma matrix
size state index gamma matrix
index aligntoken exploit unit boundari

unit aligntoken
size unit frame
hset gethmm unit unit todo express
size getnumst
size

size

size tutt tedg time index utter
logsum logzero hansu check code search comment relat code
size

size state index unit matrix
size getsenoneid state index
gammajt loggamma
statelog p edgelog p gammajt
logadd errorsign tutt statelog p





loggamma col loggamma row


check normalized actual english word
also count zero prob
size nonzerost
column errorsign

logsum logzero
errorsign

islogzero errorsign
nonzerost

logadd logsum errorsign
todo count virginlogzero frame

fab logsum errorsign row
fprintf stderr forwardbackward warn overal posterior column logsum

fprintf stderr forwardbackward zero state posterior nonzerost errorsign row errorsign col

convert posterior
coord errorsign
errorsign expf errorsign


comput ground truth score
critic detail consist lattic avoid skew weight
todo need member actual make
lattic scoregroundtruth size uid htkmlfwordsequ word transcript vector transcriptunigram
msra math ssematrixbas log l ls msra simplesenonehmm hset

transcript firstfram todo store frame instead then valid total durat
logic error scoregroundtruth first transcript token start frame

silenc model sinc treat special
size numfram log l ls col
hset gethmm hset gethmmid
hset gethmm hset gethmmid
numstat numstat
runtim error scoregroundtruth support state state tie
size silst senoneid

word
pathscor
index transcript

size transcript firstfram
size size transcript size transcript firstfram numfram

logic error scoregroundtruth transcript token order
acoust score frame
msra simplesenonehmm tran p prevtran p previou tran p
prev previou state index
size

size senoneid uid
recov tran p state index

msra simplesenonehmm tran p tran p
senoneid silst

prevtran p gettran p silst tie thu center state ambigu

tran p prevtran p remain
note fail follow silst allow current

silst

tran p gettran p



other must ambigu

tran pindex hset senonetran p senoneid
sindex hset senonest senoneid
tran pindex sindex
runtim error scoregroundtruth fail resolv ambigu senon hset getsenonenam senoneid
tran p hset tran ps tran pindex
sindex

chang phonem necessari enter score
tran p prevtran p

prevtran p previou transit
pathscor prevtran p prev prevtran p getnumst
prev enter transit

inter state tran p
pathscor tran p prev
acoust score
pathscor log l ls senoneid
rememb state frame
prevtran p tran p
prev

last transit
prevtran p previou transit
pathscor prevtran p prev prevtran p getnumst
need transit sinc transcript dictionari includ entri
uid senoneid
pathscor gettran p numstat

pathscor transcriptunigram

islogzero pathscor
fprintf stderr scoregroundtruth ground truth path zero probabl model inconsist mayb
account
pathscor
fprintf stderr scoregroundtruth ground truth score frame pathscor numfram
pathscor



s mb rdiagnost helper diagnost analyz s mbr result


compil complain use compil sometim diagnost
s mb rdiagnost msra math ssematrixbas errorsign size uid
size bestpath vector refseen msra simplesenonehmm hset

todo
best posit runner
warn
check warn
indic whether best path state correct
size numcor
size numnegbett frame competitor better
size numposbett frame competitor better
column errorsign

size sref uid
srefnam hset getsenonenam sref
size sbest bestpath
sbestnam hset getsenonenam sbest
sref sbest
numcor
frame error signal ground truth runner second largest valu
size sneg size competitor
eneg
size spo size best postiv competitor
epo
errorsign

sref

errorsign eneg

sneg
eneg errorsign

errorsign epo

spo
epo errorsign


fab errorsign sref 0001f errorsign sref eneg
numnegbett
fab errorsign sref 0001f errorsign sref epo
numposbett
snegnam sneg size hset getsenonenam sneg
sposnam spo size hset getsenonenam spo
fprintf stderr
srefnam errorsign sref snegnam eneg sposnam epo sbestnam errorsign sbest
sbest sref
fab errorsign sref 0001f errorsign sref
fab errorsign sref 0001f errorsign sref eneg weak
fab errorsign sref 0001f errorsign sref epo
refseen noref

valid bestpath comput
fprintf stderr s mb rdiagnost frame correct better
numcor errorsign col numcor errorsign col
numnegbett numposbett


compil complain use compil sometim diagnost
s mb rsuppressweirdstuff msra math ssematrixbas errorsign size uid

size numweird
column errorsign

size sref uid
frame error signal ground truth runner second largest valu
eref errorsign sref
isweird eref neg refer
size errorsign row isweird

sref

fab errorsign eref
isweird

isweird

errorsign
errorsign
numweird


valid bestpath comput
fprintf stderr s mb rsuppressweirdstuff weird frame flatten
numweird errorsign col numweird errorsign col



forwardbackward main s mbr

thi comput lattic state level statist sequenc train s mbr

output mode
result dengamma denomin gamma form
return path likelihood denomin object
note numgamma use touch mode

output s mbr mode
todo comment
result errorsign valu neg contribut error signal
errorsignalbuf temporarili errorsign
return expect frame correct count s mbr object


lattic forwardbackward parallelst parallelst msra math ssematrixbas log l ls msra simplesenonehmm hset
msra math ssematrixbas result msra math ssematrixbas errorsignalbuf
boostingfactor
s mb rmode size uid size bound
htkmlfwordsequ word transcript vector transcriptunigram

softalign
softalignst soft align within edg current support soft within edg mode
softalignlattic softalign whole lattic

edgealign thisedgealign align memori alloc lattic
backpoint thisbackpoint hset memori forwardbackward

info numfram log l ls col
logic error forwardbackward frame mismatch lattic info numfram log l ls col
todo follow check dare crash critic never warn
info numfram uid size
fprintf stderr forwardbackward frame mismatch lattic uid info numfram uid size
info numfram result col
fprintf stderr forwardbackward frame mismatch lattic result info numfram result col

littlematrixheap matrixheap info numedg abc

phase fake word level forward backward use prune enabl
minlogpp logzero prune threshold logzero mean disabl
vector origlogpp word posterior origin lattic prune decis

phase edg forward backward time align

score ground truth transcript provid happen user provid languag model
todo longer use remov transcript paramet longer use
transcript
transcriptunigram

alloc alpha beta gamma matric share memori place
vector msra math ssematrixbas abc
vector edgeacscor edg index acoust score
funcat call forwardbackward edg level
forwardbackwardalign parallelst hset softalignst minlogpp origlogpp abc matrixheap s mb rmode returnsenoneid edgeacscor log l ls thisedgealign thisbackpoint uid bound

phase lattic level forward backward

exploit lattic sort node start node place process

checklattic comment hansu save time
ifdef print time measur
timer latlevelfwbw

vector logpp
vector eframescorrectbuf use comput eframescorrectdiff
vector log eframescorrect output phase
vector logalpha
vector logbeta
totalfwscor todo name longer precis s mb rmode
log eframescorrecttot logzero

return eframescorrect s mb rmode
softalignlattic

totalfwscor forwardbackwardlattic edgeacscor parallelst logpp logalpha logbeta boostingfactor return eframescorrect size uid thisedgealign log eframescorrect eframescorrectbuf log eframescorrecttot
s mb rmode return eframescorrect
log eframescorrecttot forwardbackwardlattic mbr edgeacscor hset logalpha logbeta size uid thisedgealign eframescorrectbuf
bugbug test


totalfwscor bestpathlattic edgeacscor logpp
ifdef print time measur
latlevelfwbw show latlevelfwbw 395682

islogzero totalfwscor

fprintf stderr forwardbackward warn path found lattic node edg node size edg size
logzero fail result matrix


phase comput state level posterior mode

comput expect frame correct s mb rmode

size numfram log l ls col
numfram info numfram
fprintf stderr forwardbackward total forward score frame totalfwscor numfram debug port

mode
s mb rmode

first take domain avoid numer issu
dengamma result result denomin gamma
mmierrorsign parallelst minlogpp origlogpp abc softalignst logpp hset thisedgealign dengamma
totalfwscor numfram valu posterior

s mbr mode


errorsign result
s mb rerrorsign parallelst errorsign errorsignalbuf logpp minlogpp origlogpp log eframescorrect log eframescorrecttot thisedgealign

dummyvari fprintf stderr note version kappa adjust kappa
log eframescorrecttot numfram valu expect frame correct count




ifdef cpuonli
ifndef secur warn
defin secur warn secur avail platform file give variabl warn


best gpu

cudalatticeop
cudalattic

pragma warn disabl 4100 unreferenc formal paramet sinc function dummi disabl allow copi past prototyp function
pragma warn disabl 4702 unreach code implement macro

msra cuda

latticefunctionsop edgealign vectorref lrhmmdef hmm vectorref lr3tran p tran ps size spalignunitid
size silalignunitid matrixref log l ls
vectorref msra lattic nodeinfo node vectorref msra lattic edgeinfowithscor edg
vectorref msra lattic aligninfo align vectorref alignoffset
vectorref backptrstorag vectorref size backptroffset
vectorref alignresult vectorref edgeacscor



latticefunctionsop forwardbackwardlattic size batchsizeforward size batchsizebackward
size numlaunchforward size numlaunchbackward
size spalignunitid size silalignunitid
vectorref edgeacscor vectorref msra lattic edgeinfowithscor edg
vectorref msra lattic nodeinfo node
vectorref msra lattic aligninfo align vectorref alig
vectorref aligmentoffset
vectorref logpp vectorref logalpha vectorref logbeta
boostingfactor return eframescorrect
vectorref uid vectorref senone2classmap
vectorref logaccalpha vectorref logaccbeta
vectorref logframescorrectedg vectorref log eframescorrect vectorref eframescorrectbuf
log eframescorrecttot totalfwscor



latticefunctionsop s mb rerrorsign vectorref alignstateid vectorref alignoffset
vectorref msra lattic edgeinfowithscor edg vectorref msra lattic nodeinfo node
vectorref logpp vectorref log eframescorrect log eframescorrecttot
matrixref errorsign matrixref errorsignalneg



latticefunctionsop mmierrorsign vectorref alignstateid vectorref alignoffset
vectorref msra lattic edgeinfowithscor edg vectorref msra lattic nodeinfo node
vectorref logpp matrixref errorsign



latticefunctionsop stateposterior vectorref alignstateid vectorref alignoffset
vectorref msra lattic edgeinfowithscor edg vectorref msra lattic nodeinfo node
vectorref logq matrixref logacc



latticefunct newlatticefunct size deviceid

nullptr


lrhmmdefvector newlrhmmdefvector size deviceid

nullptr

lr3tran pvector newlr3tran pvector size deviceid

nullptr

ushortvector newushortvector size deviceid

nullptr

uintvector newuintvector size deviceid

nullptr

floatvector newfloatvector size deviceid

nullptr

doublevector newdoublevector size deviceid

nullptr

sizetvector newsizetvector size deviceid

nullptr

nodeinfovector newnodeinfovector size deviceid

nullptr

edgeinfowithscoresvector newedgeinfovector size deviceid

nullptr

aligninfovector newaligninfovector size deviceid

nullptr




cpuonli

copyright microsoft right reserv
licens licens licens file project root full licens inform

data reader defin export function applic


stdafx
ifndef secur warn
defin secur warn secur avail platform file give variabl warn


defin dataread local
basic
data reader
config
scriptabl object




microsoft cntk

get reader name precis

precis
get reader f
precis
get reader d

invalid argument data reader precis paramet must


data reader base set minibatch layout stream minibatch input minibatch

minibatch minibatch

p mb layout minibatch second p mb layout
thi allow reader support singl layout input
iter minibatch

iter second p mb layout p mb layout
todo thi runtim check run debug
unus iter


copi mb layout to p mb layout


data reader base get minibatch stream minibatch input minibatch

tri get minibatch minibatch

set minibatch layout minibatch







config record type
data reader init from config config record type config

runtim error init call
implement call underli instead


destroy cleanup remov
note destroy use past point
data reader destroy

newer code explicitli place multipl stream input
index io name input name node name

data reader io name destroy



data reader constructor
option option windows addenergi reader specif
config record type
data reader data reader config record type config

get reader proc i data reader preader

data reader

precis config precis

ha multipl reader config exist reader
ha multipl reader

vector wstring io name config reader config record type array stringargvector
newer code explicitli place multipl stream input
io name io name input name node name

config record type thi io config io name
name reader want uci fast reader
get reader proc get reader proc get reader proc plugin load thi io reader type uci fast reader get reader name precis
io name push back io name
get reader proc nullptr
get reader proc data reader io name instanti reader config process point


legaci

wstring io name io name
backward support reader
name reader want uci fast reader
get reader proc get reader proc get reader proc plugin load config reader type uci fast reader get reader name precis
io name push back io name
get reader proc nullptr
get reader proc data reader io name


concurr reader read ahead
data reader concurr reader elem type data reader
init
todo merg code first need nbr utt per minibatch initi insid reader
io name io name

config record type thi io ha multipl reader config io name config legaci
data reader io name init thi io

option todo done insid reader
size nbr utt per minibatch config nbruttsineachrecurrentit size
data reader io name set num parallel sequenc nbr utt per minibatch



data reader data reader config paramet
data reader data reader scriptabl object i config record

destructor cleanup temp file
data reader data reader

free resourc
size io name size
data reader io name destroy


start minibatch loop startup minibatch
mb size size minibatch frame
epoch epoch
request epoch sampl sampl random default request data size use sampl dataset
data reader start minibatch loop size mb size size epoch size request epoch sampl

size io name size
data reader io name start minibatch loop mb size epoch request epoch sampl


support distribut mb read tell reader support distribut minibatch read parallel train
data reader support distribut mb read

support distribut mb read
size io name size

curr reader iter data reader find io name
curr reader iter data reader

support distribut mb read curr reader iter second support distribut mb read


support distribut mb read


start distribut minibatch loop startup distribut minibatch parallel train
mb size size minibatch frame
epoch epoch
subset num subset current node group parallel train node
num subset total node particip parallel train
request epoch sampl sampl random default request data size use sampl dataset
data reader start distribut minibatch loop size mb size size epoch size subset num size num subset size request epoch sampl request data size

size io name size

data reader io name start distribut minibatch loop mb size epoch subset num num subset request epoch sampl



get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
data reader get minibatch stream minibatch input matric


reader read column utter minibatch mb size
notic reader differ actual mbsize though supposedli utter minibatch mb size
handl reader getminibatch exact utter minbatch
thi exact specifi reader pass reader
reader return exact utter minibatch call getminibatch
then return compar specifi number consist logic error
logic error avoid usual exchang read order

b ret
vector size v nbr sentenc
size
size io name size


data reader io name set num parallel sequenc first determin param other todo thi flimsi
b ret data reader io name get minibatch matric
size thi nbr data reader io name get num parallel sequenc

thi nbr
thi nbr
logic error data reader get minibatch specifi utter minibatch consist actual utter minibatch

b ret


get minibatch4 se minibatch train includ lattic label phone boundari
latticeinput lattic utter minibatch
uid labl store size vector instead elem type matrix
boundari phone boundari
return minibatch minibatch remain
data reader get minibatch4 se vector share msra latticepair latticeinput vector size uid vector size boundari vector size extrauttmap

b ret
size io name size
b ret data reader io name get minibatch4 se latticeinput uid boundari extrauttmap
b ret


get hmm data definit train
definit
return succeed
data reader get hmm data msra simplesenonehmm

b ret
size io name size
b ret data reader io name get hmm data
b ret


size data reader get num parallel sequenc

size n nbr
size io name size

i data reader data reader io name
n nbr
n nbr get num parallel sequenc
n nbr get num parallel sequenc
logic error get num parallel sequenc slice minibatch consist stream

n nbr


data reader init propos stream minibatch input matric

size io name size
data reader io name init propos matric


data reader get propos ob stream minibatch input matric size tidx vector size histori

b ret
size io name size
b ret data reader io name get propos ob matric tidx histori
b ret


data reader copi mb layout to mb layout ptr p mb layout

bugbug thi copi reader layout info keep last like intend
size io name size
data reader io name copi mb layout to p mb layout


data reader set random seed seed

size io name size
data reader io name set random seed seed


data reader get minibatch copi
vector vector pair wstring size utt info
stream minibatch input matric
mb layout ptr p mb layout


size io name size
data reader io name get minibatch copi utt info matric p mb layout



data reader set net output
vector vector pair wstring size utt info
matrix base output
mb layout ptr p mb layout


size io name size
data reader io name set net output utt info output p mb layout



get label map get label map integ index label
return numer datatyp label
data reader label id type data reader label type data reader get label map wstring

implement


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
data reader set label map wstring section name label id type label type label map

size io name size
data reader io name set label map section name label map


get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
data reader get data wstring section name size num record size data buffer size size record start

b ret
size io name size
b ret data reader io name get data section name num record data buffer size record start
b ret


data reader data end

b ret
size io name size
b ret data reader io name data end
b ret


scriptabl object system
scriptabl object configur runtim type regist data reader regist data reader plugin data reader plugin



copyright microsoft right reserv
licens licens licens file project root full licens inform


ifndef secur warn
defin secur warn secur avail platform file give variabl warn


defin nonstdc deprec make accept posix function without
pragma warn disabl 4996 seem work todo make work
defin file offset bit forc fseeko ftello linux

ifdef secur overload standard name buffer overload strcpi
secur overload standard name

defin secur overload standard name
basic
fileutil
progress trace

ifdef unix
type
stat
unistd
glob

stdio

ctype
stdint

ifdef win32
defin nominmax
window filetim

algorithm find
limit
memori
cwctype
ifndef under header exist win ce appropri definit seem stdlib
defin win32 defin cygwin
fcntl binari text need winc
setmod
defin binari mode handl setmod handl binari
defin text mode handl setmod handl text

defin binari mode handl
defin text mode handl



defin fake annot come handi code analysi want

errno


microsoft cntk


map window build



wchar get scan format string




wchar get scan format string wchar




wchar get scan format string




wchar get scan format string




wchar get scan format string




wchar get scan format string




wchar get scan format string



wchar get scan format string

wchar get scan format string




wchar get scan format string




wchar get scan format string size




wchar get scan format string





wchar get format string




wchar get format string wchar




wchar get format string




wchar get format string




wchar get format string




wchar get format string




wchar get format string



wchar get format string

wchar get format string




wchar get format string




wchar get format string size




wchar get format string




wchar get format string




wchar get format string wchar





fget text special fwscanf differ valu text file

fget text file

wchar format string get format string
fwscanf format string

runtim error error read valu file invalid format format string

runtim error error read file strerror errno


fget text file wchar

wchar format string get format string
fwscanf format string

runtim error error read valu file invalid format format string

runtim error error read file strerror errno




fopen or die like fopen termin error
pathnam return stdout stdin depend mode
chang binari mode given make sure
fclose handl


wchar strchr wchar wchar

wcschr


pathnam open stdin stdout chang mode given

file fopen std handl mode

file strchr mode stdin stdout
strchr mode strchr mode chang binari mode
fsetmod strchr mode



file fopen or die pathnam mode

file pathnam fopen std handl mode fopen pathnam mode


runtim error error open file pathnam strerror errno

strchr mode
optim sequenti access larg buffer
setvbuf iofbf 10000000 fail




file fopen or die wstring pathnam wchar mode

file pathnam fopen std handl mode wfopen pathnam mode


runtim error error open file pathnam strerror errno

strchr mode
optim sequenti access larg buffer
setvbuf iofbf 10000000 fail





mode binari text


fsetmod file



runtim error fsetmod invalid

ifdef under win ce win32 differ type fileno
file fileno note error check possibl

fileno note error check possibl

binari mode text mode


runtim error error chang file mode strerror errno




fread or die like fread termin error


fread or die size size size count file

read limit random window chunk
count

size chunkn count size 1024 1024 bugbug sure meant limit byte unit size
size fread size chunkn
chunkn
runtim error error read file strerror errno
count
size



ifdef win32
fread or die size size size count handl

read limit random window chunk
count

size chunkn count size size 1024 1024
dword
read file dword chunkn
chunkn
runtim error error read file get last error
count size size






fwrite or die like fwrite termin error
window fwrite problem write time fail
invalid argument error chunk


fwrite or die size size size count file


size total byte size count
total byte

size want write total byte
defin limit 1024 1024 limit time
want write limit

want write limit

size fwrite want write
want write

runtim error error write file 08lx size count write byte
size size count want write
size count total byte
strerror errno

total byte want write
want write



ifdef win32
fwrite or die size size size count handl


dword total byte dword size count
total byte

dword want write total byte
defin limit 1024 1024 limit time
want write limit

want write limit

dword byte written
write file want write byte written

runtim error error write file 08lx size
count write byte
size count want write
size count total byte
strerror errno

total byte want write
want write




fseek or die file offset mode

cur po ftell
cur po

runtim error error seek strerror errno

fseek offset mode


runtim error error seek strerror errno

cur po



fprintf or die like fprintf termin error


pragma warn push
pragma warn disabl 4793 vararg caus code gener
fprintf or die file


start
vfprintf


runtim error error write file strerror errno


pragma warn


fsync or die like fsync termin error


fsync or die file

fileno


runtim error unabl convert file handl file descriptor strerror errno


ensur sync return
ifdef win32
flush file buffer handl osfhandl

runtim error error sync file get last error


fsync


runtim error error sync file strerror errno





fflush or die like fflush termin error


fflush or die file

fflush


runtim error error flush file strerror errno




files determin size file byte open file

size files file

ifdef win32
size cur po ftelli64
cur po

runtim error error determin file posit strerror errno

fseeki64 seek

runtim error error seek file strerror errno
size ftelli64

runtim error error determin file posit strerror errno
fseeki64 cur po seek

runtim error error reset file posit strerror errno

todo test
stat stat
fstat fileno stat

runtim error error determin length file strerror errno
stat size uint64 stat compil mode
stat size



files determin size file byte pathnam
size files wchar pathnam

file fopen or die pathnam


size files
fclose
size



fclose




ifndef under win ce

filesize64 determin size file byte pathnam
int64 filesize64 wchar pathnam

ifdef win32
stat64 fileinfo
wstat64 pathnam fileinfo


fileinfo size

files pathnam





fget setpo seek function error handl


uint64 fgetpo file

ifdef standard allow cast fpo integ number inde work linux window
fpo post
fgetpo post

runtim error error get file posit strerror errno

ftello
uint64 post uint64
post file offset enabl
decltyp post
logic error file offset enabl

post


fsetpo file uint64 reqpo

ifdef standard allow cast fpo integ number inde work linux window
ifdef special hack
visual studio fsetpo flush read buffer thi conflict situat
gener read linearli skip byte occasion
speech recognit tool thi requir optim

uint64 curpo fgetpo
uint64 cureob curpo mess structur
reqpo curpo reqpo cureob

made call fsetpo
reqpo fgetpo


seek within exist buffer move posit dummi read
65536
size size reqpo size curpo countof
fread fail realli
curpo

sinc mess someth unexpect happen buffer back
curpo fgetpo curpo cureob
oop

special hack

actual perform seek
fpo post reqpo
fsetpo post
assum unix
post reqpo
reqpo file offset enabl
decltyp reqpo post reqpo
logic error file offset enabl
fseeko post seek


runtim error error set file posit strerror errno



unlink or die unlink error handl


unlink or die pathnam

unlink pathnam errno enoent file miss want
runtim error error delet file pathnam strerror errno

unlink or die wstring pathnam

wunlink pathnam errno enoent file miss want
runtim error error delet file pathnam strerror errno



renam or die renam error handl


renam or die

ifdef win32
delet destin file exit match linux semant
fexist delet file a
runtim error error delet file get last error

move file a
runtim error error renam file get last error

delet destin file exist
workaround renam workaround
hdf fuse implement fail
workaround fuse renam run philli
unlink or die
renam

runtim error error renam file strerror errno




renam or die wstring wstring

ifdef win32
delet destin file exit match linux semant
fexist delet file w
runtim error error delet file get last error

move file w
runtim error error renam file get last error

renam or die wtocharpath wtocharpath




fputstr write termin


fputstr file

fwrite or die strnlen size secur note review


fputstr file

fputstr


ifdef win32
pragma warn push
pragma warn disabl 4127

fputstr file wchar



fwrite or die wcsnlen size secur note review



size str len wcsnlen size
uniqu char16 str16 char16 str len
str len

str16 char16

str16 str len
fwrite or die str16 str len secur note review



runtim error error unknown encod


ifdef win32
pragma warn


fputstr file wstring

fputstr



fexist test file exist


fexist wchar pathnam

ifdef
win32 find dataw find file data
handl h find find first file w pathnam find file data
h find invalid handl valu

find close h find







file wfopen pathnam
nullptr



fexist pathnam

ifdef
win32 find dataa find file data
handl h find find first file a pathnam find file data
h find invalid handl valu

find close h find







file fopen pathnam
nullptr




funicod test file use unicod read


funicod file

test code
fread test code
test code 0x feff

fseek seek
rewind




fgetlin like fget termin error
remov newlin charact like get
return alway guarante termin


ifdef cygwin strnlen somehow miss cygwin quick check build window although real target platform
size strnlen size

find



ifdef under strlen defin win ce
size strnlen size

find



wchar fget wchar file

fgetw

size strnlen wchar size

wcsnlen


char
char fgetlin file char size

todo redefin write matter defin wchar
char fget size
reach time feof

ferror
runtim error error read line strerror errno



size strnlen size

check buffer overflow

size size

basic char exampl
uint64 filepo fgetpo error messag
runtim error input line file offset charact allow filepo size msra strfun utf8 exampl


remov newlin

unix window style



window style





style








version
fgetlin file

vector 1000000
fgetlin size


version
wstring fgetlinew file

vector wchar 1000000
fgetlin size


version avoid memori alloc
fgetlin file vector

resiz 1000000 enough increas
fgetlin size
assign


fgetlin file wstring vector wchar

resiz 1000000 enough increas
wchar fgetlin size
assign


buffer version
fgetlin file vector

size 1000000 enough increas
resiz size
fgetlin size
resiz strnlen size secur note review


fgetlin file vector wchar

size 1000000 enough increas
resiz size
fgetlin size
resiz wcsnlen size secur note review


read termin
fgetstr file size size




fgetc

runtim error error read miss strerror errno


size
runtim error input line charact allow size


size




read termin wstring
fgetstr file




fgetc

runtim error error read miss strerror errno


push back




read termin
wchar fgetstr file size wchar size




todo redefin write matter defin wchar
wint fgetwc
weof
runtim error error read miss strerror errno


size

runtim error input line wchar tacter allow size

wchar

size




1800
read termin wstring
wstring fgetwstr file

todo redefin write matter defin wchar
wstring



known runtim microsoft connect 768113
fgetwc skip certain condit
alreadi updat releas 2012
workaround fgetc twice simul fgetwc

wint fgetwc
fgetc
fgetc

synthet fgetc output simul fgetwc
note order work littl endian
wint wint
weof
runtim error error read miss strerror errno


push back wchar





read termin wstring
wstring fgetwstr file

todo redefin write matter defin wchar
wstring


wint fgetwc
weof
runtim error error read miss strerror errno


push back wchar





fskipspac file

count
count

fgetc


ferror
runtim error error read file strerror errno


isspac space undo get charact

ungetc

runtim error error ungetc strerror errno



count


fskipwspac file

todo redefin write matter defin wchar
count
count

wint fgetwc
weof

ferror
runtim error error read file strerror errno


iswspac space undo get charact

wint ungetwc

runtim error error ungetc strerror errno



count


fskip new line skip white space line incl newlin
skip skip line otherwis leav line lead space
return
fskip newlin file skip


found

skip white space



fgetc


accept newlin

found
skip
fgetc


found skip


found newlin

found
ungetc

runtim error error ungetc strerror errno
found

newlin



read space termin token
todo trail space like fscanf doessurround space
fgettoken file size size

fskipspac skip lead space




fgetc


isspac

size
runtim error input token charact allow size


todo is white space fgetc skip trail space


ungetc

runtim error error ungetc strerror errno

size




fgettoken file


fgettoken


read space termin token
wchar fgettoken file size wchar size

todo redefin write matter defin wchar
fskipwspac skip lead space
wint weof



fgetwc
weof

iswspac

size
runtim error input token wchar tacter allow size
wchar

todo is white space fgetc skip trail space
weof

ungetwc

runtim error error ungetwc strerror errno

size




wstring fgetwtoken file

wchar
fgettoken



ftryget text file

wchar
ftryget text





fput text write charact


fput text file

fput text



fget tag read


fget tag file


fread or die





fcheck tag read verifi termin wrong


fcheck tag file expect tag

fcompar tag fget tag expect tag


fcheck tag ascii file expect tag

enough
fskipspac
fgettoken
expect tag

runtim error invalid found expect expect tag




fcompar tag compar tag termin wrong


fcompar tag read tag expect tag

read tag expect tag

runtim error invalid found expect
read tag expect tag




fput tag write


fput tag file


strnlen
fwrite or die strnlen



fskipstr skip termin


fskipstr file




fread or die




fpad write termin file boundari
note file must open binmod work properli window

fpad file

current write posit
ftell


runtim error error ftell strerror errno

determin mani byte need least termin
creat dummi length incl termin

dummi string asia
size offset dummi string dummi string
offset
fputstr dummi string offset



fgetbyt read valu


fgetbyt file


fread or die




fgetshort read valu


fgetshort file


fread or die



fgetshort bigendian file


fread or die




fgetint24 read valu


fgetint24 file



fread or die read lower order byte
shift upper bit uninit
shift bit sign extend




fgetint read valu


fgetint file


fread or die



fgetint bigendian file


fread or die



fgetint ascii file

fskipspac


fread or die
isdigit


fread or die

ungetc


runtim error error ungetc strerror errno





fgetlong read valu


fgetlong file


fread or die




fgetfloat read valu


fgetfloat file


fread or die



fgetfloat bigendian file

bitpattern fgetint bigendian
bitpattern


fgetfloat ascii file


fskipspac
fscanf secur hint overload

runtim error error read valu file invalid format strerror errno

runtim error error read file strerror errno





fgetdoubl read valu


fgetdoubl file


fread or die



ifdef win32


fgetwav read entir file


wavehead prepar rest sampl count

fmt length

w format tag
n avg byte per sec n sampl per sec n block align

riffchar
riffchar
riffchar
riffchar
sampl count

data length sampl count n block align
riff length data length



data length 0xffffffff
riff length 0xffffffff


wavechar
wavechar
wavechar
wavechar
wavechar
wavechar
wavechar
wavechar

datachar
datachar
datachar
datachar


wavehead prepar bit channel sampl count

n channel channel
n sampl per sec
n block align channel bit
n avg byte per sec n block align
w bit per sampl bit

prepar rest sampl count


wavehead prepar waveformatex sampl count unknown

n channel n channel
n sampl per sec n sampl per sec
n block align n block align
w bit per sampl w bit per sampl

prepar rest sampl count


wavehead write file

fput tag riff
fputint riff length
fput tag wave
fput tag
fputint fmt length
fputshort w format tag
fputshort n channel
fputint n sampl per sec
fputint n avg byte per sec
fputshort n block align
fputshort w bit per sampl
fmt length
w format tag
fput tag
fputint data length
fflush or die


wavehead updat file

cur po ftell
cur po

runtim error error determin file posit strerror errno

files
riff length
data length riff length
fseek or die seek
fputint riff length
fseek or die seek
fputint data length
fseek or die cur po seek





fputbyt write valu


fputbyt file

fwrite or die



fputshort write valu


fputshort file

fwrite or die



fputint24 write valu


fputint24 file


fwrite or die write order byte



fputint write valu


fputint file

fwrite or die



fputlong write valu


fputlong file

fwrite or die



fputfloat write valu


fputfloat file

fwrite or die



fputdoubl write valu


fputdoubl file

fwrite or die



fputfil write binari block file


fputfil wstring pathnam vector buffer

file fopen or die pathnam


buffer size
otherwis buffer illeg express
fwrite or die buffer buffer buffer size

fclose or die



fclose




fputfil wstring pathnam wstring

file fopen or die pathnam


length
otherwis buffer illeg express
fwrite or die length

fclose or die



fclose




fputfil wstring pathnam

file fopen or die pathnam


length
otherwis buffer illeg express
fwrite or die length

fclose or die



fclose





fgetfil load file binari block


fgetfil wstring pathnam vector buffer

file fopen or die pathnam
size files
buffer resiz
buffer size
otherwis buffer illeg express
fread or die buffer buffer buffer size

fclose


fgetfil file vector buffer
version read
buffer resiz
buffer reserv 1000000 avoid mani realloc
vector inbuf
inbuf resiz 65536 read chunk size
feof read

size fread inbuf inbuf inbuf size
ferror

runtim error fgetfil error read file strerror errno

buffer insert buffer inbuf inbuf

buffer reserv buffer size


load huge chunk
size fgetfilechar wstring path vector buffer

file fopen or die path
size files
buffer reserv
fread or die buffer
buffer push back make proper



line
strtoklin line line

strtok strtok
line push back


msra file fgetfilelin wstring path vector buffer vector line

load huge chunk
size fgetfilechar path buffer

pars line
line resiz
line reserv
strtoklin buffer line


return avoid memori alloc
vector msra file fgetfilelin wstring path vector buffer

load huge chunk
size fgetfilechar path buffer

pars line
vector line
line reserv
strtoklin buffer line
line



getfiletim access modif time


ifndef filetim
filetim dword dw low date time dword dw high date time minwindef
time filetim

filetim targettim filetim inputtim fuptod

targettim dw high date time inputtim dw high date time
targettim dw high date time inputtim dw high date time targettim dw low date time inputtim dw low date time



ifdef win32
find handl

handl
find handl find handl
find handl find handl


find handl handl



find handl

todo check error code uncaught except
invalid handl valu
find close

handl






getfiletim wstring path filetim time
file modif time cannot determin
ifdef win32
win32 find dataw find file data
find handl h find find first file w path find file data
h find invalid handl valu

time find file data ft last write time




todo test mtime desir resolut
stat
result

associ stat
result stat wtocharpath path
check statist valid
result


time mtime





expand wildcard wildcard expans path includ directori


ifdef win32
win32 style variant want
return failur alloc
bool expand wildcard wstring path vector wstring path

convert root filenam convent
size path length
path
path

remov termin backslash
size last path length
last path last
path eras last

convert root filenam convent
path find
path root

split everyth first wildcard
size wpo path find first
wpo path path
wpo path find first skip
wpo wstring npo
wildcard
path push back path



split everyth afterward
wstring rest remain path directori
size spo path find first wpo
spo wstring npo

rest path substr spo
path eras spo


crawl folder
win32 find dataw ffdata
find handl h find find first file w path ffdata
h find invalid handl valu

dword get last error
rest
match file
anoth error

size path find last
wstring npo
logic error unexpect miss path
wstring parent path substr


skip parent directori
is dir ffdata dw file attribut file attribut directori file attribut repars point
is dir ffdata c file name


wstring filenam parent ffdata c file name
rest

path push back filenam

is dir multi wildcard expand

bool expand wildcard filenam rest path
error mean match access deni subfold

find next file w h find ffdata




expand wildcard wstring path vector wstring path

ifdef win32
bool expand wildcard path path

runtim error error expand wild card win32 error path get last error

linux glob
glob glob result
glob wtocharpath path glob tild glob result

runtim error error expand wild card path strerror errno


glob result pathc

path push back msra strfun utf16 glob result pathv

globfre glob result




make intermedi dir make intermedi dir path


mkdir wstring path

wmkdir path
errno eexist
error alreadi exist
ifdef win32 wmkdir return access deni folder exist read check exist
errno eacc

dword get file attribut w path
invalid file attribut file attribut directori



runtim error mkdir error creat intermedi directori path


make subdir file includ parent
msra file make intermedi dir wstring filepath

vector wchar
resiz filepath length
wcscpi filepath
wstring subpath
skip
ifdef win32
window share first level machin share name cannot made


subpath
skip skip level machin share


unix filepath start absolut
path creat path also start


subpath


make constitu filenam make trail slash
wchar context nullptr
wchar wcstok context wcstok context

subpath subpath subpath skip

mkdir subpath

skip
skip skip level
rebuild path
subpath
subpath
subpath




fuptod test whether output file least input file


test file target older input use make mode
input must exist inputrequir otherweis target exist consid date
target exist
msra file fuptod wstring target wstring input inputrequir

filetim targettim
getfiletim target targettim
target miss need updat
filetim inputtim
getfiletim input inputtim
inputrequir input miss requir pretend date forc caller fail
date target higher time stamp
targettim inputtim note use overload win32 filetim linux filetim time size


separ separ
string
vector string split string string string

vector string vstr
string csub
size ifound
size ifoundlast ifound
ifound find first ifound
ifound string npo

csub substr ifoundlast ifound ifoundlast
csub
vstr push back csub

ifoundlast ifound
ifound find first ifoundlast

ifound length
csub substr ifoundlast ifound ifoundlast
csub
vstr push back csub

vstr


vector split string istr
vector wstring split string wstring istr wstring

wcstomb wstring output mbc

size length
vector wchar char
fill
wcstomb


wstring mbstowc input mbc

size length
vector wchar char wchar
fill wchar
oacr warn suppress unsaf string function review size rogeryu 2006
mbstowc
wstring


wstring s2w

ifdef unix
mbstowc

codecvt utf8 wchar convert type x
wstring convert convert type x wchar convert x
convert x byte




ws2 wstring wstr

ifdef unix
wcstomb wstr

codecvt utf8 wchar convert type x
wstring convert convert type x wchar convert x
convert x byte wstr


includ basic
includ mpi wrapper

microsoft cntk mpi wrapper my rank
share microsoft cntk mpi wrapper microsoft cntk mpi wrapper nullptr

copyright microsoft right reserv
licens licens licens file project root full licens inform

config file defin configur file loader


ifndef secur warn
defin secur warn secur avail platform file give variabl warn


file
config
scriptabl object

microsoft cntk

pars command line pars command line paramet
argc count
argv argument paramet
config config
config paramet pars command line argc wchar argv config paramet config

config set name

thi vector keep track config file alreadi read
vector resolv config file
config string

start name
argc

wstring argv

allow chang current directori easier debug
wstring cd descriptor current directori
wcsnicmp cd descriptor cd descriptor length

wstring substr cd descriptor length
wchdir
invalid argument fail current directori
fprintf stderr chang current directori


load config file
wstring config descriptor config file
compar wcsnicmp config descriptor config descriptor length

config file pars regular argument
compar

config string msra strfun utf8

config file path specifi separ

file path msra strfun utf8 substr config descriptor length
vector file path vec msra strfun split file path
file path file path vec

find resolv config file resolv config file file path resolv config file

alreadi read file read
resolv config file push back file path
config string config read config file file path
rememb config directori path brain script network builder
get brain script network builder includ path push back file directori path of msra strfun utf16 file path


runtim error cannot specifi config file multipl time command line



config string concaten line includ paramet command line comment strip

expand line form
config string config resolv includ statement config string resolv config file

convert config dictionari level express form block brace kept verbatim pars insid
config file pars config string
config string


resolv includ statement take config look line
form config path config path separ path config file
encount line read config file list config path specifi order
includ bodi file eventu return includ
config file includ config file recurs file well
config string config within look statement
resolv config file path config file alreadi resolv thi vector use prevent loop
prevent file includ multipl time
return config statement replac bodi specifi config file
config parser resolv includ statement config string vector resolv config file

vector line msra strfun split config string
includ keyword
size includ keyword size includ keyword size
new config string
line line

line compar includ keyword size includ keyword

file path line substr includ keyword size line size includ keyword size
file path find open brace var npo

runtim error variabl usag var name support statement explicit path config file must provid


vector file path vec msra strfun split file path
file path file path vec

file alreadi resolv resolv path vector contain resolv
find resolv config file resolv config file file path resolv config file

recurs resolv statement includ config file
ensur config file includ twice keep track config
file alreadi resolv resolv path vector
resolv config file push back file path
new config string resolv includ statement read config file file path resolv config file



alreadi resolv path write warn user awar
todo thi messag written stderr stderr get redirect specifi file
fprintf stderr warn config file includ multipl time includ config file file path





new config string line


new config string


load config file load multipl configur file add config paramet
file path delimit file path correspond config file load
config string to append config process togeth config file
config parser load config file wstring file path config string to append

config string read config file file path
config string to append nullptr

config string config string to append


file pars config string


load config file and resolv variabl load configur file config paramet
config file contain refer variabl defin config config paramet
method resolv variabl thi method meant process config file
order allow access variabl defin primari config file var name syntax
file path file path file load
config these config paramet use order resolv var name instanc config file
config parser load config file and resolv variabl wstring file path config paramet config

read file resolv variabl pars
file content read config file file path
file content config resolv variabl file content
file pars file content


load config file load configur file config paramet
file path file path file read
config parser load config file wstring file path

read pars
file pars read config file file path


same read config file take input instead wstring
config parser read config file file path

read config file msra strfun utf16 file path


read config file read multipl config file concaten content file return
file path delimit file path correspond config file read
return concatent file content
config parser read config file wstring file path

config string
vector wstring file path vec msra strfun split file path
file path file path vec

config string read config file file path

config string


same read config file take input instead wstring
config parser read config file file path

read config file msra strfun utf16 file path


read config file read configur file line strip comment concaten newlin process expans
file path path config file read
return concatent file content
config parser read config file wstring file path

file file file path file option read

initi config name file name
config name msra strfun utf8 file path
locat config name find last
locat npo
config name config name substr locat
config name move config name

read entir file
consid file support instead call line line
size file length file can seek file size

config file
config file reserv file length
file is eof

file get line
strip comment


config file append
config file append


config file


get file config name determin name featur label section config file
featur vector featur name string
label vector label name string
config record type
get file config name config record type config vector wstring featur vector wstring label

config get member id

config can be config record

config record type temp config
break
befor requir paramet unus label
break
config paramet contain element
temp exist current

dictionari contain relev entri consid input stream either label featur
temp exist current label map file temp exist current label dim temp exist current label type temp exist current section type wstring temp section type label
label push back
temp exist current
featur push back




get file config name config paramet config paramet vector wstring featur vector wstring label
get file config name scriptabl object i config record scriptabl object i config record vector wstring featur vector wstring label

find config name determin name heirarchi section config file contain particular
config configur search
search config section
name vector section name path format subsect
config record type
find config name config record type config vector wstring name

wstring wkey wstring
config get member id

config can be config record

config record type temp config
config paramet contain element
temp exist current wkey

name push back




find config name config paramet config paramet vector wstring name
find config name scriptabl object i config record scriptabl object i config record vector wstring name

trim trim white space start
trim
note entir
trim

found find first
found npo

eras


eras found
found find last
found npo
eras found


trim quot trim surround quotat mark
trim
trim quot



front back
substr size




copyright microsoft right reserv
licens licens licens file project root full licens inform


ifndef secur warn
defin secur warn secur avail platform file give variabl warn

defin nonstdc deprec make accept posix function without

basic
defin format special special version format routin
file

stdint
local
ifdef win32
defin nominmax
window
version helper
shlwapi
pragma comment shlwapi

ifdef unix
unistd
linux limit path


microsoft cntk

file creation
filenam path
file option option open file
file file wstring filenam file option

init filenam file option


file file filenam file option

convert wstring wchar
init msra strfun utf16 filenam file option


file file wchar filenam file option

init filenam file option


string
is non file path string filenam


filenam front command output pipe
filenam back command input pipe
filenam size filenam stdin stdout


test file exist
pathnam pipe consid exist
string
file exist string filenam

is non file path filenam fexist filenam


file exist filenam
file exist wstring wstring filenam

string
file make intermedi dir string filenam

is non file path filenam
msra file make intermedi dir filenam


file make intermedi dir filenam implement need
file make intermedi dir wstring wstring filenam

constructor call
file init wchar filenam file option

filenam filenam
option file option
filenam
runtim error file filenam
output pipe filenam front
input pipe filenam back
translat option fopen
read file option file option read
write file option file option write
read write
runtim error file either file option read file option write must specifi
convert file option fopen mode
wstring option read
write

alreadi read file chang read write
option clear
option append
output pipe filenam

option append
msra file make intermedi dir filenam write regular file also creat intermedi directori conveni


file option file option binari
option

option
sequenti flag alloc read buffer
file option file option sequenti
option
open file
special path syntax understood
refer stdin stdout
write pipe
read pipe
pclose need
seekabl
filenam stdin stdout

write read
runtim error file cannot specifi file option read file option write path
file write stdout stdin

output pipe input pipe pipe syntax

input pipe output pipe
runtim error file pipe cannot specifi file option read file option write
input pipe read
runtim error file pipe must consist file option read file option write
command input pipe filenam substr filenam size filenam substr
file wpopen command option
file
runtim error file error exexut pipe command command strerror errno
pclose need


attempt regular file

file fopen or die filenam option
seekabl



determin directori given pathnam
wstring feel free make need
wstring file directori path of wstring path

ifdef win32
win32 accept forward slash seem path remov file spec
todo
path cch canonic convers part canonic it�
probabl good idea anyway sinc suspect charact might
confus path cch function larri osterman
consid get full path name canonic last element find krell
path msra strfun replac all wstring path

hresult
is windows8 or greater path cch remov file spec avail window

hresult path cch remov file spec proc inout updat inexpress cch path pwstr size
hinstanc hinst lib load librari text core path
hinst lib nullptr
runtim error directori path of load librari unexpectedli fail
path cch remov file spec proc path cch remov file spec reinterpret cast path cch remov file spec proc get proc address hinst lib path cch remov file spec
path cch remov file spec
runtim error directori path of get proc address unexpectedli fail

actual call care
path cch remov file spec path path size

free librari hinst lib

window older path remov file spec instead
path remov file spec path

done
path resiz wcslen path
noth remov
path

runtim error directori path of path remov file spec unexpectedli fail

path find last
path npo
path eras
directori path current directori


path


determin file name given pathnam
wstring feel free make need
wstring file file name of wstring path

ifdef win32
wstring delim

wstring delim

path find last delim
path npo
path substr
directori path
path


path current execut
wstring file get execut path

ifdef win32
wchar path 33000
get modul file name w path countof path
logic error get execut path get modul file name w unexpectedli fail
path

http stackoverflow question 4025370 execut discov path linux
getpid
path path
sprintf path proc
dest path
readlink path dest path
runtim error get execut directori readlink call fail

msra strfun utf16 dest



skip given delimit charact
file skip to delimit delim



delim

fgetc file
feof file

printf unexpect file
logic error unexpect file




file is text base

option file option text


file destructor
close file
note check error file correspond pipe stream flush close file write
file file

pclose need

todo check error code uncaught except
pclose file

file stdin file stdout file stderr

fclose file
uncaught except
runtim error file fail close file filenam



file flush

fflush or die file


read line
line denot support convent



fgetc file getc

begin with unicod bom

0x ef 0x bb 0x bf


read newlin
string
fget string file

resiz

fgetc



fgetc
runtim error fget malform text file without


push back
strip unicod
strip start
thi allow unix multipl file bo ms
sinc otherwis invalid within file well defin upward compat
size begin with unicod bom
clear



get line line file

file get line

fget file


push back string vector line line push back
push back string vector wstring line line push back msra strfun utf16

get line line file
string
file get line file file vector string line

line clear
line
file is eof

file get line line
push back string line line


file get line vector wstring line

file get line line

file get line vector line

file get line line


zero space termin wstring file
valu write file
file file wstring

write string



zero space termin file
valu write file
file file

write string



marker file marker depend file
marker marker place file
file file file marker marker

file file
marker

file marker begin file begin file marker
todo write

file marker end file file marker
file text file
todo what
option file option text
file

file marker begin list begin marker
marker written either

file marker list separ separ element
noth built space delimint type
futur make customiz specifi separ

file marker end list line marker
option file option text
file write string

file marker begin section begin section
file marker end section section
section modifi


file


put marker begin support list count
count element
file file put marker file marker marker size count

marker file marker begin list
marker begin support count marker
count



put marker section begin end tag
section name section
file file put marker file marker marker section

file file
section marker take paramet
marker file marker begin section marker file marker end section
marker
file section
file


put marker section begin end tag
section name section
file file put marker file marker marker wstring section

file file
section marker take paramet
marker file marker begin section marker file marker end section
marker
file section
file


zero termin wstring file
valu read file
file file wstring

is text base
fgetwtoken file

fgetwstr file



zero termin file
valu read file
file file

is text base
fgettoken file

fgetstr file



read char read specifi charact reset read pointer request
valu return
charact read
reset reset read pointer
file read char size reset

size initi keep compil happi
reset
get posit
resiz
cast


reset
set posit


read char read specifi charact reset read pointer request
valu return
charact read
reset reset read pointer
file read char wstring size reset

size initi keep compil happi
reset
get posit
resiz
wchar cast wchar


reset
set posit


write string output file
output
size size output zero termin
file write string size

size

fwprintf file size



is text base
fwprintf file

fputstr file



read string read file
buffer read
size size buffer incl zero termin fail input
file read string size

is text base

fgettoken file size
begin with unicod bom

start line


fgetstr file size


write string output file
write text base file space embed write quot around
bugbug thi consist wchar version
output
size size output zero termin
file write string wchar size

ifdef embed space
start implement embed space support quot
complet sure need
spacefound
wchar quot
is text base

search embed space quot
wstring search string
wchar result
result wcspbrk search string

is white space result
spacefound
search string find result



size

fwprintf file size



is text base
fwprintf file

fputstr file



read string read file
buffer read
size size buffer
file read string wchar size

is text base
fgettoken file size

fgetstr file size


is unicod bom charact unicod byte order mark
skip skip mark found default
return unicod
file is unicod bom skip

file file
uint64 get posit note thi fail seekabl stream
begin file order mark



exist unicod file
found
option file option text


size countof file is eof
getc file
found begin with unicod bom

restor pointer skip
found skip

set posit

found


size size file
warn call reset marker care
size file size

can seek
runtim error file attempt size seekabl stream
files file


is eof read past file
file found
file is eof

feof file


is white space charact whitespac space
skip skip whitespac found default
return whitespac found
todo thi actual consum white space charact document behavior
file is white space skip

space found
space cur



fgetc file

space found
space cur isspac
space found space found space cur
space cur skip
back last charact ignor
ungetc file

space found


end of line or eof charact line sequenc possibl preceed space detect
skip skip line found default
return line found file found noth found lead space strip
file end of line or eof skip

is text base
fskip newlin file skip




marker file
ignor other expect charact
must get marker method paramet
file file file marker marker

file file

marker

file marker begin file begin file marker
check unicod marker
is text base can seek file pipe cannot unicod sorri
is unicod bom

file marker end file file marker file
is eof
runtim error file marker end file found

file marker begin list begin marker
marker written count header

file marker list separ separ element
noth built space delimint type
futur make customiz specifi separ

file marker end list line marker
is text base

found end of line or eof
found also return
runtim error newlin found


file marker begin section begin section
file marker end section section
section modifi


file


marker file
ignor other expect charact
must get marker method paramet
thi fail seekabl stream
file is marker file marker marker skip

retval
marker

file marker begin file begin file marker
check unicod marker
retval is unicod bom skip

file marker end file file marker file
retval is eof

file marker begin list begin marker
marker written count header
valid header know neg

file marker list separ separ element
noth built space delimint type
futur make customiz specifi separ

file marker end list line marker
is text base

eol seen
eol seen end of line or eof skip
retval eol seen


file marker begin section begin section
file marker end section section
destinquish current


retval


get marker begin support list count
count return element
file file get marker file marker marker size count

marker file marker begin list
marker begin support count file marker
text base fail without except
is text base
ftryget text file count

fget file count



get marker section begin end tag
section name section expect
file file get marker file marker marker section

section marker take paramet
marker file marker begin section marker file marker end section
marker


section
runtim error section name mismatch section



get marker section begin end tag
section name section expect
file file get marker file marker marker wstring section

section marker take paramet
marker file marker begin section marker file marker end section
marker
wstring

section
runtim error section name mismatch section



tri get marker section begin end tag
section name section expect
file tri get marker file marker marker wstring section

section marker take paramet
marker file marker begin section marker file marker end section
marker
size get posit
wstring



section






set posit



tri get marker section begin end tag
section name section expect
file tri get marker file marker marker section

section marker take paramet
marker file marker begin section marker file marker end section
marker
size get posit




section






set posit



get posit posit file
uint64 file get posit

can seek
runtim error file attempt get posit seekabl stream
fgetpo file


posit file
posit file
file set posit uint64

can seek
runtim error file attempt set posit seekabl stream
fsetpo file


helper load matrix stream file liter
input expect contain line matrix natur print order human
input
get line fn fill input line matrix
return denot
output
num row num col matrix dimens infer newlin
matrix valu column major order readi set valu
elem type
load matrix from lambda get line fn wstring locat for msg vector elem type size num row size num col

load matrix vector vector sinc know size advanc
vector elem type
vector vector elem type element
size num col in first row

line


input line
get line fn line
line


token pars
clear
line


isspac



point first charact fail pars
valu strtod
isspac
runtim error load matrix from text file malform element size locat for msg

push back elem type valu


size num element in row size
element
num col in first row num element in row
num element in row num col in first row
runtim error column dimens inconsist previou dimens element size num element in row num col in first row locat for msg

element push back


num row element size
num col num col in first row

perform transpos copi element vector elem type
order store column major format
resiz num row num col
num col
num row
num row element


load matrix file file simpl text file consist line matrix line contain element separ white space
elem type
vector elem type file load matrix from text file wstring file path size num row size num col

file myfil file path file option file option text file option file option read

load matrix from lambda read input line follow
input line reach
get line fn line

myfil is eof

myfil get line line
line
line
file manifest line
also allow line within file help visual structur matric realli tensor

line clear line indic file


vector elem type
load matrix from lambda get line fn file path num row num col



load matrix file file simpl text file consist line matrix line contain element separ white space
elem type
vector elem type file load matrix from string liter liter size num row size num col

load matrix from lambda read input line follow
input line reach
size cursor travers take refer modifi
get line fn line

find first blank charact line
liter find first skip previou line lead space
npo
line clear line
find line
end po liter find first find line
end po npo
end po liter size requir look pretti sourc code
line liter substr end po
end po advanc cursor posit skip round



vector elem type
load matrix from lambda get line fn liter num row num col



vector file load matrix from text file wstring file path size num row size num col
vector file load matrix from text file wstring file path size num row size num col

vector file load matrix from string liter liter size num row size num col
vector file load matrix from string liter liter size num row size num col



copyright microsoft right reserv
licens licens licens file project root full licens inform

except with call stack defin cntk except stack util

stdafx
except with call stack
basic
ifdef win32
dbg help
win base

algorithm
iostream

microsoft cntk



make function name stand out name
collect call stack size skip level make function name stand out write

summari thi retriev call stack summari

except with call stack get call stack size skip level make function name stand out



output
collect call stack skip level skip make function name stand out output stack

output stack

output

sinc part error report hung error





summari thi output call stack summari

except with call stack print call stack size skip level make function name stand out

collect call stack skip level skip make function name stand out stack

cerr stack



make unmangl name readabl
insert space around main name better visual parsabl space
thi use heurist name fragil sinc add remov space
make function name stand out orig name

guard except sinc use except report

name orig name
strip modifi pars back
modifi
name find last abcdefghijklmnopqrstuvwxyz
npo

modifi name substr
name name substr

ha arg list name name back
size angl depth
size paren depth
hit end ha arg list name alreadi
hit start
pars name escap nest
look start name without qualifi
comma separ
size name size

account nest
name
angl depth
name
angl depth
name
paren depth
name
paren depth
space
name name size name
name eras remov
comma
name

name size name
name eras remov space comma
hit end angl depth paren depth
name insert level separ space better readabl

name
name name
paren depth angl depth
name
hit end hit start start argument

hit end
name insert

name name name hit end hit start start name

name
name insert
name insert total insert space
hit start


name modifi



orig name



summari thi collect stack track write provid write
param name write function write text associ callstack param
param name newlin function write line newlin param
summari
collect call stack size skip level make function name stand out write

caller
call stack depth

write call stack

ifdef win32

rtl captur stack back trace kernel without bind must manual determin pointer
ushort winapi captur stack back trace type ulong ulong pvoid pulong
captur stack back trace type rtl captur stack back trace captur stack back trace type get proc address load librari kernel32 rtl captur stack back trace
rtl captur stack back trace nullptr fail somehow
write fail gener call stack get proc address rtl captur stack back trace fail error msra strfun utf8 format win32 error get last error

handl process get current process
sym initi process nullptr
write fail gener call stack sym initi fail error msra strfun utf8 format win32 error get last error

call stack
call stack caller
frame
frame rtl captur stack back trace caller call stack nullptr

symbol info symbol info symbol info calloc symbol info variabl length structur vector easili
symbol info max name len
symbol info size of struct symbol info
frame frame call stack depth

format emit
size first frame skip level skip collect call stack
size first frame frame

first frame
write

write

sym from addr process dword64 call stack symbol info

write make function name stand out make function name stand out symbol info name symbol info name
write



dword error get last error

sprintf call stack
write
write sym from addr error msra strfun utf8 format win32 error error



write

free symbol info

sym cleanup process

linux

frame 1024
backtrac address frame
num frame backtrac backtrac address frame
symbol list backtrac symbol backtrac address num frame

size skip level num frame

begin name
begin offset
begin address

find parenthes address offset surround mangl name
symbol list

name begin
begin name
rel address ofset
begin offset
begin offset begin name absolut address
begin address

size 1024
buffer size

begin name begin address begin name begin address

begin name
begin address
begin offset rel address
begin offset

mangl name begin name begin offset caller offset begin offset begin address
statu
funcnam size 4096
size func name size funcnam size
func name funcnam size work buffer
demangl begin name func name func name size statu
f name
statu
f name make function name stand out make function name stand out make readabl

f name begin name fail fall back

name sourc file print sinc use
sourc file symbol list
size sourc file width
sourc file size sourc file width
sourc file sourc file substr sourc file size sourc file width
begin address unnecessari space
begin address
pc offset begin offset begin offset
snprintf buffer size begin address f name pc offset

couldn pars line print whole line came
snprintf buffer size symbol list

write buffer


free symbol list




except with call stack runtim error
except with call stack logic error
except with call stack invalid argument



copyright microsoft right reserv
licens licens licens file project root full licens inform

data writer defin export function applic


stdafx
defin datawrit local
data writer

microsoft cntk

get writer name precis

precis
get writer f
precis
get writer d

invalid argument data writer precis paramet must


config record type
data writer init from config config record type config

runtim error init call
implement call underli instead


destroy cleanup remov
note destroy use past point
data writer destroy

data writer destroy


data writer constructor
config configur writer
config record type
data writer data writer config record type config

get writer proc i data writer pwriter

name writer want binari writer binari reader
todo thi seem like find replac oper
wstring writer type config writer type binari reader
writer type htkmlf writer writer type htkmlf reader

writer type htkmlf reader

writer type binari writer writer type binari reader

writer type binari reader

writer type lu sequenc writer writer type lu sequenc reader

writer type lu sequenc reader

writer type lm sequenc writer writer type lm sequenc reader

writer type lm sequenc reader

writer type kaldi reader writer type kaldi writer

writer type kaldi reader


precis config precis

get writer proc get writer proc get writer proc plugin load writer type get writer name precis
data writer
get writer proc data writer

data writer init config


data writer data writer config paramet
data writer data writer scriptabl object i config record

destructor cleanup temp file
data writer data writer

free resourc
data writer
data writer destroy


get section section file
section section name section data sepcif config file use determin save
data writer get section wstring section type nocas compar section

data writer get section section


save data save file file
record start start record
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
data writer save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

data writer save data record start matric num record dataset size byte variabl size


save map save file
save id name section save section subsect format
label map save file
data writer save map wstring save id label id type label type label map

data writer save map save id label map




copyright microsoft right reserv
licens licens licens file project root full licens inform

eval defin export function applic


defin secur warn secur avail platform file give variabl warn

stdafx
basic
defin eval local
eval

microsoft cntk

elem type
get eval name elem type






get eval name

name get eval f
name


get eval name

name get eval d
name


elem type
eval elem type init config

logic error init call
implement call underli instead


destroy cleanup remov
note destroy use past point
elem type
eval elem type destroy

destroy


eval constructor
elem type
eval elem type get eval class config

get eval proc i evalu model elem type peval

initi

wstring cntk eval
name want cntk eval
size found config find evalu
found npo

size config find first found
npo

msra strfun utf16 config substr found found


creat variabl call proper templat version
elem type elem type elem type
get eval proc get eval proc get eval proc plugin load get eval name elem type
get eval proc


eval constructor
option option windows addenergi reader specif
elem type
eval elem type eval config

get eval class config
init config


destructor cleanup temp file
elem type
eval elem type eval

free resourc


destroy





creat network creat network specifi descript
network descript network descript
elem type
eval elem type creat network network descript

creat network network descript


get node dimens node dimens specifi node
dimens name node dimens node
node group node request input output specifi
elem type
eval elem type get node dimens wstring size dimens node group node group

get node dimens dimens node group


start evalu minibatch loop prepar network evalu call
ouput node name name node evalu
elem type
eval elem type start evalu minibatch loop wstring output node name

start evalu minibatch loop output node name


evalu evalut model given input output
input node name input vector
output node name output vector output vector need prealloc caller size happen evalu
elem type
eval elem type evalu wstring vector elem type input wstring vector elem type output

evalu input output


evalu evalu network without input provid output
output node name output vector output vector need prealloc caller size happen evalu
elem type
eval elem type evalu wstring vector elem type output

evalu output


reset state reset cell state start utter
elem type
eval elem type reset state

reset state


instanti
eval
eval


copyright microsoft right reserv
licens licens licens file project root full licens inform

thi file requir nvml librari unfortun librari instal environ variabl locat
window get instal program file nvidia corpor win7 amd64 releas nvml
linux need instal deploy http develop nvidia deploy
nvml includ path instal deploy nvidia

from document
nvml librari found program w6432 nvidia corpor nvsmi window ad path dynam link nvml path path environment variabl dynam load nvml call load librari path
linux nvml librari found standard librari path linux nvml librari instal


defin secur warn secur avail platform file give variabl warn
basic
platform
best gpu
config config paramet
scriptabl object
ifndef cpuonli
pragma comment cudart
cuda runtim
nvml note expect program file nvidia corpor win7 amd64 releas nvml window path instal deploy nvidia linux
pragma comment nvml note expect program file nvidia corpor win7 amd64 releas nvml window path instal deploy nvidia linux
vector

best gpu dummi someth avoid linker warn

common matrix cpudevic

ifndef cpuonli defin disabl gp us

cuda includ
cuda
ifdef window
defin nominmax
window
delayimp
shlobj
defin path delimit
defin unix
defin path delimit
window
stdio

algorithm

memori
cross process mutex


best gpu


microsoft cntk

processor data

core
nvml memori memori
nvml util util
cuda devic prop devic prop
size cuda free mem
size cuda total mem
cntk found
devic id devic id cuda side processor


best gpu flag

best gpu normal
best gpu avoid share share known machin learn app
best gpu favor memori favor memori
best gpu favor util favor util
best gpu favor speed favor fastest processor
best gpu exclus lock obtain mutex select
best gpu requeri rerun last queri updat statist


best gpu

uniqu cross process mutex gpu mutex


initi initi
nvml data nvml data valid
cuda data cuda data valid
devic count mani devic avail
queri count mani time queri usag counter
best gpu flag last flag flag state last queri
last count count devic filter allow devic
vector processor data proc data
allow devic bitfield allow devic
disallow cpu devic
get cuda properti
get nvml data
queri nvml data


best gpu
initi nvml data cuda data devic count queri count last flag best gpu normal last count allow devic disallow cpu devic

init

best gpu
init
set allow devic vector devic allow certain gp us
devic allow devic
disallow devic devic

devic devic

devic
disallow cpu devic

allow devic devic

allow all reset allow gp us allow
use multipl multipl gp us
get devic best gpu flag flag best gpu normal singl devic
all devic use specifi gp us get devic call
requeri devic requeri refresh statist pick last queri
vector get devic all devic best gpu flag flag best gpu normal multipl devic

lock devic devic id trial


devic from config pars devic id config paramet determin behavior desir
symbol mean
automat pick singl base best gpu score

singl singl cuda
thi call paramet time determin upon first call
deviceid type select devic deviceid type devic id b lock gpu intargvector exclud devic

thi call paramet
deviceid type select devic id deviceid notyetdetermin
select devic id deviceid notyetdetermin
select devic id devic id
select devic id devic id
invalid argument select devic attempt chang devic select mean select devic id devic id deviceid auto

devic id deviceid auto

deviceid type best devic id deviceid notyetdetermin
best devic id
best devic id deviceid notyetdetermin

devic select init
best gpu best gpu nullptr
best gpu nullptr

best gpu best gpu
exclud devic size

best gpu disallow devic exclud devic



best devic id deviceid type best gpu get devic best gpu flag b lock gpu best gpu avoid share best gpu exclus lock best gpu avoid share
todo need hold pointer queri use hold

alreadi chosen
devic id best devic id


devic id

ifdef math export
declspec dllexport

deviceid type devic from config scriptabl object i config record config

intargvector exclud devic config array config exclud devic
b lock gpu config lock gpu
need deal cntk config semant devic id either
valpp config find devic id
valpp
select devic deviceid auto b lock gpu exclud devic given
valp valpp determin point
valp scriptabl object string

wstring valp

select devic cpudevic exclud devic

select devic deviceid auto b lock gpu exclud devic

invalid argument invalid valu devic id paramet allow sensit


select devic valp b lock gpu exclud devic

legaci version cntk config
ifdef math export
declspec dllexport

deviceid type devic from config config paramet config

intargvector exclud devic config array config exclud devic
config valu config devic id
b lock gpu config lock gpu

equal ci select devic cpudevic exclud devic
equal ci select devic deviceid auto b lock gpu exclud devic
select devic b lock gpu exclud devic


thi helper cuda come cuda sampl consid benefici helper cuda
todo thi duplic gpu matrix
begin architectur definit
convert sm ver2 core major minor

defin architectur type version determin core


0x mm hexidecim notat major version minor version
core
s s mto core

s s mto core n gpu arch core per sm

0x10 tesla gener
0x11 tesla gener
0x12 tesla gener
0x13 tesla gener gt200
0x20 fermi gener gf100
0x21 fermi gener gf10x
0x30 kepler gener gk10x
0x35 kepler gener gk11x


index

n gpu arch core per sm index

n gpu arch core per sm index major minor

n gpu arch core per sm index core


index


n gpu arch core per sm core


best gpu get cuda properti

cuda data




processor data proc data

cuda set devic
devic id
cuda get devic properti devic prop
size free
size total
cuda mem get info free total
core convert sm ver2 core devic prop major devic prop minor devic prop multi processor count
cuda free mem free
cuda total mem total

cuda devic reset

cuda data proc data size


best gpu init

initi


count object
cuda error cuda get devic count devic count
cuda success
devic count fail gp us

processor data pd empti
devic count

processor data processor data
pd empti
proc data push back


devic count

get cuda properti
get nvml data

initi


best gpu best gpu

processor data proc data



proc data clear

nvml data

todo check error code uncaught except
nvml shutdown



get nvml data nvidia manag librari
best gpu get nvml data

alreadi initi cuda skip
nvml data cuda data


first initi nvml librari
nvml return result nvml init
nvml success result




queri nvml data


get devic determin best devic
best flag flag modifi score calcul
best gpu get devic best gpu flag best flag

vector best get devic best flag

best
runtim error devic select elig devic found

best


set allow devic allow devic
devic vector allow devic
best gpu set allow devic vector devic

allow devic
devic devic

allow devic devic



devic allow particular devic allow
return devic allow otherwis
best gpu devic allow devic

devic devic

devic
disallow cpu devic

allow devic devic


allow all reset allow filter allow gp us
best gpu allow all

allow devic bit


use multipl multipl gp us
return return last call
best gpu use multipl

last count


get devic determin best devic
mani devic want
best flag flag modifi score calcul
vector best gpu get devic best gpu flag best flag

best gpu flag best flag best flag

want devic give eveyth
all devic
devic count
requeri devic

last count


creat initi initi
vector best devic count
vector score devic count

gp us found
proc data size

best clear
devic allow
best push back

best


latest
queri nvml data

util gpu w
util mem w
speed w
free mem w
ml app run w

requeri flag last time
best flag best gpu requeri
best flag last flag

adjust weight necessari
best flag best gpu avoid share

ml app run w

best flag best gpu favor memori favor memori

free mem w

best flag best gpu favor util favor util

util gpu w
util mem w

best flag best gpu favor speed favor fastest processor

speed w


processor data proc data

score

devic allow devic id


util score
score util util gpu w
score util memori util mem w
score core 1000 speed w
memori total memori free memori total 1000000 remot
driver wddm driver valu window alloc memori nvml point view
devic prop tcc driver memori total
cuda free mem cuda total mem
score free mem w
score cntk found ml app run w
best size

look better score
score score

make room score correct locat insert sort
best size

score score
best best

score score
best devic id





extra slot disallow devic
best size

devic allow never remov
best
best back




process
cross process mutex devic alloc lock gpgpu queri

devic alloc lock acquir best flag best gpu exclus lock failur realli happen
runtim error devic from config unexpect failur acquir devic alloc


even user want still need check whether particular lock
respect user exclus

vector best and avaialb
best

lock devic

avail
best and avaialb push back


best best and avaialb
best size

best resiz



save last valu futur requeri
last flag best flag
last count best size

elimin gp us
best size

devic allow
best push back


best size

lock devic best


best best gp us


queri nvml data queri nvidia manag librari accumul counter
failur simpli back without fill structur without set nvml data
best gpu queri nvml data

cuda data


devic count

nvml devic devic
nvml pci info
nvml memori memori
nvml util util

queri devic handl perform oper devic
nvml return result nvml devic get handl by index devic
nvml success result
fail back

bu id use know devic physic talk
use identifi also match nvml devic handl cuda devic
result nvml devic get pci info devic
nvml success result


processor data cur pd
processor data proc data

devic prop pci bu id

cur pd




cur pd


memori usag work driver
result nvml devic get memori info devic memori
nvml success result

cur pd memori memori

memori usag work driver
result nvml devic get util rate devic util
nvml success result

queri count

averag slightli overweight recent queri
cur pd util cur pd util queri count util queri count
cur pd util memori cur pd util memori queri count util memori queri count



cur pd util util

queri count

size
result nvml devic get comput run process devic size
size

vector nvml process info process info size
process info resiz size
nvml process info info process info
info use gpu memori
result nvml devic get comput run process devic size process info
nvml success result

cntk found
nvml process info info process info

name
name resiz
name length
nvml system get process name info name
name resiz strlen name
size name find last path delimit
npo
name name substr
get current process id info name length

ifdef win32
cntk found cntk found equal ci name cntk recogn
cntk found cntk found equal ci name equal ci name also recogn proprietari legaci tool

cntk found cntk found name cntk linux sensit


valu save
cur pd cntk found cntk found


nvml data



best gpu lock devic devic id trial

devic id alway



port perfect work practic
buffer
sprintf buffer gpgpu exclus devic devic id
uniqu cross process mutex mutex cross process mutex buffer
mutex acquir wait avail

fprintf stderr lock devic fail exclus devic id




fprintf stderr lock devic lock devic id trial test avail exclus
trial
gpu mutex devic id move mutex

fprintf stderr lock devic unlock test devic id




ifdef win32



interfac window system find nvml path
need sinc build process copi


notifi hook get call everi call
delay load helper thi allow user hook everi call
skip delay load helper entir

dli notifi dli start process dli note pre load librari dli note pre get proc dli note end process call

winapi delay load notifi
dli notifi
p delay load info pdli


load nvml altern path
dli notifi dli note pre load librari strcmp pdli sz dll nvml

wchar path
wchar nvml path path
hresult sh get known folder path folderid program file path
lstrcpi nvml path path
co task mem free path
succeed

hmodul
wchar dll name nvidia corpor nvsmi nvml
lstrcat nvml path dll name
load librari ex nvml path load with alter search path



check fail get proc version driver
dli notifi dli fail get proc strcmp pdli sz dll nvml

name
size strlen pdli sz proc name
strcpi name pdli sz proc name
version ap is support truncat
name
name
farproc pfn ret get proc address pdli hmod cur name
pfn ret





extern c
pfn dli hook pfn dli notifi hook2 pfn dli hook delay load notifi
thi failur hook dli notifi dli fail load lib dli fail get proc
extern c
pfn dli hook pfn dli failur hook2 pfn dli hook delay load notifi
win32




cpuonli
timer util

ifdef win32
defin nominmax
window
larg integ tick per second
bool set freq queri perform frequenc tick per second

time


microsoft cntk

timer get stamp

ifdef win32
larg integ
queri perform counter
quad part

timespec
clock gettim clock realtim work linux

nano nsec





timer start

start get stamp


timer restart

start
start


timer stop

get stamp


timer elaps microsecond

start
diff



diff start



diff get stamp start


diff

diff


ifdef win32
set freq
diff micro tick per second quad part

diff micro nano




copyright microsoft right reserv
licens licens licens file project root full licens inform

eval wrapper manag code wrap evalu model


window
vcclr

util
vector
memori
msclr marshal cppstd

except with call stack
eval

system
system collect


system
system collect gener
system collect
microsoft cntk

microsoft cntk extens manag

cntk except

use retriev model appropri element
elem type
get eval proc i evalu model elem type

manag wrapper evalu model
elem type
i evalu model manag i dispos

pair wstring vector elem type map entri


summari initi cref i evalu model manag summari
param name func name factori name retriev model param
i evalu model manag string func name

wchar dllname ptr to string char evaldl
h modul load librari dllname
h modul nullptr

gcnew cntk except system string format cannot find librari gcnew string dllname




msclr interop marshal context context
func context marshal func name
proc address get proc address h modul func
get eval proc get eval proc elem type proc address
i evalu model elem type
get eval proc

except

gcnew cntk except gcnew system string



summari initi model evalu librari cntk configur summari
param name config model configur entri param
init string config

nullptr

gcnew object dispos except object dispos


msclr interop marshal context context
std config context marshal config



init std config

except

get custom except



summari creat network base network descript configur summari
param name network descript configur file contain network descript param
creat network string network descript

nullptr

gcnew object dispos except object dispos


msclr interop marshal context context
std network descript context marshal network descript



creat network std network descript

except

get custom except



summari evalu model singl forward feed retriev output layer summari
param name output key param
param name output size param
return result specifi layer return
list elem type evalu string output key output size

nullptr

gcnew object dispos except object dispos


wstring vector elem type std output




vector share vector elem type share output vector

list elem type output gcnew list elem type output size
output size

output gcnew elem type


dictionari string list elem type output map gcnew dictionari string list elem type
output map output key output

item output map

wchar ptr to string char item
share vector elem type copi list item valu
share output vector push back
std output insert map entri




evalu std output

except

get custom except


enumer output map key get enumer
item std output

retriev layer
enumer move next
string enumer current

vector elem type ref vec item second
index

copi output structur
ref vec

output map index



output map output key

except





summari evalu model input retriev output layer summari
param name input param
param name output param
evalu dictionari string list elem type input dictionari string list elem type output

nullptr

gcnew object dispos except object dispos


wstring vector elem type std input
wstring vector elem type std output



vector share vector elem type share input vector
vector share vector elem type share output vector

item input

wchar ptr to string char item
share vector elem type copi list item valu
share input vector push back
std input insert map entri


item output

wchar ptr to string char item
share vector elem type copi list item valu
share output vector push back
std output insert map entri




evalu std input std output

except

get custom except


enumer output key get enumer
item std output

retriev layer
enumer move next
string enumer current

vector elem type ref vec item second
index

copi output structur
ref vec

output index



except





summari evalu model input retriev output layer summari
param name input param
param name output key param
param name output size param
return result specifi layer return
list elem type evalu dictionari string list elem type input string output key output size

list elem type output gcnew list elem type output size
output size

output gcnew elem type


dictionari string list elem type output map gcnew dictionari string list elem type
output map output key output

evalu input output map

output map output key


i evalu model manag

nullptr




i evalu model manag



i evalu model manag

nullptr

destroy
nullptr




nativ model evalu
i evalu model elem type

summari copi element type structur structur summari
param name item param
return vector item return
share vector elem type copi list list elem type

share vector elem type lower vector elem type
nullptr

elem type item

lower push back item


lower


summari throw except base except summari
param name except except param
return except return
cntk except get custom except except

determin appropri except initi except payload
except with call stack runtim error

except with call stack runtim error rich dynam cast except with call stack runtim error runtim error
gcnew cntk runtim except gcnew system string rich gcnew system string rich call stack

except with call stack logic error

except with call stack logic error rich dynam cast except with call stack logic error logic error
gcnew cntk logic error except gcnew system string gcnew system string rich call stack

except with call stack invalid argument

except with call stack invalid argument rich dynam cast except with call stack invalid argument invalid argument
gcnew cntk invalid argument except gcnew system string gcnew system string rich call stack

alloc

gcnew cntk bad alloc except gcnew system string



gcnew cntk except gcnew system string




summari manag specif model evalu summari
remark thi necessari gener templat work remark
i evalu model manag f i evalu model manag


i evalu model manag f i evalu model manag f
i evalu model manag get eval f




summari manag specif model evalu summari
remark thi necessari gener templat work remark
i evalu model manag d i evalu model manag


i evalu model manag d i evalu model manag d
i evalu model manag get eval d




cntk except except


cntk except except


cntk except string messag except messag


cntk except string messag string callstack except messag nativ call stack callstack


string nativ call stack


cntk runtim except cntk except


cntk runtim except cntk except


cntk runtim except string messag string callstack cntk except messag callstack



cntk logic error except cntk except


cntk logic error except cntk except


cntk logic error except string messag string callstack cntk except messag callstack



cntk invalid argument except cntk except


cntk invalid argument except cntk except


cntk invalid argument except string messag string callstack cntk except messag callstack



cntk bad alloc except cntk except


cntk bad alloc except cntk except


cntk bad alloc except string messag cntk except messag



thi method trick compil emit method class
refer http msdn microsoft librari ms177213 aspx
explan behavior
emit

i evalu model manag f
init
evalu nullptr nullptr
evalu nullptr
evalu
creat network

i evalu model manag d
init
evalu nullptr nullptr
evalu nullptr
evalu
creat network




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
compil header
stdafx contain compil inform


stdafx

copyright microsoft right reserv
licens licens licens file project root full licens inform

network descript languag code use interpret network descript languag


defin secur warn secur avail platform file give variabl warn

model edit languag
convolut node
input and param node


microsoft cntk

equal insensit check node equal length first must least half actual node name
todo allow partial match seem misguid discourag remov
string1 compar comparis equal insensit sensit replac sensit version
string2 second compar
altern altern name
string equal insensit modifi string1 sensit version differ
equal insensit string1 string2 altern

equal strnicmp string1 string2 string1 size

allow partial match less half
equal string1 size strlen string2
equal

partial match replac full name
equal strcmp string1 string2
string1 string2

equal altern

equal strnicmp string1 altern string1 size

allow partial match less half
equal string1 size strlen altern
equal

match altern replac full name
equal
string1 string2


equal


mel properti properti set properti
mel properti

mel prop null
mel prop paramet updat requir
mel prop learn rate multipli
mel prop featur
mel prop label
mel prop final criterion
mel prop evalu
mel prop output
mel prop recurr


set group tag group node
node prop node properti clear
grouptag node ad remov group
properti ad properti delet
elem type
mel script elem type set group tag comput node base ptr node prop comput network ptr wstring group tag


add to node group group tag node prop

remov from node group group tag node prop


process ndl script process script
net ndl net ndl structur
ndl pass until complet process pass ndl pass all
full valid valid complet network might snippet full network
elem type
mel script elem type process ndl script net ndl elem type net ndl ndl pass ndl pass until full valid

ndl util elem type ndl util net ndl
ndl util process ndl script net ndl ndl pass until full valid


call function call
name name call
paramet
elem type
mel script elem type call function name config param list

name name
equal insensit name creat model creat blank model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet creat model newli creat model alway becom

make share comput network cpudevic
overrid model name and set default model

equal insensit name creat model with name creat blank model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet creat model with name model name newli creat model alway becom

make share comput network cpudevic
overrid model name and set default model

equal insensit name load model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet load model model file name format cntk newli load model alway becom

wstring model format get option model format num fix param

make share comput network cpudevic
load elem type
overrid model name and set default model

equal insensit name load model with name

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet load model with name model name model file name format cntk newli load model alway becom

wstring model format get option model format num fix param

make share comput network cpudevic
support specif kind legaci format sole purpos allow user convert load save
model format cntk legaci tensorlib

read elem type
node featur node
node set dim tensor shape node get sampl matrix num row node ha mb layout tensorlib input valu incorrect tensor dimens
compil network



load elem type
overrid model name and set default model

equal insensit name load ndl snippet

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet load ndl snippet model name ndlsnippet

model name
wstring ndl snippet file name
make share comput network cpudevic
ndl script elem type script
config paramet ndl script script read config file ndl snippet file name

check section snippet file wish read
section get option snippet section num fix param

section

ndl script exist section

runtim error section specifi option paramet found file section ndl snippet file name

config valu ndl snippet ndl script section
evalu ndl snippet ndl snippet



script load config file ndl snippet file name


overrid model name and set default model model name

equal insensit name save default model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet save default model model file name format cntk

wstring model format get option model format num fix param

wstring file name

net ndl default

runtim error save default model call name exist least model load

valid network save
process ndl script net ndl default ndl pass all
save edit file name

equal insensit name save model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet save model model name model file name format cntk

wstring model format get option model format num fix param

model name
wstring file name

net ndl elem type net ndl map name to net ndl model name
net ndl
runtim error save model call network setup activ model name model name

valid finish second line defin
process ndl script net ndl ndl pass all
net ndl save edit file name

equal insensit name set default model

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet set default model model name

set exist model as default

equal insensit name unload model

unload model take variabl paramet expect model name
size

model name
found map name to net ndl find model name
found map name to net ndl

found second clear
model clear
found second net ndl default
net ndl default nullptr
map name to net ndl eras found


fprintf stderr warn model exist model name


equal insensit name dump model dump

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet dump network model name file name includ data

includ data get option includ data valu num fix param

model name
wstring file name

found map name to net ndl find model name
found map name to net ndl
runtim error model exist cannot dump exist model model name


net ndl elem type net ndl found second
process ndl script net ndl ndl pass all
found second dump all node to file includ data file name


equal insensit name dump node

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet dump node node name file name includ data

includ data get option includ data valu num fix param

wstring file name

net ndl elem type net ndl
vector comput node base ptr node find symbol net ndl
process ndl script net ndl ndl pass all
net ndl dump node info to file node includ data file name

equal insensit name copi node copi

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet copi node from node to node copi valu

copi node flag copi flag get option copi node flag num fix param



copi node copi flag

equal insensit name copi sub tree

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet copi sub tree from node to network to node name prefix copi valu

copi node flag copi flag get option copi node flag num fix param



prefix
copi sub tree prefix copi flag

equal insensit name copi node input copi input

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet copi node input from node to node

node
net ndl elem type net ndl to
net ndl elem type net ndl from
vector gen name valu name gener name net ndl from net ndl to

net ndl from net ndl to
runtim error copi input requir symbol network belong differ network

process ndl script net ndl from ndl pass all
gen name valu name name

node name first
wstring node name node node name
wstring to node name name second

net ndl to copi node net ndl from node name to node name copi node flag copi node input link


equal insensit name set node input set input

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet set node input to node input id base input node name

node
net ndl elem type net ndl to
net ndl elem type net ndl from
vector comput node base ptr node to find symbol net ndl to
vector comput node base ptr node from find symbol net ndl from
input num

net ndl to net ndl from
runtim error set node input requir symbol network belong differ network

node from size
runtim error set node input must singl valu input repres item
node to size
runtim error set node input must least target repres item

process outstand script ensur input resolv
process ndl script net ndl from ndl pass resolv
node node to

node set input input num node from


equal insensit name set node input set input

size size
runtim error invalid paramet valid paramet set node input to node input node name1 input node name2 input node name3

node
net ndl elem type net ndl to
vector comput node base ptr node to find symbol net ndl to
node to size
runtim error set node input must exactli target repres node

vector comput node base ptr input node
input node resiz size

process outstand script ensur input resolv
process ndl script net ndl to ndl pass resolv

size

net ndl elem type net ndl from
vector comput node base ptr node from find symbol net ndl from

net ndl to net ndl from
runtim error set node input requir symbol network belong differ network

node from size
runtim error set node input input node translat node name translat multipl node name

input node node from


node to attach input input node

equal insensit name set properti

size
runtim error invalid paramet valid paramet set properti to node properti name properti valu

prop name
mel properti prop mel prop null
legaci
legaci name properti
equal insensit prop name final criterion criteria prop name criterion
equal insensit prop name prop name evalu
legaci properti work differ
equal insensit prop name need gradient need gradient equal insensit prop name comput gradient
prop mel prop paramet updat requir backward compat



properti name properti
pleas keep tabl sort
equal insensit prop name criterion prop mel prop final criterion
equal insensit prop name evalu prop mel prop evalu
equal insensit prop name featur prop mel prop featur
equal insensit prop name label prop mel prop label
equal insensit prop name learn rate multipli prop mel prop learn rate multipli
equal insensit prop name output prop mel prop output
equal insensit prop name recurr prop mel prop recurr
invalid argument invalid properti support prop name

node
net ndl elem type net ndl
vector comput node base ptr node find symbol net ndl

probab anyth make sure creat
process ndl script net ndl ndl pass initi

net ndl
node node

prop

mel prop paramet updat requir backward compat

node set learn rate multipli


mel prop learn rate multipli

node set learn rate multipli


mel prop featur


set group tag node featur


mel prop label


set group tag node label


mel prop final criterion


set group tag node criterion


mel prop evalu


set group tag node evalu


mel prop output


set group tag node output


mel prop recurr






runtim error invalid properti support prop name





equal insensit name set properti for sub tree

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet set properti for sub tree root node name properti name properti valu

prop name
mel properti prop mel prop null

equal insensit prop name need gradient need gradient equal insensit prop name comput gradient

prop mel prop paramet updat requir backward compat

equal insensit prop name learn rate multipli

prop mel prop learn rate multipli



runtim error invalid properti support prop name


node
net ndl elem type net ndl
vector comput node base ptr node find symbol net ndl

make sure link resolv
process ndl script net ndl ndl pass resolv

node node

prop

mel prop paramet updat requir backward compat

learn rate multipli
net ndl set learnabl node below learn rate multipli learn rate multipli node


mel prop learn rate multipli

learn rate multipli
net ndl set learnabl node below learn rate multipli learn rate multipli node




runtim error invalid properti support prop name





equal insensit name remov node remov equal insensit name delet node delet

net ndl elem type process
remov take variabl paramet expect node name wildcard pattern
size

node
net ndl elem type net ndl
vector comput node base ptr node find symbol net ndl

make sure process remov
process network valid start fail first
process find net ndl process

process ndl script net ndl ndl pass all
process net ndl


node size
runtim error delet must least target repres item
node node

net ndl delet node node node name



equal insensit name renam

size num fix param num option param
size num fix param num option param size num fix param
runtim error invalid paramet valid paramet renam old node name new node name

node
net ndl elem type net ndl to
net ndl elem type net ndl from
vector gen name valu node name gener name net ndl from net ndl to

net ndl from net ndl to
runtim error copi input requir symbol network belong differ network

process everyth node tag
process ndl script net ndl from ndl pass all

origin node name input gener output node name
gen name valu node name node name

node node name first
net ndl from renam node node node name second


equal insensit name revis paramet

learnabl paramet elem type learnabl paramet node
size
runtim error invalid paramet valid paramet revis paramet node name node paramet in ascii path name
node name
param path

net ndl elem type net ndl
vector comput node base ptr node find symbol net ndl

p node node

p node oper name learnabl paramet elem type type name

fprintf stderr warn want chang paramet node learnabl paramet node skip node
p node node name p node oper name


share learnabl paramet node p param node dynam pointer cast learnabl paramet node p node
p param node revis from file msra strfun utf16 param path
fprintf stderr revis node paramet file p node node name param path




runtim error unknown editor name



mel script
mel script


copyright microsoft right reserv
licens licens licens file project root full licens inform

defin entri point consol applic


defin secur warn secur avail platform file give variabl warn

stdafx

chrono

basic
comput network
data reader
simpl network builder

simpl evalu
network descript languag
ndl network builder


microsoft cntk

unus build without simpl sgd present solut
elem type
test bing config paramet config

config exist train

cout usag train featur dim network descript learn rate per mb mb size epoch size max epoch outdir test test size endl



size vdim config featur dim
size udim
vector wstring filepath
filepath push back config train

data reader elem type data reader vdim udim filepath config
config array layer size config network descript
simpl network builder elem type net builder layer size train criterion squar error eval criterion squar error sigmoid data reader


config array learn rate per mb config learn rate per mb
config array mb size config mb size
size epoch size config epoch size
size max epoch config max epoch
momentum per mb
out dir config outdir
wstring model path wstring msra strfun utf16 out dir append bingranknet

simpl sgd elem type learn rate per mb mb size epoch size max epoch model path momentum per mb
train net builder data reader

cout endl endl endl endl test endl

test
vector wstring testfilepath
testfilepath push back config test
size test size config test size
data reader elem type test data reader vdim udim testfilepath config

wstring final net path model path append append wstring max epoch

simpl evalu elem type net builder load network from file final net path
evalu test data reader 1024 final net path append result test size



elem type
do eval config paramet config
config record type elem type
do train config record type config

elem type
test m nist config paramet config base

config paramet config config base mnist train
do train config paramet elem type config
config paramet config test config base mnist test
do eval elem type config test


elem type
test speech config paramet config base

config paramet config config base speech train
do train config paramet elem type config
config paramet config test config base speech test
do eval elem type config test


elem type
test reader config paramet config base

nonexist config base nonexist test except handler
config paramet config config base mnist test
config paramet reader config config reader
reader config insert trace level config trace level

size mb size config minibatch size
size epoch size config epoch size
epoch size

epoch size request data size


data reader data reader reader config

name featur label
vector wstring featur name
vector wstring label name
get file config name reader config featur name label name

setup minibatch matric
devic id
featur matrix make share matrix elem type devic id
label matrix make share matrix elem type devic id
mb layout ptr p mb layout make share mb layout
stream minibatch input matric
matric add input featur name featur matrix p mb layout tensor shape
matric add input label name label matrix p mb layout tensor shape

start chrono system clock
epoch config max epoch
epoch
epoch epoch epoch epoch

data reader start minibatch loop mb size epoch epoch size

data reader get minibatch matric

matrix elem type featur matric get input matrix elem type featur name
matrix elem type label matric get input matrix elem type label name

label get num row

fprintf stderr featur featur get num row featur get num col featur featur



fprintf stderr featur label featur get num row featur get num col featur featur label get num row label get num col label label



chrono system clock
elaps start
fprintf stderr second elaps chrono durat cast chrono millisecond elaps count 1000


elem type
test sequenc reader config paramet config base

nonexist config base nonexist test except handler
config paramet config config base sequenc test

size mb size config minibatch size
size epoch size config epoch size
epoch size

epoch size request data size


file type file type file type

config paramet reader config config file type reader sequenc reader sentenc
reader config insert trace level config trace level

vector wstring featur name
vector wstring label name
get file config name reader config featur name label name

data reader data reader reader config

name featur label
vector wstring file
file push back reader config file

setup minibatch matric
featur matrix make share matrix elem type
label matrix make share matrix elem type
mb layout ptr p mb layout make share mb layout
stream minibatch input matric
matric add input featur name featur matrix p mb layout tensor shape
matric add input label name label matrix p mb layout tensor shape

start chrono system clock
epoch config max epoch
epoch
epoch epoch epoch epoch

data reader start minibatch loop mb size epoch epoch size
data reader get minibatch matric

featur matric get input matrix elem type featur name
label matric get input matrix elem type label name
fprintf stderr featur label featur get num row featur get num col featur featur label get num row label get num col label label


chrono system clock
elaps start
fprintf stderr second elaps chrono durat cast chrono millisecond elaps count 1000



is paramet config valu param map valu

param map find valu param map


elem type
test macro config paramet config base

ndl script elem type script config base ndl full
comput network ptr make share comput network
ndl node evalu impl elem type node evalu
script evalu node evalu ndl pass initi


elem type
test configur config paramet config base

config paramet config macro config base macro exampl
iter macro config macro iter macro config macro iter macro

config valu param map
config paramet config cn iter macro second
config cn exist paramet

config array config cn paramet
size
param map config valu uniniti

config paramet config node config cn node list
iter config node
iter config node iter

wstring node name
node name msra strfun utf16 iter first
config array config node iter second
op name config node
is paramet param map op name



op name input valu config node size

size row
is paramet param map config node
row config node

op name learnabl paramet config node size

size row
is paramet param map config node
row config node
size col
is paramet param map config node
col config node
learn rate multipli
init
config array init data

look option paramet
config node size

need gradient
config paramet config param config node
config param exist learn rate multipli todo test rather exist
need gradient config param learn rate multipli
config param exist init

init
init data config param init


initi
init

uniform
elem type init valu scale
size input size col

init data size
init valu scale init data
init data size
uniform equal ci init data uniform




link node
config node config cn relat
iter config node iter config node iter

wstring node name msra strfun utf16 iter first
config array config node iter second
num children config node size
num children

wstring node name config node



config paramet config root config cn root node
config array config node config root featur node
size config node size

wstring node name config node


config root exist label node

config node config root label node
size config node size

wstring node name config node



config root exist criterion node

config node config root criterion node
size config node size

wstring node name config node



config root exist criteria node legaci

config node config root criteria node
size config node size

wstring node name config node



config root exist node req multi seq handl

config node config root node req multi seq handl
size config node size

wstring node name config node

fprintf stderr warn node req multi seq handl flag defunct


config root exist eval node

config node config root eval node
size config node size

wstring node name config node



config root exist output node

config node config root output node
size config node size

wstring node name config node





elem type
test command line config paramet config base

command line
config paramet config config base commandlin
config paramet string test config string test
config paramet unicod test string test unicod test
config paramet array test config array test
config paramet dict test config dict test
config file pars basic type

config 5555
cout endl
config nother 1234
cout endl
8100000
config 5555
cout endl
config nother 1234
size 12345678901234
thing ask nest config
unicod test 5555
cout endl
unicod test nother 1234
size 12345678901234
size config size 5555
cout endl
config nother 1234

stuff level config level
unicod test
command unicod test command

bool true
config bool true
bool fals
config bool fals
bool impli true
config bool impli true

config exist bool impli fals

config nother
cout endl
1234 5678
config
cout endl
config nother
23456e
config
cout endl
string test nother 2345
string1
string test
string test nother
cout endl
string test nother def string
cout endl
string quot thi quot
string test string quot
wstring
wstring wstr unicod test wstring
wstr wstring unicod test nother new valu
wcout wstr endl
wstr wstring unicod test nother def wstring
wstring quot 東京に行きましょう．
wstring wstr quot unicod test wstring quot

test
array empti
config array array empti array test array empti
array singl hello
config array array singl array test array singl
array multipl hello
config array array multipl array test array multipl
array multipl brace hello brace
config array array multipl brace array test array multipl brace
array multipl array test nother array multipl brace longer support need
array multipl separ brace hello custom separ brace
config array array multipl separ brace array test array multipl separ brace
array quot string
path space file
1999 file

config array array quot string array test array quot string
array quot string
array quot string
array repeat
config array array repeat array test array repeat
array hetro 234e56 dict first second
config array array hetro array test array hetro
array hetro
wstr wstring array hetro
array hetro
array hetro
array hetro
config paramet dict array hetro
name dict name
array nest first second third ident separ nest
config array array nest array test array nest
name array nest name
config array array1 array nest
name array1 name
config array array2 array nest
name array2 name
config array array3 array nest
name array3 name
config array array4 array nest

dictionari test
dict empti
config paramet dict empti dict test dict empti
dict singl first
config paramet dict singl dict test dict singl
dict multipl first hello second
config paramet dict multipl dict test dict multipl
dict multipl brace first hello second third forth brace
config paramet dict multipl brace dict test dict multipl brace
dict multipl dict test nother dict multipl brace longer support need
dict multipl separ brace first hello second third bool forth fifth quot sixth seventh brace
config paramet dict multipl separ brace dict test dict multipl separ brace
dict quot string
file
path space file
1999 file

map path space

config paramet dict quot string dict test dict quot string
array quot string dict quot string file
map dict quot string map
map

nest
dict nest

dict1 dict2 dict3
embed comment name dictionari

first
second
third


first second third forth embed separ



dict2 first second third
dict3
first second
third
forth fifth


config paramet dict nest config dict nest
name dict nest name
config array dict nest
name name
config paramet dict element1
name dict element1 name
config paramet dict element2
name dict element2 name
config array array nest
name array nest name
config paramet dict n element1 array nest
name dict n element1 name
config paramet dict n element2 array nest
name dict n element2 name
config paramet dict2 dict nest dict2
name dict2 name
config paramet dict3 dict nest dict3
name dict3 name


file file temp test file option read file option text
marker
file tri get marker file marker begin section bval

file tri get marker file marker begin section bnew

file tri get marker file marker begin section other


file
printf



test configur elem type config base
test macro elem type config base


elem type
test cn config paramet config

test command line elem type config
test sequenc reader elem type config
test reader elem type config
test m nist elem type config
test speech elem type config
test bing elem type config


test cn config paramet config
test cn config paramet config

gener test routin
gener templat

config paramet config
test cn config
test cn config


copyright microsoft right reserv
licens licens licens file project root full licens inform

cntk defin entri point consol applic


defin nonstdc deprec make accept posix function without

stdafx
basic
action
comput network
comput node
data reader
data writer
simpl network builder
ndl network builder
model edit languag
cpu matrix use set num thread
common matrix

mpi wrapper
config
simpl evalu
simpl output writer
best gpu
progress trace
fileutil
scriptabl object
brain script evalu
brain script parser


chrono
algorithm
defin win32

delay imp
pragma comment delayimp
pragma comment shlwapi

buildinfo
hostnam
ifdef leakdetect
memori leak detect

vector
iostream
queue

memori

ifndef
defin


todo temporari mechan enabl memori share
node output valu matric thi away
share readi enabl
share node valu matric


microsoft
microsoft cntk

test routin forward declar
elem type
test cn config paramet config

redirect std err wstring logpath

logprintf stderr redirect stderr file logpath
make share file logpath file option write file option text
dup2 fileno

runtim error unexpect failur redirect stderr file

setvbuf stderr ionbf 16384 unbuff
f kept keep around get chang


w char to string wchar

wstring

assign



todo thi action move action lib
elem type
dump node info config paramet config

wstring model path config model path
wstring node name config node name all node
wstring node name regex str config node name regex
wstring def out file path model path node name
wstring output file config output file def out file path
print valu config print valu
print metadata config print metadata
print valu print metadata

invalid argument print valu print metadata sinc noth dump


comput network alway
load elem type model path todo combin previou line
dump node info to file node name print valu print metadata output file node name regex str


size get max epoch config paramet config param

config paramet config sgd config param
size max epoch config sgd max epoch

max epoch


special temporari guard invalid usag truncat exist product setup
disabl legaci truncat set config paramet top level config config paramet command config

top level config exist current truncat




action reader section differ truncat valu reader section
config array action command config action
size action size

action train action train rnn

config paramet config paramet command config
config paramet reader config paramet command config reader
reader section must section train train rnn
reader exist current truncat exist current truncat

invalid argument disabl legaci usag set truncat reader section allow pleas move truncat level section




disabl legaci usag config paramet top level config config array command

size command size

config paramet cfg paramet top level config command
disabl legaci truncat set top level config cfg paramet



when run parallel command commandsto run on all rank
parallel across multipl rank other rank
commandsto run on all rank train train rnn adapt test devtest

process command
elem type
do command config paramet config share mpi wrapper

config array command config command train

num cpu thread config num cpu thread
num cpu thread cpu matrix elem type set num thread num cpu thread

num cpu thread

logprintf stderr use thread num cpu thread


progress trace config progress trace

temporari hack prevent user fail small break chang relat truncat flag redon bigger better
disabl legaci usag config command

summar command info upfront stdout
size full total max epoch
command size

configur paramet match command
config paramet command param config command
config array action command param action train

determin action perform
action size

action train action train rnn

wstring model path command param model path
logprintf stderr cntk model path model path
size max epoch get max epoch command param
logprintf stderr cntk command train info command max epoch
full total max epoch max epoch



logprintf stderr cntk command train info cntk no more command total full total max epoch

progress trace comput cluster manag
progress trace is main node

progress trace set trace flag
progress trace trace total number of step full total max epoch enabl trace total epoch


size full epoch offset

execut command
command size

configur paramet match command
config paramet command param config command
config array action command param action train

progress trace nullptr is main node

progress trace set step offset full epoch offset epoch rel


determin action perform
action size

thi action action

banner visual separ action
delim
prefix action
fprintf stderr
logprintf stderr delim
logprintf stderr strlen delim
logprintf stderr prefix thi action strlen delim strlen prefix thi action size
logprintf stderr strlen delim
logprintf stderr delim

nullptr commandsto run on all rank find thi action commandsto run on all rank is main node

thi action train thi action train rnn

logprintf stderr cntk command train begin command
do train config paramet elem type command param
logprintf stderr cntk command train end command
full epoch offset get max epoch command param

thi action adapt

do adapt elem type command param

thi action test thi action

do eval elem type command param

thi action edit

do edit elem type command param

thi action

do cross valid elem type command param

thi action write

do write output elem type command param

thi action devtest

test cn elem type config devtest action root config instead

thi action dumpnod

dump node info elem type command param

thi action convertdbn

do convert from dbn elem type command param

thi action exportdbn

do export to dbn elem type command param

thi action creat label map

do creat label map elem type command param

thi action write word and class

do write word and class info elem type command param

thi action plot

do topolog plot elem type command param

thi action

do paramet svd elem type command param



runtim error unknown action command thi action command



fprintf stderr
logprintf stderr action complet thi action

ndl script elem type ndl script
ndl script clear global clear macro command

synchron rank proceed action command

wait all




time date stamp

time time
localtim

sprintf year 1900 mday hour



print built info

logprintf stderr
logprintf stderr build info
logprintf stderr t built time date time
logprintf stderr t last modifi date timestamp
ifdef buildtyp
logprintf stderr t build buildtyp

ifdef buildtarget
logprintf stderr t build target buildtarget

ifdef with 1 bitsgd
logprintf stderr t with 1bit with 1 bitsgd

ifdef mathlib
logprintf stderr t math mathlib

ifdef cuda path
logprintf stderr t cuda path cuda path

ifdef path
logprintf stderr t cub path path

ifdef cudnn path
logprintf stderr t cudnn path cudnn path

ifdef exist
logprintf stderr t build branch buildbranch
logprintf stderr t build sha1 buildsha1

ifdef builder
logprintf stderr t built builder buildmachin

ifdef buildpath
logprintf stderr t build path buildpath

logprintf stderr


print usag info

logprintf stderr
logprintf stderr usag cntk config file your config file
logprintf stderr detail inform pleas consult cntk book
logprintf stderr introduct comput network comput network toolkit
logprintf stderr



main brain script


wstring consum arg vector wstring arg

arg
invalid argument unexpect command line
wstring arg front
arg eras arg


what
append vector wstring to what what

to what insert to what

wstring path to bs string liter wstring path quot pathnam

ha singl quot path find path wstring npo
ha doubl quot path find path wstring npo
ha singl quot ha doubl quot
invalid argument pathnam cannot contain singl quot time path
ha singl quot
path

path


todo decid also need three variabl
wstring standard function
wstring common macro
wstring comput node

wmain with bs argc wchar argv call wmain wrapper catch report win32 except

vector wstring arg argv argv argc
exe path consum arg arg

startup messag
redirect stderr print twice upfront redirect goe file
wstring startup messag msra strfun wstrprintf run msra strfun utf16 get host name msra strfun utf16 time date stamp
startup messag msra strfun wstrprintf command line exe path
arg
startup messag

logprintf stderr startup messag

pars command line option
vector wstring sourc file
vector wstring includ path
vector wstring overrid
wstring work dir
arg

option consum arg arg
option option file defin sourc file
append sourc file msra strfun split consum arg arg
option declar search path
append includ path msra strfun split consum arg arg
option defin variabl command line
overrid push back consum arg arg
option set work directori
work dir consum arg arg

invalid argument invalid command line option option


chang work directori
work dir
wchdir work dir

compil brain script
wstring
cntk core start includ standard macro

note use lowercas match linux name cntk
standard function comput node common macro
sourc file sourc file
path to bs string liter sourc file

overrid


fprintf stderr
logprintf stderr brain script

expr pars config express move includ path pars
valp evalu expr evalu pars dictionari
config valp as ref scriptabl object i config record dictionari

legaci paramet chang spell
config find done file variabl follow camel start lower letter
invalid argument legaci spell done file longer allow done file

config find command spell error plural use action instead match
invalid argument legaci spell command longer allow action

config find
invalid argument legaci name longer allow precis

parallel train
share microsoft cntk mpi wrapper
paralleltrain config parallel train
paralleltrain
mpi wrapper get instanc creat

share node valu matric config share node valu matric

trace gpu memori alloc set trace level config trace gpu memori alloc

log
wstring logpath config stderr
logpath

logpath action todo cntk concaten action name longer know
logpath todo need append

paralleltrain
logpath msra strfun wstrprintf rank current node rank

redirect std err logpath
logprintf stderr startup messag


config info
print built info

execut action
config precis
num cpu thread config num cpu thread
num cpu thread cpu matrix set num thread num cpu thread
num cpu thread
logprintf stderr use thread num cpu thread

progress trace config progress trace
size full total max epoch bugbug allow read epoch paramet would instanti thu execut object

progress trace comput cluster manag
progress trace nullptr is main node
progress trace trace total number of step full total max epoch enabl trace total epoch

main loop execut action
action val config action

note weird behavior action scalar valu rather resolv alreadi call that mean alreadi complet action
pretti direct consequ lazi evalu good solut would syntax array includ length
sinc behav indistinguish keep
action val scriptabl object config array

scriptabl object config array action action val
action get index rang first action get index rang second

todo when run parallel command commandsto run on all rank
parallel across multipl rank other rank
action wstring

evalu thu execut action


action alreadi execut comment

write done file request
wstring done file config done file
done file

file fopen or die done file
fprintf success finish time date stamp get host name
fclose or die

todo chang back complet underscor look good output
logprintf stderr complet
fflush stderr

mpi wrapper delet instanc
exit success



main cntk config languag

call wmain wrapper catch repot win32 except
wmain old cntk config argc wchar argv

config paramet config
raw config string config paramet pars command line argc argv config command param want
timestamp config timestamp
timestamp

progress trace set timestamp flag


command param want
wstring logpath config stderr

2015 done file use
wstring done file config done file
config array command config command train

paralleltrain train
share microsoft cntk mpi wrapper
paralleltrain config parallel train
paralleltrain
mpi wrapper get instanc creat

share node valu matric config share node valu matric

trace gpu memori alloc set trace level config trace gpu memori alloc

logpath

command size

logpath
logpath wstring command

logpath

paralleltrain

wostringstream
current node rank
logpath rank

redirect std err logpath


print built info goe file
timestamp time date stamp

dump config info
fprintf stderr
logprintf stderr run get host name timestamp
logprintf stderr command line
argc
fprintf stderr argv space better visual separ
fprintf stderr

debug
thi simpli merg differ config paramet specifi config file command line directli
print
fprintf stderr
logprintf stderr config variabl resolv
logprintf stderr raw config string
logprintf stderr config variabl resolv

same variabl resolv paramet multipl time config overridden command line
assign appear even though last assign matter
fprintf stderr
logprintf stderr config with variabl resolv
logprintf stderr config resolv variabl raw config string
logprintf stderr config with variabl resolv

thi output valu variabl paramet assign config paramet multipl time last
valu appear
fprintf stderr
logprintf stderr process config with variabl resolv
config dump with resolv variabl
logprintf stderr process config with variabl resolv


logprintf stderr command
command size
fprintf stderr command
fprintf stderr

command
config precis
accept precis backward compat
config exist
invalid argument cntk paramet deprec call precis

logprintf stderr precis


do command config

do command config

runtim error cntk invalid precis must

complet write done file request
done file

file fopen or die done file
fprintf success finish time date stamp get host name
fclose or die

todo chang back complet underscor
logprintf stderr complet
fflush stderr

mpi wrapper delet instanc
exit success


handler call stack upon alloc failur
alloc failur handler

microsoft cntk debug util print call stack
handler nullptr
alloc



main wrapper catch except print


wmain1 argc wchar argv call wmain wrapper catch report win32 except

handler alloc failur handler



print built info build info directli user provid zero argument conveni check build

argc

logprintf stderr command line argument given
print usag info
exit failur


detect legaci cntk configur
is old cntk config
argc is old cntk config
is old cntk config wcsnicmp config file argv

is old cntk config
wmain old cntk config argc argv

brain script
wmain with bs argc argv

scriptabl object script except

fprintf stderr
logprintf stderr except occur
print error
exit failur

i except with call stack base

fprintf stderr
logprintf stderr except occur dynam cast except call stack
exit failur

except

fprintf stderr
logprintf stderr except occur
exit failur



fprintf stderr
logprintf stderr unknown error occur
exit failur



ifdef window
termin thi

logprintf stderr termin abort
fflush stderr
exit failur


defin except found vcpp except error sever error error found

log delay load error pexcept pointer p exc pointer

p exc pointer except record except code except found

p delay load info p delay load info p exc pointer except record except inform
logprintf stderr cntk fail load p delay load info sz dll



wmain argc wchar argv wmain wrapper report win32 except

termin termin thi insert termin handler stderr get flush actual termin
error mode stderr make sure prompt cntk execut

note seem work process seem hang instead termin


wmain1 argc argv

log delay load error get except inform except execut handler

code get except code

code except access violat access violat famou 0xc0000005 error
code except divid zero integ divis zero
code except stack overflow stack overflow
code except found modul found
logprintf stderr cntk caught win32 except code
fflush stderr
exit failur




ifdef unix
unix main convert encod pass visual studio style wmain take wchar string
main argc argv

todo chang contain
wchar warg wchar argc
argc

warg wchar strlen argv
size mbstowc warg argv strlen argv
strlen argv

wmain1 argc warg
argc
warg
warg



brain script test test

defin secur warn secur avail platform file give variabl warn

basic
brain script evalu
brain script parser

ifndef
defin


microsoft


msra strfun

note current seem master copi check whether also chang

wstring standard function comput node common macro

todo newer merg experimentalthingi

wstring standard function
print valu format print action valu format
fail fail action
requir paramet messag fail requir paramet messag
format valu format string function format valu format
replac string function replac replacewhat withwhat
substr string function substr char
string function
floor numer function floor
length numer function length
ceil floor
round floor

sign




wstring comput node bugbug option arg work scope problem caus circular refer
mean comput node mean node input
inv std dev comput node inv std dev node input
per dim mean var normal feat mean inv std dev comput node per dim mean var normal node input feat mean inv std dev
paramet out d paramet comput node learnabl paramet node out dim out d in dim
input featur paramet todo
row slice first row row featur comput node row slice node input featur first first row row
delay delay recurr comput node delay node input delta t delay
sigmoid comput node sigmoid node input
comput node log node input
cross entropi with softmax label out z comput node cross entropi with softmax node input label out z
error predict label out z comput node error predict node input label out z

wstring common macro todo renam row col in dim out dim vice versa whichev
row col paramet row init fixedvalu valu paramet row col
sbff row col sigmoid row col
mean var norm feat per dim mean var normal feat mean feat inv std dev feat
log prior label mean label



some test



collect sort test case
wchar parser test

paramet input paramet
print
print action
print string function format
print string function format
print action hello world oop
string function format print result delta delta
print print hello world
print format fortytwo fortytwo
print
print
print offset offset
recurs
print
ndl comput network
feat dim label dim 9000 hidden dim 2048 num hidden layer
my featur input feat dim my label input label dim
feat norm mean var norm my featur
hidden stack layer layer sbff hidden stack layer hidden dim hidden dim sbff feat norm hidden dim feat dim
out layer hidden stack num hidden layer label dim hidden dim
out z out layer
cross entropi with softmax my label out z
error predict my label out z
log prior log prior my label
scale log likelihood out z log prior

factori
print
fibonacci sequenc memoiz
print fib fib val val val val

print
ndl comput network
feat dim label dim 9000 hidden dim 2048 num hidden layer
my featur input feat dim featur my label input label dim label
feat norm mean var norm my featur
layer layer num hidden layer layer sbff layer layer hidden dim hidden dim sbff feat norm hidden dim feat dim
out layer layer num hidden layer label dim hidden dim
out z out layer delay out z
cross entropi with softmax my label out z
error predict my label out z
log prior log prior my label
scale log likelihood out z log prior

window
print
ndl comput network
hidden dim
num hidden layer
total context window

sourc
feat dim label dim 9000
my featur input feat dim my label input label dim

split augment input vector individu frame vector
subfram row slice feat dim feat dim my featur

hidden layer
layer layer num hidden layer layer store dict store hidden state vector
model paramet
paramet hidden dim feat dim paramet outdim indim
layer paramet hidden dim hidden dim fail input hidden
paramet hidden dim hidden dim hidden hidden
paramet hidden dim hidden dim
paramet hidden dim bia
share part activ input connect bia
share layer
layer layer layer layer
subfram

recurr part linear
step sigmoid
share
share
step
step

output layer linear point softmax appli later
out layer
model paramet
paramet label dim hidden dim
paramet label dim hidden dim
paramet label dim
output
top hidden layer layer num hidden layer
center t floor
top hidden layer center t top hidden layer center t

out z out layer want care rest dictionari

defin criterion node
cross entropi with softmax my label out z
error predict my label out z

defin output node decod
log prior log prior my label
scale log likelihood out z log prior minu log prior output

fail dict outsid express name local
print
dict out y input ndl comput network out z dict out y

option print option option valu

first
one onli first
size first parser test

fprintf stderr test fflush stderr
parser test parser test
expr pars config dict from string standard function comput node common macro parser test vector wstring
expr dump
expr
one onli



config except

print error


namespac
config parser config parser syntact sourc express tree

defin secur warn secur avail platform file give variabl warn

brain script parser
file
cstdio
cstdlib
cctype

vector
dequ

stdexcept
algorithm

ifndef
defin


microsoft


msra strfun
microsoft cntk


sourc file text refer locat


sourc file constructor
sourc file sourc file wstring locat wstring text
path locat line split text

command line
sourc file sourc file wstring path
path path file

file path file option read file option text get line line


text locat is valid

sourc file as index size


sourc file text posit point start
text locat text locat new sourc file sourc file sourc file

text locat
line no
char po
sourc file as index sourc file map size index store sourc file
sourc file map push back move sourc file take ownership sourc file give numer index



helper pretti print error show sourc code line mark point error
issu

text locat locat lineno sourc file posit print overal error
wstring markup markup symbol posit dot inbetween
add markup wchar size char po

char po markup size
markup resiz char po fill desir posit
markup char po overwrit
markup char po

issu text locat locat
locat locat




trace
text locat trace text locat locat wchar trace kind wchar wchar expr path

fprintf stderr path trace kind expr path
line locat get sourc file line
line locat line no line size line locat line no
issu issu locat
issu add markup locat char po
fprintf stderr line issu markup


report error
sourc line shown posit mark
becaus often hard recogn issu point occur also report histori compact visual form
sinc often multipl context sourc line sourc line consecut context
text locat print issu vector text locat locat wchar error kind wchar kind wchar

vector issu issu trace error backward
size symbol index
size locat size

locat locat
locat is valid mean thrower locat context

build
symbol index locat line no issu back locat line no locat sourc file as index issu back locat sourc file as index

issu size


issu push back locat

indic mani step back sequenc
wchar
symbol index

symbol index
wchar symbol index
symbol index
wchar symbol index
symbol index
wchar symbol index


symbol index
insert markup
issu back add markup locat char po

backward
locat resili thrower textr locat avoid

first loc issu front locat
fprintf stderr line error kind kind first loc line no report base first loc char po first loc get sourc file path
fprintf stderr locat mark parent context mark
issu rbegin issu rend

issu
issu locat
line get sourc file line
line line no line size line line no
fprintf stderr line issu markup


fprintf stderr error kind
fflush stderr

vector sourc file text locat sourc file map


reader read sourc code includ load disk


code sourc

vector text locat locat stack parent locat includ file
text locat cursor current locat
wchar current line cach cursor get sourc file line cursor line no
updat current line cursor
cach current line

line cursor get sourc file line
cursor line no line size
current line nullptr

current line line cursor line no



sourc file insid push sourc file
set sourc file sourc file sourc file

cursor text locat new sourc file move sourc file save sourc file cursor start
cach current line cach current line



code sourc except config except


code sourc except wstring text locat
config except


config except wchar kind

read sourc



declspec noreturn fail wstring text locat

microsoft cntk debug util print call stack
code sourc except


enter sourc file start result statement
push sourc file sourc file sourc file

locat stack push back cursor
set sourc file move sourc file


insid file
is in includ

locat stack size


done sourc file onli call nest file outermost must pop
pop sourc file

is in includ
logic error pop sourc file locat stack
cursor locat stack back restor cursor came
cach current line cach current line
locat stack back


current cursor rememb token also use throw error
text locat get cursor

cursor


charact current posit
special case
line return
file return
wchar got char

current line
file
current line cursor char po
line

current line cursor char po


chan also address current charact pass stdlib funcion wcstod
wchar got char ptr

current line cursor char po


advanc cursor char across line boundari
consum char size char

got char

logic error consum cannot beyond sourc file
char

char
logic error consum cannot beyond line
cursor line no
cach current line line chang cach line
cursor char po


cursor char po char


charact
wchar get char

consum char
got char




lexer iter sourc code return token token


lexer code sourc

wstring keyword
wstring punctuat
vector wstring includ path


lexer vector wstring includ path
code sourc includ path includ path current token text locat

keyword wstring





punctuat wstring










token kind

invalid
punctuat
numberliter
stringliter
booleanlit
identifi
keyword
todo liter identifi


token

wstring identifi keyword punctuat liter

token kind kind
text locat begin locat text first charact token
is line initi token first line ignor comment
token text locat
begin locat kind invalid is line initi


diagnost helper
wstring token kind to string token kind kind

kind

invalid
invalid
punctuat
punctuat
numberliter
numberliter
stringliter
stringliter
identifi
identifi
keyword
keyword



unknown


wstring to string show content token debug

kind str token kind to string kind
kind

numberliter
kind str wstrprintf
stringliter
kind str
identifi
keyword
punctuat
kind str

kind str




lexer except config except


lexer except wstring text locat
config except


config except wchar kind

token




declspec noreturn fail wstring token

microsoft cntk debug util print call stack
lexer except begin locat


find file either given locat travers path
wstring find sourc file wstring path vector wstring includ path

file exist path
path
exist path scan path
todo thi littl weird rather done call site
file name file file name of path
includ path

todo separ match path
new path file name
file exist new path
new path

path directori
file directori path of file get execut path
new path file name
file exist new path
new path
found unmodifi caller fail
path


token current token
consum input charact form token
mutat cursor current token
white space comment skip
includ file handl
cursor left first charact belong token
todo need know whether want
token next token

got char
skip white space
rememb whether cross line dictionari assign newlin syntact accept
cross line end get cursor line no get cursor char po
iswblank

cross line end
get char

token get cursor
is line initi cross line end
handl file


is in includ

includ path eras includ path current file
pop sourc file
next token tail call current get drop ignor
is line initi line


realli sourc code done call multipl time keep return
kind

iswdigit iswdigit got char ptr

begin ptr got char ptr
wchar end ptr nullptr
wcstod begin ptr end ptr bugbug seem honor local set need with cntk pars right germani
end ptr begin ptr
fail pars realli happen
kind numberliter
end ptr end ptr prevent token
end ptr
consum char end ptr begin ptr

iswalpha identifi keyword

iswalpha iswdigit insid also allow digit

push back
get char

check keyword
keyword find keyword
kind keyword

kind identifi
special path


name tok next token must follow liter
name tok kind stringliter
fail must follow quot name tok
path find sourc file name tok includ path
push sourc file sourc file path current cursor right pathnam pick later
includ path insert includ path file directori path of path
next token


0x27 liter

kind stringliter
rememb quot charact
get char consum quot charact
note string escap charact consid

append
get char

runaway
fail without close quotat mark
get char consum close quot

punctuat

kind punctuat

append get char first punctuat
punctuat find punctuat
get char need consum second
singl

back drop last
punctuat find punctuat unknown
fail unexpect charact

special comment


consum char wcslen got char ptr
next token



got char
get char note test leverag circuit evalu semant
get char

fail comment without close
get char consum
next token token






token got token

current token

consum token

current token next token

token get token

consum token
got token


simpl test
test

lexer test cntk train main ntrain test test line
push sourc file sourc file command line lexer test
got token kind lexer token kind

token got token first token
fprintf stderr token to string
consum token

fail error test get cursor




parser pars configur


diagnost helper content
express dump indent

fprintf stderr indent

fprintf stderr

fprintf stderr

fprintf stderr

fprintf stderr

fprintf stderr

fprintf stderr
arg

fprintf stderr
arg
dump indent

name arg

fprintf stderr
name arg

fprintf stderr indent first
second second dump indent


fprintf stderr


parser lexer

error
pars except config except


pars except wstring text locat
config except


config except wchar kind

pars



declspec noreturn fail wstring token

microsoft cntk debug util print call stack
pars except begin locat


expect wstring fail strprintf expect got token begin locat know work
expect wstring

fail expect got token begin locat


token must punctuat check
consum punctuat wchar

got token
kind punctuat
expect wstring
consum token


token must keyword check
consum keyword wchar

got token
kind keyword
expect wstring
consum token


token must identifi check token return identifi
wstring consum identifi

got token
kind identifi
expect identifi

consum token



wstring infix preced preced level oper

parser sourc file sourc file vector wstring includ path
lexer move includ path

infix preced wstring
also sort operand








set sourc file move sourc file
consum token first token

express ptr operand from token symbol token helper make operand express consum

operand make share express begin locat
consum token
operand

express ptr pars operand stop at newlin

got token
express ptr operand
kind numberliter numer liter

operand make share express begin locat wstring
consum token

kind stringliter liter

operand make share express begin locat
consum token

liter

operand make share express begin locat wstring
consum token

kind identifi dict member unqualifi

operand make share express begin locat
operand consum identifi

unari oper


operand make share express begin locat encod
consum token
operand arg push back pars express stop at newlin



operand operand from token symbol
operand consum identifi
operand arg push back pars operand stop at newlin

condit express

operand operand from token symbol
operand arg push back pars express condit
consum keyword
operand arg push back pars express express
consum keyword
operand arg push back pars express express

nest parenthes

consum token
operand pars express across newlin content paren becom part express tree
consum punctuat

dictionari

operand make share express begin locat
consum token
operand name arg pars record member
consum punctuat



operand operand from token symbol
consum punctuat
operand arg push back pars express first index
consum punctuat
operand arg push back pars express last index
consum punctuat
consum punctuat
operand arg push back pars express argument initi
consum punctuat


expect operand
operand return avoid control path valu

express ptr pars express requir preced stop at newlin

left pars operand stop at newlin first operand


op tok got token
bugbug stop at newlin broken
prevent accept
hand would prevent total valid dict dict2
correct solut semicolon newlin
continu pars across newlin syntact meaning ambigu brain script
stop at newlin op tok is line initi

op iter infix preced find op tok
op iter infix preced done left express

op preced op iter second
op preced requir preced requir preced level belong express

op tok
oper make share express op tok begin locat left left operand macro applic
deal special case first
treat member lookup macro applic index togeth oper
refer dictionari item

consum token
oper locat got token begin locat locat identifi
oper consum identifi



left current allow singl argument
expect identifi
consum token
macro arg make share express left locat left wrap identifi macro arg express
todo test pars
bodi pars express op preced stop at newlin preced make right associ
oper arg macro arg paramet
oper arg push back bodi right operand

macro applic

mean appli
arg express arg param arg express unbound var
arg arg vector express name arg
oper arg push back pars macro arg

index

consum token
oper arg push back pars express index
consum punctuat



special get flatten oper possibl operand
consum token
right pars express op preced stop at newlin right operand entir multi operand express higher preced
left append flatten

oper arg left arg
oper locat left locat locat first need choos locat

oper arg push back right form multipl operand

regular

consum token
right pars express op preced stop at newlin right operand entir multi operand express higher preced
oper arg push back right right operand

left oper

left

macro arg express list posit depend option paramet
thi use defin macro macro
result

arg vector given comma separ
macro definit must pass defin check
name arg dictionari option arg
macro definit dictionari valu valu use argument given
express ptr pars macro arg defin

consum punctuat
macro arg make share express got token begin locat
got token defin argument



expr pars express could option
defin expr defin allow singl identifi
fail argument identifi expect expr locat
expr got token

expr expr get resolv forgotten
consum token
def valu expr pars express valu
macro arg name arg insert make pair make pair expr locat def valu expr
second
fail duplic option paramet expr locat


macro arg arg push back expr posit arg
got token

consum token


consum punctuat
macro arg

wstring pair text locat express ptr pars record member

dictionari
member identifi express
macro declar translat lambda
expr
get repres dictionari
expr
express structur

arg paramet arg name arg
arg express unbound
form
express
get map
express
wstring pair text locat express ptr member
id tok got token
id tok kind identifi

locat id tok begin locat error messag
consum identifi member name
option
express ptr array index expr from expr to expr
got token


consum token
array index expr pars operand name index variabl
array index expr
expect identifi
consum punctuat
from expr pars express start index
consum punctuat
to expr pars express index
consum punctuat

option macro arg
paramet got token pars macro arg defin express ptr option macro
consum punctuat
pars express newlin right hand side
macro rewrit assign express
paramet
make share express paramet locat paramet
rewrit assign express
array index expr

creat express index variabl
macro arg make share express array index expr locat array index expr wrap identifi macro arg express
init lambda expr make share express array index expr locat macro arg bodi
make share express locat
arg push back from expr first index
arg push back to expr last index
arg push back init lambda expr argument initi

insert
member insert make pair make pair locat
second
fail duplic member definit locat
advanc
id tok got token
id tok
id tok get token

member

verifi at end

got token kind
fail junk sourc get cursor

level pars pars dictonari member without enclos return dictionari
express ptr pars record member to dict

top member pars record member
verifi at end
express ptr top dict make share express get cursor
top dict name arg top member
top dict

simpl test develop
test

parser test train messag print action messag hello world
pars config dict from string parser test vector wstring dump



global export function execut parser
express ptr pars sourc file sourc file vector wstring includ path

parser move sourc file move includ path pars record member to dict

express ptr pars config dict from string wstring text vector wstring includ path

pars sourc file command line text move includ path

express ptr pars config dict from file wstring path vector wstring includ path

sourc file sourc file path note resolut path done
includ path insert includ path file directori path of path must path nest statement
pars move sourc file move includ path

express ptr pars config express wstring sourc text vector wstring includ path

parser parser sourc file command line sourc text move includ path
expr parser pars express newlin
parser verifi at end
expr



brain script evalu execut given config file

defin secur warn secur avail platform file give variabl warn

basic

scriptabl object
brain script evalu
brain script parser

dequ

function
memori
cmath

ifndef
defin


microsoft


msra strfun
microsoft cntk
microsoft scriptabl object

trace enabl debug output


evalu evalu syntact pars tree
evalu convert pars tree pars config dict from string file graph live object



error handl


error

evalu except config except


evalu except wstring text locat
config except


configerror wchar kind

evalu



declspec noreturn evalu error wstring text locat

microsoft cntk debug util print call stack
evalu except


declspec noreturn fail wstring text locat

evalu error

declspec noreturn type expect wstring express ptr

fail expect express locat

declspec noreturn unknown identifi wstring text locat

fail unknown identifi


creat fail error messag given text locat
thi use awat knowledg text locat config valu ptr could aris differ system python wrapper
wstring make fail fn text locat text locat

text locat wstring

fail text locat




access config valu ptr content error messag


valu

share as ptr config valu ptr valu express ptr wchar type for messag

valu
type expect type for messag
valu as ptr


to doubl config valu ptr valu express ptr

dynam cast doubl valu

type expect
dval
dval great place breakpoint


integ fail fraction
to int config valu ptr valu express ptr

to doubl valu


type expect integ



to boolean config valu ptr valu express ptr

dynam cast bool valu todo factor express

type expect




configur runtim type express


type function
defin defin runtim type

make runtim type constructor


configur runtim type make runtim type constructor

configur runtim type rt info
rt info construct i config record ptr config construct

make runtim object config

rt info is config record i config record valu
rt info


inform configur runtim type
configur runtim type find runtim type info wstring type id

configur runtim type regist find type id



name lookup


config valu ptr evalu express ptr i config record ptr scope wstring expr path wstring expr id forward

look member search scope
found tri lexic enclos scope insid thi handl config record
config valu ptr resolv identifi wstring text locat id locat i config record ptr scope

scope find look name
note could also scope like consum abl error proper text locat offend field

unknown identifi id locat
found resolv valu lazili valu hold thunk comput valu upon first
ensur is resolv first access valu must execut thunk
valu avail



look identifi express config record
config valu ptr record lookup express ptr record expr wstring text locat id locat i config record ptr scope wstring expr path

note scope record left must still evalu current scope
variabl insid express often singl variabl referenc someth current scope
look
identifi hand look record scope parent chain
record as ptr i config record evalu record expr scope expr path record expr record
resolv identifi id locat record resolv scope record current scope



runtim creation


evalu element dictionari express turn config record
meant pass init runtim
share config record config record from dict express express ptr record expr i config record ptr scope wstring expr path

evalu record express
thi leav member unevalu sinc demand
order get evalu depend use
record as ptr config record evalu record expr scope expr path record expr record
resolv entri need pass world know noth
record



oper


entri lookup tabl
config valu ptr express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path infix op
infix op

wstring pretti name pretti printabl name plu
infix op number op
infix op string op
infix op bool op
infix op comput node op operand comput node comput node
infix op dict op dict dict
infix op wchar name infix op number op infix op string op infix op bool op infix op comput node op infix op dict op
pretti name name number op number op string op string op bool op bool op comput node op comput node op dict op dict op




function implement oper
declspec noreturn invalid infix op type express ptr

fail cannot appli operand locat


config valu ptr comp op express ptr left right i config record ptr wstring expr path

make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
logic error unexpect

config valu ptr num op express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path

left left val as ref doubl
right right val as ref doubl
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
make primit config valu ptr fmod left right make fail fn locat expr path
make primit config valu ptr left right make fail fn locat expr path
comp op left right scope expr path

config valu ptr str op express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path

left left val as ref string
right right val as ref string
config valu ptr make share string left right make fail fn locat expr path
comp op wstring left right scope expr path

config valu ptr bool op express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path

left left val as ref bool
right right val as ref bool circuit semant right val thunk remain requir oper
make primit config valu ptr left right val as ref bool make fail fn locat expr path
make primit config valu ptr left right val as ref bool make fail fn locat expr path
make primit config valu ptr left right val as ref bool make fail fn locat expr path
comp op left right val as ref bool scope expr path

node op handl magic cntk type oper comput node object
todo automag cast valu constant node allow node
config valu ptr node op express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path

special case overload
unari minu negat node
product scalar
todo test code updat origin test
wstring oper name


right val
logic error unexpect
oper name negat



right val doubl comput node scalar
swap left val right val scalar comput node
left val doubl
oper name scale scalar comput node

oper name time comput node comput node matrix produt

comput node comput node


oper name plu

oper name minu

oper name element time

logic error unexpect

directli instanti comput node magic oper automat translat
find creation
rt info find runtim type info comput node
rt info
logic error unknown magic runtim
form config record comput node correspond oper
config make share config record scope make fail fn locat
note scope thi config hold xxx node runtim instanti
when fetch paramet look record parent scope find look routin
valu alreadi config valu ptr form need scope lookup either
config oper make fail fn locat config valu ptr make share string oper name make fail fn locat expr path
left fail fn left val get fail fn report error constant belong scalar factor express
vector config valu ptr input
oper name scale

scale first operand doubl must convert constant
todo appli gener oper
constant config make share config record config make fail fn locat
constant config oper left fail fn config valu ptr make share string learnabl paramet left fail fn expr path
make primit config valu ptr left fail fn expr path
constant config row left fail fn
constant config col left fail fn
constant config shape left fail fn bugbug row col longer right need tensor shape
constant config valu left fail fn left val
constant config learn rate multipli left fail fn make primit config valu ptr left fail fn expr path
valu config valu ptr rt info construct constant config left fail fn expr path
valu with name dynam cast ha name valu
valu with name
valu with name set name valu get express name
left val valu actual left valu

input push back left val
oper name negat negat input right val nullptr
input push back right val
config input left fail fn config valu ptr make share config array move input left fail fn expr path
config left fail fn config valu ptr make share string left fail fn expr path node
oper name time

make primit config valu ptr left fail fn expr path
config output rank left fail fn

instanti comput node
valu config valu ptr rt info construct config make fail fn locat expr path
valu with name dynam cast ha name valu
valu with name
valu with name set name valu get express name
valu

config valu ptr dict op express ptr config valu ptr left val config valu ptr right val i config record ptr scope wstring expr path


logic error unexpect
left left val as ptr config record
right right val as ptr config record
left
right
scope
expr path todo creat composit dictionari
left val

config valu ptr bad op express ptr config valu ptr config valu ptr i config record ptr wstring

invalid infix op type


lookup tabl oper
thi list oper lambda evalu
wstring infix op infix op

pretti name number op string op bool op comput node op dict op
infix op with num op bad op bad op node op dict op
infix op time num op bad op bad op node op bad op
infix op num op bad op bad op bad op bad op
infix op element time bad op bad op bad op node op bad op
infix op num op bad op bad op bad op bad op
infix op num op bad op bad op bad op bad op
infix op plu num op str op bad op node op bad op
infix op minu num op bad op bad op node op bad op
infix op equal num op str op bool op bad op bad op
infix op not equal num op str op bool op bad op bad op
infix op num op str op bool op bad op bad op
infix op num op str op bool op bad op bad op
infix op num op str op bool op bad op bad op
infix op num op str op bool op bad op bad op
infix op bad op bad op bool op bad op bad op
infix op bad op bad op bool op bad op bad op
infix op bad op bad op bool op bad op bad op



thunk delay evalu


creat call evalu expr realiz valu
unresolv config valu ptr contain thunk move copi
config valu ptr make evalu thunk ptr express ptr expr i config record ptr scope wstring expr path wstring expr id

config valu ptr expr scope expr path expr id comput valu expr

trace
text locat trace expr locat msra strfun wstrprintf thunk expr path expr expr path expr id
valu evalu expr scope expr path expr id
valu great place breakpoint

config valu ptr make thunk make fail fn expr locat expr path



main evalu highli recurs


evalu
input express
output config valu ptr hold evalu valu express
secondari input
scope parent config record nest config record creat recurs name lookup
expr path expr id form express path
express path
express path encod path express tree
meant abl give comput node name later lookup behav look directli
node path particular node child would use address
note return valu complex valu type like dictionari config record function config lambda
todo thi implement take stack space should mani function
config valu ptr evalu express ptr i config record ptr scope wstring expr path wstring expr id

claus error inject tree node text locat rethrow

express name
merg expr path expr id
expr path expr id
expr path append
expr path append expr id
trace
trace
text locat trace locat msra strfun wstrprintf expr path expr path
liter

make primit config valu ptr make fail fn locat expr path liter

config valu ptr make share string make fail fn locat expr path liter

make primit config valu ptr make fail fn locat expr path liter
express instanti runtim right

find
rt info find runtim type info
rt info
fail unknown runtim locat
form config record
dict expr arg
arg expr path rt info is config record expr path reset expr name path expos dictionari
valu config valu ptr rt info construct config record from dict express dict expr scope arg expr path make fail fn locat expr path construct
name
valu with name dynam cast ha name valu
valu with name
valu with name set name valu get express name
valu creat initi valu other refer

condit express

condit to boolean evalu arg scope expr path arg
condit
evalu arg scope expr path expr name sinc exist

evalu arg scope expr path

function
macro store lambda

scope express rememb lexic scope captur context
arg list expr arg argument express identifi possibl option arg
arg list expr
logic error paramet expect
fn expr arg express
arg list expr fn expr scope expr path vector config valu ptr arg config lambda name param name arg wstring caller expr path config valu ptr

todo document name arg parent scope dictionari should share config valu ptr instead clariti
expr name
caller expr path name result evalu assign
expr path outsid name macro defin
arg list arg list expr arg
arg size arg list size
logic error applic mismatch
execut bodi pass
creat scope contain posit name arg
evalu express scope
parent scope scope definit captur context
note scope variabl scope express macro definit
creat config record param name arg list valu arg
arg scope make share config record scope make fail fn arg list expr locat look first proceed upward lexic scope captur context
note failfn config record report unknown variabl point locat arg list express
howev insid brain script access check instead locat variabl
creat entri everi argument valu
note valu normal thunk sinc want evalu use
size arg size posit

arg name arg list paramet name
arg name
logic error paramet must consist identifi
arg val move arg valu paramet
failfn arg val get fail fn
arg scope arg name make fail fn arg name locat move arg val
note express paramet valu must evalu current scope

also name
name arg name arg

name arg first
arg val move name arg second
failfn arg val get fail fn note arg val get destroy upcom move
arg scope failfn move arg val todo failfn right

macro name expr path
wstring macro id expr path
macro id find
wstring npo
macro id eras
evalu
evalu fn expr arg scope caller expr path macro id bring arg scope keep scope upward chain

posit arg
vector wstring param name
arg list arg list expr arg
arg list


logic error paramet must consist identifi
param name push back

name arg
nam arg definit list option valu
config lambda name param name param
name arg arg list expr name arg

name arg first
locat name arg second first locat identifi
expr name arg second second express evalu valu
name param move make evalu thunk ptr expr scope evalu valu context definit expr path todo
name param locat config valu ptr make evalu thunk ptr expr scope evalu valu context definit expr path expr locat expr path todo
thunk call valu ever use

config valu ptr make share config lambda move param name move name param make fail fn locat expr path

appli

lambda expr arg
arg expr arg pass express express
as ptr config lambda evalu lambda expr scope expr path macro visibl express name lambda expr
arg expr
logic error argument expect
arg vector valu
like express evalu point comput demand
arg arg expr arg
arg size get num param
fail wstrprintf expect posit paramet provid get num param arg size arg expr locat
vector config valu ptr arg val arg size
onli one arg arg size arg expr name arg
size arg size posit

arg val expr arg express evalu
arg name get param name
arg val move make evalu thunk ptr arg val expr scope expr path todo onli one arg arg name
make thunk valu rvalu sinc unresolv config valu ptr copi
wstrprintf gone expr name
note scope macro form scope config record express access scope
use must come outsid argument
thi littl inconsist real record refer record
howev still expect behavior real record user see name
pass arg also paramet name depend specif use

name arg config record
could check whether name actual accept leav appli check also happen call cntk code
name arg arg expr name arg
config lambda name param name arg val
todo scope where scope come mayb need sinc valu alreadi resolv document
name arg name arg

name arg first pass name argument
locat name arg second first locat express
expr name arg second second express name argument
name arg val move make evalu thunk ptr expr scope expr path todo
thunk evalu pass actual valu ever use first time
thi own thunk pass styd move appli sinc allow copi unresolv config valu ptr
note scope
declar call anyth
name arg less clear whether user would expect still consist posit arg common

call
appli move arg val move name arg val expr path

variabl access
record config record

new scope make share config record scope make fail fn locat scope insid record symbol also visibl
failfn use code use retriev valu report text locat record defin
creat entri everi dictionari entri
evalu member point
instead valu keep express ptr wrap evalu express ptr config valu ptr call
member evalu demand use
entri name arg

entri first
expr entri second second express comput entri
new scope make fail fn entri second first make evalu thunk ptr expr new scope scope expr path todo
note scope record assign like ocaml that record member visibl
express initi record member assign potenti outer
explicitli access outer slightli ugli syntax

bugbug wrong text locat pass should identifi name arg store locat identifi
config valu ptr new scope make fail fn locat expr path


resolv identifi locat scope variabl macro access within current scope
variabl macro access given config record element

record expr arg
record lookup record expr locat scope evalu record expr expr path

array
express config array

return flatten member config array
make share config array note could speed keep left append
size arg size concaten arg

expr arg
append move make evalu thunk ptr expr scope msra strfun wstrprintf expr path

config valu ptr make fail fn locat expr path locat first sure best



first index expr arg first index
last index expr arg last index
init lambda expr arg initi valu
first index to int evalu first index expr scope expr path first first index expr
last index to int evalu last index expr scope expr path last last index expr
as ptr config lambda evalu init lambda expr scope expr path initi init lambda expr
get num param
fail requir initi argument index init lambda expr locat
point must know dimens initi need know element
resolv member demand allow recurs access variabl
creat vector thunk initi valu
vector config valu ptr element thunk
index first index index last index index

index valu make primit config valu ptr index make fail fn locat expr path never need index config valu ptr
elem expr path expr path wstrprintf expr path index express name show index lookup
init expr path expr path wstrprintf express name show initi
creat realiz element
config valu ptr index valu init lambda expr scope elem expr path init expr path comput valu expr

trace
text locat print issu vector text locat init lambda expr locat wstrprintf index index valu execut initi thunk
appli init lambda expr index valu result valu
init lambda as ptr config lambda evalu init lambda expr scope init expr path init lambda expr time simpl name
vector config valu ptr arg val index valu creat index valu
todo current scope come aren look name arg directli
valu init lambda appli move arg val config lambda name param elem expr path
todo chang version appli
valu great place breakpoint

element thunk push back config valu ptr make thunk make fail fn init lambda expr locat elem expr path todo

make share config array first index move element thunk
config valu ptr make fail fn locat expr path

access element index

arr valu evalu arg scope expr path vector
index expr arg
as ptr config array arr valu index expr
index to int evalu index expr scope expr path index index expr
index make fail fn index expr locat note element unresolv resolv

unari oper
unari oper

arg expr arg
arg val ptr evalu arg expr scope expr path negat
note expr path sinc argument expess path
arg val ptr doubl

arg val ptr

make primit config valu ptr arg val ptr make fail fn locat expr path
arg val ptr comput node object comput node becom negat node

arg val ptr

node op arg val ptr config valu ptr scope expr path

fail substr cannot appli operand msra strfun utf16 arg val ptr type name locat

unari

to boolean evalu arg scope expr path arg
make primit config valu ptr make fail fn locat expr path

regular oper


op iter infix op find
op iter infix op
logic error implement
function op iter second
left arg arg
right arg arg
left val ptr evalu left arg scope expr path function pretti name arg
right val ptr evalu right arg scope expr path function pretti name arg
left val ptr doubl right val ptr doubl
function number op left val ptr right val ptr scope expr path
left val ptr string right val ptr string
function string op left val ptr right val ptr scope expr path
left val ptr bool right val ptr bool
function bool op left val ptr right val ptr scope expr path
comput node magic know class name
left val ptr comput node object right val ptr comput node object
function comput node op left val ptr right val ptr scope expr path
left val ptr comput node object right val ptr doubl
function comput node op left val ptr right val ptr scope expr path
left val ptr doubl right val ptr comput node object
function comput node op left val ptr right val ptr scope expr path
left val ptr config record right val ptr config record
function dict op left val ptr right val ptr scope expr path

invalid infix op type


config except

error keep track parent locat pars well make easier user spot error
add locat locat




config valu ptr evalu pars express ptr

evalu i config record ptr nullptr scope



extern entri point evalu


level entri
config sequenc realli pars that tree comput member
express ptr

record lookup locat nullptr evalu member


share object evalu field express ptr wstring

record lookup locat nullptr scope evalu evalu member


config valu ptr evalu express ptr

evalu pars



built brain script function action



built function implement object also valu


wstring format config valu config valu ptr wstring

string function
format
give charact unicod valu
replac withwhat replac occur withwhat
substr substr
todo regex replac
string function string

wstring substr wstring ibegin inum

neg index index index exceed
ibegin size ibegin ibegin size
allow exceed
inum size inum size
substr

todo regex replac

string function i config record ptr configp

config configp
wstring write
config
what arg config
wstring what arg
format
format config valu config

wstring wchar
substr
substr config config char
replac
msra strfun replac all wstring config replacewhat config withwhat

what arg fail unknown valu string function



format config valu helper config valu
center printf format without exampl
todo chang take regular format arg support also to string
todo check right haskel
todo turn print print f print f provid format printf solut question
wstring format config valu config valu ptr wstring

size find
wstring npo
runtim error format config valu format must contain
string

wstrprintf as ref string

doubl

as ref doubl

wstrprintf

wstrprintf

config record todo to string method

record as ptr config record
member id record get member id todo test chang
wstring result
first
member id

first
first

result append
result append
result append
result append format config valu record

ha to string nest string result

config array todo to string method

as ptr config array
wstring result
rang get index rang
rang first rang second

rang first
result append
result append format config valu wstring logic error format config valu bound index iter

ha to string nest string result

ha to string
as ref ha to string to string

msra strfun utf16 type name cannot


numer function
floor
length
numer function box of doubl


numer function i config record ptr configp
box of doubl

config configp
write
config
what arg config
wstring what arg
floor
floor
length

string
wstring size
otherwis expect

as ref config array
rang get index rang
rang second rang first



what arg fail unknown valu numer function



compar function
is same object
compar function box of bool


compar function i config record ptr configp
box of bool

config configp
write
arg arg config arg
what arg config
wstring what arg
is same object

arg arg arg as ref config array
rang arg get index rang
rang second rang first
arg arg fail is same object expect
arg1 arg rang first as ptr object
arg2 arg rang second as ptr object
arg1 arg2


what arg fail unknown valu compar function




gener purpos action


sampl runtim object test
print action object


print action i config record ptr configp

config configp
config
string format config valu convert without format inform
fprintf stderr



fail action config error
fail action object


fail action i config record ptr configp

config configp
note quit optim term error shown show offend variabl
messag valu config
fail
fail trick compil issu warn 4702 unreach code
messag valu fail messag valu show locat messag fail call



debug special dump argument valu return valu
debug object

debug i config record ptr


fake trigger

configur runtim type make runtim type constructor debug

configur runtim type rt info
rt info construct i config record ptr configp

config configp
valu config valu
enabl config enabl
enabl

wstring config

fprintf stderr
valu string valu format config valu valu convert without format inform
fprintf stderr

valu

rt info is config record
rt info



comput network scriptabl object system


function
scriptabl object configur runtim type regist string function regist string function string function
scriptabl object configur runtim type regist numer function regist numer function numer function
scriptabl object configur runtim type regist compar function regist compar function compar function
action
scriptabl object configur runtim type regist print action regist print action print action
scriptabl object configur runtim type regist fail action regist fail action fail action
special
scriptabl object configur runtim type regist debug regist debug debug

main todo item
evalu optim stack usag
dictionari merg allow overwrit command line
instal filter first check
fulli name filter part chain pass inner dictionari creat
wrapper around filter
when process express insid current filter chain appli straight away
model merg
network expos dictionari express config record network
node node
creat modifi network
ndl comput network
also access need chain check match take first
mayb sole solut filter problem comput merg dict possibl fulli name detect downstream
explicitli access current scope need paramet name dict entri creat option
make semi sens syntact easi hope use often
macro paramet latter would refer macro name clearli defin mechan hard implement ambigu
name lookup inject text locat error stack
string everi paramet learnabl paramet row output dimens col input dimens
identifi becom complic becom carri
express path problem
macro express path assign thunk creat thunk rememb
howev realli thunk express path context execut context creat
mayb clever scheme overwrit result come back retriev valu name right patch veri tricki find right rule condit

namespac

copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

simpl network builder
comput network builder

comput node
input and param node
linear algebra node
nonlinear node
convolut node
recurr node
pre comput node

pragma warn disabl 4189 lot unus variabl show variabl

microsoft cntk

elem type
comput network ptr simpl network builder elem type build network from descript

comput network ptr
standard network kind

ffdnn kind
build ffdnn from descript

rnn kind
build rnn from descript

lstm kind
build lstm network from descript

class lstm network kind
build class lstm network from descript

ncelstm network kind
build ncelstm network from descript

class entropi rnn kind
build class entropi rnn from descript

log bilinear network kind
build log bilinear network from descript

dnnlm network kind
build dnnlm network from descript

condit lstm network kind
build condit lstm network from descript

ifdef come soon
crflstm network kind
build crflstm network from descript



logic error build network from descript invalid standard network kind standard network kind


post process network
compil network




elem type
comput network ptr simpl network builder elem type build ffdnn from descript


comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size
comput node ptr input output label prior scale log likelihood

input builder creat input node featur layer size
add to node group featur input

appli mean var norm

builder mean input mean of featur
builder inv std dev input inv std of featur
output builder per dim mean var normal input mv normal featur

input output


num hidden layer

builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet layer size
output appli nonlinear function builder plu builder time input featur featur

add dropout node
input builder dropout output drop h1

input output

num hidden layer

wstring name of w msra strfun wstrprintf
wstring name of b msra strfun wstrprintf
wstring name of prev h msra strfun wstrprintf
wstring name of time name of w name of prev h
wstring name of plu name of time name of b
wstring name of h msra strfun wstrprintf

builder creat learnabl paramet name of w layer size layer size
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet name of b layer size
output appli nonlinear function builder plu builder time input name of time name of plu name of h

add dropout node
input builder dropout output drop name of h

input output



wstring name of w msra strfun wstrprintf num hidden layer
wstring name of b msra strfun wstrprintf num hidden layer
wstring name of prev h msra strfun wstrprintf num hidden layer
wstring name of time name of w name of prev h
wstring name of plu name of time name of b

builder creat learnabl paramet name of w layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet name of b layer size num hidden layer
output builder plu builder time input name of time name of plu
renam node output h last

label builder creat input node label layer size num hidden layer

add train and eval criterion node output label

need prior

prior builder mean label prior
input builder prior log of prior

follow line need probabl need
output builder softmax output
output builder output

scale log likelihood builder minu output input scale log likelihood
add to node group output scale log likelihood



add to node group output output


softmax layer prob need adapt need
output builder softmax output posterior prob
add to node group output output





note comput node compuat network suppos independ elem type keep depend
elem type
comput network ptr simpl network builder elem type build rnn from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


recur
num hidden layer

todo figur spars matrix size
builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale

recurr layer size recurr layer recur

builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale

past valu builder past valu default hidden activ layer size
good algorithm detect loop setup
output appli nonlinear function
builder plu
builder time input builder time past valu

past valu attach input output
recur



output simpl network builder elem type appli nonlinear function builder plu builder time input
todo
output builder time input


add dropout node
input builder dropout output

input output

num hidden layer

todo figur spars matrix size
builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale

recurr layer size recurr layer recur

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale

past valu builder past valu default hidden activ size layer size
good algorithm detect loop setup
output appli nonlinear function
builder plu
builder time input builder time past valu

past valu attach input output
recur



output simpl network builder elem type appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output



builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale
matrix l2 reg

label builder creat input node label layer size num hidden layer
add train and eval criterion node input label criterion

output builder time input output

add to node group output output

need prior
prior builder mean label





elem type
comput network ptr simpl network builder elem type build class entropi rnn from descript

comput network builder elem type builder

get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr wrd2cl cls2idx clslogpostprob clsweight

vocab size layer size num hidden layer
runtim error build class entropi rnn from descript vocabulari size output layer size

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


recur
num hidden layer

builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale

recurr layer size recurr layer recur

builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale

past valu builder past valu default hidden activ layer size
good algorithm detect loop setup
output appli nonlinear function
builder plu
builder time input builder time past valu

past valu attach input output
recur



builder creat learnabl paramet layer size
init learnabl paramet uniform init random seed init valu scale
output simpl network builder elem type appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output

num hidden layer

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
recurr layer size recurr layer recur

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale

past valu builder past valu default hidden activ size layer size
good algorithm detect loop setup
output appli nonlinear function
builder plu
builder time input builder time past valu

past valu attach input output
recur



output simpl network builder elem type appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output



need input output matrix
10000 10000 vocabulari size
speed issu word matrix simpli obtain column slice
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

label dens matrix element word index
label builder creat input node label

clsweight builder creat learnabl paramet weight for class post prob nbr cl layer size num hidden layer
init learnabl paramet clsweight uniform init random seed init valu scale
clslogpostprob builder time clsweight input class post prob

output add train and eval criterion node input label train node class base cross entropi eval node class base cross entrpi
clslogpostprob

add to node group output output

need prior

prior builder mean label






elem type
comput network ptr simpl network builder elem type build condit lstm network from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr clslogpostprob
comput node ptr clsweight

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookup tabl

add dropout node
input builder dropout output

input output



logic error build class lstm network from descript lstm node cannot take spars input need project spars input continu vector lookup tabl suggest setup layer size vocabs hiddim vocabs dimens project lookup tabl order project singl window larger context window lookup tabl order exampl width context window


recur
offset lookup tabl order
num hidden layer

output comput node ptr build lstm node compon random seed layer size offset offset lookup tabl order layer size offset input
output comput node ptr build lstm compon random seed layer size offset offset lookup tabl order layer size offset input
previous use use lstm node correct fast
input output
offset num hidden layer

output comput node ptr build lstm node compon random seed layer size layer size input
output comput node ptr build lstm compon random seed layer size layer size input

add dropout node
input builder dropout output

input output



serv bia term
builder creat input node binari featur aux feat dim
add to node group featur
builder creat learnabl paramet msra strfun wstrprintf aux tran
layer size num hidden layer aux feat dim
init learnabl paramet uniform init random seed init valu scale
appli nonlinear function builder time num hidden layer time to get global bia
output builder plu input plu global bia
input output

need input output matrix
10000 10000 vocabulari size
speed issu word matrix simpli obtain column slice
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

label dens matrix element word index
label builder creat input node label

clsweight builder creat learnabl paramet weight for class post prob nbr cl layer size num hidden layer
init learnabl paramet clsweight uniform init random seed init valu scale
clslogpostprob builder time clsweight input class post prob

output add train and eval criterion node input label train node class base cross entropi eval node class base cross entrpi
clslogpostprob

output builder transpos time input output

add to node group output output

softmax layer prob need adapt need
output builder softmax output posterior prob





elem type
comput network ptr simpl network builder elem type build log bilinear network from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior featin
comput node ptr nullptr
comput node ptr wxi1 nullptr nullptr
comput node ptr wxi2 nullptr wxi3 nullptr wxi4 nullptr
comput node ptr nullptr nullptr nullptr nullptr nullptr nullptr
comput node ptr past valu xi past valu xii past valu xiii past valu xiv

input builder creat spars input node featur layer size
input builder creat input node featur layer size
featin input
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


use lookupt node unittest
lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookuptatbl

add dropout node
input builder dropout output

input output


recur
good algorithm detect loop setup

output input
ma order

past valu xi
builder past valu default hidden activ layer size msra strfun wstrprintf past valu
past valu xi set learn rate multipli
past valu xi attach input input
todo figur spars matrix size
builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale

builder plu output builder time past valu xi
output




add dropout node
input builder dropout output

input output

lookup tabl order num hidden layer

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder time input
input output
recurr layer size recurr layer recur

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
past valu builder past valu default hidden activ layer size
output builder plu builder time past valu input

past valu attach input output
input output
recur


builder creat learnabl paramet msra strfun wstrprintf layer size
output builder plu input

add dropout node
input builder dropout output

input output


builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

label builder creat input node label layer size num hidden layer
add train and eval criterion node input label

output builder time input output

add to node group output output

need prior

prior builder mean label






elem type
comput network ptr simpl network builder elem type build dnnlm network from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input nullptr nullptr nullptr nullptr past valu output nullptr label nullptr prior nullptr
comput node ptr nullptr
comput node ptr wxi1 nullptr nullptr
comput node ptr wxi2 nullptr wxi3 nullptr wxi4 nullptr
comput node ptr nullptr nullptr nullptr nullptr nullptr nullptr
comput node ptr past valu xi past valu xii past valu xiii past valu xiv

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


recur
num hidden layer

builder creat learnabl paramet layer size

past valu xi builder past valu default hidden activ layer size
past valu xii builder past valu default hidden activ layer size
past valu xiii builder past valu default hidden activ layer size
past valu xiv builder past valu default hidden activ layer size
past valu xi attach input input
past valu xii attach input input
past valu xiii attach input input
past valu xiv attach input input

recurr layer size recurr layer recur

todo figur spars matrix size
wxi2 builder creat learnabl paramet wxi2 layer size layer size
init learnabl paramet wxi2 uniform init random seed init valu scale
todo figur spars matrix size
wxi3 builder creat learnabl paramet wxi3 layer size layer size
init learnabl paramet wxi3 uniform init random seed init valu scale
todo figur spars matrix size
wxi4 builder creat learnabl paramet wxi4 layer size layer size
init learnabl paramet wxi4 uniform init random seed init valu scale
todo figur spars matrix size
wxi1 builder creat learnabl paramet wxi1 layer size layer size
init learnabl paramet wxi1 uniform init random seed init valu scale
todo figur spars matrix size
builder creat learnabl paramet layer size layer size
init learnabl paramet uniform init random seed init valu scale

good algorithm detect loop setup
builder plu
builder tanh
builder plu
builder time wxi4 past valu xiv
builder plu
builder time wxi3 past valu xiii
builder plu
builder time wxi2 past valu xii
builder plu
builder time wxi1 past valu xi
builder time input

output
past valu xi set learn rate multipli
past valu xii set learn rate multipli
past valu xiii set learn rate multipli
past valu xiv set learn rate multipli
recur



output simpl network builder elem type appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output

num hidden layer

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
recurr layer size recurr layer recur

builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
comput node base ptr recurr
past valu builder past valu default hidden activ layer size
output simpl network builder elem type appli nonlinear function builder plu builder time input builder time past valu
past valu attach input output
recur



output simpl network builder elem type appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output



todo figur spars matrix size
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer
label builder creat spars input node label layer size num hidden layer
add train and eval criterion node input label

output builder time input

add to node group output output

need prior

prior builder mean label






elem type
share comput node elem type comput node ptr simpl network builder elem type build direct connect random seed size i layer size input dim size output dim comput node ptr input comput node ptr to node

comput network builder elem type builder

comput node ptr direct output merg node

size direct connect size

direct connect i layer

comput node ptr direct wio builder creat learnabl paramet msra strfun wstrprintf output dim input dim
init learnabl paramet direct wio uniform init random seed init valu scale
direct output appli nonlinear function builder time direct wio input

comput node ptr scalar builder creat learnabl paramet msra strfun wstrprintf
scalar valu set valu elem type
comput node ptr scale builder element time scalar direct output msra strfun wstrprintf

merg node builder plu to node scale



merg node


elem type
share comput node elem type comput node ptr simpl network builder elem type build lstm compon random seed size i layer size input dim size output dim comput node ptr input ob

comput network builder elem type builder

size num hidden layer layer size size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr
comput node ptr
comput node ptr past valu hi past valu ci past valu ho past valu hf past valu hc past valu cf past valu cc
comput node ptr direct wio direct input direct output
comput node ptr

input input ob
builder creat learnabl paramet msra strfun wstrprintf i layer output dim input dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim input dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim input dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim input dim

init learnabl paramet uniform init random seed init valu scale
init learnabl paramet uniform init random seed init valu scale
init learnabl paramet uniform init random seed init valu scale
init learnabl paramet uniform init random seed init valu scale

builder creat learnabl paramet msra strfun wstrprintf i layer output dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
forget gate init val
valu set valu forget gate init val
input gate init val
valu set valu input gate init val
output gate init val
valu set valu output gate init val

builder creat learnabl paramet msra strfun wstrprintf i layer output dim output dim
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
init learnabl paramet uniform init random seed init valu scale

builder creat learnabl paramet msra strfun wstrprintf i layer output dim output dim
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
init learnabl paramet uniform init random seed init valu scale

builder creat learnabl paramet msra strfun wstrprintf i layer output dim output dim
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf i layer output dim
init learnabl paramet uniform init random seed init valu scale

builder creat learnabl paramet msra strfun wstrprintf i layer output dim output dim
init learnabl paramet uniform init random seed init valu scale

size layer1 output dim

past valu hi builder past valu default hidden activ layer1
past valu hf builder past valu default hidden activ layer1
past valu ho builder past valu default hidden activ layer1
past valu hc builder past valu default hidden activ layer1
past valu ci builder past valu default hidden activ layer1
past valu cf builder past valu default hidden activ layer1
past valu cc builder past valu default hidden activ layer1

const input gate valu

builder creat learnabl paramet msra strfun wstrprintf constit i layer output dim
set learn rate multipli
valu set valu const input gate valu
nullptr


appli nonlinear function
builder plu
builder plu
builder plu
builder time input

builder time past valu hi
builder diag time past valu ci


nullptr

builder tanh
builder plu
builder time input
builder plu
builder time past valu hc




builder element time
builder tanh
builder plu
builder time input
builder plu
builder time past valu hc



const forget gate valu

nullptr


appli nonlinear function
builder plu
builder plu
builder plu
builder time input

builder time past valu hf
builder diag time past valu cf


nullptr

past valu cc



builder element time past valu cc


builder plu

const output gate valu

nullptr


appli nonlinear function
builder plu
builder plu
builder plu
builder time input

builder time past valu ho
builder diag time


nullptr

output builder tanh



output builder element time builder tanh


past valu ho attach input output
past valu hi attach input output
past valu hf attach input output
past valu hc attach input output
past valu ci attach input
past valu cf attach input
past valu cc attach input

add dropout node
input builder dropout output

input output
output input

output


ifdef come soon

elem type
comput network ptr simpl network builder elem type build crflstm network from descript

comput network builder elem type builder
get total number of node built

ulong random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr
comput node ptr
comput node ptr past valu hi past valu ci past valu ho past valu hf past valu hc past valu cf past valu cc
comput node ptr direct wio direct input direct output
comput node ptr output from each layer depth nullptr
comput node ptr tran

input builder creat input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookup tabl

add dropout node
input builder dropout output

input output

output from each layer input


direct connect input node output node

recur
offset lookup tabl order
num hidden layer

offset num hidden layer

recurr layer size recurr layer recur

output comput node ptr build lstm compon random seed layer size offset lookup tabl order layer size input
input output

recur



builder creat learnabl paramet msra strfun wstrprintf layer size layer size offset lookup tabl order
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf layer size
output appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output



builder creat learnabl paramet msra strfun wstrprintf time befor soft max num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

output builder time input output befor softmax

tran builder creat learnabl paramet msra strfun wstrprintf tran prob num hidden layer layer size num hidden layer layer size num hidden layer
tran valu set valu elem type layer size num hidden layer
init learnabl paramet tran uniform init random seed init valu scale
tran set learn rate multipli
label builder creat input node label layer size num hidden layer
add train and eval criterion node output label nullptr crf train criterion crf eval criterion nullptr tran

input output
output builder sequenc decod label input tran output
add to node group output output

output builder softmax input posterior prob







elem type
comput network ptr simpl network builder elem type build class lstm network from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr clslogpostprob
comput node ptr clsweight

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookup tabl

add dropout node
input builder dropout output

input output



logic error build class lstm network from descript lstm node cannot take spars input need project spars input continu vector lookup tabl suggest setup layer size vocabs hiddim vocabs dimens project lookup tabl order project singl window larger context window lookup tabl order exampl width context window


recur
offset lookup tabl order
num hidden layer

output comput node ptr build lstm node compon random seed layer size offset offset lookup tabl order layer size offset input
output comput node ptr build lstm compon random seed layer size offset offset lookup tabl order layer size offset input
previous use use lstm node correct fast
input output
offset num hidden layer

output comput node ptr build lstm node compon random seed layer size layer size input
output comput node ptr build lstm compon random seed layer size layer size input

add dropout node
input builder dropout output

input output



need input output matrix
10000 10000 vocabulari size
speed issu word matrix simpli obtain column slice
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

label dens matrix element word index
label builder creat input node label

clsweight builder creat learnabl paramet weight for class post prob nbr cl layer size num hidden layer
init learnabl paramet clsweight uniform init random seed init valu scale
clslogpostprob builder time clsweight input class post prob

output add train and eval criterion node input label train node class base cross entropi eval node class base cross entrpi
clslogpostprob

output builder transpos time input output

add to node group output output

softmax layer prob need adapt need
output builder softmax output posterior prob






elem type
share comput node elem type comput node ptr simpl network builder elem type build lstm node compon ulong size size size comput node ptr

invalid argument build lstm node compon lstm node longer avail


elem type
share comput node elem type comput node ptr simpl network builder elem type build lstm node compon ulong random seed size i layer size input dim size output dim comput node ptr input ob

comput network builder elem type builder
size num hidden layer layer size size

comput node ptr input output
comput node ptr w input gate w forget gate w output gate w memori cell matrix

input input ob
size n dim input dim output dim
w input gate builder creat learnabl paramet msra strfun wstrprintf winputg i layer output dim n dim
init learnabl paramet w input gate uniform init random seed init valu scale
w input gate valu column slice set valu input gate init val init input gate bia
w forget gate builder creat learnabl paramet msra strfun wstrprintf wforgetg i layer output dim n dim
init learnabl paramet w forget gate uniform init random seed init valu scale
w forget gate valu column slice set valu forget gate init val init forget gate bia
w output gate builder creat learnabl paramet msra strfun wstrprintf woutputg i layer output dim n dim
init learnabl paramet w output gate uniform init random seed init valu scale
w output gate valu column slice set valu output gate init val init output gate bia
w memori cell matrix builder creat learnabl paramet msra strfun wstrprintf wmemorycellweight i layer output dim input dim output dim
init learnabl paramet w memori cell matrix uniform init random seed init valu scale
w memori cell matrix valu column slice set valu init memori cell bia

output builder lstm input ob w input gate w forget gate w output gate w memori cell matrix msra strfun wstrprintf lstm i layer

ifdef debug decod
w input gate valu set valu elem type
w forget gate valu set valu elem type
w output gate valu set valu elem type
w memori cell matrix valu set valu elem type


add dropout node
input builder dropout output

input output
output input

output



elem type
comput network ptr simpl network builder elem type build lstm network from descript

comput network builder elem type builder
get total number of node built

ulong random seed

size num hidden layer layer size size

size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr
comput node ptr
comput node ptr past valu hi past valu ci past valu ho past valu hf past valu hc past valu cf past valu cc
comput node ptr direct wio direct input direct output
comput node ptr output from each layer depth nullptr

spars input
input builder creat spars input node featur layer size

input builder creat input node featur layer size

add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookup tabl
ifdef debug decod
valu set valu elem type


add dropout node
input builder dropout output

input output

output from each layer input


direct connect input node output node

recur
offset lookup tabl order
num hidden layer


output comput node ptr build lstm node compon random seed layer size offset offset lookup tabl order layer size offset input
output comput node ptr build lstm compon random seed layer size offset offset lookup tabl order layer size offset input
previous use use lstm node correct fast
input output
output from each layer offset input

offset num hidden layer

recurr layer size recurr layer recur


output comput node ptr build lstm node compon random seed layer size layer size input
output comput node ptr build lstm compon random seed layer size layer size input
previous use use lst mnode fast correct

recur



builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf layer size
output appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output

output from each layer input



builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale
ifdef debug decod
valu set valu elem type

label builder creat input node label layer size num hidden layer
add train and eval criterion node input label

output builder time input output

need prior

prior builder mean label
input builder prior log of prior
comput node ptr
scale log likelihood builder minu output input scale log likelihood
add to node group output scale log likelihood


add to node group output output

softmax layer prob need adapt need
output builder softmax output posterior prob





elem type
comput network ptr simpl network builder elem type build ncelstm network from descript

comput network builder elem type builder
get total number of node built

random seed

size num hidden layer layer size size
size num recurr layer recurr layer size

comput node ptr input past valu output label prior
comput node ptr
comput node ptr clslogpostprob
comput node ptr bia
comput node ptr output from each layer depth nullptr

input builder creat spars input node featur layer size
add to node group featur input

appli mean var norm

builder mean input
builder inv std dev input
output builder per dim mean var normal input

input output


lookup tabl order

builder creat learnabl paramet msra strfun wstrprintf layer size layer size lookup tabl order
init learnabl paramet uniform init random seed init valu scale
output builder lookup tabl input lookup tabl

add dropout node
input builder dropout output

input output

output from each layer input


direct connect input node output node

recur
offset lookup tabl order
num hidden layer

output comput node ptr build lstm compon random seed layer size offset offset lookup tabl order layer size offset input
input output
output from each layer offset input

offset num hidden layer

recurr layer size recurr layer recur

output comput node ptr build lstm compon random seed layer size layer size input

recur



builder creat learnabl paramet msra strfun wstrprintf layer size layer size
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet msra strfun wstrprintf layer size
output appli nonlinear function builder plu builder time input


add dropout node
input builder dropout output

input output

output from each layer input



size offset layer size size

direct connect layer output layer output layer
output build direct connect random seed layer size offset layer size layer size lookup tabl order layer size num hidden layer output from each layer input
output nullptr
input output


need input output matrix
10000 10000 vocabulari size
speed issu word matrix simpli obtain column slice
builder creat learnabl paramet msra strfun wstrprintf num hidden layer layer size num hidden layer layer size num hidden layer
init learnabl paramet uniform init random seed init valu scale

label dens matrix element word index
label builder creat input node label nois

bia builder creat learnabl paramet bia vector layer size layer size size
bia valu set valu elem type layer size layer size size
init learnabl paramet bia uniform init random seed layer size layer size size init valu scale
clslogpostprob builder time clsweight input class post prob

output add train and eval criterion node input label train node nce base cross entropi eval node nce base cross entrpi bia

add to node group output output

need prior

prior builder mean label






load model file frank seid microsoft legaci tool
elem type
comput network ptr simpl network builder elem type build network from dbn file wstring dbn model file name

comput network builder elem type builder

comment name
version
num layer
layer type

random seed

comput node ptr input output label prior scale log likelihood
share pre comput node base elem type pc node ptr

file fstream dbn model file name file option file option binari file option file option read

check dbn tag fstream
runtim error error read file find expect
fstream comment
check dbn tag fstream bdbn
runtim error error read file find expect bdbn
fstream version num layer

matrix elem type global mean read matrix from dbn file fstream gmean
matrix elem type global std dev read matrix from dbn file fstream gstddev
global mean get num col
global std dev get num col

move sinc element wise oper expens wrong
cur dev id global std dev get devic id
global std dev transfer from devic to devic cur dev id cpudevic
global std dev get num row
global std dev elem type elem type global std dev
global std dev transfer from devic to devic cpudevic cur dev id

check dbn tag fstream bnet
runtim error error read file find expect bnet

num layer index input layer

fstream layer type

matrix elem type read matrix from dbn file fstream
matrix elem type bia read matrix from dbn file fstream remnant pretrain need
matrix elem type read matrix from dbn file fstream


input builder creat input node featur get num col
add to node group featur input

size frame dim global mean get num row
size num context frame get num col frame dim
size context dim num context frame frame dim
matrix elem type context mean context dim devic id
matrix elem type context std dev context dim devic id

move sinc element wise oper expens wrong
context mean transfer from devic to devic devic id cpudevic
context std dev transfer from devic to devic devic id cpudevic
size frame dim

size num context frame

context mean frame dim elem type global mean
context std dev frame dim elem type global std dev


context mean transfer from devic to devic cpudevic devic id
context std dev transfer from devic to devic cpudevic devic id

builder mean input mean of featur
pointer cast pre comput node base elem type side load from matrix context mean
set learn rate multipli

builder inv std dev input inv std of featur
pointer cast pre comput node base elem type side load from matrix context std dev
set learn rate multipli

output builder per dim mean var normal input mv normal featur
input output

num layer

output layer size get num row

wstring name of w msra strfun wstrprintf
wstring name of b msra strfun wstrprintf
wstring name of prev h msra strfun wstrprintf
wstring name of time name of w name of prev h
wstring name of plu name of time name of b
wstring name of h msra strfun wstrprintf

builder creat learnabl paramet name of w get num row get num col
valu set valu

builder creat learnabl paramet name of b bia get num row
valu set valu bia

layer type perceptron

fprintf stderr read perceptron get num row get num col
output builder plu builder time input name of time name of plu

layer type rbmisalinearbernoulli

fprintf stderr read linear layer get num row get num col
output builder plu builder time input name of time name of plu

assum rbmbernoullibernoulli

fprintf stderr read linear layer get num row get num col
output appli nonlinear function builder plu builder time input name of time name of plu name of h
add dropout node
input builder dropout output drop name of h


input output


check dbn tag fstream enet
runtim error error read file find expect enet
size output layer size layer size layer size size

label builder creat input node label output layer size

layer type perceptron complet network

renam node output h last

matrix elem type prior val read matrix from dbn file fstream
prior val get num col prior val get num row output layer size

prior builder mean label prior
pointer cast pre comput node base elem type prior side load from matrix prior val
prior set learn rate multipli

pretrain network need output layer init

size output layer size
output layer size
output layer size output layer size
layer size size
layer size layer size size

runtim error output layer size must specifi convert train network output layer size

size penultim size input get sampl matrix num row

wstring name of w msra strfun wstrprintf
wstring name of b msra strfun wstrprintf
wstring name of prev h msra strfun wstrprintf
wstring name of time name of w name of prev h
wstring name of plu name of time name of b
wstring name of h msra strfun wstrprintf

builder creat learnabl paramet name of w output layer size penultim size
init learnabl paramet uniform init random seed init valu scale
builder creat learnabl paramet name of b output layer size
output builder plu builder time input name of time name of plu
renam node output h last

need prior

matrix elem type zero matrix elem type zero output layer size devic id
prior builder mean label prior
pointer cast pre comput node base elem type prior mark comput
prior valu set valu zero



add train and eval criterion node output label

layer type perceptron need prior

input builder prior log of prior

follow line need probabl need
output builder softmax output
output builder output

scale log likelihood builder creat comput node oper name of minu node scale log likelihood
scale log likelihood attach input output input
add to node group output scale log likelihood



add to node group output output


check dbn tag fstream edbn
runtim error error read file find expect enet

perform necessari valid post process
compil network




layer base
elem type
share comput node elem type simpl network builder elem type appli nonlinear function comput node ptr input size layer wstring node name

comput network builder elem type builder

comput node ptr output
wstring non linear function non linear function layer
non linear function oper name of sigmoid node
output builder sigmoid input node name
non linear function oper name of rectifi linear node
output builder rectifi linear input node name
non linear function oper name of tanh node
output builder tanh input node name
non linear function non linear function none non linear function

output input linear layer
node name
renam node output node name


logic error unsupport nonlinear

output


elem type
share comput node elem type simpl network builder elem type add train and eval criterion node comput node ptr input comput node ptr label comput node ptr matrix
wstring train node name wstring eval node name
comput node ptr clspostprob comput node ptr tran

comput network builder elem type builder

add to node group label label

comput node ptr output

bugbug tinput conflict criteria expect weight matrix transpos 10000 vocab size 10000 instead 10000
class cross entropi with softmax use incompat tinput tinput comput demand criterion node
use need still incompat
comput node ptr tinput input

train criterion

train criterion cross entropi with softmax
matrix nullptr
tinput builder time matrix input
output builder cross entropi with softmax label tinput train node name cross entropi with softmax train node name

train criterion squar error
matrix nullptr
tinput builder time matrix input
output builder squar error label tinput train node name squar error train node name

train criterion logist
matrix nullptr
tinput builder time matrix input
output builder logist label tinput train node name logist train node name

ifdef come soon
train criterion
tran nullptr
output builder label input tran train node name train node name


train criterion class cross entropi with softmax
output builder class cross entropi with softmax label input matrix clspostprob train node name class cross entropi with softmax train node name

train criterion nce cross entropi with softmax
output builder nois contrast estim label input matrix clspostprob train node name nois contrast estim node train node name
output builder nois contrast estim label input matrix clspostprob train node name nois contrast estim node train node name


logic error unsupport train criterion

add to node group criterion output

eval criterion eval criterion cross entropi with softmax train criterion train criterion cross entropi with softmax
eval criterion eval criterion squar error train criterion train criterion squar error
eval criterion eval criterion logist train criterion train criterion logist
eval criterion eval criterion train criterion train criterion
eval criterion eval criterion class cross entropi with softmax train criterion train criterion class cross entropi with softmax
eval criterion eval criterion nce cross entropi with softmax train criterion train criterion nce cross entropi with softmax

eval criterion

eval criterion cross entropi with softmax
matrix nullptr tinput input
tinput builder time matrix input
output builder cross entropi with softmax label tinput eval node name eval cross entropi with softmax eval node name
output builder cross entropi with softmax label tinput eval node name cross entropi with softmax eval node name

eval criterion class cross entropi with softmax
output builder class cross entropi with softmax label input matrix clspostprob eval node name eval class cross entropi with softmax eval node name
output builder class cross entropi with softmax label input matrix clspostprob eval node name class cross entropi with softmax eval node name

eval criterion nce cross entropi with softmax
output builder nois contrast estim label input matrix clspostprob eval node name nois contrast estim node eval node name

eval criterion squar error
matrix nullptr tinput input
tinput builder time matrix input
output builder squar error label tinput eval node name eval squar error eval node name
output builder squar error label tinput eval node name squar error eval node name

eval criterion logist
matrix nullptr tinput input
tinput builder time matrix input
output builder squar error label tinput eval node name eval squar error eval node name
output builder logist label tinput eval node name logist eval node name

eval criterion error predict
matrix nullptr tinput input
tinput builder time matrix input
output builder error predict label tinput eval node name eval error predict eval node name

ifdef come soon
eval criterion
tran nullptr
matrix nullptr tinput input
tinput builder time matrix input
output builder label tinput tran eval node name eval crf eval node name



logic error unsupport train criterion

output set learn rate multipli


add to node group evalu output

output


simpl network builder
simpl network builder


helper


train criterion pars train criterion string wstring

equal ci cross entropi with softmax train criterion cross entropi with softmax
equal ci sequenc with softmax train criterion sequenc with softmax
equal ci squar error train criterion squar error
equal ci logist train criterion logist
equal ci nois contrast estim train criterion nce cross entropi with softmax
equal ci class cross entropi with softmax train criterion class cross entropi with softmax
logic error train criterion invalid train criterion valu valid valu cross entropi with softmax squar error logist class cross entropi with softmax sequenc with softmax


eval criterion pars eval criterion string wstring

equal ci error predict eval criterion error predict
equal ci cross entropi with softmax eval criterion cross entropi with softmax
equal ci sequenc with softmax eval criterion sequenc with softmax
equal ci class cross entropi with softmax eval criterion class cross entropi with softmax
equal ci logist eval criterion logist
equal ci nois contrast estim eval criterion nce cross entropi with softmax
equal ci squar error eval criterion squar error
logic error eval criterion invalid train criterion valu valid valu error predict cross entropi with softmax squar error logist sequenc with softmax




copyright microsoft right reserv
licens licens licens file project root full licens inform

eval action cntk evalu relat action


defin nonstdc deprec make accept posix function without

stdafx
basic
action
comput network
comput node
data reader
data writer
config
simpl evalu
simpl output writer
criterion
best gpu
scriptabl object
brain script evalu


chrono
algorithm
vector
iostream
queue

memori

ifndef
defin



microsoft
microsoft cntk


do eval base cntk command


elem type
do eval base config paramet config i data reader reader

deviceid type devic id devic from config config
config array minibatch size config minibatch size 40960
size epoch size config epoch size
epoch size

epoch size request data size

wstring model path config model path
intargvector mb size minibatch size

trace level config trace level
size num m bs to show result config num m bs to show result
size max sampl in ram config max sampl in ram size size
size num submini batch config num subminibatch size

config array eval node name config eval node name
vector wstring eval node name vector
eval node name size

eval node name vector push back eval node name


comput network creat from file elem type devic id model path

trace flag
enabl node trace config trace node name real config paramet array stringargvector
config trace node name categori config paramet array stringargvector
config trace node name spars config paramet array stringargvector

simpl evalu elem type mpi wrapper get instanc num m bs to show result trace level max sampl in ram num submini batch
evalu reader eval node name vector mb size epoch size


elem type
do eval config paramet config

test
config paramet reader config config reader
reader config insert trace level config trace level

data reader test data reader reader config

do eval base elem type config test data reader


do eval config paramet config
do eval config paramet config


do cross valid cntk command


elem type
do cross valid config paramet config

test
config paramet reader config config reader
reader config insert trace level config trace level

deviceid type devic id devic from config config
config array minibatch size config minibatch size 40960
size epoch size config epoch size
epoch size

epoch size request data size

wstring model path config model path
intargvector mb size minibatch size

config array cv interv config config cross valid interv
intargvector cv interv cv interv config

size sleep second between run config sleep time between run

trace level config trace level
size num m bs to show result config num m bs to show result
size max sampl in ram config max sampl in ram size size
size num submini batch config num subminibatch size

config array eval node name config eval node name
vector wstring eval node name vector
eval node name size

eval node name vector push back eval node name


vector vector epoch criterion cv error result
vector wstring cv model

data reader cv data reader reader config

final model evalu
size cv interv cv interv cv interv

wstring cv model path msra strfun wstrprintf model path

fexist cv model path

fprintf stderr model exist cv model path
final model evalu fexist model path
file miss


cv model path model path
final model evalu



cv model push back cv model path
comput network creat from file elem type devic id cv model path

simpl evalu elem type mpi wrapper get instanc num m bs to show result trace level max sampl in ram num submini batch

fprintf stderr model cv model path
eval error evalu cv data reader eval node name vector mb size epoch size
cv error result push back eval error

sleep 1000 sleep second between run


find best model
cv error result size
logic error model evalu

vector min error
vector min err id
vector epoch criterion eval error cv error result
eval error size

min error push back eval error averag
min err id push back


cv error result size

eval error cv error result
eval error size

eval error averag min error

min error eval error averag
min err id




fprintf stderr best model
fprintf stderr
min error size
fprintf stderr base best model cv model min err id min error


do cross valid config paramet config
do cross valid config paramet config


do write output cntk write command


elem type
do write output config paramet config

config paramet reader config config reader

reader config insert trace level config trace level
reader config insert random want random output result

data reader test data reader reader config

config array minibatch size config minibatch size 2048
intargvector mb size minibatch size

size epoch size config epoch size
epoch size

epoch size request data size


vector wstring output node name vector

get model from config config paramet elem type config output node name vector

trace flag
enabl node trace config trace node name real config paramet array stringargvector
config trace node name categori config paramet array stringargvector
config trace node name spars config paramet array stringargvector

simpl output writer elem type writer

config exist writer

config paramet writer config config writer
writer unittest writer config unittest
data writer test data writer writer config
writer write output test data reader mb size test data writer output node name vector epoch size writer unittest

config exist output path

wstring output path config output path
write format option format option config
node unit test config node unit test
writer write output test data reader mb size output path output node name vector format option epoch size node unit test


invalid argument write command must specifi either writer output path


do write output config paramet config
do write output config paramet config

copyright microsoft right reserv
licens licens licens file project root full licens inform

other action cntk action


defin nonstdc deprec make accept posix function without

stdafx
basic
action
data reader
comput network
comput node
config
scriptabl object
brain script evalu


chrono
algorithm
vector
iostream
queue

memori


ifndef
defin



microsoft
microsoft cntk


do creat label map cntk creat label map command


elem type
do creat label map config paramet config

get section name interest
section config section
section probabl peer config section work thank heirarch resolut
config paramet config section config section
config paramet reader config config section reader
reader config insert allow map creation
size minibatch size config minibatch size 2048
trace level config trace level
vector wstring featur name
vector wstring label name
get file config name reader config featur name label name

setup minibatch matric
featur matrix make share matrix elem type cpudevic
label matrix make share matrix elem type cpudevic
stream minibatch input matric
mb layout ptr p mb layout make share mb layout
matric add input featur name featur matrix p mb layout tensor shape
label name size
runtim error creat label map label found process

creat reader entir dataset label
start chrono system clock
wstring label name label name

take last label file defin might input
matric add input label name label matrix p mb layout tensor shape

label map file name
config paramet label config reader config label name
label map file
label config exist current label map file
label map file label config label map file
reader config exist current label map file
label map file label config label map file

runtim error creat label map label map file defin

fexist label map file

fprintf stderr creat label map label map file alreadi exist work label map file


fprintf stderr creat label map creat map file label map file

data reader data reader reader config
data reader start minibatch loop minibatch size request data size
count
data reader get minibatch matric

matrix elem type featur matric get input matrix elem type featur name
count featur get num col
trace level
fprintf stderr progress meter

data reader start minibatch loop minibatch size request data size

result
trace level
fprintf stderr nread label produc count label map file

chrono system clock
elaps start
trace level
fprintf stderr second elaps chrono durat cast chrono millisecond elaps count 1000


do creat label map config paramet config
do creat label map config paramet config


do paramet svd cntk command



action
action perform follow process transform exist model
learnabl paramet whose name match user specifi regex
approxim matric multipl
order keep rank structur train
origin node replac whose opert time
left children right chilren

command
user need specifi
model path path exist model
outputmodel path write transform model
keep ratio mani percentag energi want keep
align size result signular valu align
paramet name name regex paramet node want perform decomposit



helper do paramet svd

pars svd config file wstring wstring config

msra file textread reader
reader

wstring line reader wgetlin
vector wstring token msra strfun split line
token size

config token msra strfun todoubl token



brief config file usag
svd config file usag

fprintf stderr usag svd config file
fprintf stderr svd config file refer main config svd config
fprintf stderr each line file specifi group learnabl paramet node regex keep ratio associ group
fprintf stderr exampl
fprintf stderr
fprintf stderr

elem type
do paramet svd config paramet config

deviceid type devic id
wstring model path config model path
wstring outputmodel path config outputmodel path
wstring svdconfig

keepratio config keep ratio
size align size config align size
wstring svdnode regex config node name regex
svdnode regex

svdconfig svdnode regex keepratio



altern user also config specifi keep ratio differ group node
wstring svdnode config file config svd config
pars svd config file svdnode config file svdconfig

svd config file usag




model path

fprintf stderr error do paramet svd model path



comput network devic id
load elem type model path

perform sv decomposit elem type svdconfig align size
outputmodel path
save outputmodel path


do paramet svd config paramet config
do paramet svd config paramet config


do write word and class info cntk write word and class command


compar functor sort second element pair
todo

compar second



bugbug thi compar element first word name thi current version lead differ sort thu definit
second second second element
first first

second second



thi convert train text file special format encod inform

output vocabulari word2class class2idx file inform
vocabulari format follow
42068
50770
45020
first column word index
last column index word
second column third column inform purpos
realli use gener output later process neural network train

wrd2cl dens matrix vocab size map word
cls2idx dens matrix map first word index

thi format base entropi follow assumpt made
word sort word togeth
wrds2cl wrd2cl wrd2cl vocab size
sort cls2idx cls2idx cls2idx cls2idx
elem type
do write word and class info config paramet config

size vocab size config vocab size
nbr cl config nbr class todo size
cutoff config cutoff

input file config input file train text file without
output map file config output map file specifi write regular map file
output vocab file config output vocab file
output word2 cl nbr cl config output word2 cl
output cls2 index nbr cl config output cls2 index

unk word config
begin sequenc config begin sequenc
end sequenc config end sequenc
legaci version hard code
fall back default rather user script
begin sequenc end sequenc
invalid argument pleas specifi paramet begin sequenc end sequenc

output map file
cerr map file output map file endl
cerr vocabulari file output vocab file endl
nbr cl

cerr word output word2 cl endl
cerr class index output cls2 index endl

cerr endl

check whether alreadi date
make mode config make mode
make mode

done msra file fuptod s2w output vocab file s2w input file input requir
nbr cl

done msra file fuptod s2w output word2 cl s2w input file input requir
done msra file fuptod s2w output cls2 index s2w input file input requir

done

cerr output file date




matrix elem type wrd2cl cpudevic
matrix elem type cls2idx cpudevic

ifstream input file todo file support pipe

runtim error fail open input file input file
cerr read input file input file input file endl

nbr cl
cls2idx resiz nbr cl

unord count

process input line line

vector vstr
prev cl idx
token
begin sequenc pattern begin sequenc
end sequenc pattern end sequenc
getlin

eras find first prefix space
eras find last surfix space

begin sequenc find begin sequenc pattern npo
begin sequenc pattern

end sequenc find end sequenc pattern npo
end sequenc pattern

vstr msra strfun split
thi use start assum
count idea whether correct algorithm
start with1 begin sequenc begin sequenc end sequenc
size start with1 vstr size
count vstr

close

cerr vocabulari size count size

vector word
remain word
unord size index

vector count
vector index word

size word count less cutoff count size
cutoff
iter count

iter second cutoff
word count less cutoff

word count less cutoff
runtim error word remain cutoff threshold cutoff

vocab size word count less cutoff

cerr warn actual vocabulari size less requir endl
cerr t requir vocabulari size vocab size endl
cerr t actual vocabulari size count size endl
cerr t actual vocabulari size cutoff word count less cutoff endl
cerr chang actual vocabulari size word count less cutoff endl
vocab size word count less cutoff


nbr cl

form class
implement algorithm mikolov todo refer
wrd2cl resiz vocab size

pair stringdoubl
unord remov note supposedli faster
unk count todo
size size
size actual vocab size vocab size
prioriti queue stringdoubl vector stringdoubl compar second stringdoubl
compar second stringdoubl vector stringdoubl count count
size actual vocab size cond

size
word first
freq second todo
word unk word

unk count freq
actual vocab size

remov first second




unk count second


remov unk word unk count
count resiz remov size
total

nbr cl

iter remov
total iter second

iter remov
sqrt iter second total



size
resiz remov size

prioriti queue stringdoubl vector stringdoubl compar second stringdoubl
compar second stringdoubl vector stringdoubl remov remov


word first
freq second
nbr cl

sqrt freq total



nbr cl nbr cl



size word size
insert index insert make pair word second
insert
word push back word

count freq
nbr cl



word size index size word size size

class

iter count
word push back iter first
sort word word
count resiz word size
size word size
count count find word second


word size count size

write file
output map file

msra file make intermedi dir s2w output map file
ofstream ofmap output map file
word word
ofmap word endl
ofmap close
cerr creat label map file count size entri


msra file make intermedi dir s2w output vocab file
ofstream ofvocab output vocab file
size word size

nbr cl
wrd2cl elem type
cl idx nbr cl
nbr cl cl idx prev cl idx

cls2idx cl idx elem type left boundari cl idx
prev cl idx

ofvocab count word cl idx endl

ofvocab close
cerr creat vocabulari file count size entri

nbr cl

write output
todo save write temp name renam
msra file make intermedi dir s2w output word2 cl
ofstream owfp output word2 cl
owfp
runtim error fail write output word2 cl
size wrd2cl get num row
owfp wrd2cl endl
owfp close
cerr creat word wrd2cl get num row entri

msra file make intermedi dir s2w output cls2 index
ofstream ocfp output cls2 index
ocfp
runtim error fail write output cls2 index
size cls2idx get num row
ocfp cls2idx endl
ocfp close
cerr creat index cls2idx get num row entri



do write word and class info config paramet config
do write word and class info config paramet config


do topolog plot cntk plot command


topolog plot comput network
elem type
do topolog plot config paramet config

wstring model path config model path
wstring output dot file config output dot file filenam languag output specifi modelpath use
wstring output file config output file filenam render topolog plot
render done
render cmd must cntk call
wstring render cmd config render cmd option cntk call render convert outdot file graph
tool graphviz tpng
special placehold

output file default modelpath
output dot file
output dot file model path

comput network cpudevic
load elem type model path

plot network topolog output dot file
fprintf stderr creat network descript format output dot file

output file

render cmd
invalid argument plot specifi output file also need render cmd
part problemat earli version
wregex input place holder
wregex output place holder

patch pathnam
render cmd regex replac render cmd input place holder output dot file
render cmd regex replac render cmd output place holder output file

render cmd msra strfun replac all render cmd wstring output dot file
render cmd msra strfun replac all render cmd wstring output file


render cmd

fprintf stderr execut third parti tool render render cmd
ifdef unix
system msra strfun utf8 render cmd
ignor result get flag save valu

wsystem render cmd


fprintf stderr done


do topolog plot config paramet config
do topolog plot config paramet config

copyright microsoft right reserv
licens licens licens file project root full licens inform

network factori cntk network creation relat function


stdafx
action
simpl network builder
ndl network builder
scriptabl object
brain script evalu
brain script parser

comput network ptr deviceid type get creat network fn scriptabl object i config record config

creat network brain script creat model
creat wrapper around train
creat network config lambda config creat network as ptr scriptabl object config lambda
creat network config lambda deviceid type devic id

execut
vector scriptabl object config valu ptr arg
scriptabl object config lambda name param name arg
net valu creat network config lambda appli move arg move name arg build network from descript
typecast result desir
net valu as ptr comput network



comput network ptr deviceid type get creat network fn config paramet

implement
cntk config support lambda

config record type elem type
tri get network factori config record type config comput network ptr deviceid type creat network fn

deviceid type devic id devic from config config

config exist creat network

creat network fn get creat network fn config need separ need code


config exist simpl network builder

config record type simpl network builder config config simpl network builder
net builder make share simpl network builder elem type simpl network builder config pars configur store simpl network builder
creat network fn net builder deviceid type devic id

share comput network net builder build network from descript oper base configur save



legaci
config exist ndl network builder

config record type ndl network builder config config ndl network builder
share ndl builder elem type net builder make share ndl builder elem type ndl network builder config
creat network fn net builder deviceid type devic id

share comput network net builder build network from descript



legaci test mode brain script will away fulli integr
config exist brain script network builder config exist experiment network builder legaci name

outer cntk config take inner part brain script
prepend standard definit also definit devic id precis object pull construct
bugbug get text locat right need inject locat marker sourc moot fulli
wstring sourc of network config exist brain script network builder config brain script network builder config experiment network builder
sourc of network find first
invalid argument brain script network descript must either express config record

path path config read addit configur path support brain script network builder
includ path config paramet get brain script network builder includ path

inject addit item sourc code
support way specifi network brain script
brain script network builder express evalu comput network
brain script network builder paramet comput network
sourc of network form turn comput network construct comput network
sourc of network comput network sourc of network
sourc of bs msra strfun wstrprintf cntk core core note use lowercas match linux name cntk
devic id devic id pass
precis
network sourc code express evalu comput network
devic id elem type name elem type sourc of network
expr pars config dict from string sourc of bs move includ path

rest done evalu virgin network need
note evalu brain script instanti network evalu call must insid
creat network fn expr deviceid type devic id

evalu pars tree particularli level field network
evalu creat network
evalu field expr network come back object
network dynam pointer cast comput network cast
network
logic error build network from descript comput network meant
success
network







config record type elem type
comput network ptr deviceid type get network factori config record type config

comput network ptr deviceid type creat network fn
got it tri get network factori config record type elem type config creat network fn
got it
runtim error network builder found config file ndl network builder simpl network builder brain script network builder must specifi

creat network fn


helper remov exist output node replac given
patch output node comput network ptr config array output node name vector wstring output node name vector

clear current output node
output node
remov from node group output output node back
insert desir node instead
wstring name output node name

node name exist name

fprintf stderr patch output node node name skip name


output node name vector push back name
node get node from name name
add to node group output node



config record type elem type
comput network ptr get model from config config record type config vector wstring output node name vector

deviceid type devic id devic from config config

config array output node name config output node name config array

comput network ptr

first network builder present
comput network ptr deviceid type creat network fn
got it tri get network factori config record type elem type config creat network fn
got it

sever way creat network
creat network fn devic id
output node name size

invalid compil network
patch output node output node name output node name vector
compil network
bugbug thi gener valid output


network builder given load model path

wstring model path config model path

creat from file sinc user might specifi output node name config
compil network patch avoid output valid
make share comput network devic id
read elem type model path
output node name size
patch output node output node name output node name vector
compil network





comput network ptr deviceid type get network factori scriptabl object i config record scriptabl object i config record config
comput network ptr deviceid type get network factori scriptabl object i config record scriptabl object i config record config
comput network ptr deviceid type get network factori config paramet config paramet config
comput network ptr deviceid type get network factori config paramet config paramet config
comput network ptr get model from config config paramet config paramet config vector wstring output node name vector
comput network ptr get model from config config paramet config paramet config vector wstring output node name vector

copyright microsoft right reserv
licens licens licens file project root full licens inform

train action cntk train relat action


defin nonstdc deprec make accept posix function without

stdafx
basic

action
comput network
comput node
data reader
data writer
simpl network builder
ndl network builder
model edit languag

config
simpl evalu
simpl output writer
best gpu
scriptabl object
brain script evalu
brain script parser


chrono
algorithm
vector
iostream
queue

memori

ifndef
defin



microsoft
microsoft cntk


do train cntk train command


creat certain cntk config brain script

share creat object scriptabl object i config record config wchar

todo cntk config ad trace level config cannot i config record immut solut just trace level macro reader
config as ptr instanti call


share creat object config paramet config wchar

config paramet reader config config
reader config insert trace level config trace level todo ad config block easi config trace level
make share reader config cntk config specifi dictionari must explicitli instanti


config record type elem type
do train config record type config

make mode config make mode
deviceid type devic id devic from config config

determin network creation
sever way creat network
comput network ptr deviceid type creat network fn

creat network fn get network factori config record type elem type config

data reader creat object data reader config reader

share data reader cv data reader
config exist cv reader
cv data reader creat object data reader config cv reader

share elem type optim
config exist optim

optim creat object elem type config optim

legaci cntk config syntax need record call

config record type config sgd config
optim make share elem type config sgd


optim init mpi mpi wrapper get instanc
optim train creat network fn devic id data reader cv data reader make mode


microsoft scriptabl object

microsoft cntk


comput node scriptabl object system


train action



share object make runtim object train action i config record ptr configp

i config record config configp
wstring precis config precis dispatch elem type
precis
do train i config record config
precis
do train i config record config

runtim error invalid valu precis must precis

make share object dummi


comput node scriptabl object system
scriptabl object configur runtim type regist train action regist train action train action


do train scriptabl object i config record scriptabl object i config record config
do train scriptabl object i config record scriptabl object i config record config
do train config paramet config paramet config
do train config paramet config paramet config


do adapt cntk adapt command


elem type
do adapt config paramet config

deviceid type devic id devic from config config

config paramet config sgd config
make mode config make mode

config paramet reader config config reader
reader config insert trace level config trace level

data reader make share data reader reader config

share data reader cv data reader
config paramet cv reader config config cv reader

cv reader config size

cv reader config insert trace level config trace level
cv data reader make share data reader cv reader config


wstring orig model file name config orig model file name
wstring ref node name config ref node name

elem type config sgd

init mpi mpi wrapper get instanc
adapt orig model file name ref node name data reader cv data reader devic id make mode


do adapt config paramet config
do adapt config paramet config


do edit cntk edit command


elem type
do edit config paramet config

wstring edit path config edit path
wstring ndl macro config ndl macro
ndl script elem type ndl script
ndl macro

ndl script load config file ndl macro

mel script elem type mel script
mel script load config file and resolv variabl edit path config


do edit config paramet config
do edit config paramet config

copyright microsoft right reserv
licens licens licens file project root full licens inform

network descript languag code use interpret network descript languag


defin secur warn secur avail platform file give variabl warn

network descript languag
ndl network builder

convolut node
deprec node
evalu node
input and param node
linear algebra node
nonlinear node
pre comput node
reshap node
recurr node
special purpos node
train node



microsoft cntk

duplic node duplic node macro need might alreadi exist
node node duplic
duplic node exist previous duplic node alreadi
elem type
ndl node elem type ndl script elem type duplic node ndl node elem type node

ndl node elem type new node node copi
children push back new node
new node set parent script
new node


elem type
ndl script elem type ndl script ndl script copi me
config parser copi me

base name copi me base name
script string copi me script string
macro node copi me macro node
no definit copi me no definit definit made script interpret macro name call
defin macro defin expand macro reason call method
copi me comput network backup lookup use network node mix

script line pars node order
ndl node elem type node copi me script

duplic node
ndl node elem type new node duplic node node
add symbol new node get name new node

paramet function ad
config valu valu new node get param string
pars paramet new node valu creat new

script
script push back new node


search tabl symbol copi
happen constant defin macro
pair ndl node elem type pair copi me symbol

find copi tabl copi
symbol find pair first symbol

duplic node
ndl node elem type new node duplic node pair second
add symbol pair first new node
anyth take paramet evalu script
new node get param string


note child node popul node duplic
duplic separ


copi creat disconnect copi node
copi everyth macro expans
copi me node copi
elem type
ndl node elem type ndl node ndl node elem type copi me

name copi me name valu left equal
valu copi me valu valu right equal node name valu
parent copi me parent parent script
copi me node
param string copi me param string paramet
param macro copi me param macro paramet macro variabl use macro definit
copi paramet repars copi

nullptr pointer arbitrari structur
script macro call need expand macro call
expand eval valu overwitten multipl call macro
script copi me script ndl script elem type copi me script nullptr

elem type
ndl script elem type ndl script ndl script move me
config parser move move me

base name move move me base name
script string move move me script string
script move move me script script line pars node order macro definit follow bodi
symbol move move me symbol tabl
macro node move move me macro node interpret macro definit
no definit move move me no definit definit made script interpret macro name call
defin macro move move me defin macro
children move move me children child node note script node children macro node
move move me comput network backup lookup use network node mix


equal insensit check node equal
string1 compar comparis equal insensit sensit replac sensit version
string2 second compar
altern altern name
string equal insensit modifi string1 sensit version differ
equal insensit wstring string1 wstring string2 wchar altern

equal equal ci string1 string2
altern equal ci string1 altern

equal
string1 string2

equal


loop work
ndl pass ndl pass ndl pass

ndl pass ndl pass max
ndl pass cast ndl pass ndl pass
ndl pass


check function check match name
string1 compar comparis equal least half full node name replac full node name
allow undetermin variabl undetermin variabl symbol defin allow
name found
check function node type allow undetermin variabl

allow undetermin variabl
allow undetermin variabl allow undetermin variabl

wstring node type msra strfun utf16 node type

equal insensit node type oper name of ab node
equal insensit node type oper name of averag pool node
equal insensit node type oper name of batch normal node
ifdef come soon
equal insensit node type oper name of crf node

equal insensit node type oper name of class base cross entropi with softmax node cbce with sm
equal insensit node type oper name of clip node
equal insensit node type oper name of convolut node convolv
equal insensit node type oper name of pool node
equal insensit node type oper name of co distanc node co dist
equal insensit node type oper name of co distanc with neg sampl node co with neg sampl
equal insensit node type oper name of cosin node
equal insensit node type oper name of cross entropi node
equal insensit node type oper name of cross entropi with softmax node ce with sm
equal insensit node type oper name of diag time node
equal insensit node type oper name of diagon node
equal insensit node type oper name of dropout node
equal insensit node type oper name of dummi criterion node dummi criterion
equal insensit node type oper name of element time node
equal insensit node type oper name of error predict node classif error
equal insensit node type oper name of exp node
equal insensit node type oper name of floor node
equal insensit node type oper name of futur valu node
ifdef come soon
equal insensit node type oper name of gmm log likelihood node gmmll

equal insensit node type oper name of hardmax node
equal insensit node type oper name of input valu input
equal insensit node type oper name of inv std dev node
equal insensit node type oper name of khatri rao product node columnwis cross product
equal insensit node type oper name of learnabl paramet paramet
equal insensit node type oper name of log node
equal insensit node type oper name of log softmax node
equal insensit node type oper name of logist node logist
equal insensit node type oper name of lookup tabl node
equal insensit node type oper name of matrix l1 reg node l1 reg
equal insensit node type oper name of matrix l2 reg node l2 reg
equal insensit node type oper name of max pool node
equal insensit node type oper name of mean node
equal insensit node type oper name of minu node
equal insensit node type oper name of negat node
equal insensit node type oper name of past valu node delay
equal insensit node type oper name of per dim mean var de normal node per dim mv de norm
equal insensit node type oper name of per dim mean var normal node per dim mv norm
equal insensit node type oper name of plu node
equal insensit node type oper name of reciproc node
equal insensit node type oper name of rectifi linear node re lu
equal insensit node type oper name of reshap node
equal insensit node type oper name of row repeat node
equal insensit node type oper name of row stack node
ifdef come soon
equal insensit node type oper name of sequenc decod node se with sm

equal insensit node type oper name of sequenc with softmax node se with sm
equal insensit node type oper name of sigmoid node
equal insensit node type oper name of sin node
equal insensit node type oper name of softmax node
equal insensit node type oper name of spars input valu spars input
equal insensit node type oper name of sqrt node
equal insensit node type oper name of squar error node
equal insensit node type oper name of sum column element node
equal insensit node type oper name of sum element node
equal insensit node type oper name of tanh node
equal insensit node type oper name of time node
equal insensit node type oper name of transpos dimens node support transpos
equal insensit node type oper name of transpos time node
legaci name
equal insensit node type column element time
equal insensit node type constant const
equal insensit node type imag input imag
equal insensit node type imag paramet
equal insensit node type row element time
equal insensit node type row slice
equal insensit node type scale
equal insensit node type spars imag input spars imag
equal insensit node type transpos

actual node name paramet found someth

node type msra strfun utf8 node type



elem type
ndl script elem type ndl script elem type

variabl class

ndl script ndl script

ndl script ndl script


ndl node name counter

ndl node name counter

ndl node
ndl node

ndl script
ndl script


copyright microsoft right reserv
licens licens licens file project root full licens inform

note despit name file realli pars actual comput network


defin secur warn secur avail platform file give variabl warn

basic
ndl network builder
linear algebra node
recurr node
convolut node
nonlinear node
reshap node
input and param node
tensor shape

microsoft cntk



elem type
ndl node evalu impl elem type evalu ndl node elem type node wstring base name ndl pass

comput network builder elem type builder

constant need evalu translat number
node get type ndl type constant node get type ndl type array


setup node paramet start paramet mani
need ndl pass resolv step hookup input
node param start
node param count

paramet
vector ndl node elem type paramet node get paramet

name use node
wstring name msra strfun utf16 node get name
base name

name base name name


wstring cn node type msra strfun utf16 node get valu

comput node ptr node ptr

node pointer node store eval valu
ndl pass initi

node ptr comput node elem type from void ptr node get eval valu
node ptr

node ptr dynam pointer cast comput node elem type get node from name name
node set eval valu node ptr



oper name of input valu cn node type oper name of spars input valu cn node type

is spars oper name of spars input valu cn node type
paramet size
runtim error paramet tensor dimens vecdim row col cn node type

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size
tensor shape process tensor shape paramet node is imag cn node type

wstring dynam axi node get option paramet dynam axi
todo dynam axi name node point node memoiz insid
first look node alreadi exist network
bugbug dimens
node name exist name
node ptr dynam pointer cast comput node elem type get node from name name
is spars
node ptr builder creat spars input node name tensor shape dynam axi

node ptr builder creat input node name tensor shape dynam axi


cn node type imag input cn node type spars imag input

is spars cn node type spars imag input
paramet size paramet size allow legaci num imag ignor
runtim error paramet imag width imag height imag channel cn node type

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size imag width ndl node elem type get scalar
size imag height ndl node elem type get scalar
size imag channel ndl node elem type get scalar
imag layout kind imag layout kind imag layout kind from node get option paramet imag layout
wstring dynam axi node get option paramet dynam axi

is spars
node ptr builder creat spars input node name imag dimens as tensor shape imag width imag height imag channel imag layout kind dynam axi

node ptr builder creat input node name imag dimens as tensor shape imag width imag height imag channel imag layout kind dynam axi


oper name of learnabl paramet cn node type cn node type imag paramet

is imag cn node type imag paramet
is imag

paramet size
runtim error paramet tensor dimens vecdim row col plu option paramet learn rate multipli init uniform gaussian fixedvalu init valu scale valu cn node type



paramet size
runtim error paramet imag width imag height imag channel plu option paramet learn rate multipli init uniform gaussian fixedvalu init valu scale valu cn node type


ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size
tensor shape process tensor shape paramet node is imag cn node type

backward compat need gradient subsum learn rate multipli
gradient updat need node get option paramet need gradient
node get option paramet need gradient
node get option paramet comput gradient
learn rate multipli node get option paramet learn rate multipli
gradient updat need user specifi need gradient flag
learn rate multipli

node ptr builder creat learnabl paramet name tensor shape
node ptr set learn rate multipli learn rate multipli

ndl pass final

random seed
wstring init string node get option paramet init uniform
elem type init valu scale node get option paramet init valu scale
elem type valu node get option paramet valu
init on cpu onli node get option paramet init on cpu onli
forc random seed node get option paramet random seed disabl

equal ci init string fix valu
node ptr valu set valu valu
equal ci init string uniform
init learnabl paramet node ptr forc random seed random seed forc random seed init valu scale init on cpu onli
equal ci init string gaussian
init learnabl paramet node ptr forc random seed random seed forc random seed init valu scale init on cpu onli
equal ci init string from file

init from file path node get option paramet init from file path
init from file path
runtim error init from file path must from file initi method
init from file path init from file path init from file path size
remov open close quot
init from file path init from file path substr init from file path size
fexist init from file path
runtim error file point init from file path exist init from file path
dynam pointer cast learnabl paramet elem type node ptr init from file msra strfun utf16 init from file path


runtim error init must valu uniform gaussian fix valu


cn node type constant

paramet size
runtim error constant paramet option paramet row yourvalu col yourvalu

ndl pass initi

size row node get option paramet row
size col node get option paramet col

node ptr builder creat learnabl paramet name row col
node ptr set learn rate multipli

ndl pass final node ptr valu get num element

elem type paramet get scalar
node ptr valu set valu


cn node type row slice note thi map onto slice node specifi differ

paramet size
runtim error row slice three paramet usag row slice start row index num row orig node name

node param count
node param start

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size start index ndl node elem type get scalar
size row ndl node elem type get scalar

node ptr builder row slice start index row name


cn node type oper name of row repeat node

paramet size
runtim error row repeat paramet usag row repeat orig node name num repeat

node param count
node param start

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size ndl node elem type get scalar

node ptr builder row repeat name


cn node type oper name of diagon node

paramet size
runtim error diagon paramet usag diagon orig node name

node param count
node param start

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size

node ptr builder diagon name


cn node type reshap oper name of reshap node

paramet size
runtim error reshap paramet usag reshap orig node name num row imag width imag height imag channel

node param count
node param start

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size row ndl node elem type get scalar
size width node get option paramet imag width
size height node get option paramet imag height
size channel node get option paramet imag channel
imag layout kind imag layout kind imag layout kind from node get option paramet imag layout

node ptr builder legaci reshap row imag dimens as tensor shape width height channel imag layout kind name


cn node type oper name of past valu node
cn node type oper name of futur valu node

paramet size paramet size allow legaci col paramet unus
runtim error past valu futur valu three paramet usag past valu row input time step default hidden activ
todo allow tensor descriptor allow infer mayb alreadi support check

node param count input
node param start paramet size index input

ndl pass initi

evalu scalar paramet
vector evalu paramet node base name paramet size
size row ndl node elem type get scalar
three paramet second column
ignor legaci size col paramet size ndl node elem type get scalar

default hidden activ node get option paramet default hidden activ todo paramet call default hidden activ

backward compat check time step first
size time step node get option paramet time step
time step
time step node get option paramet delay time

cn node type oper name of past valu node
node ptr builder past valu default hidden activ row time step name

node ptr builder futur valu default hidden activ row time step name


cn node type oper name of convolut node cn node type oper name of pool node

paramet size paramet size

cn node type oper name of convolut node

runtim error unexpect paramet count support mode
convolut take paramet weight node name input valu node name kernel width kernel height output channel horizont subsampl vertic subsampl
option paramet zero pad yourvalu max temp mem size in sampl yourvalu imag layout cudnn
convolut take paramet weight node name input valu node name kernel shape
option paramet map count yourvalu stride yourvalu share yourvalu auto pad yourvalu lower pad yourvalu upper pad yourvalu max temp mem size in sampl yourvalu imag layout cudnn
convolut paramet kernel shape map count stride share auto pad lower pad upper pad array kernel shape
cn node type cn node type



runtim error unexpect paramet count paramet input valu node name pool kind kernel shape
option paramet stride yourvalu auto pad yourvalu lower pad yourvalu upper pad yourvalu imag layout cudnn
paramet kernel shape stride auto pad lower pad upper pad array kernel shape
cn node type cn node type



setup paramet posit children hook later
node param start
node param count cn node type oper name of convolut node

ndl pass initi

paramet size

req param node get paramet
opt param node get paramet
param getter req param node size index tensor shape

index req param size
parm req param index
parm get type ndl type array
tensor shape size parm get scalar
parm node get parent script pars variabl parm get valu get paramet
vector size dim parm size
size dim size
dim parm get valu
tensor shape dim

param resolv opt param node name size default val tensor shape

find opt param opt param name ndl node elem type equal ci get name name
opt param
tensor shape default val
parm node get parent script pars variabl get valu
parm get type ndl type constant
tensor shape size parm get valu
parm parm get paramet
vector size dim parm size
size dim size
dim parm get valu
tensor shape dim

bool param resolv opt param node name default val vector

find opt param opt param name ndl node elem type equal ci get name name
opt param
vector default val
parm node get parent script pars variabl get valu
parm nullptr
vector get valu
parm get type ndl type array
vector parm get valu
parm parm get paramet
vector dim parm size
size dim size
dim parm get valu
dim


kernel shape param getter req param size
map count param resolv map count
stride param resolv stride
share bool param resolv share
auto pad bool param resolv auto pad
lower pad param resolv lower pad
upper pad param resolv upper pad
imag layout kind imag layout imag layout kind from node get option paramet imag layout
size max temp mem size in sampl node get option paramet max temp mem size in sampl

pool pool kind
cn node type oper name of pool node

parm node get parent script pars variabl req param get valu
pool pool kind from wstring parm get valu


pool pool kind

node ptr builder convolut kernel shape map count stride share
auto pad lower pad upper pad imag layout max temp mem size in sampl name



node ptr builder pool pool kernel shape stride auto pad lower pad upper pad imag layout name



paramet size

skip weight node input valu node

evalu scalar paramet
vector evalu paramet node base name paramet size
reset counter start zero
size kernel width ndl node elem type get scalar
size kernel height ndl node elem type get scalar
size output channel ndl node elem type get scalar
size horizont subsampl ndl node elem type get scalar
size vertic subsampl ndl node elem type get scalar


option
imag layout kind imag layout kind imag layout kind from node get option paramet imag layout
zero pad node get option paramet zero pad
size max temp mem size in sampl node get option paramet max temp mem size in sampl

node ptr builder convolut kernel width kernel height output channel
horizont subsampl vertic subsampl imag layout kind zero pad
max temp mem size in sampl name





cn node type oper name of max pool node

paramet size
runtim error paramet input valu node name window width window height horizont subsampl vertic subsampl imag layout cudnn cn node type

setup paramet posit children hook later
node param count
node param start

ndl pass initi

skip input valu node

evalu scalar paramet
vector evalu paramet node base name paramet size
reset counter start zero
size window width ndl node elem type get scalar
size window height ndl node elem type get scalar
size horizont subsampl ndl node elem type get scalar
size vertic subsampl ndl node elem type get scalar


imag layout kind imag layout kind imag layout kind from node get option paramet imag layout

node ptr builder max pool input width input height channel window width window height
horizont subsampl vertic subsampl imag layout kind name


cn node type oper name of averag pool node

paramet size
runtim error paramet input valu node name window width window height horizont subsampl vertic subsampl imag layout cudnn cn node type

setup paramet posit children hook later
node param count
node param start

ndl pass initi

skip input valu node

evalu scalar paramet
vector evalu paramet node base name paramet size
reset counter start zero
size window width ndl node elem type get scalar
size window height ndl node elem type get scalar
size horizont subsampl ndl node elem type get scalar
size vertic subsampl ndl node elem type get scalar


imag layout kind imag layout kind imag layout kind from node get option paramet imag layout

node ptr builder averag pool input width input height channel window width window height
horizont subsampl vertic subsampl imag layout kind name


cn node type oper name of batch normal node

paramet size
runtim error paramet input valu node name scale bia run mean run inv std dev cn node type

setup paramet posit children hook later
node param count
node param start

ndl pass initi

skip input valu node scale bia run mean run inv std dev
evalu scalar paramet
vector evalu paramet node base name paramet size

option paramet
spatial node get option paramet spatial
norm time const node get option paramet normal time constant
blend time const node get option paramet blend time constant
epsilon node get option paramet epsilon 00001
wstring bn engin s node get option paramet engin cntk
use cntk engin
equal ci bn engin s cntk
use cntk engin
equal ci bn engin s cudnn
use cntk engin

invalid argument unsupport batch normal engin choos either cntk cudnn
imag layout kind imag layout kind imag layout kind from node get option paramet imag layout

node ptr builder batch normal nullptr nullptr nullptr nullptr nullptr spatial norm time const blend time const epsilon use cntk engin imag layout kind name





setup variabl node paramet process
node param count paramet size paramet node standard node
node param start

ndl pass initi

node ptr builder creat comput node node get valu name





ndl pass initi
node set eval valu node ptr
evalu paramet
evalu paramet node base name node param start node param count

ndl pass resolv

vector input evalu paramet node base name node param start node param count

cn node type oper name of row stack node support variabl length input

vector comput node base ptr input node
input node resiz input size
input size
input node comput node elem type from void ptr input

node ptr attach input input node




vector comput node base ptr input node
input
input node push back comput node elem type from void ptr
node ptr attach input input node
todo
input size

todo vector attach

node ptr attach input comput node elem type from void ptr input


node ptr attach input comput node elem type from void ptr input comput node elem type from void ptr input


node ptr attach input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input


node ptr attach input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input


node ptr attach input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input


node ptr attach input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input comput node elem type from void ptr input


node param count
runtim error invalid paramet name call node get name node get valu




process common option paramet current
process option paramet node


ndl pass final




process tensor shape paramet assum posit paramet start posit tensor dimens pars
is imag must tensor interpret option paramet imag layout say
elem type
tensor shape ndl node evalu impl elem type process tensor shape paramet ndl node elem type node vector size is imag wstring cn node type error messag

gather dim
vector size dim
dim push back ndl node elem type get scalar first mandatori
size
dim push back ndl node elem type get scalar

imag interpret layout accord option imag layout paramet
paramet given assum time oper interpret last dimens accord imag layout
is imag

dim size
runtim error paramet width height num channel cn node type
imag layout kind imag layout kind imag layout kind from node get option paramet imag layout
size dim size last need arrang
small vector size imag dim imag dimens as tensor shape dim dim dim imag layout kind get dim
size
dim imag dim


turn tensor
tensor shape dim


ndl builder impl
ndl builder impl



copyright microsoft right reserv
licens licens licens file project root full licens inform

esoter action cntk action deprec


defin nonstdc deprec make accept posix function without

stdafx
basic
action
comput network
comput node
data reader
data writer
simpl network builder
config
scriptabl object


chrono
algorithm
vector
iostream
queue

memori

ifndef
defin



microsoft
microsoft cntk


do convert from dbn cntk convertdbn command


elem type
do convert from dbn config paramet config

wstring model path config model path
wstring dbn model path config dbn model path

net builder make share simpl network builder elem type config
comput network ptr net builder build network from dbn file dbn model path
save model path



do export to dbn cntk exportdbn command


elem type
do export to dbn config paramet config

deviceid type devic id devic from config config

wstring model path config model path
wstring dbn model path config dbn model path

comput network ptr make share comput network devic id
load elem type model path

write file
save to dbn file elem type dbn model path


do convert from dbn config paramet config
do convert from dbn config paramet config
do export to dbn config paramet config
do export to dbn config paramet config

copyright microsoft right reserv
licens licens licens file project root full licens inform

reshap node collect node reshap sampl matric lead layout chang


basic
reshap node
matrix
comput node
sequenc

unord


vector
stdexcept

memori
algorithm


microsoft cntk


reduc element axi input


elem type
reduc element node elem type copi to comput node base ptr node p wstring new name copi node flag flag

base copi to node p new name flag
node dynam pointer cast reduc element node elem type node p
node axi axi
node oper oper
node


elem type
reduc element node elem type load file fstream size model version

base load fstream model version
fstream axi oper
valid op


elem type
reduc element node elem type save file fstream

base save fstream
fstream axi oper note serial opcod sinc opcod chang


elem type
reduc element node elem type forward prop frame rang

arg
size rank determin elementwis tensor rank
result valu tensor for rank
input input valu tensor for rank

actual oper copi reduct
result do unari op of input element wise oper op copi
note implement mean pass alpha


elem type
reduc element node elem type backprop to size input index frame rang

input index input index

arg
size rank determin elementwis tensor rank
slice output grad gradient tensor for rank propag
slice input grad input gradient tensor for rank

gradient simpl pass code unfortun


element wise oper op sum
plu broadcast gradient
slice input grad add copi of slice output grad


come

log plu softmax
henc gradient
softmax reduc log plu
target gradient gradient from top input valu output valu todo verifi
comput dfferenc input output place would need temp memori need opcod add scale exp of diff ternari

copi gradient valu target gradient gradient from top output valu input valu need opcod todo verifi



elem type
reduc element node elem type output use in comput input node gradient



element wise oper op sum
differ log plu

logic error should


elem type
reduc element node elem type input use in comput input node gradient size input index



element wise oper op sum
differ log plu

logic error should


oper specif element wise oper
elem type
reduc element node elem type valid op

oper plu element wise oper op sum

invalid argument given invalid oper code allow plu soon node descript oper


elem type
reduc element node elem type valid is final valid pass

base valid is final valid pass
infer mb layout from input for standard case is final valid pass

valid opcod instanti never updat
valid op

shape input get sampl layout
dim shape get dim
axi
dim entir sampl reduc scalar
axi axi dim size
dim axi axi reduc scalar
is final valid pass
invalid argument shape axi node descript shape axi

set dim tensor shape dim input ha mb layout


reduc element node
reduc element node


where bit vector extract indic valu sequenc


wrapper mb layout sequenc vector pack sequenc
sequenc length vector

vector vector size sequenc vector
mb layout sequenc info sequenc info
sequenc vector sequenc vector vector sequenc sequenc length
vector sequenc info sequenc info origin sequenc info seq id
sequenc length vector vector sequenc info sequenc info sequenc vector sequenc vector sequenc info sequenc info sequenc vector sequenc vector
size size sequenc info size
mb layout sequenc info size descriptor sequenc

sequenc info
seq id sequenc info seq id

t begin
t end sequenc vector size


sequenc length vector


todo where mb layout creat begin forward prop forward prop
begin forward prop gener access actual valu
forward prop might late defin semant
bugbug thi first node valu depend mb layout resiz valu otherwis alway
elem type
where node elem type forward prop non loop

gather sequenc
in mb layout input get mb layout
input input valu
sequenc in mb layout get all sequenc
index sequenc index sequenc buffer
index sequenc size sequenc size
index sequenc resiz sequenc size
size sequenc size

sequenc
seq id sequenc

index sequenc index sequenc
index sequenc clear
size get num time step
input in mb layout get column index condit check node perform meat
index sequenc push back
note access valu directli put both state possibl consum well

input collaps data locat bugbug move back sinc both state broken present
creat mb layout
out mb layout get mb layout
out mb layout init as pack sequenc sequenc length vector sequenc index sequenc temp placement buffer temp row alloc buffer
copi output
vector elem type out mb layout get num col numer limit elem type quiet cannot easili avoid initi might well init gap
size sequenc size out mb layout get all sequenc size sequenc index beyond
size size

out mb layout get all sequenc
seq id sequenc gap keep

index sequenc index sequenc
size get num time step
out mb layout get column index elem type index sequenc

dangl gap take opportun verifi
size size sequenc size
sequenc seq id sequenc
size size out mb layout get all sequenc size
out mb layout get all sequenc seq id sequenc
result kept cpudevic sinc like access pack index node
valu transfer to devic if not there cpudevic is be move empti transfer updat prefer devic
valu set valu out mb layout get num col cpudevic matrix format matrix format col major


elem type
where node elem type backprop to non loop size input index

cannot backprop condit



elem type
where node elem type valid is final valid pass

comput node base valid is final valid pass
gener mb layout
is final valid pass input ha mb layout
invalid argument oper oper minibatch layout node name oper name
p mb layout

p mb layout make share mb layout gener layout
p mb layout set uniqu axi name where node axi

scalar scalar
is final valid pass input get sampl layout get num element
invalid argument oper oper scalar input node name oper name
set dim tensor shape


where node
where node


pack index node target object index sequenc sequenc


elem type
pack index node elem type forward prop non loop

sourc mb layout input sourcedata get mb layout use index convers
index mb layout input indexdata get mb layout
index input indexdata valu index valu map
result valu pack index valu map sourc data layout
sourc sequenc
input matrix contain time indic sequenc refer frame insid sequenc
replac everi sequenc index resolv column index mb layout
sourc sequenc sourc mb layout get all sequenc
size sourc sequenc size

sourc seq sourc sequenc
sourc seq seq id sequenc

index seq index mb layout find sequenc sourc seq seq id find correspond entri index mb layout
size t index t index index seq get num time step t index index valu index sequenc

j index index mb layout get column index index seq t index time index actual locat matrix storag
t sourc size index j index time locat rel sourc sequenc
j sourc sourc mb layout get column index sourc seq t sourc time index well thi perform rang check
result j index elem type j sourc


note mayb longer need insid updat function valu size node
result collaps data locat bugbug move back sinc both state broken present


elem type
pack index node elem type backprop to non loop size input index

cannot backprop condit




elem type
pack index node elem type valid is final valid pass

comput node base valid is final valid pass

inherit mb layout sampl dimens scalar index data
becaus index sequenc pack index sequenc target index calcul
p mb layout input indexdata get mb layout
is final valid pass input indexdata ha mb layout input sourcedata ha mb layout
logic error oper requir input minibatch must mb layout node name oper name

is final valid pass input indexdata get sampl layout get num element
invalid argument oper requir second argument index data scalar sequenc node name oper name

set dim input indexdata get sampl layout ha mb layout


pack index node
pack index node


gather pack node pack index sourc data gather oper


elem type
gather pack node elem type forward prop non loop

input indexdata mask miss valu column to frame rang input indexdata get mb layout indic invalid column gather scatter
index input indexdata valu column indic copi
sourc input sourcedata valu sourc copi
output valu output goe
output do gather column of beta index sourc alpha


elem type
gather pack node elem type backprop to non loop size input index

input index sourcedata

index input indexdata valu column indic copi
sourc gradient input sourcedata gradient sourc propag gradient intpu
output gradient gradient output gradient propag
sourc gradient do scatter column of beta index output gradient alpha



elem type
gather pack node elem type valid is final valid pass

comput node base valid is final valid pass

inherit mb layout index data
p mb layout input indexdata get mb layout
is final valid pass input indexdata ha mb layout
logic error requir first argument index time dimens node descript

sourc ha time dimens input sourcedata ha mb layout

is final valid pass input indexdata get sampl layout get num element
invalid argument requir first argument index scalar time sequenc node descript

inherit tensor dimens sourc data minu last column time dimens todo need becom simpler
sourc ha time dimens
set dim input sourcedata get sampl layout ha mb layout


small vector size layout scalar
input sourcedata get sampl layout get rank

src layout input sourcedata get sampl layout get dim
layout assign src layout src layout

set dim tensor shape layout ha mb layout



gather pack node
gather pack node


scatter pack node layout data pack index sourc data scatter oper


elem type
scatter pack node elem type forward prop non loop

input indexdata get mb layout input sourcedata get mb layout
invalid argument oper requir minibatch layout index sourc node name oper name
input indexdata mask miss valu column to frame rang input indexdata get mb layout indic invalid column gather scatter
index input indexdata valu column indic copi
sourc input sourcedata valu sourc copi
output valu output goe
output do scatter column of beta index sourc alpha


elem type
scatter pack node elem type backprop to non loop size input index

input index sourcedata

index input indexdata valu column indic copi
sourc gradient input sourcedata gradient sourc propag gradient input
output gradient gradient output gradient propag
sourc gradient do gather column of beta index output gradient alpha



elem type
scatter pack node elem type valid is final valid pass

comput node base valid is final valid pass

inherit mb layout layout data thing
p mb layout input layoutdata get mb layout
is final valid pass input layoutdata ha mb layout input indexdata ha mb layout input sourcedata ha mb layout
logic error oper requir input minibatch must mb layout node name oper name

is final valid pass input indexdata get sampl layout get num element
invalid argument oper requir second argument index data scalar sequenc node name oper name

todo also know index data sourc data must mb layout runtim

inherit tensor dimens sourc data
set dim input sourcedata get sampl layout ha mb layout


scatter pack node
scatter pack node



copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

comput node
input and param node
comput network builder todo pull new comput node from config node know network larg
tensor shape

ifndef
defin


microsoft cntk




subroutin evalu


elem type
comput node elem type backprop frame rang children in thi loop children in outer loop

normal gradient matrix creat input anoth node
thi happen though special node insid
consum outsid depend those might topolog sort
node propag outsid thu last
time step sequenc receiv gradient parent
thu gradient matric alloc
keep enabl work
case need
need gradient gradient initi
logic error oper backprop call uniniti gradient node name oper name
fprintf stderr oper initi gradient line node name oper name

need gradient
lazi zero gradient gradient first time


is all frame is part of loop children in thi loop
logic error oper backprop call whole batch frame rang node particip node name oper name

size input size

comput node ptr child input
child need gradient
children in thi loop child is part of loop is part of loop
children in outer loop child is part of loop is part of loop

fprintf stderr backprop oper child node name oper name child node name child oper name
need gradient
logic error oper need gradient children node name oper name
dumpoutput
fprintf stderr backprop node name

child lazi zero gradient gradient first time

propag node outsid effici
thi handl seq travers flow control node backprop
check verifi
is part of loop child is part of loop is all frame

logic error backprop ineffici oper propag gradient
node name oper name child node name child oper name


fprintf stderr backprop to time idx in seq node name oper name
backprop to comput partial child sum gradient valu child

ifdef display debug

fprintf stderr gradient need comput child oper name child node name





subroutin valid implement


helper infer mb layout node input standard
standard
input must share layout ad minibatch
except layout time node
layout stabil
differ layout involv fail
comput node base infer mb layout from input for standard case is final valid pass

mb layout ptr p mb layout start layout
child input

child node delay valu node base seem allow bugbug then oper correctli

child p mb layout layout typic paramet node

p mb layout first layout copi
p mb layout child p mb layout
p mb layout child p mb layout is final valid pass layout compar whether
runtim error infer mb layout from input for standard case expect minibatch layout children child use differ layout previous children might sync runtim design reconcil dynam axi forward layout node
node descript child node name child oper name

consist instal
link to mb layout p mb layout


singl input map input element wise sigmoid
comput node base valid unari map is final valid pass

input size
comput node base valid is final valid pass
infer mb layout from input for standard case is final valid pass
set dim input


binari oper plu
allow broadcast dimens layout row otherwis col
thi also help resiz children size
comput node base valid binari zip is final valid pass allow broadcast

input size
comput node base valid is final valid pass
infer mb layout from input for standard case is final valid pass

valid infer binari input dim

is final valid pass
input get mb layout input get mb layout input ha mb layout input ha mb layout

logic error minibatch layout might sync runtim design reconcil dynam axi forward layout node node descript


result tensor shape dimens
shape0 get input sampl layout
shape1 get input sampl layout
small vector size dim shape0 get dim
shape1 get rank dim size
dim resiz shape1 get rank one

rank higher need take rank
rank higher pad equal lentgh
size shape1 get rank

size dim1 shape1
bugbug must consid allow broadcast flag
dim dim1 broadcast unspecifi
dim dim1 dimens broadcast
dim1 dim broadcast unspecifi
dim alreadi correct
is final valid pass dim1 dim broadcast unspecifi must match
invalid argument input dimens compat
node descript shape0 shape1


set dim tensor shape dim ha mb layout


nari oper ternari zip clip
allow broadcast dimens layout row otherwis col
thi also help resiz children size
comput node base valid nari zip is final valid pass allow broadcast size num input

input size num input
comput node base valid is final valid pass
infer mb layout from input for standard case is final valid pass

valid infer nari input dim num input

check minibatch layout consist possibl pair choos
is final valid pass
size num input
size num input
input get mb layout input get mb layout input ha mb layout input ha mb layout
logic error minibatch layout might sync runtim design reconcil dynam axi forward layout node node descript

result tensor shape dimens input
shape0 get input sampl layout

dim input
size max rank shape0 get rank
size num input

shape get input sampl layout
shape get rank max rank
max rank shape get rank

small vector size dim shape0 get dim
dim resiz max rank

first check invalid dimens
size max rank

size max dim
tensor shape max shape shape0 arbitrari use error messag
size num input

current shape get input sampl layout
size current rank current shape get rank
make sure rank input bigger current index otherwis impli singleton dimens need
current rank

size current dim current shape
current dim max dim current dim max dim broadcast known meant infer

invalid argument input dimens compat
node descript max shape current shape

current dim max dim

max dim current dim
max shape current shape





right dim
size max rank

size num input

shape get input sampl layout

shape get rank

size shape
dim
dim




set dim tensor shape dim ha mb layout


unari reduc oper matrix l1 reg node
comput node base valid unari reduc is final valid pass

input size
comput node base valid is final valid pass
p mb layout nullptr node hold mini batch
set dim tensor shape


binari reduc oper cross entropi with softmax node
current call criterion node
thi also infer child learnabl paramet wonder need criterion node edg case
learnabl paramet regular criterion node learnabl paramet criterion node place
comput node base valid binari reduc is final valid pass

comput node base valid is final valid pass
p mb layout nullptr node hold mini batch
valid infer binari input dim

is final valid pass

input get sampl layout is elementwis compat with input get sampl layout

input get sampl layout
input get sampl layout
bugbug allow broadcast
logic error tensor dimens input match node descript

input ha mb layout
logic error expect mb layout input node descript
input ha mb layout
logic error expect mb layout input node descript
shape mb layout runtim

set dim tensor shape


helper valid
complex case convolut dimens quit difficult user know deriv
thi featur allow node help resiz input node expect valu
input must learnabl paramet
comput node base valid infer binari input dim

limit infer children dimens
dimens specifi assum operand dimens
note check sinc call node children
children formal verifi elsewher consist
input size
size index index index

input index
input index
borrow dimens input input
valid infer input dim from get sampl layout



case
comput node base valid infer nari input dim size num input

limit infer children dimens
dimens specifi assum operand dimens
note check num input sinc call node n input children
children formal verifi elsewher consist
input size num input
size index index num input index

input index

size index other index other num input index other

index other index

input index other
borrow dimens input input
valid infer input dim from get sampl layout





error back leav outsid code detect error
elem type
comput node elem type valid infer input dim from tensor shape other shape

infer learnabl paramet point
node dynam cast learnabl paramet elem type
node
node infer input dim from other shape



tensor helper


determin sampl tensor dimens oper base output input
sampl tensor mean consid singl sampl mb layout sampl layout singl matrix column
todo turn rank member variabl call method valid current call everi singl forward prop backprop to
size comput node base determin elementwis tensor rank

determin largest tensor dimens amongst sampl shape output select input
size max rank get sampl layout get rank
size get num input

size rank input get sampl layout get rank
max rank rank
max rank rank

max rank


form actual tensor describ full
tensor shape comput node base get tensor shape size rank

layout necessari sequenc time axe none absorb column dimens
tensor shape tensor shape get sampl layout todo need expect tensor arbitrari stride came slice reshap transpos place
ha mb layout

size rank size rank tensor shape get rank
tensor shape append in place get mb layout get num parallel sequenc
tensor shape append in place get mb layout get num time step

tensor shape


tensor shape slice referenc given frame rang
import thi shape carri offset stride dimens
tensor shape comput node base get tensor slice for size rank frame rang

form actual tensor describ full
note thi stride
tensor shape get tensor shape rank

determin slice dimens describ frame rang
note these dimens without stride
slice tensor slice with mb layout for tensor shape get dim get mb layout

narrow tensor
note stride honor correctli
tensor shape narrow to slice

tensor shape


get tensor slice for refer singl column result time axe
thi need time node left argument broken individu matric gemm call
enabl first argument mb layout need mb layout refer singl sequenc time step
tensor shape comput node base get one sampl tensor slice for size rank frame rang

tensor shape result get tensor slice for rank
undo ad time axe done get tensor shape
is one column wrt get mb layout
logic error get one sampl tensor slice for requir refer singl sampl
ha mb layout
result trim rank in place rank note thi verifi extra dimens reduc
result



other


comput node base format oper prototyp extra arg

prototyp
prototyp msra strfun strprintf node name oper name

oper
is leaf
prototyp


prototyp
size get num input

child input

prototyp

child
prototyp msra strfun strprintf child node name

prototyp

prototyp extra arg
prototyp


tensor dimens oper
prototyp

is leaf

prototyp
size get num input

child input

prototyp

child nullptr

prototyp


prototyp child shape descript

prototyp extra arg
prototyp


prototyp msra strfun strprintf shape descript

prototyp


comput node base shape descript

msra strfun strprintf
sampl layout
ha mb layout
ha mb layout get mb layout get axi name


elem type
comput node elem type dump node info print valu print metadata file fstream

print metadata

fstream node name oper name

is leaf

fstream wstring
size get num input


fstream wstring
fstream input input node name

fstream wstring




write content node format readabl form
transpos mean sampl transpos column sampl
is spars zero valu transpos make sens column transpos
elem type
comput node elem type write minibatch with format file frame rang
size onli up to row size onli up to t transpos is categori label is spars
vector label map sequenc separ
sequenc prologu sequenc epilogu
element separ sampl separ
valu format string
output gradient

minibatch matrix mat data mat row mat stride
matrix elem type output valu output gradient gradient valu
mat row output valu get num row
mat stride mat row column
uniqu elem type mat data ptr output valu copi to array
elem type mat data mat data ptr
sampl layout get sampl layout current use spars dens tensor linear

process sequenc
mb layout ptr p mb layout get mb layout
p mb layout mb layout print aggreg learnabl paramet

p mb layout make share mb layout
p mb layout init as frame mode treat singl sampl
todo thi done effici ever need

sequenc p mb layout get all sequenc
width p mb layout get num time step

tensor shape tensor shape get sampl layout
stringstream
dim tensor shape get dim
dim

shape bugbug chang tensor shape make sure alway format

sequenc prologu ha shape sequenc prologu find sequenc prologu npo
sampl separ ha shape sampl separ find sampl separ npo
sequenc prologu ha seq id sequenc prologu find sequenc prologu npo
sampl separ ha seq id sampl separ find sampl separ npo

size sequenc size

seq info sequenc
seq info seq id sequenc noth gap

t begin seq info t begin seq info t begin
t end seq info t end width seq info t end width
t begin t end sequenc resid
also referenc sequenc resid

narrow frame rang need
is all frame t begin time offset ptrdiff time idx in seq
is all frame t end time offset ptrdiff time idx in seq ptrdiff time rang
t begin
t begin
t end
t end
rang want
ptrdiff
skip sequenc

sequenc matrix seq data seq row seq col seq stride
seq data mat data p mb layout get column index seq info t begin mat stride
seq row mat row
seq col
seq stride p mb layout get num parallel sequenc mat stride

seq prol sequenc prologu
sampl sep sampl separ

sequenc prologu ha shape sampl separ ha shape

msra strfun strprintf shape seq info get num time step
sequenc prologu ha shape
seq prol msra strfun replac all seq prol
sampl separ ha shape
sampl sep msra strfun replac all sampl sep


sequenc prologu ha seq id sampl separ ha seq id

msra strfun strprintf seq info seq id
sequenc prologu ha seq id
seq prol msra strfun replac all seq prol
sampl separ ha seq id
sampl sep msra strfun replac all sampl sep



fprintf or die sequenc separ
fprintf or die seq prol

output accord format specif
format char valu format string back
is categori label categori find valu output index possibl map

format char verifi label dimens

output valu get num row label map size
sampl layout label map size match first

size warn
warn
fprintf stderr write dimens match entri label map file map seq row label map size
valu format string back fallback
format char valu format string back


updat matrix place index
find column
size seq col time step sequenc

max loc
max val
size seq row row

seq data seq stride
max loc max val

max loc
max val


seq data seq stride elem type max loc overwrit first element place

seq row ignor remain dimens

valu
dval

format char real

dval dval fab dval clear sign neg produc inconsist
fprintf or die valu format string dval

format char categori integ index

fprintf or die valu format string dval

format char categori label

size uval size dval
label map
uval label map size
uval label map size
sval label map uval
fprintf or die valu format string sval


bound print
iend transpos seq row seq col dimens
jend transpos seq col seq row
istop transpos onli up to row onli up to t stop dimens debug often need first valu huge matric
jstop transpos onli up to t onli up to row
istrid transpos seq stride
jstride transpos seq stride
is spars

spars linear entir matrix singl vector print coordin
todo thi done nice keep block structur
size num print
size iend element flatten

size jend row

dval seq data istrid jstride
dval valu

num print
fprintf or die transpos sampl separ element separ
dval format char hack assum either never precis hit
dval
size transpos
size transpos
size sampl layout size

fprintf or die sampl layout
sampl layout label map size annot index label dimens match misfir
fprintf or die label map sampl layout
sampl layout

seq info get num time step
fprintf or die
fprintf or die





size jend output row bugbug index renam


fprintf or die sampl sep
jstop jstop jend jstop jend well valu instead

fprintf or die jend jstop nuff said


inject sampl tensor index print wise tensor
transpos sampl layout size is categori label differ sampl dimens

size sampl layout size
fprintf or die sampl layout get stride sampl layout
fprintf or die

valu
size iend element


fprintf or die element separ
istop istop iend

fprintf or die iend istop


dval seq data istrid jstride
dval



fprintf or die sequenc epilogu
sequenc
fflush or die


write format option process wstring node name fragment size minibatch id

fragment msra strfun replac all fragment
fragment msra strfun replac all fragment
fragment msra strfun replac all fragment
fragment msra strfun replac all fragment config might strip space
fragment find fragment npo
fragment msra strfun replac all fragment msra strfun utf8 node name
fragment find fragment npo
fragment msra strfun replac all fragment msra strfun strprintf minibatch id
sequenc id
fragment


config record type
write format option write format option config record type config
write format option

gather addit format option
config exist format

config record type format config config format config record type record
format config exist current inherit outer block

wstring format config
real
categori is categori label
spars is spars
invalid argument write must real categori spars
label map file wstring format config label map file

transpos format config transpos transpos
prologu format config prologu prologu
epilogu format config epilogu epilogu
sequenc separ msra strfun utf8 format config sequenc separ wstring msra strfun utf16 sequenc separ
sequenc prologu msra strfun utf8 format config sequenc prologu wstring msra strfun utf16 sequenc prologu
sequenc epilogu msra strfun utf8 format config sequenc epilogu wstring msra strfun utf16 sequenc epilogu
element separ msra strfun utf8 format config element separ wstring msra strfun utf16 element separ
sampl separ msra strfun utf8 format config sampl separ wstring msra strfun utf16 sampl separ
precis format msra strfun utf8 format config precis format wstring msra strfun utf16 precis format
todo chang string wstring avoid convers mess



write format option save file fstream

fstream is categori label
fstream label map file
fstream is spars
fstream transpos
fstream prologu
fstream epilogu
fstream sequenc separ
fstream sequenc prologu
fstream sequenc epilogu
fstream element separ
fstream sampl separ
fstream precis format


write format option load file fstream size model version

fstream is categori label
fstream label map file
fstream is spars
fstream transpos
fstream prologu
fstream epilogu
fstream sequenc separ
fstream sequenc prologu
fstream sequenc epilogu
fstream element separ
fstream sampl separ
fstream precis format


write format option write format option config paramet
write format option write format option scriptabl object i config record


variabl


atom ullong time stamp time stamp counter atom init

size size share singl matrix comput node const one
size size share doubl matrix comput node const one


instanti core templat


comput node
comput node



microsoft scriptabl object

microsoft cntk


comput node scriptabl object system



share object make runtim object comput node base i config record ptr configp

node new comput node from config configp
temporarili disabl caus test fail
node i recurr node
node valid is final valid pass initi valid access dimens
node


scriptabl object configur runtim type regist comput node base regist comput node comput node


box version tensor shape scriptabl object system



tensor shape dim
box tensor shape box of tensor shape


box tensor shape i config record ptr configp
box of tensor shape tensor shape config array flatten vector from size configp dim





box vector box of vector


box vector i config record ptr configp
box of vector config array flatten vector from configp item




scriptabl object configur runtim type regist box tensor shape regist tensor shape tensor shape
scriptabl object configur runtim type regist box vector regist int vector int vector
scriptabl object configur runtim type regist box vector size regist size vector size vector
scriptabl object configur runtim type regist box vector regist bool vector bool vector



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform


basic
input and param node
file load matrix from text file
tensor shape small vector



microsoft cntk


learnabl paramet input
repres weight matric bias
todo node name


bugbug call random init reset
todo need rememb init paramet
elem type
learnabl paramet elem type init shape tensor shape shape

set dim shape
updat function valu size alloc matrix
valu set valu todo invalid instead


config
elem type
learnabl paramet elem type learnabl paramet scriptabl object i config record ptr configp
learnabl paramet configp devic id placehold configp shape

todo chang dimens take gener tensor instead that minor break chang convert brain script
attach input from config configp get expect num input
paramet row col plu option paramet learn rate multipli init uniform gaussian fixedvalu init valu scale valu
configp exist learn rate multipli
set learn rate multipli configp learn rate multipli
configp exist need gradient configp exist need gradient configp exist comput gradient
invalid argument deprec paramet name need gradient need gradient comput gradient support brain script learn rate multipli instead

wstring init string configp init
init string fix valu
valu set valu elem type configp valu
init string uniform init string gaussian

todo option also
random seed
forc random seed configp random seed forc specif random seed use test repeat initi independ evalu order
init random init string uniform forc random seed random seed forc random seed configp init valu scale configp init on cpu onli

init string from file

wstring init from file path configp init from file path
init from file path
runtim error init from file path paramet must provid from file initi method
init from file init from file path

init string from liter

wstring init from liter configp init from liter
init from liter
runtim error init from liter paramet must provid from liter initi method
size num row num col
file load matrix from string liter elem type msra strfun utf8 init from liter num row num col
init from array num row num col


runtim error init must valu uniform gaussian fix valu from file


initi random number
init on cpu onli alway init make initi consist across test
elem type
learnabl paramet elem type init random uniform init
random seed
elem type init valu scale
init on cpu onli

fprintf stderr get num row get num col random seed node name

random seed offset random seed offset paramet config
init on cpu onli
valu transfer to devic if not there cpudevic
complex version need repro test case gener older version
valu get sampl layout get rank valu valu as matrix

valu valu

uniform init

todo move hidden extra factor make visibl
elem type rand rang init valu scale
valu set uniform random valu rand rang rand rang random seed



size input size valu get num col
elem type rand initstd init valu scale sqrt elem type input size
valu set gaussian random valu rand initstd random seed

init on cpu onli
valu transfer to devic if not there devic id


initi read matrix text file
elem type
learnabl paramet elem type init from file wstring init from file path

size num row num col
file load matrix from text file elem type init from file path num row num col
init from array num row num col


initi read matrix text file
elem type
learnabl paramet elem type init from array vector elem type size num row size num col

infer tensor dimens input file
note map dimens input matrix tensor dimens somewhat confus
file contain matrix text line save column major represent
that represent reshap column major tensor
get sampl layout get num element least dimens

dim get sampl layout get dim
infer rank
dim size
dim push back
dim size num col
dim push back
infer row
dim infer dimens input matrix dimens
dim num row alreadi mismatch caught verifi data size
infer col product dimens first must match matrix col singl posit infer
size zero dim mean found
size prod
size dim size

dim

prod
zero dim
zero dim

invalid argument oper specifi shape cannot infer mani unknown dimens node name oper name get sampl layout

zero dim found zero

dim zero dim num col prod
prod dim zero dim num col
invalid argument oper specifi shape cannot infer tensor shape cannot hold matrix node name oper name get sampl layout num row num col

set dim tensor shape dim


bugbug allow read arbitrari tensor singl column file
current would caus matrix tensor dimens mismatch todo comment date
valu set valu num row num col devic id cast elem type matrix flag normal
todo cast soon ryan matrix refactor separ set valu extern deep copi
verifi data size valu saniti check


elem type
learnabl paramet elem type save file fstream

base save fstream
fstream learn rate multipli
sampl layout save fstream
fstream valu


elem type
learnabl paramet elem type load file fstream size model version

base load fstream model version

tensor shape sampl layout

model version cntk model version

fstream learn rate multipli
sampl layout load fstream

legaci format

paramet updat requir
fstream paramet updat requir
set learn rate multipli paramet updat requir

size row col
fstream row col
row legaci file format
sampl layout tensor shape row col


sampl layout load fstream accept legaci format
col legaci format last tensor dimens split column dimens
sampl layout append in place sampl layout get rank col



load valu fstream
set dim sampl layout note call load valu sinc load valu overwrit sampl layout
verifi data size valu saniti check


comput function anyth paramet node
elem type
learnabl paramet elem type updat function mb size



elem type
learnabl paramet elem type forward prop frame rang



elem type
learnabl paramet elem type backprop to size input index frame rang

logic error oper leaf node backprop to never call node name oper name


elem type
learnabl paramet elem type valid is final valid pass

base valid is final valid pass
p mb layout nullptr node hold mini batch


call comput node valid infer input dim from
error back without updat
caller must verifi dimens
thi weird sinc call node valid
bugbug thi clear random initi current usabl case
elem type
learnabl paramet elem type infer input dim from tensor shape other shape

thi shape get sampl layout

stand shape
ha miss dim thi shape get rank thi shape get num element
ha miss dim noth infer


infer least dimens
other shape get rank other shape get num element
logic error valid infer input dim from infer dimens must

dimens copi other shape
verifi dimens node explicitli defin vector element
ha ani dim
thi shape get dim
ha ani dim
ha ani dim straight
init shape other shape
ha miss dim exist shape zero fill other shape

thi shape get rank thi shape get rank other shape get rank
logic error valid infer input dim from infer dimens must match rank
small vector size new dim thi shape get dim
size thi shape get rank
new dim
new dim other shape
init shape tensor shape new dim

fprintf stderr oper tensor shape infer node name oper name get sampl layout


elem type
learnabl paramet elem type dump node info print valu print metadata file fstream

print metadata

base dump node info print valu print metadata fstream

4096
sprintf get as matrix num row get as matrix num col
fstream
sprintf learn rate multipli need gradient learn rate multipli learn rate multipli todo updat accept better match name well
fstream


print node valu to file print valu print metadata fstream


learnabl paramet
learnabl paramet



copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

basic
comput node
comput network
recurr node
input and param node

vector


algorithm




microsoft cntk

thi sourc file contain method relat evalu forward prop backprop network valid matrix memori alloc memori share


forward backward propag


main entri point evalu minibatch forward prop
thi call forward prop node order flow network
network appli concurr frame minibatch parallel mode oper
recurr loop must treat differ
recurr node make comput time step time plu sigmoid delay
must execut frame frame se quential rather
treat littl nest network done insid seq travers flow control node
littl nest network defin execut network form nest sentinel node seq travers flow control node
comput network forward prop comput node base ptr root node

verifi is compil forward prop

travers node determin evalu order
get nest network root node forward prop frame rang nullptr


gradient matrix root node
return node comput node elem type backprop intend
elem type
set root gradient to scalar one comput node base ptr nodep

node dynam pointer cast comput node elem type nodep
ha match type node nullptr
ha match type

reset root gradient
node reset gradient

ha match type


main entri point evalu follow gradient comput forward prop back prop
typic call pattern
forward prop node
forward prop train criterion reus comput result previou step
backprop train criterion
comput network backprop comput node base ptr root node train criterion comput gradient

environ is train
logic error backprop requir network train mode

initi root gradient scalar valu
set root gradient to scalar one root node set root gradient to scalar one root node
logic error backprop train criterion neither comput node comput node

reset gradient root node zero actual intern lazi care
zero input gradient root node

backpropag network
get nest network root node backprop frame rang nullptr


comput network form nest network comput node base ptr root node

nest network find root node nest network
fprintf stderr form nest network warn call twice oper root node node name root node oper name

nest network root node make share par travers flow control node all seq node get eval order root node


comput node base ptr comput network get nest network comput node base ptr root node

nest network find root node nest network
logic error get nest network call without prior call form nest network oper root node node name root node oper name
nest network root node



par travers flow control node method travers

thi outer recurr node node
execut mode sampl independ allow
concurr comput bulk cuda launch


comput network par travers flow control node par travers flow control node vector share seq travers flow control node recurr info comput node base ptr all node must order

travers network evalu order creat replac recurr seq travers flow control node
share i comput node loop seen consist check
node iter all node node iter all node

share seq travers flow control node rec info find in recurr loop recurr info node iter check node particip recurr
rec info node part gather node must consecut all node

instead node sentinel seq travers flow control node
nest node push back rec info

verifi encount node consecut
loop seen insert rec info second
logic error par travers flow control node member consecut node rec info node name

consum node part consecut
node iter all node node iter is part of loop find in recurr loop recurr info node iter rec info
node iter

regular level node loop

nest node push back node iter
node iter consum node



comput network par travers flow control node forward prop frame rang

node nest node


dynam pointer cast learnabl paramet node
dynam pointer cast comput node node debug log minibatch

node is out of date wrt input

node begin forward prop
node forward prop with layout node get mb layout
node end forward prop

node bump eval time stamp




comput network par travers flow control node backprop frame rang children in thi loop children in outer loop

children in thi loop children in outer loop todo think mean come mode
process node determin order
pnode nest node rbegin pnode nest node rend pnode iter backward evalu order

node pnode

node begin backprop
node backprop with layout node get mb layout children in thi loop children in outer loop
node end backprop


comput network par travers flow control node request matric befor forward prop matrix pool matrix pool


comput network par travers flow control node releas matric after forward prop matrix pool matrix pool


comput network par travers flow control node alloc gradient matric for input matrix pool matrix pool


comput network par travers flow control node request matric befor backprop matrix pool matrix pool


comput network par travers flow control node releas matric after backprop matrix pool matrix pool




seq travers flow control node method travers unrol

while mode process sampl independ thu
pa rallel mode honor sequenti depend
unrol time step run network time step


comput network seq travers flow control node begin forward prop

take opportun check layout share node
todo
node nest node

node get mb layout get mb layout
logic error evalu node insid recurr must layout ident mismatch found node
node node name node get mb layout axi string
nest node node name nest node get mb layout axi string


tell commenc
node nest node
node begin forward prop


evalu seq travers flow control node flow control node
thi evalu node flow control node mode process frame frame nest
thi time axi chang
todo onc nest loop frame rang argument refer outer
comput network seq travers flow control node forward prop frame rang

layout associ
node share layout
get mb layout nest node get mb layout

everi time step node particular treat like littl comput network
note current limit linear time loop noth stop iter iter imag
implement accord frame rang iter
frame rang iter rang get mb layout step direct
rang rang

node nest node

node forward prop
node bump eval time stamp




comput network seq travers flow control node end forward prop

tell done past valu node captur state bptt process
node nest node
node end forward prop


call first iter step comput gradient
comput network seq travers flow control node begin backprop

node2 nest node
node2 begin backprop


comput network seq travers flow control node backprop frame rang children in thi loop children in outer loop

children in thi loop children in outer loop todo think mean come mode
recurr node nest node bugbug for forward doe mean remov for forward
p mb layout recurr node get mb layout
frame rang iter rang p mb layout step direct
rang rbegin rang rend note revers iter

node iter2 recurr node rbegin node iter2 recurr node rend node iter2

node2 node iter2
node2 backprop children in thi loop children in outer loop
flag tell backprop skip back propag insid node
node outsid done later end backprop mode




call last iter step comput gradient
comput network seq travers flow control node end backprop

follow handl node insid back propag gradient node outsid
effici perform outsid mode lstm speech setup measur overal speed
node iter2 nest node rbegin node iter2 nest node rend node iter2

node2 node iter2
node2 backprop frame rang nest node get mb layout children in thi loop children in outer loop


tell node done itera tion
node2 nest node
node2 end backprop


comput network seq travers flow control node request matric befor forward prop matrix pool matrix pool

node loop iter nest node
node loop iter request matric befor forward prop matrix pool

comput network seq travers flow control node releas matric after forward prop matrix pool matrix pool


comput network seq travers flow control node alloc gradient matric for input matrix pool matrix pool

todo dealloc opposit order
node iter nest node rbegin node iter nest node rend node iter

node iter alloc gradient matric for input matrix pool


comput network seq travers flow control node request matric befor backprop matrix pool matrix pool


comput network seq travers flow control node releas matric after backprop matrix pool matrix pool

node iter nest node rbegin node iter nest node rend node iter

node iter need gradient
node iter releas matric after backprop matrix pool



find node part recurr
found pointer node
share comput network seq travers flow control node comput network find in recurr loop vector share seq travers flow control node recurr info comput node base ptr node

look recurr loop network
todo check is part of loop also store node direct lookup
iter recurr info

find iter nest node iter nest node node iter nest node todo need method seq travers flow control node
iter

nullptr part recurr


check node recurr is out of date wrt input except delay node check would fail must skip
todo would suffici check time stamp unifi time stamp mechan then need special check delay node check input time stamp
comput network seq travers flow control node is out of date wrt input

nest node

is out of date wrt input
oper name oper name of past valu node
oper name oper name of futur valu node
todo shift node land check well ideal test whether i recurr node







todo par travers flow control node
comput network reset eval time stamp

node iter name to node map node iter name to node map node iter
node iter second reset eval time stamp


comput network bump eval time stamp vector comput node base ptr node

size node size
node bump eval time stamp


debug
comput network print comput tree comput node base ptr root node
forward comput
print matric

node get eval order root node note take refer sinc revers
forward comput

fprintf stderr n print forward comput node order



fprintf stderr n print gradient comput node order
node revers


node size
fprintf stderr


node node
node print self print matric




prepar network


call model edit oper delet node rebuild network
these invalid post process structur access fail
comput network invalid compil network

is compil
all seq node clear
eval order clear
nest network clear
input valu clear
learnabl paramet clear


verifi network undergon compil network
comput network verifi is compil

is compil
logic error compil network expect


compil network bring network execut state
call creation load modif
thi method set member clear invalid compil network
todo thi somewhat partial state order key nullptr
comput network compil network

fprintf stderr n post process network

is compil could verifi member virgin
invalid easier safer
invalid compil network

step repeat root node node without parent pre comput node
determin set of all root

fprintf stderr root all root size
root all root
fprintf stderr root node name root oper name

note step loop root node gradual push loop function
reduc redund oper share portion network

step creat depth first tree travers order complet graph
todo cach reorder form recurr loop reorder store get eval order nullptr alway valid loop
form eval order nullptr

step form input valu learnabl paramet set entir network
need reset mb layout
todo move decid whether nullptr version need reset mb layout could order filter
collect input and learnabl paramet nullptr

step establish time axi relationship
thi set mb layout pointer input node accord user spec time axe
todo input valu travers remov depend form eval order
reset mb layout

step discov nest loop
form recurr loop nullptr form todo need root
node all root
form recurr loop node bugbug these call need patch eval order will unnecessari move

step creat correct depth first travers cach input paramet set everi actual root node
root all root

form eval order root
collect input and learnabl paramet root


step form nest structur travers node
node all root
form nest network node

step infer node dimens
valid network

step optim network


step some detail
reset eval time stamp invalid valu field realli belong start evalu minibatch loop

fprintf stderr n post process network complet
is compil


determin root node
root node forward prop call
train criterion criteria
output
pre comput node
result store all root
bugbug current implement output also input other must specifi explicitli
comput network determin set of all root

start referenc node
comput node base ptr all node referenc node
iter name to node map

node iter second
all node insert node
size node get num input

input node input
input result incorrect oper

invalid argument determin set of all root input oper connect network malform
node node name node oper name

referenc node insert input


comput node base ptr unreferenc node
differ all node all node referenc node referenc node insert unreferenc node unreferenc node

explicitli specifi node
todo thi ideal also need demand compil allow node use output fact
comput node base ptr all known root
node final criterion node
all known root insert node
node evalu node
all known root insert node
node output node
all known root insert node
iter name to node map pre comput node

node iter second
node requir pre comput
all known root insert node


all root referenc node also explicitli specifi root
all root clear
unreferenc node unreferenc node all known root all known root insert all root all root

bring root well defin order
observ differ order depend complex node brain script express
sort all root all root comput node base ptr comput node base ptr

node name node name



initi setup mb layout pointer
link input node mb layout
reset other nullptr expect valid network
comput network reset mb layout

reset well defin mb layout meaning layout
note valid never call oper actual comput lead mb layout
p mb layout of network init

first reset
node get all node for root nullptr
node link to mb layout nullptr

dynam axi node apart soon deprec network wide mb layout main holder mb layout initi
instanc node chang mb layout like where node
node get node with type dynam axi
node link to mb layout make share mb layout node get name

thi initi insid input node proper connect
node input node nullptr

todo i take dynam axi node
dynam pointer cast i take dynam axi node

logic error expect implement i take dynam axi node node descript
wstring axi name get request dynam axi

axi name

legaci behavior share mb layout
todo remov p mb layout of network altogeth issu
node link to mb layout p mb layout of network



axi node get node from name axi name

axi node
runtim error find node retriev dynam axi axi node node descript axi name

node dynam axi node though could deriv node thi would involv
depend order thing evalu though
axi node oper name dynam axi
runtim error dynam axi argument must dynam axi node node descript axi node node descript
axi node ha mb layout
logic error expect mb layout node node descript axi node node descript
node link to mb layout axi node get mb layout





valid


valid network need evalut specif output node
thi call valid everi node evalu order allow propag thing forward
thi call lazili node clear cach
mb layout link expect alreadi input reset nullptr node
comput network valid network

call node valid order valid mb layout function valu dimens
problem recurr loop partial valid
node valid partial input children valid revisit
node get eval order nullptr

node node

node visit
node need gradient node is paramet updat requir propag upward follow


valid done
step
valid mean dimens check
keep go node valid input valid well
valid mean consist check
fail chang stage
size
size to valid node size
to valid

fprintf stderr n valid network node process to valid
to valid valid node node is first pass is final valid pass


fprintf stderr n valid network
to valid valid node node is first pass is final valid pass
to valid
logic error valid sub network valid node unexpectedli return work left

propag info seq travers flow control node
todo futur valid flat par travers flow control node structur then unnecessari
rec info all seq node

node rec info sourc node
rec info need gradient node need gradient
rec info link to mb layout node get mb layout


node node

node must output zero dimension otherwis assum user error
node get sampl layout get num element
runtim error oper element node node name

fprintf stderr

log layout node
vector comput node base ptr non default node
node node

node get mb layout p mb layout of network
non default node push back node

non default node

fprintf stderr node share minibatch layout input non default node size node size
node non default node
fprintf stderr node node name
fprintf stderr



helper discov dimens chang
pair tensor shape get dim comput node base ptr node

make pair node get sampl layout node ha mb layout


comput network valid node comput node base ptr node is final valid pass

children node get input

keep state
mb layout ptr old mb layout ptr node get mb layout
get dim node
vector pair tensor shape child dim
child children
child dim push back get dim child
sampl layout node get sampl layout
call valid mani time need sinc stuff chang underneath
node valid is final valid pass node visit verif instead infer
also take opportun propag need gradient
need gradient node need gradient
child children todo need check stabl is final valid pass
node need gradient child need gradient
check state node valid node visit node updat
unchang
unchang old mb layout ptr node get mb layout
unchang get dim node
vector pair tensor shape new child dim
child children
new child dim push back get dim child
unchang child dim new child dim
unchang sampl layout node get sampl layout
unchang need gradient node need gradient
unchang


perform valid topolog sort node
return mani node either could valid chang thu must redon
size comput network valid node comput node base ptr node is first pass is final valid pass

size todo
node node

children node get input
is leaf node is leaf
valid node least child
ha visit child
all children visit
child children

ha visit child child visit singl visit child point valid
all children visit child visit

make sure dynam axi place design
thi stop need coher concept pass shape
child oper name dynam axi
runtim error cannot use input anoth node use dynam axi properti input node child node descript


least visit child
valid
ha visit child is leaf least child make sens call valid

prev prototyp node format oper prototyp
unchang


unchang valid node node is final valid pass
updat prototyp node format oper prototyp
prototyp valid problemat track valid error loop
unchang
is final valid pass
prototyp upon everi chang use debug
is first pass unchang prev prototyp updat prototyp

fprintf stderr valid updat prototyp

valid fail prototyp anyway input arg

fprintf stderr valid fail prev prototyp


node visit

saniti check
is final valid pass unchang
logic error valid sub network oper chang valid node node name node oper name
is final valid pass all children visit
logic error valid sub network oper valid although children visit node node name node oper name
children valid
valid all children visit unchang is leaf

count need
valid
todo

todo



memori alloc

mark node pure induc paramet sharabl creat space valu
comput network mark valu non sharabl node

node get eval order nullptr
wstring all leaf descend are paramet or pre comput node
comput node base ptr all learnabl paramet get node with type oper name of learnabl paramet
note cannot learnabl paramet need paramet node regardless whether requir updat

comput node base ptr all pre comput node
node node

node i pre comput node
all pre comput node push back node


node node

input node get input
wstring mynam node node name
all paramet or pre comput node

input size check leaf node caus possibl leaf node input paramet precomput node mark sharabl alreadi

find all pre comput node all pre comput node node all pre comput node

input input

input name input node name
all leaf descend are paramet or pre comput node find input name all leaf descend are paramet or pre comput node

found mean leaf node order
input is leaf input is part of loop
find all learnabl paramet all learnabl paramet input all learnabl paramet

all leaf descend are paramet or pre comput node input name



all paramet or pre comput node
all leaf descend are paramet or pre comput node input name





all leaf descend are paramet or pre comput node input name

all paramet or pre comput node






all leaf descend are paramet or pre comput node mynam all paramet or pre comput node
all paramet or pre comput node
node mark valu non sharabl




elem type
comput network print memori share structur vector comput node base ptr node

matrix elem type wstring mem share structur
node

comput node elem type node comput node elem type
pair matrix elem type wstring matrix info node get matrix info
item matrix info

matrix elem type matrix item first
mem share structur find matrix mem share structur
mem share structur insert pair matrix elem type wstring matrix wstring

wstring mem share structur matrix
insert item second



fprintf stderr n memori share structur
item mem share structur

wstring item second
fprintf stderr item first
mem share info

fprintf stderr mem share info

fprintf stderr

fprintf stderr



need call actual valid execut
predetermin share matric reduc memori usag
todo find simpl topolog order alloc eval matric order directli
without pass train node
comput network alloc all matric vector comput node base ptr eval root node
vector comput node base ptr out valu root node
comput node base ptr train root node

are matric alloc


alloc memori forward backward comput
fprintf stderr n alloc matric forward backward propag

verifi is compil alloc all matric

special topolog node sole induc paramet valu share
mark valu non sharabl node

perform back propag train root node nullptr

creat composit eval order specifi node root
vector comput node base ptr forward prop root
forward prop root insert forward prop root eval root node eval root node
forward prop root insert forward prop root out valu root node out valu root node
train root node nullptr
forward prop root push back train root node

node determin parent whether output
node need back propag
unord comput node base ptr output valu need dure back prop
unord comput node base ptr unord comput node base ptr parent map
root node forward prop root

node get eval order root node

node get num input

comput node base ptr input node get input
parent map input insert node

perform back propag

output valu need dure back prop find input output valu need dure back prop
output valu need dure back prop input input output use in comput input node gradient

output valu need dure back prop input node input use in comput input node gradient



output valu need dure back prop input





unord comput node base ptr parent count
key valu parent map

parent count key valu first key valu second size


construct composit forward prop order enumer
node correspond root arrang
rel order appear evalu order
comput node base ptr all node eval order get eval order nullptr
comput node base ptr node for forward prop root comput node base enumer node forward prop root
vector comput node base ptr composit forward prop eval order
node all node eval order

find node for forward prop root cbegin node for forward prop root cend node node for forward prop root cend

composit forward prop eval order push back node



comput node base ptr complet evalu
node iter composit forward prop eval order

node iter set output need dure backprop output valu need dure back prop node iter

node iter is part of loop

todo form nest network avoid complet evalu check
share seq travers flow control node rec info find in recurr loop all seq node node iter
rec info nullptr
complet evalu insert rec info second

rec info request matric befor forward prop matrix pool

node loop iter rec info nest node

releas matric after eval for children node loop iter parent count





node iter request matric befor forward prop matrix pool
releas matric children sinc root node inform use share
other
releas matric after eval for children node iter parent count



train root node nullptr

comput node base ptr back prop node get eval order train root node

simul gradient comput order determin alloc matric
comput node base ptr complet gradient

need call sinc alway comput gradient children root node children node
train root node request matric befor backprop matrix pool

iter back prop node rbegin iter back prop node rend iter gradient comput travers revers order

iter
is part of loop

vector comput node base ptr recurr node
share seq travers flow control node rec info find in recurr loop all seq node
complet gradient insert rec info second

mode alloc first dealloc
todo step par travers flow control node alloc gradient matric for input releas matric after backprop
bugbug would work wrong order need rethink need make alloc eval matric alloc gradient matric function
rec info alloc gradient matric for input matrix pool
loop comput sampl sampl alloc
rec info releas matric after backprop matrix pool




mode alloc immedi dealloc
alloc gradient matric for input matrix pool
root node inform use share other also small
train root node need gradient
releas matric after backprop matrix pool




are matric alloc

memori share structur
vector comput node base ptr all node get all node
all node size
logic error network comput node

all node comput node
print memori share structur all node
all node comput node
print memori share structur all node

logic error unexpect node precis


comput network releas matric after eval for children comput node base ptr unord comput node base ptr parent count

get num input

comput node base ptr p node get input
parent count p node
parent count p node
p node releas matric after forward prop matrix pool




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

basic
comput node
comput network
input and param node
train node

vector




microsoft cntk

thi sourc file contain file relat model edit futur brain script edit modifi node place


network edit


comput node base ptr comput network copi node comput network from net
wstring from name
wstring to name
copi node flag flag

invalid compil network

to name
to name from name

comput node base ptr p from node from net get node from name from name
comput node base ptr p to node

allow cross network child copi caller explic handl children fixup
flag copi node flag copi node input link
from net flag copi node flag copi node across network

logic error copi node copi node children across network invalid


node name exist to name

p to node p from node duplic to name flag
add node to net p to node



node alreadi exist
p to node get node from name to name

node copi need
p from node p to node
logic error copi node copi node network node name

p from node copi to p to node to name flag blast exist node

p to node


copi complet independ tree
node name exist
comput network copi sub tree comput network from net
wstring from name wstring to name prefix
copi node flag flag

invalid compil network

flag copi node flag copi node valu
logic error copi sub tree cannot copi tree without copi node valu

comput node base ptr from root from net get node from name from name

from node get eval order from root bugbug thi probabl fail precomput order invalid point

wstring from node name from node node name
wstring to node name to name prefix from node name

comput node base ptr to node copi node from net from node name
to node name
copi node flag copi node valu

flag copi node flag copi node input link

copi children structur node gener
from node get num input
to node set input get node from name to name prefix from node get input node name




copi input node network
comput network copi input wstring from name wstring to name

copi node from name to name copi node flag copi node input link


renam node renam node anoth name
node name orig origin node name
node name new node name
comput network renam node wstring node name orig wstring new node name

renam node get node from name node name orig new node name


comput network renam node comput node base ptr node wstring new node name

make sure name alreadi use
iter name to node map find new node name
iter name to node map found
runtim error renam node target name alreadi exist

invalid compil network

remov node from net node take remporarili
node set node name new node name chang name
add node to net node back


delet node network includ set input link remov node group
comput network delet node wstring node name

invalid compil network

comput node base ptr node to delet get node from name node name

first link node involv whole connect remov
node iter name to node map node iter name to node map node iter

comput node base ptr node node iter second
size node get num input

comput node base ptr child node get input

node to delet child
child node to delet

use call detatch input better retain input
node set input nullptr





node to delet parent
node to delet detach input deref input might leak circular refer

unlink node group set
group iter get all node group

search find group iter group iter node to delet
search group iter
group iter eras search


note necessari updat all seq node hanld invalid compil network call

node
remov node from net node to delet


replac name node new node name includ move network link
thi use base adapt reduc featur copi
need updat map well children
comput network chang node wstring node name comput node base ptr new node

comput node base ptr old node get node from name node name

new node node name node name todo thi test earlier hope code depend
invalid argument chang node new node must name node
old node oper name new node oper name
invalid argument chang node new node must node

invalid compil network

chang node node input point node instead
node iter name to node map node iter name to node map node iter

comput node base ptr node node iter second
node get num input
node get input old node
node set input new node


chang input node share input
old node get num input

new node set input old node get input todo attach input
old node set input nullptr bugbug node longer point network


replac node network
remov node from net old node
add node to net new node

also updat node group
group iter get all node group

group group iter
group size
group old node
group new node



replac node current node assum node leaf node
need updat node old node child
todo call node alreadi part network thi current allow
bugbug seem chang node also updat node group
bugbug what new node referenc old node name
bugbug unrel node name exist
comput network replac leaf node wstring old node name comput node base ptr new node

invalid compil network

comput node base ptr old node get node from name old node name

relink input node whose child old node point instead
node iter name to node map node iter name to node map node iter

comput node base ptr node node iter second
node get num input
node get input old node
node set input new node


remov
add node to net if not yet new node
delet node old node name todo remov node from net


criterion node time orphan previou remov
new node name come connect input use connect exist node name
bugbug oper exist node
comput network replac final criterion node wstring old node name comput node base ptr new node

invalid compil network

remov criterion node
bugbug node remov network seem strang inconsist
wa there remov from node group criterion get node from name old node name
wa there
runtim error replac final criterion node node replac criterion node

replac children
thi look node network name current input relink input
allow move node network anoth reconnect name input
new node get num input

name to node map find new node get input node name name to node map
runtim error child node part network new node get input node name
new node set input name to node map new node get input node name


network
add node to net if not yet new node

node criterion node group
add to node group criterion new node


comput network add featur node comput node base ptr featur node

invalid compil network

add node to net featur node
add to node group featur featur node


unus
remov node destruct
comput node base ptr comput network remov featur node comput node base ptr featur node

invalid compil network

wstring node name featur node node name
node name exist node name
runtim error remov featur node featur node exist

remov link node
node iter name to node map node iter name to node map node iter

comput node base ptr node node iter second
size node get num input

comput node base ptr child node get input
child featur node

node set input





remov featur
search find featur node featur node featur node
search featur node
featur node eras search

note bother reset sinc node gone
remov node from net featur node



set learn rate multipli learnabl paramet feed pass root node
call
comput network set learnabl node below learn rate multipli learn rate multipli comput node base ptr root node

find node avail node
root node nullptr

node iter name to node map node iter name to node map node iter

comput node base ptr node node iter second
node oper name oper name of learnabl paramet
node set learn rate multipli learn rate multipli




calcul specif node
node get all node for root root node

node oper name oper name of learnabl paramet
node set learn rate multipli learn rate multipli






copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

basic
comput node
comput network
comput network builder use load save
linear algebra node
nonlinear node
convolut node
recurr node
reshap node
train node
pre comput node
evalu node
special purpos node
mpi wrapper todo belong

vector
stack





microsoft cntk


matrix pool method



vector share matrix matrix pool get releas matric

releas float matric



vector share matrix matrix pool get releas matric

releas doubl matric



construct


clear state use destructor also load
thi necessari make sure leav node hang recurr cyclic refer
comput network clear network

releas refer node
invalid compil network

group iter get all node group
group iter clear

cycl
note dure edit network construct share portion network node cannot howev share evalu
network share longer evalu must still releas
henc must cycl node taken anoth network know environ pointer
correct weak pointer intrus chang
iter name to node map

node iter second
node get environ ptr environ
taken anoth network
node set environ nullptr
node detach input


name to node map clear

p mb layout of network init



serial


edit network possibl valid compil
comput network save edit wstring file name file option file format

is compil
compil network
save file name file format


comput network save wstring file name file option file format

verifi is compil save
save temporari file renam request file name
thi standard trick avoid havign corrupt model file process die write
wstring tmp file name file name
save to file impl tmp file name file format
renam or die tmp file name file name


todo file distinguish node
comput network save to file impl wstring file name file option file format

file fstream file name file format file option file option write
fstream put marker file marker file marker begin section

model version
fstream put marker file marker file marker begin section b version
fstream size current cntk model version
fstream put marker file marker file marker end section e version

fstream size name to node map size

node info first
fstream put marker file marker file marker begin section b node list
node iter name to node map node iter name to node map node iter

comput node base ptr node ptr node iter second

current cntk model version cntk model version
wstring precis
node ptr comput node
precis elem type name
node ptr comput node
precis elem type name
logic error unexpect node
fstream precis

fstream node ptr oper name
name
fstream node ptr node name
content
node ptr save fstream


fstream put marker file marker file marker end section e node list

relationship
fstream put marker file marker file marker begin section b relat
node iter name to node map node iter name to node map node iter

comput node base ptr node ptr node iter second
fstream node ptr node name node ptr get num input
size node ptr get num input

node ptr input
fprintf stderr warn node child pleas check file node ptr node name

fstream node ptr input node name


fstream put marker file marker file marker end section e relat

fstream put marker file marker file marker begin section b root node

fstream put marker file marker file marker begin section b featur node
fstream featur node size
size featur node size
fstream featur node node name
fstream put marker file marker file marker end section e featur node

fstream put marker file marker file marker begin section b label node
fstream label node size
size label node size
fstream label node node name
fstream put marker file marker file marker end section e label node

fstream put marker file marker file marker begin section b criterion node
fstream criterion node size
size criterion node size
fstream criterion node node name
fstream put marker file marker file marker end section e criterion node

fstream put marker file marker file marker begin section b eval node
fstream evalu node size
size evalu node size
fstream evalu node node name
fstream put marker file marker file marker end section e eval node

fstream put marker file marker file marker begin section b output node
fstream output node size
size output node size
fstream output node node name
fstream put marker file marker file marker end section e output node

fstream put marker file marker file marker end section e root node

fstream put marker file marker file marker end section

fstream flush


load section node contain persist paramet
thi also use reload model without recreat train
todo reload becaus train hold pointer paramet directli that
elem type elem type model prior cntk model version serial elem type ignor
comput network read persist paramet file fstream creat

fstream get marker file marker file marker begin section

model version
size model version cntk model version version info version
fstream tri get marker file marker file marker begin section b version

fstream model version
fstream get marker file marker file marker end section e version

model version current cntk model version
invalid argument read model file newer format version cntk version handl model version current cntk model version

size num node
fstream num node

node info first
fstream get marker file marker file marker begin section b node list
size num node

wstring precis
model version cntk model version
fstream precis mean elem type pass outsid

wstring op name node name
fstream op name node name

comput node base ptr node
creat reload exist
node get node from name node name
precis
node comput network builder new node op name devic id node name
precis
node comput network builder new node op name devic id node name
precis file format elem type
node comput network builder elem type new node op name devic id node name

runtim error read unexpect precis precis

node load fstream model version

creat load scratch
add node to net node
reload exist

node get sampl layout
chang valid node node is final valid pass
chang

node get sampl layout
fprintf stderr valid sub network oper chang node node name node oper name

logic error valid sub network oper chang reload valid node node name node oper name




fstream get marker file marker file marker end section e node list


deseri model
thi post process model compil network load instead
elem type read persist paramet
comput network read wstring file name

clear network

file fstream file name file option file option binari file option file option read

read persist paramet elem type fstream

size num node name to node map size

relationship
fstream get marker file marker file marker begin section b relat
size num node

wstring node name
size num children
fstream node name num children
num children

vector wstring children name
children name resiz num children
size num children
fstream children name

todo file distinguish
comput node base ptr node ptr get node from name node name
vector comput node base ptr children node
children node resiz num children
num children
children node get node from name children name

node ptr attach input children node


fstream get marker file marker file marker end section e relat

fstream get marker file marker file marker begin section b root node

wstring node name
size

fstream tri get marker file marker file marker begin section b featur node

fstream

size

fstream node name
add to node group featur get node from name node name

fstream get marker file marker file marker end section e featur node


fstream tri get marker file marker file marker begin section b label node

fstream
size

fstream node name
add to node group label get node from name node name


bugbug should insid block
fstream get marker file marker file marker end section e label node

fstream tri get marker file marker file marker begin section b criterion node
fstream tri get marker file marker file marker begin section b criteria node legaci

fstream
size

fstream node name
add to node group criterion get node from name node name


fstream tri get marker file marker file marker end section e criteria node legaci

fstream get marker file marker file marker end section e criterion node check legaci first name



section back compat skip
fstream tri get marker file marker file marker begin section b node req multi seq handl

fprintf stderr warn ignor defunct b node req multi seq handl section input file
fstream
size
fstream node name dummi
fstream get marker file marker file marker end section e node req multi seq handl


fstream tri get marker file marker file marker begin section b eval node

fstream
size

fstream node name
add to node group evalu get node from name node name

fstream get marker file marker file marker end section e eval node


fstream tri get marker file marker file marker begin section b output node

fstream
size

fstream node name
add to node group output get node from name node name

fstream get marker file marker file marker end section e output node


section back compat skip
fstream tri get marker file marker file marker begin section b pair node

fstream

runtim error read pair node longer support
fstream get marker file marker file marker end section e pair node


fstream get marker file marker file marker end section e root node

fstream get marker file marker file marker end section



node construct


version need access random seed offset
excess use simpl network builder alway creat learnabl paramet realli absorb
elem type
comput network init learnabl paramet comput node base ptr node uniform init random seed elem type init valu scale init on cpu onli

learnabl paramet node dynam pointer cast learnabl paramet elem type node
learnabl paramet node init random uniform init random seed get random seed offset init valu scale init on cpu onli


comput network is typic criterion node comput node base ptr node ptr

todo
node ptr oper name oper name of squar error node
node ptr oper name oper name of logist node
node ptr oper name oper name of cross entropi with softmax node
node ptr oper name oper name of sequenc with softmax node
node ptr oper name oper name of cross entropi node
node ptr oper name oper name of class base cross entropi with softmax node
node ptr oper name oper name of error predict node
ifdef come soon
node ptr oper name oper name of crf node

node ptr oper name oper name of dummi criterion node





node precomput precomput
comput node base ptr comput network get node requir pre comput comput node base ptr root node check comput

comput node base ptr node
node get eval order root node todo verifi order matter replac get all node for root

pcnode dynam pointer cast i pre comput node node
pcnode

node requir pre comput
check comput pcnode ha comput
node push back node


node


creat input valu learnabl paramet list
thi enumer leav reachabl root node
leav
input
learnabl paramet
travers disabl one
input reachabl precomput node complet comput
learnabl paramet constant
comput network collect input and learnabl paramet comput node base ptr root node

input valu find root node input valu must call
learnabl paramet find root node learnabl paramet

gather list
comput node base ptr visit
comput node base ptr input learnabl paramet
root node
collect input and learnabl paramet rec root node visit input learnabl paramet

root all root
collect input and learnabl paramet rec root visit input learnabl paramet

sort learnabl paramet name consist order load save file
learnabl paramet sort comput node base ptr comput node base ptr

node name node name


input valu root node move input
learnabl paramet root node move learnabl paramet


comput network collect input and learnabl paramet rec comput node base ptr node comput node base ptr visit comput node base ptr input comput node base ptr learnabl paramet

visit find node visit allreadi

node oper name oper name of input valu node oper name oper name of spars input valu
input push back node
node oper name oper name of learnabl paramet node is paramet updat requir
learnabl paramet push back node


pre comput node alreadi done travers
pcnode dynam pointer cast i pre comput node node
pcnode pcnode ha comput

recurs
visit insert node
input node get input
collect input and learnabl paramet rec input visit input learnabl paramet



elem type
comput network set dropout rate comput network ptr comput node base ptr criterion node dropout rate prev dropout rate drop out seed

dropout rate prev dropout rate

fprintf stderr set dropout rate dropout rate
todo chang independ elem type
comput node base ptr dropout node get node with type oper name of dropout node criterion node
dropout node size dropout rate
fprintf stderr warn dropout node


node iter dropout node

node dynam pointer cast dropout node elem type node iter
node set dropout rate dropout rate
node set random seed drop out seed



prev dropout rate dropout rate



elem type
comput network set batch normal time constant comput network ptr comput node base ptr criterion node
normal time constant prev normal time constant
blend time constant prev blend time constant

normal time constant prev normal time constant blend time constant prev blend time constant

normal time constant prev normal time constant
fprintf stderr set batch normal time constant normal time constant
blend time constant prev blend time constant
fprintf stderr set batch normal blend time constant blend time constant
todo chang independ elem type
batch normal node get node with type oper name of batch normal node criterion node
batch normal node size
fprintf stderr warn batch normal node


node iter batch normal node

node dynam pointer cast batch normal node elem type node iter
node set normal time constant normal time constant prev normal time constant
blend time constant prev blend time constant



prev normal time constant normal time constant
prev blend time constant blend time constant



sequenc train paramet smooth weight frame drop threshhold
elem type
comput network set seq param comput network ptr
comput node base ptr criterion node
hsmooth weight
frame drop thresh
doreferencealign



b mm ifactor
s mbr


fprintf stderr set hsmooth weight frame drop threshhold hsmooth weight frame drop thresh
fprintf stderr set seq gammar relat paramet b mmi factor use mbr
b mm ifactor s mbr
comput node base ptr seq node get node with type oper name of sequenc with softmax node criterion node
seq node size

fprintf stderr warn sequenc node



node iter seq node node iter seq node node iter

node dynam pointer cast sequenc with softmax node elem type node iter
node set smooth weight hsmooth weight
node set frame drop thresh frame drop thresh
node set refer align doreferencealign
node set gammar calcul param b mm ifactor s mbr




comput network set max temp mem size for cnn comput network ptr comput node base ptr criterion node size max temp mem size in sampl

max temp mem size in sampl
fprintf stderr set temp memori size convolut oper sampl max temp mem size in sampl
comput node base ptr convolut node get node with type oper name of convolut node criterion node
convolut node size max temp mem size in sampl

fprintf stderr warn convolut oper found



node iter convolut node node iter convolut node node iter

nodef dynam pointer cast convolut node node iter
nodef
nodef setm max temp mem size in sampl max temp mem size in sampl
node dynam pointer cast convolut node node iter
node
node setm max temp mem size in sampl max temp mem size in sampl





unit test



call unit test node
add verif correct node oper

comput network unit test allow fragment

vector wstring v error
current valid node valid everyth
featur node size allow fragment
runtim error featur node specifi
first give criteria node root node
final criterion node size

node final criterion node

allow fragment
form recurr loop node
set actual mini batch size from featur
unit test node
v error push back node node name


allow fragment
runtim error criterion node specifi
output node
output node size

node output node
unit test node
v error push back node node name

allow fragment
runtim error output node specifi
evalu node
evalu node size

node evalu node
unit test node
v error push back node node name

v error


comput network unit test comput node base ptr root node

fprintf stderr unit test node root node node name

node get all node for root root node
node unit test


fprintf stderr





topolog plot


dot graph configur


wstring learnabl paramet style
wstring featur style
wstring criteria style
wstring node req multi seq handl style
wstring label style
wstring normal node style
wstring precomput node style
wstring past valu node style
wstring futur valu node style

dot graph configur

learnabl paramet style node shape color gray style fill round
featur style node shape ellips color fillcolor white
criteria style node shape doublecircl color fillcolor white
node req multi seq handl style node shape doublecircl color brown fillcolor white
normal node style node shape ellips color blue fillcolor white style solid
precomput node style node shape color black style dash fill fillcolor limegreen
label style node shape diamond color brown style bold
past valu node style node shape box3d color lightgray style fill fillcolor white
futur valu node style node shape box3d color style fill fillcolor white



wstring comput network form special node wstring style vector comput node base ptr special node

special node


wstring style

special node
msra strfun wstrprintf get name



comput network describ network use dot comput arc arc
wstring out file

dot graph configur dotcfg

file fstream out file file option file option text file option file option write

precomput node
vector comput node base ptr pre comput node
vector comput node base ptr allnod get all node
allnod

requir pre comput
pre comput node push back


past valu node
vector comput node base ptr past valu node
allnod

oper name oper name of past valu node oper name delay
past valu node push back


futuret valu node
vector comput node base ptr futur valu node
allnod

oper name oper name of futur valu node
futur valu node push back

learnabl paramet
vector comput node base ptr learnabl paramet
allnod

oper name oper name of learnabl paramet
learnabl paramet push back


fstream strict digraph
fstream rankdir


special node

fstream special node

learnabl paramet
fstream form special node dotcfg learnabl paramet style learnabl paramet
featur
fstream form special node dotcfg featur style featur node
label
fstream form special node dotcfg label style label node
critera
fstream form special node dotcfg criteria style criterion node
comput node
fstream form special node dotcfg precomput node style pre comput node
past valu node
fstream form special node dotcfg past valu node style past valu node
futur valu node
fstream form special node dotcfg futur valu node style futur valu node
normal node
fstream dotcfg normal node style


label node

fstream label oper name
wstring line
allnod

line clear
line msra strfun wstrprintf label
get name get name wstring get sampl layout ha mb layout
oper name
fstream line



graph

subgraph sourc
fstream subgraph
fstream rank sourc
line clear
featur node
line line msra strfun wstrprintf get name
fstream line

subgraph output criteria
fstream subgraph
fstream rank sink
line clear
criterion node
line line msra strfun wstrprintf get name
output node
line line msra strfun wstrprintf get name
evalu node
line line msra strfun wstrprintf get name

fstream line


specifi connect

arc arc

comput node base ptr first
comput node base ptr second

wstring srcname get name
wstring desnam get name

oper name oper name of past valu node oper name delay

special treament past valu node children
creat dummi node
comput node base ptr past valu node
wstring dummi name get name dummi
wstring msra strfun wstrprintf node shape box3d color lightgray style fill label
past valu node get name past valu
dummi name
line
line msra strfun wstrprintf dummi name srcname

oper name oper name of futur valu node

special treament futur valu node children
creat dummi node
comput node base ptr futur valu node
wstring dummi name get name dummi
wstring msra strfun wstrprintf node shape box3d color style fill label
futur valu node get name futur valu
dummi name
line
line msra strfun wstrprintf dummi name srcname



line msra strfun wstrprintf desnam srcname


fstream line

fstream


comput network plot network topolog wstring output file

verifi is compil plot network topolog
valid network


step arc network

unord comput node base ptr visit
comput arc arc

group iter get all node group

note also featur node label node noth sinc input
todo test whether
group group iter
size group size
group enumer arc visit arc



step output descript

describ network use dot arc output file


enumer arc reach start current node children
visit record alreadi visit node
comput node base enumer arc unord comput node base ptr visit comput arc arc

comput node base ptr tovisit

visit find share visit node visit

tovisit push back share

tovisit

comput node base ptr cur node tovisit front
tovisit front

visit find cur node visit

size cur node input size

arc push back comput arc cur node cur node input

visit find cur node input visit children visit
tovisit push front cur node input go visit children

visit insert cur node






special oper


todo lift config languag move underli code math thi model edit oper


thi perform decomposit differ group learnabl paramet
perform decomposit
approx rank rank rank
after decomposit node becom intermedi node whose children
learnabl paramet

bugbug current work elem type
elem type
comput network perform sv decomposit wstring svd config size align size

vector pair vector wstring node group
wregex name filter

svd config

wstring regex str first
keep ratio second
vector wstring name in group

name filter assign regex str

name to node map name to node map

regex str regex match first name filter

regex str node node match regex str



share comput node elem type dynam pointer cast learnabl paramet elem type second



valu get num col valu get num row


still
name in group push back first

node group push back make pair name in group keep ratio


size group id
group node group

keepratio group second
fprintf stderr

fprintf stderr
paramet svd start process group keep ratio
group id keepratio
fprintf stderr


name group first

name to node map find name name to node map

could delet previou group



share comput node elem type p node dynam pointer cast learnabl paramet elem type name to node map name

step decomposit
matrix elem type p node valu as matrix deep clone

vector need
get num col get num row


size get num row
size get num col

matrix elem type
chrono time point chrono system clock st time chrono system clock
matrix elem type
chrono time point chrono system clock en time chrono system clock





descend order

elem type totalenergi
size get num row
totalenergi
elem type keepenergi totalenergi keepratio
elem type runenergi

size
size indx indx get num row indx

runenergi indx
runenergi keepenergi

indx




get num row get num row

align size

align size
align size get num row get num row align size

keep row col result matrix multipi
help runtim

chrono durat elapsedtim en time st time
fprintf stderr
perform matrix node name 20l comput time sec keep energi keep valu reduc paramet
name elapsedtim count
keepratio


red u
matrix elem type red u column slice
matrix elem type red vt

red vt
red vt resiz
red vt assign row slice valu of

matrix elem type red s size get devic id
size

elem type sqrtsigma elem type sqrt
red s sqrtsigma


red u row element multipli with red s transpos
red vt column element multipli with red s

step creat paramet node time node
wstring left child name name bugbug with brain script node name must proper identifi variabl express node name
wstring right child name name
share comput node elem type p left add node to net with elem type learnabl paramet elem type devic id left child name
share comput node elem type p right add node to net with elem type learnabl paramet elem type devic id right child name

todo abl move instead copi current strightforward
red u red vt slice
p left valu as matrix red u deep clone
p right valu as matrix red vt deep clone

share comput node elem type p time add node to net and attach input time node elem type devic id name p left p right

step remov node
replac leaf node name p time



necessari post process
compil network


helper form logic layer export network use save to dbn file
dbn layer


dbn layer node nullptr bia nullptr sigmoid
comput node base ptr node
comput node base ptr bia
sigmoid
dbn layer


save network format microsoft legaci tool use outsid microsoft
elem type
comput network save to dbn file comput network ptr wstring file name

helper method
verifi type all vector comput node base ptr node wstring type valu

find node node type valu comput node base ptr node node oper name type valu node

get node consum comput node base ptr node vector comput node base ptr

vector comput node base ptr consum
item get all node

input item get input

input node

consum push back item





consum

get first differ node vector comput node base ptr comput node base ptr node comput node base ptr

found node find node comput node base ptr item item node
found node nullptr found node

get first node with differ type vector comput node base ptr wstring comput node base ptr

found node find comput node base ptr item item oper name
found node nullptr found node

where node vector comput node base ptr node comput node base ptr predic vector comput node base ptr

vector comput node base ptr result

node node

predic node

result push back node



result

get node with type vector comput node base ptr wstring vector comput node base ptr

vector comput node base ptr result

node

node oper name

result push back node



result

get all prior node comput node base ptr node

wstring lower name node get name
transform lower name lower name lower name tolow

node oper name oper name of learnabl paramet lower name find prior wstring npo

find replic context vector elem type




size


base len size
match

match

base len

base len

match





match






output node
comput node base ptr output node get node with type oper name of error predict node
comput node base ptr output node get first node with differ type output node front get input oper name of input valu

output node nullptr

runtim error cannot find output node


comput node base ptr order list
stack comput node base ptr node stack

node stack push output node

node stack size

node node stack
node stack
node input node get input
input node input

cyclic
item order list

item input

warn cyclic depend node item get name
cyclic



cyclic
node stack push input

order list push back node


order list revers

multipl node multipli symbol variabl
comput node base ptr mult node
share dbn layer dbn layer ptr
dbn layer ptr dbn layer

item order list

item oper name oper name of time node verifi type all item get input oper name of learnabl paramet

mult node push back item



node mult node

vector comput node base ptr consum get node consum node
consum size

sigmoid
wstring layer id node get name

comput node base ptr first consum consum front

first consum oper name oper name of plu node

runtim error expect plu node consum time node


comput node base ptr bia get first differ node first consum get input node

consumer2 get node consum consum front front
consumer2 oper name sigmoid

sigmoid
layer id consumer2 get name



layer id first consum get name


input multipl node split
style
vector comput node base ptr agg time get node with type node get input oper name of time node
agg time size

comput node base ptr mult node agg time front
dbn layer ptr make share dbn layer
dbn layer ptr make share dbn layer

first input mult node get input
second input mult node get input
bia bia
node first input

bia nullptr
node second input

sigmoid
sigmoid sigmoid

dbn layer push back
dbn layer push back



param node get node with type node get input oper name of learnabl paramet front
dbn layer ptr make share dbn layer
bia bia
node param node
sigmoid sigmoid

dbn layer push back




write layer output
want invstd need invert element
vector comput node base ptr normal node get node with type get all node oper name of per dim mean var normal node
normal node size

runtim error model contain least node oper oper name of per dim mean var normal node


comput node base ptr mean node normal node front get input
comput node base ptr std node normal node front get input

matrix elem type mean node matrix mean node comput node elem type valu deep clone
matrix elem type inv std node matrix move std node comput node elem type valu deep clone element invers
vector elem type inv std node matrix get num element
elem type ref arr
size arr size size
inv std node matrix copi to array ref arr arr size

find replic context
vector comput node base ptr prior node where node get all node get all prior node
prior node size

warn could reliabl determin prior node



write file

file fstream file name file option file option binari file option file option write

local helper function write stuff expect format
put tag fstream fstream
put string fstream fstream write string
put int fstream fstream

write matrix option appli
put matrix convert matrix elem type size maxelem name

put tag bmat
put string name
size num row get num row
size num col get num col

maxelem size

put int num row
put int num col

allow shorten vector need mean invstd

put int maxelem
put int


code transpos matrix output maxelem float point number stream
size
size num col maxelem
size num row maxelem
fstream

put tag emat

put matrix matrix elem type name put matrix convert size name

write
dump header
put string
put tag bdbn
put int version
put int cast dbn layer size layer

dump featur norm
put matrix convert mean node matrix mean node matrix get num row gmean
put matrix convert inv std node matrix inv std node matrix get num row gstddev

put tag bnet
last one dbn layer
last one
dbn layer dbn layer

dbn layer ptr layer

dbn layer

put string rbmgaussbernoulli

last one

put string perceptron

layer sigmoid

put string rbmbernoullibernoulli



put string rbmisalinearbernoulli


write main weight matrix
weight layer node comput node elem type valu deep clone
transpos weight transpos
put matrix transpos

write bias vector
mandatori pack zero given
row layer node get as matrix num row
layer bia nullptr

zero matrix elem type zero row cpudevic
put matrix convert zero row



put matrix convert layer bia comput node elem type valu row


some sort legaci vector useless
zero matrix elem type zero cpudevic
put matrix zero


dump prior
put tag enet
prior node size

put matrix prior node front comput node elem type valu



warn prioriti node found

put tag edbn


comput network init learnabl paramet comput node base ptr node uniform init random seed init valu scale init on cpu onli
comput network read wstring file name
comput network read persist paramet file fstream creat
comput network perform sv decomposit wstring svd config size aligneds
comput network set dropout rate comput network ptr comput node base ptr criterion node dropout rate prev dropout rate drop out seed
comput network set batch normal time constant comput network ptr comput node base ptr criterion node normal time constant prev normal time constant blend time constant prev blend time constant
comput network set seq param comput network ptr comput node base ptr criterion node hsmooth weight frame drop thresh doreferencealign
b mm ifactor s mbr
comput network save to dbn file comput network ptr wstring file name

comput network init learnabl paramet comput node base ptr node uniform init random seed init valu scale init on cpu onli
comput network read wstring file name
comput network read persist paramet file fstream creat
comput network perform sv decomposit wstring svd config size aligneds
comput network set dropout rate comput network ptr comput node base ptr criterion node dropout rate prev dropout rate drop out seed
comput network set batch normal time constant comput network ptr comput node base ptr criterion node normal time constant prev normal time constant blend time constant prev blend time constant
comput network set seq param comput network ptr comput node base ptr criterion node hsmooth weight frame drop thresh doreferencealign
b mm ifactor s mbr
comput network save to dbn file comput network ptr wstring file name

comput network scriptabl object system
scriptabl object configur runtim type regist comput network regist comput network comput network



copyright microsoft right reserv
licens licens licens file project root full licens inform


basic
comput node
special purpos node


vector
stdexcept
memori

microsoft cntk


trace node log frequenc log first log gradient too onli up to row 100000000 onli up to t 100000000 format

debug trace node valu write minibatch with format


elem type
trace node elem type trace node scriptabl object i config record ptr configp
trace node configp devic id placehold

attach input from config configp get expect num input
messag wstring configp
log first configp log first
log frequenc configp log frequenc
log gradient too configp log gradient too implement
format option write format option configp
onli up to row configp onli up to row
onli up to t configp onli up to t


elem type
trace node elem type save file fstream

base save fstream
fstream messag
fstream log first
fstream log frequenc
fstream log gradient too
format option save fstream
bugbug thi serial pathnam map file disk nice better solut
fstream onli up to row
fstream onli up to t


elem type
trace node elem type load file fstream size model version

base load fstream model version
fstream messag
fstream log first
fstream log frequenc
fstream log gradient too
format option load fstream model version
fstream onli up to row
fstream onli up to t


elem type
trace node elem type begin forward prop

base begin forward prop
num m bs run


elem type
trace node elem type forward prop frame rang

size rank determin elementwis tensor rank
result valu tensor for rank
input input valu tensor for rank
result assign copi of input
content
num m bs run

prologu format option process node name format option prologu num m bs run
fprintf stderr prologu

num m bs run log first log frequenc num m bs run log frequenc

format char format option is categori label format option label map file
valu format string format option precis format format char format use fprintf format valu
sequenc separ format option process node name format option sequenc separ num m bs run
sequenc prologu format option process node name format option sequenc prologu num m bs run
sequenc epilogu format option process node name format option sequenc epilogu num m bs run
element separ format option process node name format option element separ num m bs run
sampl separ format option process node name format option sampl separ num m bs run

time rang get time rang
fprintf stderr trace better visual separ actual content
is all frame
fprintf stderr
time rang second time rang first
fprintf stderr time rang first
time rang second time rang first
fprintf stderr time rang first time rang second
fprintf stderr messag input format oper prototyp
input write minibatch with format stderr onli up to row onli up to t format option transpos format option is categori label format option is spars label map
sequenc separ sequenc prologu sequenc epilogu element separ sampl separ
valu format string output gradient



elem type
trace node elem type backprop to size input index frame rang

input index input index

size rank determin elementwis tensor rank
slice output grad gradient tensor for rank propag
slice input grad input gradient tensor for rank

slice input grad add copi of slice output grad


elem type
trace node elem type valid is final valid pass

valid unari map is final valid pass
is final valid pass

label map format option is categori label format option is spars format option label map file
file load label file format option label map file label map

num m bs run


trace node
trace node



copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

comput node
input and param node
comput network builder todo pull new comput node from config node know network larg
tensor shape

ifndef
defin


microsoft cntk


scriptabl object


behav like config
thi allow access node insid network i config record
thi meant use whatev replac


cach creat member
custom config record comput node base lazi creat config member wstring

name node name

insert config member config valu ptr make share string node name wstring logic error

oper oper paramet comput node

insert config member config valu ptr make share string oper name wstring logic error

scalar dimens element sampl

note when freshli creat model dimens infer
size get sampl layout get num element

invalid argument node dimens known node name
insert config member make primit config valu ptr wstring logic error

dim tensor dimens vector

implement

todo think tag mean allow user name tag singl compar



input oper name arg node plu arg altern node input show user plu node

vector config valu ptr input as valu
input get input
input as valu push back config valu ptr input wstring logic error
make share scriptabl object config array move input as valu
insert config member config valu ptr wstring logic error

exist creat entri


vector wstring i config record comput node base get member id

vector wstring name oper dim input oper name arg




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

basic
comput node
comput network
recurr node





microsoft cntk


network recurr analysi


method determin evalu order tricki presenc recurr loop
todo move separ

get recurr step direct comput node base ptr

form recurr loop main entri point network recurr analysi function call
thi analysi network recurr loop present comput root node
thi set updat
all seq node
comput node is part of loop expos outsid is part of loop
cach eval order root reorder make node belong consecut todo
often call valid network root call insid valid network well
thi call multipl node train criterion must abl previou result clear visit flag start
note thi lazi cach build and valid sub network cach other
todo futur take root node paramet anymor
comput network form recurr loop comput node base ptr root node nullptr

fprintf stderr form recurr loop node root node root node node name
depth first travers order
note thi use reset state reset visit order think need order
comput node base ptr node get eval order root node

initi node state own
todo verifi call unecessari
node node
node purg state for form recurr loop

determin strongli connect cliqu all seq node
determin sc cs root node
form loop node assign none

reorder follow
sort order
input

consum
consum never input otherwis would part
thi done dare present code memshar reli order
sort insid
graph graph delay node
thi necessari

reorder process todo elimin entir chunk code updat eval order instead construct outer node

recov visit order origin depth first travers order
note visit order use insid sourc file reorder
size
node node
node visit order note there redund index visit order sinc rather intend remov whole reorder

updat visit order node particip
node particip visit order valu
iter all seq node

size visit order in loop
todo sure algorithm
node iter nest node
visit order in loop node visit order
visit order in loop node visit order
node iter nest node
node visit order visit order in loop


reorder oper follow implant loop id node loop use purpos
iter all seq node

node iter nest node
node loop id iter loop id note loop id use insid sourc file reorder

comment done creat entri

todo make separ determin loop forward order mayb execut construct nest loop inform
bring everi correct order horizont time depend
origin graph travers order ignor delay node correct sinc cut travers detect node alreadi process wrong criterion
iter all seq node

nest node iter nest node

num non delay parent in loop node part delay node parent
thi valu use current block
node node reset

node loop id iter loop id
node num non delay parent in loop purg state for form recurr loop

node nest node

input node get input

input loop id node loop id get recurr step direct node delay node
input num non delay parent in loop cound parent input delay node



travers graph nest node start first
then updat nest node travers order
comput node base ptr node stack graph order concaten todo stack

unord comput node base ptr visit
unord comput node base ptr rec stack use insid
node nest node

unord comput node base ptr rec stack
visit find node visit node num non delay parent in loop
determin loop forward order r visit rec stack node stack node
rec stack
logic error form recurr loop determin loop forward order r clear stack


updat nest node node stack
todo what necessari
iter nest node assign node stack node stack


patch order
todo thi away done local need modifi order todo what order use besid
all seq node size

unord comput node base ptr visit

node outsid loop hang root node
comput node base ptr recurr node
comput node base ptr no recurr node
soon longer allow
root node
gather loop node r root node visit recurr node no recurr node



root node all root
gather loop node r root node visit recurr node no recurr node


reorder node node

first sort updat visit order ident node
reorder node sort comput node base ptr comput node base ptr visit order visit order

reorder loop reorder node recurr node no recurr node group node loop togeth

updat eval order root node reorder node todo fact patch


reorder process todo elimin process

loop
iter all seq node

fprintf stderr n loop node iter loop id iter node name iter nest node size
size
iter nest node iter nest node


fprintf stderr
fprintf stderr node name

fprintf stderr



turn nest network readi evalu
root node
form nest network root node



check whether node recurr direct
get recurr step direct comput node base ptr node

node i recurr node
node i recurr node get recurr step direct




determin loop direct vector comput node base ptr nest node

strongli connect compon graph
thi tarjan algorithm http wikipedia wiki tarjan strongli connect compon algorithm
respect text wikipedia page comment clariti
thi set index min index visit in stack
comput network determin sc cs comput node base ptr root node

comput node base ptr scc stack
size index
size loop id bugbug think current buggi edg need all seq node size instead

root node

root node visit
determin sc cs r root node scc stack index loop id



travers root node children master root
root node all root
root node visit
determin sc cs r root node scc stack index loop id


recurs part determin sc cs
comput network determin sc cs r comput node base ptr
comput node base ptr scc stack
size index size loop id

visit

index order visit
each node assign uniqu integ index number node consecut order discov
index index todo use visit order
min index index also min index
index

visit

node place stack order visit
when depth first search recurs explor node descend
node necessarili pop stack recurs call return
crucial invari properti node remain stack explor path node earlier stack
call explor descend know whether path node earlier stack
call return leav stack preserv stack invari
must root strongli connect compon consist togeth later node stack
node path back earlier node
path earlier node would also path earlier node
thi entir compon pop stack return preserv invari wikipedia
scc stack push back
in stack

min index min index children
min index lowlink tarjan notat repres roughli speak smallest index node known reachabl includ wikipedia
input get input

input visit

successor visit recurs
determin sc cs r input scc stack index loop id
min index min index input min index

input in stack

successor stack henc current
min index min index input min index



root node close creat entri all seq node
must left stack min index index
wherea must remov root strongli connect compon min index index
min index comput depth first search find node reachabl wikipedia
min index index
min index index min index still equal index start close

gather node
vector comput node base ptr nest node
seq travers flow control node r info all seq node size loop id


comput node base ptr node scc stack back
scc stack back
node in stack
nest node push back node
node start point done


insert all seq node
nest node size loop node detect loop size skip

alreadi
produc multipl time
form recurr loop call multipl time differ root
depth first travers might enter multipl time
todo check whether edg idempot done correctli
recurr delay node
root node
first root take first delay node valu second root second delay node
depth first tree travers enter differ place sourc node
loop detect ident determin min index index depend travers root mayb
b found find
iter all seq node

iter2 iter nest node

iter2

b found
valid realli comparison
unord comput node base ptr new loop nest node nest node
unord comput node base ptr exist loop iter nest node iter nest node
new loop exist loop
logic error determin sc cs r oper rediscov last time node name oper name




b found
fprintf stderr n determin sc cs r oper discov multipl time particip node name oper name
todo onc forbid form recurr loop ever turn b found logic error
b found


intptr hash
node nest node
hash intptr node
fprintf stderr n determin sc cs r oper hash 016x node node name oper name all seq node size hash nest node size


loop id all seq node size
logic error determin sc cs r oper inconsist loop id all seq node size node name oper name loop id all seq node size
seq travers flow control node r info all seq node size

loop id all seq node size bugbug onli loop share among root all seq node size instead
seq travers flow control node r info loop id

todo prove nest node front need store separ
r info nest node move nest node todo make part
node r info nest node

node is part of loop flag comput node escap form recurr loop
todo instead rememb pointer sentinel
node loop id r info loop id note loop id use insid sourc file reorder

r info step direct determin loop direct r info nest node
all seq node push back make share seq travers flow control node move r info
loop id count todo remov





recov process order within recurr
travers node first delay node branch
these one must comput order someth
todo onc nest network recurr travers longer necessari
comput network determin loop forward order r unord comput node base ptr visit
unord comput node base ptr rec stack
comput node base ptr node stack
comput node base ptr

visit find visit

visit insert
rec stack insert rec stack use detect infinit loop alreadi discov

get recurr step direct recurr stop delay node

size get num input
input loop id loop id ignor input come outsid
determin loop forward order r visit rec stack node stack input

rec stack eras
node stack push back

rec stack find rec stack note rec stack
logic error oper part infinit cannot unrol node name oper name


travers graph feed node level node start train criterion
node particip recurr result loop id
node no recurr result
order travers depth first
thi part form recurr loop process call place
comput network gather loop node r comput node base ptr node unord comput node base ptr visit
comput node base ptr recurr result
comput node base ptr no recurr result

visit find node visit
node
visit insert node

node get num input
gather loop node r node input visit recurr result no recurr result

node loop id
recurr result node loop id push back node

no recurr result push back node


take node modifi node consecut
node travers order
order preserv node outsid loop
node belong replac node order
todo start
call form recurr loop
comput network reorder loop comput node base ptr node
comput node base ptr recurr node
comput node base ptr no recurr node

comput node base ptr new list

comput node base ptr v tmp
comput node base ptr v recurr tmp
vector access all seq node size
node iter node node iter node node iter

share seq travers flow control node rec info find in recurr loop all seq node node iter
rec info

rec info loop id
access

new list insert new list rec info nest node rec info nest node
access




new list push back node iter



v recurr tmp size

new list insert new list v recurr tmp v recurr tmp
v recurr tmp clear


v tmp size

new list insert new list v tmp v tmp
v tmp clear


node new list


step direct loop
todo move use separ commit sinc cannot track move chang time
bugbug need extend multi dimension direct vector
determin loop direct vector comput node base ptr nest node

step direct

node nest node

get recurr step direct node
recurr node

step direct
step direct
step direct
invalid argument allow multipl differ step direct connect oper
nest node front node name nest node front oper name


step direct
logic error there recurr node connect oper
nest node front node name nest node front oper name
bugbug multipl recurr dimens support beyond point
step direct




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn secur avail platform file give variabl warn

basic
scriptabl object

comput node
input and param node
recurr node
nonlinear node
linear algebra node
reshap node

comput network
comput network builder

memori
dequ



ifndef
defin




microsoft cntk

microsoft scriptabl object


construct config


construct comput network config record
comput network comput network i config record ptr configp
comput network

config configp

deviceid type devic id deviceid type config devic id

dequ comput node base ptr work list
flatten node
collect root comput node config record expand children work process
todo thi current support node elem type could allow convers oper
config get member id

valu config
valu comput node base
work list push back comput node base ptr valu


todo process output node array sync node tag make root

construct root
construct from root devic id move work list comput node base ptr comput node base ptr map


construct network root pass work list
thi name to node map root node reachabl root
replac given root pointer well input pointer reachabl node map thi need model edit
comput network construct from root deviceid type devic id dequ comput node base ptr work list comput node base ptr comput node base ptr replac

set devic id devic id
get total number of node

replac request
thi happen model edit
work list oper map node
size num relink
node ref work list

iter replac find node ref
iter replac

node ref get environ ptr must network map
node ref iter second node ref refer patch work list place
num relink



process work
also call late attach input need
work list

node work list front
work list front


wa ad add node to net if not yet node make uniqu name
wa ad node alreadi fail differ node name


node deriv i late attach node unresolv input resolv
thi gener whole load node includ node turn late init
note edit ad node refer node
network must map input chang henc import
map late attach
node get num input call model edit alreadi input

late attach node dynam pointer cast i late attach node node
late attach node
late attach node late attach input


respect node group base tag
node get tag

keep alreadi verifi sampl longer
legaci name
criteria criterion
evalu

add to node group node paramet


travers children append work
model edit input
size node get num input

input node input

replac input need
iter replac find input
iter replac

input get environ ptr must network map
input iter second
num relink
node set input input


work list push back input could check whether node alreadi optim cleaner


num relink
fprintf stderr construct from root refer remap num relink

perform necessari post process
compil network



behav like config
thi allow access node insid network i config record
thi meant use whatev replac
todo node want node group devic id


cach creat member
custom config record comput network lazi creat config member wstring

iter name to node map find
iter name to node map

workaround allow access member insid chang
iter name to node map iter name to node map iter
msra strfun replac all wstring iter first

iter name to node map
node

comput node base ptr node iter second
todo what express path
node name node node name fail fn hold copi name error messag hold unneccessari share node risk cycl stuff
valuep config valu ptr node node name wstring logic error comput network fail retriev node node name node node name
insert config member move valuep


vector wstring i config record comput network get member id

wstring node name
iter name to node map

comput node base ptr node iter second
wstring node name node node name
node name find first node name npo skip level name

temp solut composit instead
node name msra strfun replac all wstring node name
node name find first node name npo skip composit name

node name insert node name

vector wstring node name node name



comput network from file
script wrapper construct comput network file load


elem type
comput network from file comput network


comput network from file i config record ptr configp
comput network

config configp

deviceid type devic id deviceid type config devic id
set devic id devic id

wstring path name config path name
fprintf stderr load load model file path name
load elem type path name note cntk model version elem type ignor



scriptabl object configur runtim type regist add float doubl comput network from file comput network from file regist comput network from file comput network from file


comput network with edit
script wrapper construct modifi input network edit


comput network with edit comput network

helper execut map compuat node comput node

input edit made
differ exist node node input return node instead
newli creat node graph node replac
latter case return node input total differ
origin node
comput node base ptr call edit function comput node base ptr node config lambda edit fn

wrap argument config valu ptr
wstring node name node node name
wstring express name node name todo think
valuep config valu ptr pointer cast object node node name wstring logic error call edit function fail retriev node node name express name
vector config valu ptr arg valuep
execut execut
config valu ptr result edit fn appli move arg config lambda name param express name
cast result back
result as ptr comput node base




thi construct model exist
iter node
tri sequenc edit function made edit
thi like pattern match first edit match updat node
assembl network consist network edit appli
note model edit place instead copi made share
unchang node origin
comput network with edit i config record ptr configp
comput network

config paramet
config configp
config input model as ref comput network
edit function scriptabl object config array flatten vector from config lambda config edit function
addit root scriptabl object config array flatten vector from comput node base ptr config addit root

gather edit
thi run edit function node
comput node base ptr comput node base ptr replac orig replac valu edit call
all node get all node
node all node iter node

edit fn edit function edit function match

new node call edit function node edit fn
new node node edit provid replac edit

replac node new node rememb replac
appli first edit stop



fprintf stderr edit node edit replac size
ifdef debug
replac replac
fprintf stderr replac first node name replac first oper name replac second node name replac second oper name


also edit node updat input
node take input edit must input updat
sinc updat model place must also creat replac
that achiev recurs includ parent edit edit
parent creat parent map
dequ comput node base ptr work list work recurs
replac replac
work list push back replac first
work list

node work list front
work list front
node parent
parent parent find node second

edit parent
replac find parent replac
alreadi known replac
must edit parent sinc depend replac input
replac parent parent duplic
parent work list get parent turn
work list push back parent
debug
fprintf stderr relink parent node name parent oper name replac parent node name



fprintf stderr edit node either edit need relink replac size get total number of node
key replac defin node must relink

replac point node replac
thi realli happen replac node
iter replac
replac find iter second replac
iter second replac find iter second second

three kind node
unmodifi node share network
modifi node user edit parent
origin node longer referenc
network construct root origin

determin root
dequ comput node base ptr root
start origin network
node all node
parent find node second parent root
root push back node
also root
node addit root
root push back node
fprintf stderr edit root construct network root size
ifdef debug
node root
fprintf stderr node node name node oper name

network defin root

construct network
deviceid type devic id deviceid type config devic id
construct from root devic id move root replac



scriptabl object configur runtim type regist comput network with edit regist comput network with edit comput network with edit



copyright microsoft right reserv
licens licens licens file project root full licens inform

comput network builder helper construct comput network comput node extern


defin secur warn secur avail platform file give variabl warn

basic
comput network builder
comput node

convolut node
deprec node
evalu node
input and param node
linear algebra node
nonlinear node
pre comput node
reshap node
recurr node
special purpos node
train node



microsoft cntk



creat node given arg use multipl place
elem type type
share comput node elem type creat standard node wstring node type type arg

pleas keep tabl sort
ifdef come soon
node type oper name of crf node crf node elem type forward type arg


node type oper name of ab node ab node elem type forward type arg
node type oper name of class base cross entropi with softmax node class base cross entropi with softmax node elem type forward type arg
node type oper name of clip node clip node elem type forward type arg
node type oper name of co distanc node co distanc node elem type forward type arg
node type oper name of co distanc with neg sampl node co distanc with neg sampl node elem type forward type arg
node type oper name of cosin node cosin node elem type forward type arg
node type oper name of cross entropi node cross entropi node elem type forward type arg
node type oper name of cross entropi with softmax node cross entropi with softmax node elem type forward type arg
node type oper name of diagon node diagon node elem type forward type arg
node type oper name of diag time node diag time node elem type forward type arg
node type oper name of dropout node dropout node elem type forward type arg
node type oper name of dummi criterion node dummi criterion node elem type forward type arg
node type oper name of dynam axi node dynam axi node elem type forward type arg
node type oper name of element time node element time node elem type forward type arg
node type oper name of environ input node environ input node elem type forward type arg
node type oper name of error predict node error predict node elem type forward type arg
node type oper name of exp node exp node elem type forward type arg
node type oper name of floor node floor node elem type forward type arg
node type oper name of futur valu node futur valu node elem type forward type arg
node type oper name of gather pack node gather pack node elem type forward type arg
ifdef come soon
node type oper name of gmm log likelihood node gmm log likelihood node elem type forward type arg

node type oper name of hardmax node hardmax node elem type forward type arg
node type oper name of inv std dev node inv std dev node elem type forward type arg
node type oper name of khatri rao product node khatri rao product node elem type forward type arg
node type oper name of log node log node elem type forward type arg
node type oper name of log softmax node log softmax node elem type forward type arg
node type oper name of lookup tabl node lookup tabl node elem type forward type arg
node type oper name of matrix l1 reg node matrix l1 reg node elem type forward type arg
node type oper name of matrix l2 reg node matrix l2 reg node elem type forward type arg
node type oper name of mean node mean node elem type forward type arg
node type oper name of minu node minu node elem type forward type arg
node type oper name of negat node negat node elem type forward type arg
node type oper name of nois contrast estim node nois contrast estim node elem type forward type arg
node type oper name of pack index node pack index node elem type forward type arg
node type oper name of past valu node past valu node elem type forward type arg
node type oper name of per dim mean var normal node per dim mean var normal node elem type forward type arg
node type oper name of per dim mean var de normal node per dim mean var de normal node elem type forward type arg
node type oper name of pass node pass node elem type forward type arg
node type oper name of plu node plu node elem type forward type arg
node type oper name of reconcil dynam axi node reconcil dynam axi node elem type forward type arg
node type oper name of reciproc node reciproc node elem type forward type arg
node type oper name of rectifi linear node rectifi linear node elem type forward type arg
node type oper name of reduc element node reduc element node elem type forward type arg
node type oper name of reshap node reshap node elem type forward type arg
node type oper name of row repeat node row repeat node elem type forward type arg
node type oper name of row stack node row stack node elem type forward type arg
node type oper name of scatter pack node scatter pack node elem type forward type arg
node type oper name of sequenc with softmax node sequenc with softmax node elem type forward type arg
ifdef come soon
node type oper name of sequenc decod node sequenc decod node elem type forward type arg

ifdef come soon
node type oper name of shift node shift node elem type forward type arg

node type oper name of sigmoid node sigmoid node elem type forward type arg
node type oper name of sin node sin node elem type forward type arg
node type oper name of slice node slice node elem type forward type arg
node type oper name of softmax node softmax node elem type forward type arg
node type oper name of sqrt node sqrt node elem type forward type arg
node type oper name of squar error node squar error node elem type forward type arg
node type oper name of logist node logist node elem type forward type arg
node type oper name of sum column element node sum column element node elem type forward type arg
node type oper name of sum element node sum element node elem type forward type arg
node type oper name of tanh node tanh node elem type forward type arg
node type oper name of trace node trace node elem type forward type arg
node type oper name of time node time node elem type forward type arg
node type oper name of transpos dimens node transpos dimens node elem type forward type arg
node type oper name of transpos time node transpos time node elem type forward type arg
node type oper name of where node where node elem type forward type arg
legaci name also support back compat model file
node type column element time element time node elem type forward type arg
node type delay past valu node elem type forward type arg
todo diag time also element time current separ implement unnecessari
node type per dim mean var normal node per dim mean var normal node elem type forward type arg
node type per dim mean var de normal node per dim mean var de normal node elem type forward type arg
node type reconcil mb layout reconcil dynam axi node elem type forward type arg
node type row element time element time node elem type forward type arg
node type row slice slice node elem type forward type arg
node type scale element time node elem type forward type arg
node type transpos transpos dimens node elem type forward type arg

node type oper name of legaci reshap node legaci reshap node elem type forward type arg

invalid argument attempt instanti oper node type


creat node given arg use multipl place
thi use load use creat standard network
elem type type
share comput node elem type creat node wstring node type type arg

check type
node type oper name of averag pool node averag pool node elem type forward type arg
node type oper name of batch normal node batch normal node elem type forward type arg
node type oper name of convolut node convolut node elem type forward type arg
node type oper name of pool node pool node elem type forward type arg
node type oper name of spars input valu spars input valu elem type forward type arg
node type oper name of input valu input valu elem type forward type arg
node type oper name of learnabl paramet learnabl paramet elem type forward type arg
node type oper name of max pool node max pool node elem type forward type arg
creat standard node elem type node type forward type arg


call simpl network builder
elem type
share comput node elem type comput network builder elem type new standard node wstring node type deviceid type devic id wstring name

creat standard node elem type node type devic id name


use load file
elem type
share comput node elem type comput network builder elem type new node wstring node type deviceid type devic id wstring name

creat node elem type node type devic id name


share comput node base new comput node from config microsoft scriptabl object i config record ptr configp

wstring precis configp precis dispatch elem type
wstring oper name configp oper
comput node base ptr node
precis
node creat node oper name configp
precis
node creat node oper name configp

runtim error new standard node invalid valu precis paramet must precis

tag use special node type comput network
support singl could futur easili extend tag
wstring configp

node set tag
node



node creation


follow function creat node attach input input
there special version node custom constructor creat comput node other
todo realli need folk want instead add node to net differ
todo separ node input duplic function input ad ad input clear

elem type
share comput node elem type comput network builder elem type creat learnabl paramet wstring param name size row size col

todo simpl network builder often follow init learnabl paramet overload right away
add node to net with elem type learnabl paramet elem type get devic id param name row col


elem type
share comput node elem type comput network builder elem type creat learnabl paramet wstring param name tensor shape tensor shape

add node to net with elem type learnabl paramet elem type get devic id param name tensor shape


todo chang take actual instead name dynam axi
elem type
share comput node elem type comput network builder elem type creat input node wstring input name size row wstring dynam axi name

add node to net with elem type input valu elem type get devic id input name row dynam axi name


elem type
share comput node elem type comput network builder elem type creat spars input node wstring input name size row wstring dynam axi name

add node to net with elem type spars input valu elem type get devic id input name row dynam axi name


elem type
share comput node elem type comput network builder elem type creat input node wstring input name tensor shape sampl layout wstring dynam axi name

add node to net with elem type input valu elem type get devic id input name sampl layout dynam axi name


elem type
share comput node elem type comput network builder elem type creat spars input node wstring input name tensor shape imag layout wstring dynam axi name

add node to net with elem type spars input valu elem type get devic id input name imag layout dynam axi name


elem type
share comput node elem type comput network builder elem type creat convolut node wstring node name
size kernel width size kernel height size output channel
size horizont subsampl size vertic subsampl
imag layout kind imag layout kind zero pad
size max temp mem size in sampl

add node to net with elem type convolut node elem type get devic id node name
kernel width kernel height output channel
horizont subsampl vertic subsampl imag layout kind
zero pad
max temp mem size in sampl


elem type
share comput node elem type comput network builder elem type creat convolut node wstring node name tensor shape kernel shape tensor shape map count
tensor shape stride shape vector share
vector auto pad tensor shape lower pad tensor shape upper pad
imag layout kind imag layout size max temp mem size in sampl

add node to net with elem type convolut node elem type get devic id node name
kernel shape map count stride shape
share auto pad lower pad upper pad
imag layout max temp mem size in sampl


elem type
share comput node elem type comput network builder elem type creat pool node wstring node name pool kind pool kind tensor shape kernel shape tensor shape stride shape
vector auto pad tensor shape lower pad tensor shape upper pad
imag layout kind imag layout

add node to net with elem type pool node elem type get devic id node name
pool kind kernel shape stride shape auto pad lower pad upper pad imag layout


elem type
share comput node elem type comput network builder elem type creat max pool node wstring node name
size window width size window height size horizont subsampl size vertic subsampl imag layout kind imag layout kind

add node to net with elem type max pool node elem type get devic id node name window width window height horizont subsampl vertic subsampl imag layout kind


elem type
share comput node elem type comput network builder elem type creat averag pool node wstring node name
size window width size window height size horizont subsampl size vertic subsampl imag layout kind imag layout kind

add node to net with elem type averag pool node elem type get devic id node name window width window height horizont subsampl vertic subsampl imag layout kind


case cover special case
unlik special one creat node given
elem type
share comput node elem type comput network builder elem type creat comput node wstring node type wstring node name

add node to net with elem type new standard node node type get devic id node name



node creation


follow function creat node link network input
todo need input share code

elem type
share comput node elem type comput network builder elem type convolut comput node ptr weight
comput node ptr input valu
size kernel width size kernel height size output channel
size horizont subsampl size vertic subsampl
imag layout kind imag layout kind zero pad size max temp mem size in sampl
wstring node name

add node to net and attach input convolut node elem type get devic id node name
kernel width kernel height output channel horizont subsampl vertic subsampl imag layout kind zero pad
max temp mem size in sampl weight input valu


elem type
share comput node elem type comput network builder elem type convolut comput node ptr weight
comput node ptr input valu
tensor shape kernel shape tensor shape map count
tensor shape stride shape vector share
vector auto pad tensor shape lower pad tensor shape upper pad
imag layout kind imag layout size max temp mem size in sampl
wstring node name

add node to net and attach input convolut node elem type get devic id node name
kernel shape map count stride shape
share auto pad lower pad upper pad
imag layout max temp mem size in sampl
weight input valu


elem type
share comput node elem type comput network builder elem type pool comput node ptr input valu
pool kind pool kind tensor shape kernel shape tensor shape stride shape
vector auto pad tensor shape lower pad tensor shape upper pad
imag layout kind imag layout
wstring node name

add node to net and attach input pool node elem type get devic id node name
pool kind kernel shape stride shape auto pad lower pad upper pad imag layout
input valu


elem type
share comput node elem type comput network builder elem type max pool comput node ptr input valu
size window width size window height size horizont subsampl size vertic subsampl imag layout kind imag layout kind
wstring node name

add node to net and attach input max pool node elem type get devic id node name window width window height horizont subsampl vertic subsampl imag layout kind input valu


elem type
share comput node elem type comput network builder elem type averag pool comput node ptr input valu
size window width size window height size horizont subsampl size vertic subsampl imag layout kind imag layout kind
wstring node name

add node to net and attach input averag pool node elem type get devic id node name window width window height horizont subsampl vertic subsampl imag layout kind input valu


elem type
share comput node elem type comput network builder elem type error predict comput node ptr comput node ptr wstring node name

add node to net and attach input error predict node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type per dim mean var normal comput node ptr featur comput node ptr mean
comput node ptr inv std dev wstring node name

add node to net and attach input per dim mean var normal node elem type get devic id node name featur mean inv std dev


elem type
share comput node elem type comput network builder elem type per dim mean var de normal comput node ptr featur comput node ptr mean
comput node ptr inv std dev wstring node name

add node to net and attach input per dim mean var de normal node elem type get devic id node name featur mean inv std dev


elem type
share comput node elem type comput network builder elem type squar error comput node ptr comput node ptr wstring node name

add node to net and attach input squar error node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type logist comput node ptr comput node ptr wstring node name

add node to net and attach input logist node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type logist comput node ptr comput node ptr comput node ptr wstring node name

add node to net and attach input logist node elem type get devic id node name


ifdef come soon
elem type
share comput node elem type comput network builder elem type sequenc decod comput node ptr label comput node ptr predict comput node ptr pairscor wstring node name

add node to net and attach input sequenc decod node elem type get devic id node name label predict pairscor



elem type
share comput node elem type comput network builder elem type cross entropi with softmax comput node ptr label comput node ptr predict wstring node name

add node to net and attach input cross entropi with softmax node elem type get devic id node name label predict


elem type
share comput node elem type comput network builder elem type sequenc with softmax comput node ptr label comput node ptr predict comput node ptr loglikelihood wstring node name

add node to net and attach input sequenc with softmax node elem type get devic id node name label predict loglikelihood


elem type
share comput node elem type comput network builder elem type nois contrast estim comput node ptr label comput node ptr predict
comput node ptr input weight
comput node ptr input bia wstring node name
nce eval mode mode

add node to net and attach input nois contrast estim node elem type get devic id node name mode label predict input weight input bia


elem type
share comput node elem type comput network builder elem type class cross entropi with softmax comput node ptr label comput node ptr predict
comput node ptr input weight
comput node ptr post prob
wstring node name

add node to net and attach input class base cross entropi with softmax node elem type get devic id node name label predict input weight post prob


elem type
share comput node elem type comput network builder elem type clip comput node ptr comput node ptr comput node ptr wstring node name

add node to net and attach input clip node elem type get devic id node name


ifdef come soon
elem type
share comput node elem type comput network builder elem type comput node ptr label
comput node ptr post dep score
comput node ptr transit score
wstring node name

add node to net and attach input crf node elem type get devic id node name label post dep score transit score



elem type
share comput node elem type comput network builder elem type dummi criterion comput node ptr object comput node ptr deriv comput node ptr predict wstring node name

add node to net and attach input dummi criterion node elem type get devic id node name object deriv predict


elem type
share comput node elem type comput network builder elem type cross entropi comput node ptr label comput node ptr predict wstring node name

add node to net and attach input cross entropi node elem type get devic id node name label predict


elem type
share comput node elem type comput network builder elem type matrix l1 reg comput node ptr wstring node name

add node to net and attach input matrix l1 reg node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type matrix l2 reg comput node ptr wstring node name

add node to net and attach input matrix l2 reg node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type mean comput node ptr wstring node name

add node to net and attach input mean node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type pass comput node ptr wstring node name

add node to net and attach input pass node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type dynam axi comput node ptr wstring node name

add node to net and attach input dynam axi node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type inv std dev comput node ptr wstring node name

add node to net and attach input inv std dev node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type negat comput node ptr wstring node name

add node to net and attach input negat node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type rectifi linear comput node ptr wstring node name

add node to net and attach input rectifi linear node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type sigmoid comput node ptr wstring node name

add node to net and attach input sigmoid node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type tanh comput node ptr wstring node name

add node to net and attach input tanh node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input exp node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input log node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input cosin node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input sin node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input ab node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type floor comput node ptr wstring node name

add node to net and attach input floor node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type hardmax comput node ptr wstring node name

add node to net and attach input hardmax node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type softmax comput node ptr wstring node name

add node to net and attach input softmax node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type log softmax comput node ptr wstring node name

add node to net and attach input log softmax node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type reciproc comput node ptr wstring node name

add node to net and attach input reciproc node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type sqrt comput node ptr wstring node name

add node to net and attach input sqrt node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type comput node ptr wstring node name

add node to net and attach input sum element node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type transpos dimens comput node ptr matrix dim1 dim2 wstring node name

add node to net and attach input transpos dimens node elem type get devic id node name dim1 dim2 matrix


elem type
share comput node elem type comput network builder elem type time comput node ptr comput node ptr size output rank wstring node name

add node to net and attach input time node elem type get devic id node name output rank


elem type
share comput node elem type comput network builder elem type transpos time comput node ptr comput node ptr wstring node name

add node to net and attach input transpos time node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type element time comput node ptr comput node ptr wstring node name

add node to net and attach input element time node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type diag time comput node ptr comput node ptr wstring node name

add node to net and attach input diag time node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type co distanc comput node ptr comput node ptr wstring node name

add node to net and attach input co distanc node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type khatri rao product comput node ptr comput node ptr wstring node name

add node to net and attach input khatri rao product node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type plu comput node ptr comput node ptr wstring node name

add node to net and attach input plu node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type minu comput node ptr comput node ptr wstring node name

add node to net and attach input minu node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type dropout comput node ptr wstring node name

add node to net and attach input dropout node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type reshap comput node ptr
tensor shape imag layout
wstring node name

add node to net and attach input reshap node elem type get devic id node name imag layout


elem type
share comput node elem type comput network builder elem type legaci reshap comput node ptr
size num row
tensor shape imag layout
wstring node name

add node to net and attach input legaci reshap node elem type get devic id node name num row imag layout



elem type
share comput node elem type comput network builder elem type row repeat comput node ptr size wstring node name

add node to net and attach input row repeat node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type diagon comput node ptr wstring node name

add node to net and attach input diagon node elem type get devic id node name


elem type
share comput node elem type comput network builder elem type past valu comput node ptr init hidden activ size size size time step wstring node name

add node to net and attach input past valu node elem type get devic id node name init hidden activ size time step


elem type
share comput node elem type comput network builder elem type futur valu comput node ptr init hidden activ size size size time step wstring node name

add node to net and attach input futur valu node elem type get devic id node name init hidden activ size time step


elem type
share comput node elem type comput network builder elem type row slice comput node ptr size start index size row wstring node name

add node to net and attach input slice node elem type get devic id node name start index start index row


elem type
share comput node elem type comput network builder elem type row stack vector comput node ptr pinput wstring node name

vector comput node base ptr input pinput size
size input size
input pinput convert comput node base ptr
add node to net and attach input row stack node elem type get devic id node name input


ifdef come soon
elem type
share comput node elem type comput network builder elem type gmm log likelihood comput node ptr unnorm prior
comput node ptr mean
comput node ptr log stddev
comput node ptr featur
wstring node name

add node to net and attach input gmm log likelihood node elem type get devic id node name unnorm prior mean log stddev featur



elem type
share comput node elem type comput network builder elem type lookup tabl comput node ptr dictionari comput node ptr input wstring node name

add node to net and attach input lookup tabl node elem type get devic id node name dictionari input


elem type
share comput node elem type comput network builder elem type batch normal comput node ptr input
comput node ptr scale comput node ptr bia comput node ptr run mean comput node ptr run inv std dev
spatial normal time constant blend time constant epsilon use cntk engin
imag layout kind imag layout kind
wstring node name

add node to net and attach input batch normal node elem type get devic id node name spatial normal time constant blend time constant epsilon use cntk engin imag layout kind input scale bia run mean run inv std dev


comput network builder
comput network builder



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
convolut engin
cu dnn factori

microsoft cntk

elem type
convolut engin elem type forward kernel workspac

geometri
input shape get num element get num row
output shape get num element get num row
size batch size get num col
batch size get num col
review alexeyk shape awar assert
kernel shape get num element kernel count kernel get num element
ifdef ndebug
unus
unus batch size


ensur compat
ensur convolut initi
forward core kernel workspac


elem type
convolut engin elem type backward data src grad kernel grad workspac

geometri
input shape get num element grad get num row
output shape get num element src grad get num row
size batch size src grad get num col
batch size grad get num col
kernel shape get num element kernel count kernel get num element
ifdef ndebug
unus
unus batch size


ensur compat
ensur convolut initi
backward data core src grad kernel grad workspac


elem type
convolut engin elem type backward kernel src grad kernel allow reus workspac

geometri
input shape get num element get num row
output shape get num element src grad get num row
size batch size get num col
batch size src grad get num col
kernel shape get num element kernel count kernel get num element
ifdef ndebug
unus
unus batch size


ensur compat
ensur convolut initi
backward kernel core src grad kernel allow reus workspac


elem type
convolut engin elem type forward pool

geometri
input shape get num element get num row
output shape get num element get num row
size batch size get num col
batch size get num col
ifdef ndebug
unus
unus batch size


ensur compat
ensur pool initi
forward pool core


elem type
convolut engin elem type backward pool src grad grad

geometri
input shape get num element grad get num row
input shape get num element get num row
output shape get num element src grad get num row
output shape get num element get num row
size batch size get num col
batch size src grad get num col
batch size get num col
batch size grad get num col
ifdef ndebug
unus
unus batch size


ensur compat
ensur pool initi
backward pool core src grad grad



refer convolut engin implement
thi engin support arbitrari convolut geometri provid effici implement
main purpos serv baselin optmiz engin cu dnn
usual implement subset gener convolut geometri

elem type
refer convolut engin convolut engin elem type


base convolut engin elem type
base


refer convolut engin convolv geometri ptr geometri deviceid type devic id imag layout kind imag layout size max temp mem size in sampl pool kind pool kind
base geometri devic id imag layout max temp mem size in sampl pool kind
mp row col geometri mp row col size cast geometri mp row col devic id is gpu devic id matrix flag normal matrix flag dont own buffer




base geometri
base devic id
base imag layout
base max temp mem size in sampl
base pool kind

ensur compat

imag layout imag layout kind
runtim error refer convolut engin support cudnn layout


ensur convolut initi

mp row iwht nullptr

flag is gpu devic id matrix flag normal matrix flag dont own buffer
mp row iwht make uniqu matrix geometri mp row iwht size
cast geometri mp row iwht devic id flag
mp row run make uniqu matrix geometri mp row run size
cast geometri mp row run devic id flag
run make uniqu matrix geometri run size
cast geometri run devic id flag



forward core kernel workspac

convolut forward kernel mp row col mp row iwht mp row run run


backward data core src grad kernel grad workspac

src grad convolut backward data kernel mp row col mp row iwht mp row run run grad


backward kernel core src grad kernel grad allow reus workspac

src grad convolut backward kernel mp row col mp row iwht mp row run run kernel grad


ensur pool initi

indic nullptr

flag is gpu devic id matrix flag normal matrix flag dont own buffer
mp row indic make uniqu matrix geometri mp row indic size
cast geometri mp row indic devic id flag
indic make uniqu matrix geometri indic size
cast geometri indic devic id flag



forward pool core

pool kind pool kind

max pool forward mp row col mp row indic indic

pool kind pool kind averag

averag pool forward mp row col mp row indic indic


invalid argument pool support pool kind



backward pool core src grad grad

pool kind pool kind

src grad max pool backward mp row col mp row indic indic grad

pool kind pool kind averag

src grad averag pool backward mp row col mp row indic indic grad


invalid argument pool support pool kind



is gpu deviceid type devic id

devic id



int mat ptr uniqu matrix

matrix mp row col
convolut specif map
int mat ptr mp row iwht
int mat ptr mp row run
int mat ptr run
pool specif map
int mat ptr mp row indic
int mat ptr indic



legaci convolut engin implement

elem type
legaci convolut engin convolut engin elem type


base convolut engin elem type
base


legaci convolut engin convolv geometri ptr geometri deviceid type devic id imag layout kind imag layout size max temp mem size in sampl pool kind pool kind
base geometri devic id imag layout max temp mem size in sampl pool kind
geometri input shape imag layout kind out t geometri output shape imag layout kind
kernel t geometri kernel shape imag layout kind stride t geometri stride imag layout kind

pad geometri auto pad



base geometri
base devic id
base imag layout
base max temp mem size in sampl
base pool kind

ensur compat

imag layout imag layout kind
runtim error legaci convolut engin support legaci layout


ensur convolut initi



forward core kernel workspac

size batch size get num col
size pack input row kernel t kernel t kernel t
size pack input col per sampl out t out t
size output size per channel pack input col per sampl
size pack input dim pack input row pack input col per sampl size pack input sampl
size input dim size input sampl

size max temp mem size in sampl max temp mem size in sampl batch size max temp mem size in sampl

kernel get num col pack input row kernel get num row out t
unus pack input row

dimension imag
gpu spars opt kernel t
get current matrix locat current data locat
stride t
pad
get matrix type matrix type spars
gpu sparse1 d gpu spars opt

switch to matrix type matrix type dens matrix format matrix format dens

reshap necessari go unpack trick
gpu spars opt
reshap out t out t out t batch size

reshap out t output size per channel batch size

size sub batch size batch size max temp mem size in sampl
size num sub batch batch size sub batch size sub batch size

size num sub batch

size start sampl id sub batch size
size end sampl id batch size start sampl id sub batch size
size small batch size end sampl id start sampl id
input sub batch get devic id

optim three differ scenario handl slightli differ
scenario dens unrol assign pack convolut input multipli
scenario spars convolut text scenario specif kernel
scenario spars other convert dens temporari work around alloc alloc memori costli
get matrix type matrix type dens gpu sparse1 d
input sub batch column slice start sampl id small batch size

input sub batch set valu column slice start sampl id small batch size get format

gpu spars opt

kernel t kernel get num col
logic error kernel width weight matrix dimens match

input sub batch reshap small batch size
output sub batch column slice start sampl id out t small batch size
convolv and weight add kernel input sub batch output sub batch
cast stride t pad



input sub batch switch to matrix type matrix type dens matrix format matrix format dens
workspac assign pack convolut input input sub batch

out t out t out t
kernel t kernel t stride t stride t
pad

output sub batch column slice output size per channel start sampl id output size per channel small batch size

workspac resiz pack input row pack input col per sampl small batch size
bugbug thi destroy content matrix also seem chang size doe should reshap
multipli kernel workspac output sub batch



reshap out t output size per channel batch size sampl becom column

out t out t out t get num row
batch size get num col


backward data core src grad kernel grad workspac

size batch size src grad get num col
size pack input row kernel t kernel t kernel t
size pack input col per sampl out t out t
size output size per channel pack input col per sampl
size pack input dim pack input row pack input col per sampl size pack input sampl
size input dim size input sampl

size max temp mem size in sampl max temp mem size in sampl batch size max temp mem size in sampl

creat slice full matrix reshap
matrix elem type src grad tmp src grad column slice src grad get num col
src grad tmp reshap out t output size per channel batch size reshap match longern oper

size sub batch size batch size max temp mem size in sampl
size num sub batch batch size sub batch size sub batch size

size num sub batch

size start sampl id sub batch size
size end sampl id batch size start sampl id sub batch size
size small batch size end sampl id start sampl id

workspac resiz pack input row pack input col per sampl small batch size
matrix elem type output gradient sub batch src grad tmp column slice start sampl id output size per channel small batch size output size per channel
matrix elem type multipli kernel output gradient sub batch workspac

matrix elem type input gradient sub batch grad column slice start sampl id small batch size
workspac unpack convolut input input gradient sub batch

out t out t out t
kernel t kernel t stride t stride t
pad


out t out t out t src grad get num row
batch size src grad get num col


backward kernel core src grad kernel grad allow reus workspac

size batch size get num col
size pack input row kernel t kernel t kernel t
size pack input col per sampl out t out t
size output size per channel pack input col per sampl
size pack input dim pack input row pack input col per sampl size pack input sampl
size input dim input imag layout width input imag layout height input imag layout channel size input sampl

size max temp mem size in sampl max temp mem size in sampl batch size max temp mem size in sampl

matrix elem type weight matrix input0
input gradient valu resiz weight matrix get num row weight matrix get num col resiz prepar gradient comput

creat slice full matrix reshap
matrix elem type src grad tmp src grad column slice src grad get num col
src grad tmp reshap out t output size per channel batch size reshap match longern oper

size sub batch size batch size max temp mem size in sampl
size num sub batch batch size sub batch size sub batch size

num sub batch allow reus gpu spars opt reus pack input evalu step chang either subbatch recurr step
review alexeyk follow make assumpt workspac fill forward call remain unchang find enforc verifi
matrix elem type multipli and add src grad tmp workspac kernel grad


size num sub batch

size start sampl id sub batch size
size end sampl id batch size start sampl id sub batch size
size small batch size end sampl id start sampl id
matrix elem type output gradient sub batch src grad tmp column slice start sampl id output size per channel small batch size output size per channel

optim three differ scenario handl slightli differ
scenario dens unrol assign pack convolut input multipli
scenario spars convolut text scenario specif kernel
scenario spars other convert dens temporari work around alloc alloc memori costli
gpu spars opt

matrix elem type input sub batch get devic id
input sub batch set valu column slice start sampl id small batch size
input sub batch reshap small batch size
matrix elem type input sub batch spars reorder input sub batch get num col input sub batch get num row input sub batch get devic id matrix type spars matrix format matrix format spars csc
matrix elem type tensor shuffl scale and add input sub batch transpos small batch size input sub batch spars reorder input sub batch spars reorder

matrix elem type output gradient sub batch reorder matrix elem type zero small batch size out t out t out t output gradient sub batch get devic id
matrix elem type tensor shuffl scale and add output gradient sub batch transpos out t small batch size out t out t output gradient sub batch reorder output gradient sub batch reorder

kernel grad reshap out t kernel t
matrix elem type convolv and weight add output gradient sub batch reorder input sub batch spars reorder kernel grad small batch size stride t pad
kernel grad reshap out t kernel t



workspac resiz pack input row pack input col per sampl small batch size
matrix elem type input sub batch column slice start sampl id small batch size
input sub batch switch to matrix type matrix type dens input sub batch get format
workspac assign pack convolut input input sub batch

out t out t out t
kernel t kernel t stride t stride t
pad

matrix elem type multipli and add output gradient sub batch workspac kernel grad




out t out t out t src grad get num row
batch size src grad get num col


ensur pool initi



forward pool core

pool kind pool kind

assign max pool result
out t out t out t out t out t
kernel t kernel t stride t stride t

pool kind pool kind averag

assign averag pool result
out t out t out t out t out t
kernel t kernel t stride t stride t


invalid argument pool support pool kind


backward pool core src grad grad

pool kind pool kind

grad add max pool gradient src grad

out t out t out t out t out t
kernel t kernel t stride t stride t

pool kind pool kind averag

grad add averag pool gradient src grad
out t out t out t out t out t
kernel t kernel t stride t stride t


invalid argument pool support pool kind



imag dimens
imag dimens out t
imag dimens kernel t
imag dimens stride t
pad

gpu spars opt
gpu sparse1 d



gemm convolut engin implement
thi engin support arbitrari convolut configur full
share implement unrol gemm techniqu
high perform convolut neural network document process chellapilla puri simard
use refer engin pool oper

elem type
gemm convolut engin refer convolut engin elem type


base refer convolut engin elem type
base


gemm convolut engin convolv geometri ptr geometri deviceid type devic id imag layout kind imag layout size max temp mem size in sampl pool kind pool kind
base geometri devic id imag layout max temp mem size in sampl pool kind




base int mat ptr

base is gpu

base geometri
base devic id
base imag layout
base max temp mem size in sampl

base mp row col
base mp row iwht
base mp row run
base run

ensur compat

imag layout imag layout kind
logic error gemm convolut engin support cudnn layout
is gpu devic id
logic error gemm convolut engin current support devic


note notat use document function
simplic cu dnn style notat convolut though engin support arbitrari convolut configur
sampl batch channel height width input respect
output output featur map height width output
also column major notat everywher oppos cu dnn use major follow cntk rule
kernel repres width height depth thi engin requir
signific restrict tensor higher dimens use describ convolut configur
exampl matrix row column repres convolut input
column sampl layout dimens stride

forward method consist part
unrol convolut input matrix
use format allow perform convolut whole minibatch singl gemm oper
possibl whcn format altern cwhn format use legaci engin could use
would unrol input transform weight matrix
perform matrix multipl unrol input weight matrix

reshap transpos result
minibatch size step requir step write result directli output
forward core kernel workspac

size batch size get num col
size sub batch size max temp mem size in sampl batch size batch size max temp mem size in sampl

size map count geometri get map count geometri input shape get rank
size map out size geometri output shape get num element map count
size unrol row map out size sub batch size
size unrol col geometri kernel shape get num element
reserv space unrol input need intermedi output
intermedi output transpos output gemm oper
transpos requir sub batch size
workspac resiz unrol row unrol col sub batch size map count

size start start batch size start sub batch size

size cur batch size sub batch size batch size start
input slice column slice start cur batch size
unrol input workspac column slice unrol col
cur batch size sub batch size

unrol input reshap map out size sub batch size unrol col
unrol input unrol input column slice cur batch size unrol col

need reshap soft transpos matric column major
unrol input reshap unrol col map out size cur batch size

unrol input
unrol input set valu
input slice unrol convolut input unrol col map out size mp row col mp row run run unrol input

cudnn layout use major kernel weight matrix
kern kernel column slice kernel get num col
kern reshap kernel get num col kernel get num row

perform matrix multipl unrol input weight
sampl batch comput result directli output matrix
cur batch size

out slice column slice start
out slice reshap map out size map count
multipli unrol input kern out slice



out temp slice workspac column slice unrol col map count
cur batch size sub batch size

out temp slice reshap map out size sub batch size map count
out temp slice out temp slice column slice cur batch size map count
out temp slice reshap map out size cur batch size map count

multipli unrol input kern out temp slice
out temp slice reshap cur batch size map out size map count
out slice column slice start cur batch size
out slice assign transpos of out temp slice




backward method work repres oper revers convolut
kernel last dimens equal input dimens gradient matrix grad becom
output revers convolut
there step
transpos reshap kernel weight
unrol convolut output sourc gradient src grad

perform matrix multipl unrol scr grad transpos weight

reshap transpos output grad
minibatch size step requir step write result directli output grad
backward data core src grad kernel grad workspac

size batch size src grad get num col
size sub batch size max temp mem size in sampl batch size batch size max temp mem size in sampl

geometri input shape
kern t geometri kernel shape

size dim count get rank
kern t dim count dim count
kern t dim count dim count

runtim error gemm convolut engin support convolut configur
possibl make gemm engin work configur defin
input output kernel tensor higher dimens geometri geometri


size map in count kern t dim count
size map out count geometri get map count dim count
size map in size get num element map in count

size unrol row map in size sub batch size
size unrol col kernel get num element map in count

reserv space
transpos kernel weight
unrol sourc gradient
intermedi gradient option
intermedi output transpos output gemm oper
transpos requir sub batch size
size kern col kernel get num element
workspac resiz kern col unrol row unrol col sub batch size map in count

kern kernel column slice kernel get num col
cudnn layout use major kernel weight matrix
kern reshap kernel get num col kernel get num row
transpos reshap
kern tran workspac column slice kern col
reshap transpos shape assign transpos of requir
kern tran reshap kern get num col kern get num row
kern tran assign transpos of kern
kern kern tran column slice kern tran get num col
reshap shape
kern reshap kernel get num element map in count map in count

size start start batch size start sub batch size

size cur batch size sub batch size batch size start
src grad slice src grad column slice start cur batch size
unrol src grad workspac column slice kern col unrol row unrol col
cur batch size sub batch size
unrol src grad unrol src grad column slice map in size cur batch size unrol col
need reshap soft transpos matric column major
unrol src grad reshap unrol col map in size cur batch size

unrol output sourc gradient
unrol src grad set valu
src grad slice unrol convolut output unrol col map in count map out count mp row col mp row run run unrol src grad

perform matrix multipl unrol output weight
sampl batch comput result directli output matrix
cur batch size

grad slice grad column slice start
grad slice reshap map in size map in count
multipli and add unrol src grad kern grad slice



need transpos exist destin gradient first valu
grad temp slice workspac column slice kern col unrol row unrol col unrol row map in count
cur batch size sub batch size
grad temp slice grad temp slice column slice map in size cur batch size map in count
grad temp slice reshap cur batch size map in size map in count
grad slice grad column slice start cur batch size
grad temp slice assign transpos of grad slice
grad temp slice reshap map in size cur batch size map in count
multipli unrol src grad weight grad
multipli and add unrol src grad kern grad temp slice
reshap transpos grad back origin form
grad temp slice reshap cur batch size map in size map in count
grad slice assign transpos of grad temp slice




backward kernel method consist part
transpos reshap convolut output matrix src grad layout
thi step need current minibatch size src grad use instead
unrol convolut input matrix layout
perform matrix multipl unrol input transpos output
kernel gradient
backward kernel core src grad kernel grad allow reus workspac

size batch size src grad get num col
size sub batch size max temp mem size in sampl batch size batch size max temp mem size in sampl

geometri input shape
kern t geometri kernel shape
out t geometri output shape

size dim count get rank
size map out count geometri get map count dim count
size map out size out t get num element map out count

kern t dim count dim count
kern t dim count dim count

runtim error gemm convolut engin support convolut configur
possibl make gemm engin work configur defin
input output kernel tensor higher dimens geometri geometri


size unrol row kern t get num element
size unrol col map out size sub batch size

reserv space
unrol input
transpos sourc gradient option
workspac resiz unrol col unrol row sub batch size map out count

size start start batch size start sub batch size

size cur batch size sub batch size batch size start
transpos reshap src grad
src grad slice src grad column slice start cur batch size
cur batch size

src grad tran slice workspac column slice unrol row map out count
cur batch size sub batch size

src grad tran slice reshap map out count map out size sub batch size
src grad tran slice src grad tran slice column slice cur batch size

reshap transpos shape requir assign transpos of
src grad tran slice reshap src grad slice get num col src grad slice get num row
src grad tran slice assign transpos of src grad slice
src grad slice src grad tran slice column slice src grad tran slice get num col

src grad slice reshap map out size cur batch size map out count

unrol input
input slice column slice start cur batch size
unrol input slice workspac column slice unrol row
cur batch size sub batch size

unrol input slice reshap map out size unrol row sub batch size
unrol input slice unrol input slice column slice cur batch size

unrol input slice reshap map out size cur batch size unrol row
unrol input slice set valu
input slice unrol convolut input for kernel backprop map out size mp row col mp row run run unrol input slice

cudnn layout use major kernel weight matrix
kern grad kernel grad column slice kernel grad get num col
kern grad reshap kernel grad get num col kernel grad get num row
multipli
multipli and add unrol input slice src grad slice kern grad




is support deviceid type devic id convolv geometri ptr geometri

devic id
find geometri share geometri share geometri share



elem type
uniqu convolut engin elem type convolut engin elem type creat convolv geometri ptr geometri deviceid type devic id
imag layout kind imag layout size max temp mem size in sampl pool kind pool kind
convolut engin kind enabl engin

is enabl convolut engin kind enabl engin
note case except even paramet match creat
call place like paramet never use
check done later engin ensur compat call egnin actual use
eng str geometri
onli legaci engin support layout
imag layout imag layout kind

is enabl convolut engin kind legaci
runtim error tri legaci convolut engin disabl
review alexeyk honor trace level
fprintf stderr n use legaci convolut engin geometri eng str
make uniqu legaci convolut engin elem type geometri devic id imag layout max temp mem size in sampl pool kind


check cu dnn engin need valid tensor convolv geometri alreadi done
is enabl convolut engin kind cu dnn
cu dnn convolut engin factori elem type is support devic id geometri pool kind

fprintf stderr n use cu dnn convolut engin geometri eng str
cu dnn convolut engin factori elem type creat geometri devic id imag layout max temp mem size in sampl pool kind


is enabl convolut engin kind gemm gemm convolut engin elem type is support devic id geometri

fprintf stderr n use gemm convolut engin geometri eng str
make uniqu gemm convolut engin elem type geometri devic id imag layout max temp mem size in sampl pool kind


is enabl convolut engin kind refer
runtim error refer convolut disabl engin support configuratin disabl
fprintf stderr n use refer convolut engin geometri eng str
make uniqu refer convolut engin elem type geometri devic id imag layout max temp mem size in sampl pool kind


convolut engin
convolut engin


stdafx
basic
gpu data transfer
gpu matrix

pragma comment cudart

pragma warn disabl 4267 convers size happen cuda syntax size
pragma warn disabl 4127 condit express constant elem type trigger
pragma warn disabl 4702 unreach code trigger unknown reason

microsoft cntk

cuda fail
sinc outer code sometim recov properli option right away
thi need farm intermitt cuda error sometim caus tool run hang instead termin
cudafail

todo variabl
dieoncudafailur
dieoncudafailur

runtim error

fprintf stderr
fprintf stderr cudafail termin fflush stderr
ifdef win32
termin process get current process exit failur fail hard hang elsewher





allow write cuda function error cuda runtim

ifdef win32
declspec noinlin


cuda error

cuda success

1000
sprintf 1000 cuda error cuda get error string
cudafail




elem type
gpu data transfer elem type sync event cuda event

cuda event queri
cuda error not readi

event readi need wait
cuda event queri fail


must wait
cuda event synchron cuda event synchron fail


stream
elem type
cuda stream gpu data transfer elem type fetch stream

elem type
cuda stream gpu data transfer elem type assign stream

elem type
cuda stream gpu data transfer elem type get fetch stream

fetch stream


elem type
gpu data transfer elem type gpu data transfer devic id use concurr stream
devic id devic id

prepar devic devic id

event
note cuda event block sync supposedli yield process total cuda event synchron caus take randomli
cuda event creat with flag fetch complet event cuda event disabl time cuda event creat with flag fail
cuda event creat with flag assign complet event cuda event disabl time cuda event creat with flag fail

pragma warn disabl 4127
use concurr stream fetch stream

cuda stream creat with flag fetch stream cuda stream non block cuda stream creat with flag fail
cuda stream creat with flag assign stream cuda stream non block cuda stream creat with flag fail



elem type
gpu data transfer elem type gpu data transfer

bugbug destroy stream variabl need destructor lazi
todo check error code uncaught except
cuda event destroy assign complet event
cuda event destroy fetch complet event


elem type
gpu data transfer elem type copi gpu to cpu async elem type gpu buffer size num element elem type cpu buffer

prepar devic devic id

cuda memcpi async cpu buffer gpu buffer num element elem type cuda memcpi devic to host fetch stream cuda memcpi async fail
cuda event record fetch complet event fetch stream cuda event record fail


elem type
gpu data transfer elem type wait for copi gpu to cpu async

prepar devic devic id

sync event fetch complet event


elem type
gpu data transfer elem type copi cpu to gpu async elem type cpu buffer size num element elem type gpu buffer

prepar devic devic id

cuda memcpi async gpu buffer cpu buffer num element elem type cuda memcpi host to devic assign stream cuda memcpi async fail
cuda event record assign complet event assign stream cuda event record fail


elem type
gpu data transfer elem type wait for copi cpu to gpu async

prepar devic devic id

sync event assign complet event



gpu data transfer
gpu data transfer


copyright microsoft right reserv
licens licens licens file project root full licens inform

tensor view main file contain function export cntk math



todo
dimens infer node
reduct highli ineffici test case imag quick e2 e plu node backprop to scale node backprop to
accuraci deviat full utter sequenc train
time node need specifi reduct dimens
convolut node need specifi reduct dimens
node creat dimens row stack should actual tensor dimens

thi tensor view layer around matrix reinterpret content gener tensor


defin secur warn secur avail platform file give variabl warn

stdafx
basic
tensor view


ifndef
defin


microsoft cntk




construct


main constructor rout
elem type
tensor view elem type tensor view matrix base ptr tensor shape shape
dynam pointer cast matrix elem type shape shape


logic error tensor view attempt creat tensor view elem type storag differ elem type
ifdef debug
check bound tensor shape underli storag
thi use detect error like pass matrix wrong input
shape get locat rang
get num element
first size second
logic error tensor view shape bound exceed bound underli storag first second




elementwis oper


match size size


dimens match

elem type size
prepar tensor operand tensor shape shape size offset
small vector size regular op dim
small vector ptrdiff regular stride
small vector size reduc op dim
small vector ptrdiff reduc stride

massag tensor shape
note tensor shape shape store shape stride magic appli

expand one make tensor compat
trail dimens broadcast
broadcast column
broadcast row tensor shape edit insert dimens
size dim
size
dim shape get rank
dim shape get rank
size
shape get rank dim
shape pad rank in place dim
shape rank

determin oper shape dimens
small vector size op dim shape get dim
size dim
size
op dim op dim shape

dimens compat check
each particip broadcast broadcast dimens must match oper dimens
size dim
size
match shape op dim
invalid argument binari tensor oper dimens input incompat oper dimens shape tensor shape op dim

flatten consecut dimens
dimens must consecut memori either broadcast broadcast across dimens
after longer match tensor shape object
fprintf stderr flatten shape shape shape tensor shape op dim
size dim

size

check store without gap skip
shape can flatten
nope
check either broadcast broadcast
shape op dim shape op dim shape shape
nope

dimens merg
size
shape flatten in place todo overdo immut thingi much
op dim tensor shape op dim flatten in place get dim
nope

fprintf stderr post flatten shape shape shape tensor shape op dim

remov singleton dimens
small vector to drop dim
ani to drop
size dim

size
shape
neither
to drop found singleton dimens
ani to drop
neither

ani to drop

size
shape drop dim in place to drop
op dim tensor shape op dim drop dim in place to drop get dim
dim op dim size dim chang

size
dim shape size
note scalar dimens allow
fprintf stderr post drop shape shape shape tensor shape op dim

determin broadcast stride dimens
precis actual broadcast dimens
sinc dimens across arg elimin must form broadcast
size todo need test output tensor well
size dim
shape op dim

shape set broadcast stride



fprintf stderr shape shape shape tensor shape op dim

determin invers broadcast dimens
invers broadcast dim actual loop kernel wherea broadcast input dim handl thread index
regular input dim
determin step product op dim
launch mani kernel

total step
stride input stride magic separ regular invers broadcast dimens
op dim stride magic allow regular broadcast dimens
revers broadcast dimens
opcod elementwis reduct
kernel
thread index dimens regular broadcast one
invers broadcast dimens
dimens includ invers broadcast everi input
perform input valu
accumul
dimens regular output
save result

separ invers broadcast dimens
singleton dimens result tensor invers broadcast must least dimens
input otherwis entir dimens would optim away
small vector is reduc dim dim invers broadcast dimens
is ani reduc dim
size dim

is red shape back
is reduc dim is red
is ani reduc dim is red


form regular invers broadcast dim
is ani reduc dim

size
regular stride shape drop dim is reduc dim get stride
regular op dim tensor shape op dim drop dim is reduc dim get dim

form invers broadcast dim
small vector is regular dim dim invers broadcast dimens
size dim
is regular dim is reduc dim nice
size
reduc stride shape drop dim is regular dim get stride
reduc op dim tensor shape op dim drop dim is regular dim get dim

reduct thing simpler

size
regular stride shape get stride
regular op dim op dim

size
reduc stride clear
reduc op dim clear


size
offset shape get offset


enforc broadcast output must input
elem type
check differ object tensor view elem type tensor view elem type


logic error nari op of when invers broadcast output must input



elem type
tensor view elem type do unari op of elem type beta tensor view elem type alpha element wise oper element wise oper reduct op


fprintf stderr tensor get shape get shape

prepar tensor descriptor inform need execut
size offset
small vector ptrdiff regular stride reduc stride
small vector size regular op dim reduc op dim
prepar tensor operand elem type tensor shape get shape get shape offset regular op dim regular stride reduc op dim reduc stride

output cannot input reduc
reduc op dim size
check differ object

perform oper
get sob tensor op beta get sob alpha reduct op offset regular op dim regular stride reduc op dim reduc stride


elem type
tensor view elem type do binari op of elem type beta tensor view tensor view elem type alpha element wise oper element wise oper reduct op


fprintf stderr tensor get shape get shape get shape

size offset
small vector ptrdiff regular stride reduc stride
small vector size regular op dim reduc op dim
prepar tensor operand elem type tensor shape get shape get shape get shape offset regular op dim regular stride reduc op dim reduc stride

output cannot input reduc
reduc op dim size
check differ object check differ object

get sob tensor op beta get sob get sob alpha reduct op offset regular op dim regular stride reduc op dim reduc stride


elem type
tensor view elem type do ternari op of elem type beta tensor view tensor view tensor view elem type alpha element wise oper element wise oper reduct op


fprintf stderr tensor get shape get shape get shape get shape

size offset
small vector ptrdiff regular stride reduc stride
small vector size regular op dim reduc op dim
prepar tensor operand elem type tensor shape get shape get shape get shape get shape offset regular op dim regular stride reduc op dim reduc stride

output cannot input reduc
reduc op dim size
check differ object check differ object check differ object

get sob tensor op beta get sob get sob get sob alpha reduct op offset regular op dim regular stride reduc op dim reduc stride



matrix product gemm flatten tensor


dimens matrix product oper pretti error report
matrix product format tensor shape shape a tran a tensor shape shape b tran b tensor shape shape c tran c

result shape a tran a result append
result
result shape b tran b result append
result
result shape c tran c result append
result


flatten tensor tensor split point first index second dimens
tensor must flatten index rang must dens
flatten to matrix tensor shape shape tran size split point

tran
split point shape get rank split point
check meaning error messag
small vector dim to drop shape get rank
size shape get rank
split point
shape can flatten
invalid argument do matrix product of shape dens dimens shape

dim to drop
handl last dimens miss column vector
split point shape get rank

shape pad rank in place split point
dim to drop resiz split point

flatten dimens
size shape get rank
dim to drop
shape flatten in place
shape drop dim in place dim to drop
handl edg first dimens miss scalar
split point

must insert dimens start
shape get rank reduc everyth split point point
shape pad rank in place append
shape swap dim in place swap preserv stride second dimens

matrix
shape get rank


convert tensor matrix
elem type
share matrix elem type tensor view elem type as matrix

shape get rank
shape get stride shape
invalid argument as matrix flatten matrix dens stride shape

creat matrix view tensor view turn view matrix
column slice
express tensor view storag coordin
first column shape get offset get num row
num column shape get num element get num row
first column get num row shape get offset num column get num row shape get num element
invalid argument as matrix flatten matrix offset width multipl storag dimens shape

reinterpret slice accord tensor shape
exampl
column contain vector store tensor sampl
want appli matrix vector
reinterpret storag matrix
appli matrix product call gemm
turn yield matrix
get reinterpret back tensor
special spars matric split cannot done exampl could multipli tensor
need slice first column num column get num col
need reshap shape get num row shape get num col

note output matrix view need move differ devic fail later sinc current structur cannot support
consequ configur simpli work current
minim chanc origin storag whenev possibl
need slice need reshap need mess storag full support move devic

need slice need reshap slice support spars well
make share matrix elem type column slice first column num column
get matrix type matrix type dens need reshap allow spars matric
runtim error as matrix spars tensor support matric
dens slice reshap neutral also fail output matrix need move devic
make share matrix elem type column slice first column num column reshap shape shape


elem type
tensor view elem type do matrix product of elem type beta tran c tensor view tran a tensor view tran b elem type alpha

determin integr dimens offset
shape a shape
shape b shape
shape c shape
shape a get rank shape b get rank shape c get rank
invalid argument do matrix product of rank match output must reduc output dimens matrix product format shape a tran a shape b tran b shape c tran c
remov dim shape a get rank shape b get rank shape c get rank
num reduc dim remov dim
num reduc dim remov dim
invalid argument do matrix product of rank mismatch matrix product format shape a tran a shape b tran b shape c tran c
first reduc dim shape a get rank num reduc dim
flatten thi updat shape a
flatten to matrix shape a tran a first reduc dim
flatten to matrix shape b tran b num reduc dim
flatten to matrix shape c tran c first reduc dim
check dimens
shape x tran x shape x tran x column respect swap transpos
shape a tran a shape c tran c output
shape b tran b shape c tran c input
shape a tran a shape b tran b reduct

invalid argument do matrix product of flatten tensor dimens mismatch matrix product format shape a tran a shape b tran b shape c tran c

creat matrix object
reshap shape a as matrix
reshap shape b as matrix
reshap shape c as matrix

tran c
matrix elem type multipli and weight add alpha tran a tran b beta

matrix elem type multipli and weight add alpha tran b tran a beta


tensor view
tensor view



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
gpu matrix
cu dnn common

microsoft cntk


const

const

const zero

const zero

cu dnn tensor cu dnn tensor tensor shape cudnn data type data type
tensor nullptr

cudnn call cudnn creat tensor descriptor tensor
cu dnn tensor dimens cu dnn use major format tensor shape column major
convers requir dimens
stride src get stride
small vector dim get rank
small vector stride stride src size
dim size stride size
get rank

dim dim size
stride dim size stride src

minibatch dimens
dim
stride stride dim
cudnn call cudnn set tensor nd descriptor tensor data type dim size dim stride


cu dnn tensor cu dnn tensor

tensor nullptr

cudnn destroy tensor descriptor tensor
tensor nullptr



cu dnn tensor updat batch size size batch size

current cu dnn support convlut anyway tensor
max dim
dim max dim
stride max dim
nb dim
cudnn data type data type
accord nvidia function fast call
cudnn call cudnn get tensor nd descriptor tensor max dim data type nb dim dim stride
nb dim max dim
dim batch size
cudnn call cudnn set tensor nd descriptor tensor data type nb dim dim stride


elem type
cudnn data type cu dnn tensor get data type

elem type
cudnn data float
elem type
cudnn data doubl

invalid argument cu dnn engin current support singl precis type


cudnn data type cu dnn tensor get data type
cudnn data type cu dnn tensor get data type

cu dnn cu dnn instanc

creat new

devic id
cuda call cuda get devic devic id
cuda devic prop prop
cuda get devic properti prop devic id cuda success prop major
runtim error cu dnn requir devic comput capabl higher
cudnn handl cudnn cudnn handl
cudnn call cudnn creat cudnn
cudnn call cudnn set stream cudnn get stream
cudnn


share cudnn handl share cudnn handl creat new cudnn handl

nullptr
cudnn destroy
cudnn statu success
ifdef ndebug
unus







cudalattic lattic forward backward function cuda execut glue code

seid hansu

defin secur warn secur avail platform file give variabl warn

defin dllexport
defin kernel emul allow compil cuda kernel
latticefunctionskernel actual inner kernel argument type defin latticestorag
kernel emul
cudalattic export
cudalatticeop bring actual lattic function kernel
cudalib gener cuda helper
cudadevic
math
memori



msra cuda

cuda error todo import cudamatrix better move cudalib

basic oper export vectorbas vector deriv
todo thi realli cudalattic sinc gener need cudavector
vectortyp opstyp
vectorbaseimpl vectortyp user must deriv vectorbas vectorbas elemtyp
opstyp kernel must deriv vectorref vectorbas elemtyp
objectondevic setdevic

vectortyp elemtyp elemtyp conveni
size capac amount alloc storag like capac vectorref size
releas

ondevic deviceid
free reset



vectorbaseimpl size deviceid
capac objectondevic deviceid


vectorbaseimpl

releas

alloc size

capac need grow

ondevic deviceid desir cuda card
cuda elemtyp pnew malloc elemtyp alloc memori insid cuda devic
capac succeed rememb
cuda elemtyp reset pnew swap pointer updat
free releas

grow keep alloc
reset

size size

vectorref elemtyp size

assign elemtyp size nelem synchron

alloc nelem assign resiz target appropri
ondevic deviceid desir cuda card
nelem
memcpi nelem
synchron
join

fetch elemtyp size nelem synchron

nelem size fetch cannot resiz target caller must
logic error fetch vector size mismatch
ondevic deviceid desir cuda card
nelem
memcpi nelem
synchron
join




glue code lattic relat class
xx xvectorimpl class must deriv vectorbaseimpl xx xvector xx xvectorop
class without kernel oper vector xx xvectorimpl
need vectorbaseimpl xx xvector vectorref instead
xx xvector vectorbas better keep cudalattic
document vector implement


matrixref tomatrixref microsoft cntk matrix

matrixref data get num row get num col get num row


latticefunctionsimpl vectorbaseimpl latticefunct latticefunctionsop


latticefunctionsimpl size deviceid
vectorbaseimpl deviceid




edgealign lrhmmdefvector hmm lr3tran pvector tran ps size spalignunitid
size silalignunitid microsoft cntk matrix log l ls nodeinfovector node
edgeinfowithscoresvector edg aligninfovector align
uintvector alignoffset ushortvector backptrstorag sizetvector backptroffset
ushortvector alignresult floatvector edgeacscor output

ondevic deviceid

matrixref log l ls matrix ref tomatrixref log l ls
latticefunctionsop edgealign dynam cast vectorbaseimpl lrhmmdefvector vectorref lrhmmdef hmm
dynam cast vectorbaseimpl lr3tran pvector vectorref lr3tran p tran ps
spalignunitid silalignunitid log l ls matrix ref
dynam cast vectorbaseimpl nodeinfovector vectorref msra lattic nodeinfo node
dynam cast vectorbaseimpl edgeinfowithscoresvector vectorref msra lattic edgeinfowithscor edg
dynam cast vectorbaseimpl aligninfovector vectorref msra lattic aligninfo align
dynam cast vectorbaseimpl uintvector vectorref alignoffset
dynam cast vectorbaseimpl ushortvector vectorref backptrstorag
dynam cast vectorbaseimpl sizetvector vectorref size backptroffset
dynam cast vectorbaseimpl ushortvector vectorref alignresult
dynam cast vectorbaseimpl floatvector vectorref edgeacscor


forwardbackwardlattic size batchsizeforward size batchsizebackward
size numlaunchforward size numlaunchbackward
size spalignunitid size silalignunitid
floatvector edgeacscor edgeinfowithscoresvector edg
nodeinfovector node aligninfovector align
ushortvector align uintvector alignoffset
doublevector logpp doublevector logalpha doublevector logbeta
boostingfactor return eframescorrect
ushortvector uid ushortvector senone2classmap doublevector logaccalpha
doublevector logaccbeta doublevector logframescorrectedg
doublevector log eframescorrect doublevector eframescorrectbuf log eframescorrecttot totalfwscor

ondevic deviceid
latticefunctionsop forwardbackwardlattic batchsizeforward batchsizebackward numlaunchforward numlaunchbackward
spalignunitid silalignunitid
dynam cast vectorbaseimpl floatvector vectorref edgeacscor
dynam cast vectorbaseimpl edgeinfowithscoresvector vectorref msra lattic edgeinfowithscor edg
dynam cast vectorbaseimpl nodeinfovector vectorref msra lattic nodeinfo node
dynam cast vectorbaseimpl aligninfovector vectorref msra lattic aligninfo align
dynam cast vectorbaseimpl ushortvector vectorref align
dynam cast vectorbaseimpl uintvector vectorref alignoffset
dynam cast vectorbaseimpl doublevector vectorref logpp
dynam cast vectorbaseimpl doublevector vectorref logalpha
dynam cast vectorbaseimpl doublevector vectorref logbeta
boostingfactor return eframescorrect
dynam cast vectorbaseimpl ushortvector vectorref uid
dynam cast vectorbaseimpl ushortvector vectorref senone2classmap
dynam cast vectorbaseimpl doublevector vectorref logaccalpha
dynam cast vectorbaseimpl doublevector vectorref logaccbeta
dynam cast vectorbaseimpl doublevector vectorref logframescorrectedg
dynam cast vectorbaseimpl doublevector vectorref log eframescorrect
dynam cast vectorbaseimpl doublevector vectorref eframescorrectbuf
log eframescorrecttot totalfwscor


s mb rerrorsign ushortvector alignstateid
uintvector alignoffset
edgeinfowithscoresvector edg nodeinfovector node
doublevector logpp doublevector log eframescorrect
log eframescorrecttot microsoft cntk matrix dengamma microsoft cntk matrix dengammasbuf

ondevic deviceid

matrixref dengamma matrix ref tomatrixref dengamma
matrixref dengammasbuf matrix ref tomatrixref dengammasbuf
latticefunctionsop s mb rerrorsign dynam cast vectorbaseimpl ushortvector vectorref alignstateid
dynam cast vectorbaseimpl uintvector vectorref alignoffset
dynam cast vectorbaseimpl edgeinfowithscoresvector vectorref msra lattic edgeinfowithscor edg
dynam cast vectorbaseimpl nodeinfovector vectorref msra lattic nodeinfo node
dynam cast vectorbaseimpl doublevector vectorref logpp

dynam cast vectorbaseimpl doublevector vectorref log eframescorrect
log eframescorrecttot dengamma matrix ref dengammasbuf matrix ref


mmierrorsign ushortvector alignstateid uintvector alignoffset
edgeinfowithscoresvector edg nodeinfovector node
doublevector logpp microsoft cntk matrix dengamma

ondevic deviceid

matrixref dengamma matrix ref tomatrixref dengamma
latticefunctionsop mmierrorsign dynam cast vectorbaseimpl ushortvector vectorref alignstateid
dynam cast vectorbaseimpl uintvector vectorref alignoffset
dynam cast vectorbaseimpl edgeinfowithscoresvector vectorref msra lattic edgeinfowithscor edg
dynam cast vectorbaseimpl nodeinfovector vectorref msra lattic nodeinfo node
dynam cast vectorbaseimpl doublevector vectorref logpp
dengamma matrix ref


stateposterior ushortvector alignstateid uintvector alignoffset
edgeinfowithscoresvector edg nodeinfovector node
doublevector logq microsoft cntk matrix logacc

ondevic deviceid

matrixref logacc matrix ref tomatrixref logacc
latticefunctionsop stateposterior dynam cast vectorbaseimpl ushortvector vectorref alignstateid
dynam cast vectorbaseimpl uintvector vectorref alignoffset
dynam cast vectorbaseimpl edgeinfowithscoresvector vectorref msra lattic edgeinfowithscor edg
dynam cast vectorbaseimpl nodeinfovector vectorref msra lattic nodeinfo node
dynam cast vectorbaseimpl doublevector vectorref logq
logacc matrix ref



latticefunct newlatticefunct size deviceid

latticefunctionsimpl deviceid


implement lrhmmdefvector
class vector level member function need extra
lrhmmdefvector newlrhmmdefvector size deviceid

vectorbaseimpl lrhmmdefvector vectorref lrhmmdef deviceid

lr3tran pvector newlr3tran pvector size deviceid

vectorbaseimpl lr3tran pvector vectorref lr3tran p deviceid

ushortvector newushortvector size deviceid

vectorbaseimpl ushortvector vectorref deviceid

uintvector newuintvector size deviceid

vectorbaseimpl uintvector vectorref deviceid

floatvector newfloatvector size deviceid

vectorbaseimpl floatvector vectorref deviceid

doublevector newdoublevector size deviceid

vectorbaseimpl doublevector vectorref deviceid

sizetvector newsizetvector size deviceid

vectorbaseimpl sizetvector vectorref size deviceid

nodeinfovector newnodeinfovector size deviceid

vectorbaseimpl nodeinfovector vectorref nodeinfo deviceid

edgeinfowithscoresvector newedgeinfovector size deviceid

vectorbaseimpl edgeinfowithscoresvector vectorref edgeinfowithscor deviceid

aligninfovector newaligninfovector size deviceid

vectorbaseimpl aligninfovector vectorref aligninfo deviceid




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
math compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx
bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

math defin export function applic


stdafx
basic
file

stdexcept

math
cpu matrix
cpu spars matrix
random
chrono
iostream
ifdef leakdetect



pragma warn disabl 4127 condit express constant elem type trigger

ifdef acml
acml
download acml acml5 ifort64
http develop tool develop core math librari acml acml download resourc
instal ifort64 variant compil intel compil librari
environ variabl acml path acml5 ifort64 folder instal acml
point folder file link librari
acml requir acml
defin
requir


ifdef
visual studio defin standard complex type properli
defin have lapack config
defin lapack complex structur

cbla
lapack


thi exampl export variabl
math n math

thi exampl export
math fn math




ifdef acml addit paramet differ matrix order
defin bla colmajor

defin bla colmajor matrix order col major


todo move common matrix
defin idx2 c base index

microsoft cntk

pragma region help enum definit

matrix order

row major major array
col major column major array


matrix transpos

no tran tran
tran tran
conj tran tran


sym matrix type

symmetr matrix store upper part
symmetr matrix store thelow part
full full popul
not symmetr symmetr matrix


matrix op side

left left multipli
right right multipli


pragma endregion help enum definit

pragma region constructor destructor


construct convers


use constructor
elem type
cpu spars matrix elem type zero init

base zero init
set comput devic id cpudevic

set comp index size
set col idx
set buffer nullptr
set un comp index nullptr
set comp index nullptr
set block size
set block id shift
set block id nullptr


use constructor
elem type
cpu spars matrix elem type check init matrix format format

format matrix format matrix format spars csc format matrix format matrix format spars csr format matrix format matrix format spars block col format matrix format matrix format spars block row

logic error cpu spars matrix unsupport spars matrix format

set format format
zero init


elem type
cpu spars matrix elem type cpu spars matrix matrix format format

check init format


elem type
cpu spars matrix elem type cpu spars matrix matrix format format size num row size num col size size

check init format
requir size and alloc num row num col size


copi deep copi
elem type
cpu spars matrix elem type cpu spars matrix cpu spars matrix elem type deep copi from

zero init
deep copi from is empti
set valu deep copi from


assign deep copi
elem type
cpu spars matrix elem type cpu spars matrix elem type cpu spars matrix elem type deep copi from

deep copi from is empti
set valu deep copi from



move shallow copi
elem type
cpu spars matrix elem type cpu spars matrix cpu spars matrix elem type move from

base shallow copi from move from
releas pointer sourc destructor releas twice
move from zero valu


move assign shallow copi
elem type
cpu spars matrix elem type cpu spars matrix elem type cpu spars matrix elem type move from

move from

base shallow copi from move from
releas pointer sourc destructor releas twice
move from zero valu




elem type
cpu spars matrix elem type cpu spars matrix

zero valu


pragma endregion constructor destructor

pragma region basic oper

make sure call order column wise wise
elem type
cpu spars matrix elem type set valu size size elem type

own buffer
logic error cannot modifi sinc buffer manag extern

get format matrix format matrix format spars csc get format matrix format matrix format spars csr

logic error cpu spars matrix unsupport set valu call


nz count
get size alloc automat resiz

alloc num row num col alloc elelemnt keep exist valu


num row

logic error cpu spars matrix set valu invalid


num col

logic error cpu spars matrix set valu invalid column


size get format matrix format spars csc
size get format matrix format spars csc

data
major index locat cpuspars index type

consist check


get col idx major index locat

logic error cpu spars matrix set valu call properli



get col idx

secondari index locat cpuspars index type
set col idx

note anymor order chang
nz count make sens need propog slice
size num col

secondari index locat cpuspars index type



make sure call order colum wise wise
elem type
cpu spars matrix elem type set valu cpu spars matrix elem type

set format get format

requir size and alloc get num row get num col nz size
nz count



memcpi nz valu nz valu nz size
memcpi row locat row locat row size
memcpi col locat col locat col size



elem type
cpu spars matrix elem type mask column valu cpu matrix column mask elem type

verifi writabl func

size get num col
column mask get num col
runtim error matrix column mask must equal column


logic error mask column valu implment zero mask spars matric

ifdef debug
get format matrix format matrix format spars csc

binari column mask
mask col column mask data

need verifi column zero
gpuspars index type col vector secondari index locat

pragma parallel

mask col col vector col vector
logic error cpu spars matrix attempt mask column element col vector col vector


implement




elem type
cpu spars matrix elem type print matrix name

print matrix name


elem type
cpu spars matrix elem type print matrix name ptrdiff row start ptrdiff row end ptrdiff col start ptrdiff col end

get format matrix format spars csc get format matrix format spars csr


implement


fprintf stderr matrix name

elem type data buffer nz valu
size major index count
cpuspars index type un compress index major index locat
cpuspars index type compress index secondari index locat

size

compress index

fprintf stderr


fprintf stderr un compress index data buffer

fprintf stderr


elem type
cpu spars matrix elem type cpu spars matrix elem type column slice size start column size num col

start column num col num col
invalid argument slice rang sourc matrix start column num col num col

get format matrix format matrix format spars csc get format matrix format matrix format spars block col
implement

cpu spars matrix elem type slice get format
slice shallow copi from

slice num col num col
get format matrix format matrix format spars csc

slice slice view offset slice view offset start column

get format matrix format matrix format spars block col

start col block end col block
found start found end
size get block size



get block id get block id assum increas valid


found start get block id get block id shift start column start column valu

start col block
found start

get block id get block id shift start column num col column valu

end col block
found end



found start

start col block get block size

found end

end col block get block size


slice slice view offset start col block

slice set block id size get block id start col block valu store block base origin column number
slice set block size size end col block start col block
slice set block id shift get block id shift start column


slice


elem type
cpu matrix elem type cpu spars matrix elem type copi column slice to dens size start column size num col

start column num col num col
invalid argument slice rang sourc matrix start column num col num col

get format matrix format matrix format spars csc
implement

cpu matrix elem type slice num row num col

pragma parallel
num col

start secondari index locat start column
secondari index locat start column

start

size get un comp index
elem type valu buffer size
slice size valu



slice


elem type
cpu matrix elem type cpu spars matrix elem type diagon to dens

num row num col
logic error diagon to dens call squar matrix

get format matrix format matrix format spars csc
implement

cpu matrix elem type diag num col

pragma parallel
num col

start secondari index locat
secondari index locat

start

size major index locat

size

diag data size




diag


elem type
cpu spars matrix elem type set matrix from csc format cpuspars index type csc col cpuspars index type elem type
size size num row size num col

own buffer
logic error cannot modifi sinc buffer manag extern

set format matrix format spars csc
requir size and alloc num row num col

note thi casualti away row size nz size depend col locat correct format spars csc thu must
copi col locat row locat nz valu that ugli error prone
memcpi col locat csc col cpuspars index type num col
memcpi row locat cpuspars index type
memcpi nz valu elem type


elem type
elem type cpu spars matrix elem type data

buffer get comp index slice view offset


elem type
elem type cpu spars matrix elem type data

buffer get comp index slice view offset


warn when memori realloc exist inform lost
todo keep exist valu argument exist valu kept even realloc
elem type
cpu spars matrix elem type alloc size num row size num col size num nz elem request grow onli keep exist valu

num row num row num col num col
logic error error call alloc dimens matrix dimens num row num col get num row get num col

size num nz elem to reserv num nz elem request size
size new comp index size num col num row num col num row
realloc get size alloc num nz elem to reserv get size alloc num nz elem to reserv grow onli get comp index size new comp index size

realloc

get format matrix format matrix format spars csc get format matrix format matrix format spars csr

p array elem type num nz elem to reserv
un comp index cpuspars index type num nz elem to reserv
comp index cpuspars index type new comp index size

keep exist valu nz count num nz elem to reserv get comp index size new comp index size
logic error alloc keep valu num nz elem to reserv comp index size new comp index size

memset p array elem type num nz elem to reserv
memset un comp index cpuspars index type num nz elem to reserv
memset comp index cpuspars index type new comp index size

keep exist valu nz count

get comp index size nz count num nz elem to reserv
memcpi p array data nz size
memcpi un comp index get un comp index major index size
memcpi comp index get comp index secondari index size


todo thi ugli intern storag share
buffer
get un comp index
get comp index

set buffer p array num nz elem to reserv
set un comp index un comp index
set comp index comp index

get format matrix format matrix format spars block col get format matrix format matrix format spars block row

elem type block val elem type num nz elem to reserv
size block id size new comp index size

keep exist valu nz count num nz elem to reserv get comp index size new comp index size
logic error resiz keep valu num nz elem to reserv comp index size new comp index size

keep exist valu get size alloc

get comp index size get size alloc num nz elem to reserv
memcpi block val data nz size
memcpi block id get block id size get comp index size


buffer
get block id

set buffer block val num nz elem to reserv
set block id block id


set size alloc num nz elem to reserv
set comp index size new comp index size



elem type
cpu spars matrix elem type requir size and alloc size num row size num col size num nz elem to reserv 10000 grow onli keep exist valu

requir size and alloc num row num col num nz elem to reserv get format grow onli keep exist valu


elem type
cpu spars matrix elem type requir size and alloc size num row size num col size num nz elem to reserv matrix format matrix format grow onli keep exist valu

requir size num row num col matrix format grow onli

size new comp index size num col num row num col num row
realloc get size alloc num nz elem to reserv get size alloc num nz elem to reserv grow onli get comp index size new comp index size

realloc
alloc num row num col num nz elem to reserv grow onli keep exist valu


elem type
cpu spars matrix elem type requir size size num row size num col grow onli

requir size num row num col get format grow onli


elem type
cpu spars matrix elem type requir size size num row size num col matrix format matrix format grow onli

get format matrix format get num row num row get num col num col
resiz num row num col matrix format grow onli


elem type
cpu spars matrix elem type resiz size num row size num col size num nz elem to reserv 10000 grow onli

resiz num row num col num nz elem to reserv get format grow onli


elem type
cpu spars matrix elem type resiz size num row size num col size num nz elem to reserv matrix format matrix format grow onli

verifi resiz func

slice view offset
num row num row
num col num col
set num storag row num row
set num storag col num col
set format matrix format

size new comp index size num col num row num col num row
realloc get comp index size new comp index size

realloc
alloc num row num col num nz elem to reserv grow onli

reset



reset matrix
elem type
cpu spars matrix elem type reset

thi equival set note spars comp index size overload
get format matrix format matrix format spars csc get format matrix format matrix format spars csr
memset get comp index cpuspars index type get comp index size
set col idx
set block size
set block id shift


alpha beta
dens spars dens
elem type
cpu spars matrix elem type multipli and weight add elem type alpha cpu matrix elem type transpos a
cpu spars matrix elem type transpos b elem type beta cpu matrix elem type

is empti is empti
logic error multipli and weight add input matrix

transpos a get num col get num row
transpos a get num row get num col
transpos b get num col get num row
transpos b get num row get num col

convert size caus overflow



invalid argument cpu spars matrix multipli and weight add inner dimens must match


beta
requir size

verifi size resiz beta


beta

memset buffer elem type get num element

beta

pragma parallel
coord

beta



get format matrix format spars csc
implement

transpos a transpos b

size get num col

size start secondari index locat col locat
size secondari index locat
size start

size major index locat row locat
elem type buffer

size get num row

alpha




transpos a transpos b

size get num col

size start secondari index locat
size secondari index locat

size start

size major index locat
elem type buffer
size get num row

alpha




transpos a transpos b

implement



implement



dens spars spars
alpha
elem type
cpu spars matrix elem type multipli and add elem type alpha cpu matrix elem type transpos a
cpu spars matrix elem type transpos b cpu spars matrix elem type

own buffer
logic error cannot modifi sinc buffer manag extern

is empti is empti
logic error left multipli and add input matrix

size transpos a get num col get num row
size transpos a get num row get num col
size transpos b get num col get num row
size transpos b get num row get num col



convert size caus overflow



invalid argument cpu spars matrix multipli and add inner dimens must match


reset

transpos a transpos b

implement

transpos a transpos b

get format matrix format spars csc
implement

alloc enough memori
set format matrix format spars block col
requir size and alloc nz count

size size w2 id
size get num col
rang batch
size start secondari index locat
size secondari index locat

size start

size major index locat rang word
elem type buffer

first
w2 id find w2 id

size w2 id size
w2 id
get block id get block size
set block size get block size



first

size w2 id get num row
size get num row
rang hidden layer
first

buffer alpha



buffer alpha





get block size get size alloc

logic error spars matrix unexpectedli rang


transpos a transpos b

implement



implement



dens spars
elem type
cpu spars matrix elem type scale and add elem type alpha cpu spars matrix elem type cpu matrix elem type

is empti is empti

logic error scale and add input matrix


get num row get num row get num col get num col

invalid argument cpu spars matrix scale and add dimens must match


get format matrix format matrix format spars csc get format matrix format matrix format spars csr

size get format matrix format matrix format spars csc get num col get num row
size

size start secondari index locat
size secondari index locat
size start

size major index locat
elem type buffer
size get format matrix format matrix format spars csc
size get format matrix format matrix format spars csc
alpha



get format matrix format matrix format spars block col get format matrix format matrix format spars block row

size get block size

size get block id get block id shift
size get format matrix format matrix format spars block col get num row get num col
size start
size start start

elem type buffer

size get format matrix format matrix format spars block col start
size get format matrix format matrix format spars block col start
alpha





runtim error cpu spars matrix scale and add implement



elem type
cpu spars matrix elem type are equal cpu spars matrix elem type cpu spars matrix elem type elem type threshold

is empti is empti
logic error are equal input matric

get num row get num row get num col get num col


result

pragma parallel
coord

threshold

result




result


normal updat smooth gradient current gradient
todo comment seem wrong smooth gradient normal grad gradient valu function valu
elem type
cpu spars matrix elem type normal grad cpu matrix elem type elem type momentum

is empti

requir size get num row get num col
set valu

bugbug dimens ownbuff check

get format matrix format matrix format spars block col get format matrix format matrix format spars block row

size get block size

size get block id get block id shift
size get format matrix format matrix format spars block col get num row get num col
size start
size start start

elem type buffer
size get format matrix format matrix format spars block col start
size get format matrix format matrix format spars block col start
momentum momentum
buffer





runtim error cpu spars matrix normal grad support block spars format



updat smooth gradient current gradient
elem type
elem type cpu spars matrix elem type adagrad cpu matrix elem type need ave multipli

is empti get num col get num col get num row get num row

requir size get num row get num col
set valu

bugbug dimens ownbuff check

elem type ave multipli

elem type floor
get format matrix format matrix format spars csc get format matrix format matrix format spars csr

size get format matrix format matrix format spars csc get num col get num row
size

size start secondari index locat
size secondari index locat
size start

size major index locat
elem type buffer

size get format matrix format matrix format spars csc
size get format matrix format matrix format spars csc
elem type adenorm
adenorm
elem type sqrt floor adenorm
buffer
adenorm

need ave multipli
ave multipli



get format matrix format matrix format spars block col get format matrix format matrix format spars block row

size get format matrix format matrix format spars block col get num row get num col
size
get block size

size col or row get block id get block id shift


elem type buffer

size get format matrix format matrix format spars block col col or row
size get format matrix format matrix format spars block col col or row

elem type sqrt floor
buffer

need ave multipli
ave multipli




size nz count
need ave multipli
ave multipli




elem type
cpu spars matrix elem type cpu spars matrix elem type inplac truncat top elem type threshold

own buffer
logic error cannot modifi sinc buffer manag extern

nz count
elem type nz valu nz valu

pragma parallel
four unrol

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

handl remain stuff


nz valu threshold
nz valu threshold





elem type
cpu spars matrix elem type cpu spars matrix elem type inplac truncat bottom elem type threshold

own buffer
logic error cannot modifi sinc buffer manag extern

nz count
elem type nz valu nz valu

pragma parallel
four unrol

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

nz valu threshold
nz valu threshold

handl remain stuff


nz valu threshold
nz valu threshold





elem type
cpu spars matrix elem type cpu spars matrix elem type inplac truncat elem type threshold

own buffer
logic error cannot modifi sinc buffer manag extern

elem type loc threshold po threshold
elem type loc t hreshold neg loc threshold po

nz count
elem type nz valu nz valu

pragma parallel
four unrol

nz valu loc threshold po
nz valu loc threshold po
nz valu loc t hreshold neg
nz valu loc t hreshold neg

nz valu loc threshold po
nz valu loc threshold po
nz valu loc t hreshold neg
nz valu loc t hreshold neg

nz valu loc threshold po
nz valu loc threshold po
nz valu loc t hreshold neg
nz valu loc t hreshold neg

nz valu loc threshold po
nz valu loc threshold po
nz valu loc t hreshold neg
nz valu loc t hreshold neg

handl remain stuff


nz valu loc threshold po
nz valu loc threshold po
nz valu loc t hreshold neg
nz valu loc t hreshold neg





elem type
cpu spars matrix elem type cpu spars matrix elem type inplac soft threshold elem type threshold

own buffer
logic error cannot modifi sinc buffer manag extern

nz count
elem type nz valu nz valu

pragma parallel
four unrol

nz valu threshold
nz valu threshold
nz valu threshold
nz valu threshold

nz valu

nz valu threshold
nz valu threshold
nz valu threshold
nz valu threshold

nz valu

nz valu threshold
nz valu threshold
nz valu threshold
nz valu threshold

nz valu

nz valu threshold
nz valu threshold
nz valu threshold
nz valu threshold

nz valu

handl remain stuff


nz valu threshold
nz valu threshold
nz valu threshold
nz valu threshold

nz valu




elem type
elem type cpu spars matrix elem type frobeniu norm

is empti


elem type todo

nz count
elem type nz valu nz valu

four unrol
pragma parallel reduct


nz valu nz valu nz valu nz valu nz valu nz valu nz valu nz valu

handl remain stuff


nz valu nz valu


sqrt


element
elem type
elem type cpu spars matrix elem type sum of ab element

is empti


elem type

ifdef acml
elem type dasum nz count reinterpret cast data

elem type cbla dasum nz count reinterpret cast data




pragma warn suppress 4244
ifdef acml
sasum nz count reinterpret cast data

cbla sasum nz count reinterpret cast data




element
elem type
elem type cpu spars matrix elem type sum of element

is empti


elem type todo

nz count
elem type nz valu nz valu

four unrol
pragma parallel reduct


nz valu nz valu nz valu nz valu

handl remain stuff


nz valu





elem type
math file file stream cpu spars matrix elem type

own buffer
logic error cannot read manag extern matrix

stream get marker file marker begin section wstring bmat
size elsiz
stream elsiz
elem type elsiz
runtim error templat argument size match file
wstring matrix name

prepar header receiv read
size colnum rownum
format

read header inform
stream matrix name format colnum rownum

set format matrix format format
get format matrix format spars csc get format matrix format spars csr
implement

requir size and alloc rownum colnum



size compress size get format matrix format spars csc colnum rownum
elem type data buffer nz valu
cpuspars index type un compress index major index locat
cpuspars index type compress index secondari index locat

read spars matrix info
size

stream data buffer

size

stream un compress index

size compress size

stream compress index


stream get marker file marker end section wstring emat

stream


math file file stream cpu spars matrix
math file file stream cpu spars matrix

elem type
math file file stream cpu spars matrix elem type

get format matrix format spars csc get format matrix format spars csr
implement

stream put marker file marker begin section wstring bmat
stream elem type
stream wstring nnmatrix note need compat could potenti

size num row num col
size compress size secondari index count
format get format

stream format num col num row



elem type data buffer nz valu
cpuspars index type un compress index major index locat
cpuspars index type compress index secondari index locat

size

stream data buffer

size

stream un compress index

size compress size

stream compress index


stream put marker file marker end section wstring emat

stream


cpu spars matrix
cpu spars matrix

matrix back store quantiz matrix
explciitli instanti method need purpos
cpu spars matrix cpu spars matrix matrix format format size num row size num col size size
cpu spars matrix cpu spars matrix matrix format
cpu spars matrix cpu spars matrix cpu spars matrix
cpu spars matrix cpu spars matrix cpu spars matrix
cpu spars matrix cpu spars matrix cpu spars matrix move from
cpu spars matrix set valu size size
cpu spars matrix set valu cpu spars matrix
cpu spars matrix data
cpu spars matrix data
cpu spars matrix reset
cpu spars matrix requir size and alloc size size size
cpu spars matrix requir size and alloc size size size matrix format
cpu spars matrix cpu spars matrix
cpu spars matrix cpu spars matrix column slice size start column size num col
cpu matrix cpu spars matrix copi column slice to dens size start column size num col
cpu spars matrix cpu spars matrix cpu spars matrix deep copi from

cpu spars matrix cpu spars matrix matrix format size size size
cpu spars matrix cpu spars matrix


stdafx
quantiz matrix
column quantiz

microsoft cntk

elem type
quantiz matrix elem type quantiz matrix size num row size num col size nbit deviceid type devic id mem alloc alloc nullptr
num row num row num col num col num bit nbit alloc alloc

q col size quantiz column elem type quantiz column size num bit num row
q word num bit num bit num bit q word num bit

logic error quantiz nbit must divisor


alloc nullptr

quantiz data matrix q col size num col devic id



quantiz data matrix q col size num col alloc malloc q col size num col devic id matrix flag dont own buffer



elem type
quantiz matrix elem type quantiz matrix quantiz matrix elem type move from
quantiz data move from quantiz data alloc move from alloc num row move from num row num col move from num col num bit move from num bit q col size move from q col size

move from quantiz data nullptr
move from alloc nullptr


elem type
quantiz matrix elem type quantiz matrix elem type quantiz matrix elem type move from

move from

quantiz data move from quantiz data
alloc move from alloc
num row move from num row
num col move from num col
num bit move from num bit
q col size move from q col size

move from quantiz data nullptr
move from alloc nullptr




elem type
quantiz matrix elem type quantiz matrix size num row size num col size nbit matrix
num row num row num col num col num bit nbit quantiz data alloc nullptr

q col size quantiz column elem type quantiz column size num bit num row
q word num bit num bit num bit q word num bit

logic error quantiz nbit must divisor


make sure matrix enough space
quantiz data get num row q col size quantiz data get num col num col


elem type
quantiz matrix elem type quantiz matrix

nullptr quantiz data

use extern alloc let free back buffer matrix
alloc nullptr

quantiz data own buffer
alloc free quantiz data data


quantiz data
quantiz data nullptr



elem type
quantiz matrix elem type get devic id

quantiz data get devic id


elem type
size quantiz matrix elem type get size

quantiz data get num element


elem type
quantiz matrix elem type buffer

quantiz data data


elem type
quantiz matrix elem type quantiz matrix elem type column slice size start column size num col

matrix slice data matrix quantiz data column slice start column num col
quantiz matrix elem type get num row num col get num bit matrix slice data


elem type
quantiz matrix elem type print matrix name size row start size row end size col start size col end

get num row get num col

logic error print quantiz matrix


row end get num row col end get num col

invalid argument index rang


deviceid type orgdevic get devic id
current data locat cur locat quantiz data get current matrix locat
cur locat current data locat

quantiz data transfer to devic cpudevic


matrix name nullptr
fprintf stderr matrix name get num row get num col

fprintf stderr unnam matrix get num row get num col

fprintf stderr print rang row start row end col start col end

size col start col end

quantiz column elem type q col get quantiz column
fprintf stderr lower upper q col lower q col upper

fprintf stderr

size ld nbit valu quantiz elem type get num bit
size num q word per col column quantiz elem type q word per col get num row get num bit
size row start row end

size q word idx num q word per col
size offset in q word num q word per col
size col start col end

quantiz column elem type q col get quantiz column
column quantiz elem type ld nbit q col lower q col upper
q word q word q col bit q word idx

q word val q val
elem type
get num bit

elem type val0 val q unquant
elem type val1 val q unquant
q val q word offset in q word
valu quantiz elem type unquantize1 q val val0 val1



q word val bitmask val q quan rang end
q val q word offset in q word get num bit bitmask
val q unquant q val


fprintf stderr q val

fprintf stderr


cur locat current data locat

quantiz data transfer to devic orgdevic



explicit instanti
quantiz matrix
quantiz matrix

stdafx
matrix quantiz cpu

microsoft cntk

elem type
matrix quantiz cpu elem type matrix quantiz cpu
matrix quantiz impl elem type cpudevic



elem type
matrix quantiz cpu elem type quantiz async matrix elem type in matrix matrix elem type in residu quantiz matrix elem type out q matrix matrix elem type out residu zero threshold for1 bit

out q matrix
todo support transfer quantiz output quantiz matrix
out q matrix get devic id cpudevic

size n bit out q matrix get num bit

size n row in matrix get num row
size n col in matrix get num col

verifi differ matrix paramet match dimens
out q matrix get num row n row out q matrix get num col n col
in residu get num row n row in residu get num col n col
out residu get num row n row out residu get num col n col

size ld nbit valu quantiz elem type n bit
ifdef quantuseppl
concurr parallel size col size

size n col


qcol out q matrix get quantiz column
zero threshold for1 bit

explicit keyword need compil
column quantiz elem type comput rang stat colj in matrix data in residu data n row n bit qcol lower qcol upper



explicit keyword need compil
column quantiz elem type comput rang stat colj in matrix data in residu data n row n bit qcol lower qcol upper


column quantiz elem type ld nbit qcol lower qcol upper
zero threshold for1 bit

explicit keyword need compil
quantiz in matrix data in residu data n row qcol bit out residu data



explicit keyword need compil
quantiz in matrix data in residu data n row qcol bit out residu data


ifdef quantuseppl




elem type
matrix quantiz cpu elem type wait quantiz async done

todo current sinc actual quantiz synchron


unquant entir matrix call unquant column
elem type
matrix quantiz cpu elem type unquant async quantiz matrix elem type in q matrix matrix elem type out matrix

in q matrix hould
in q matrix get devic id cpudevic
out matrix get devic id cpudevic

size n bit in q matrix get num bit
size n row in q matrix get num row
size n col in q matrix get num col

verifi differ matrix paramet match dimens
out matrix get num row n row out matrix get num col n col

size ld nbit valu quantiz elem type n bit
ifdef quantuseppl
concurr parallel size col size

size n col


qcol in q matrix get quantiz column
column quantiz elem type ld nbit qcol lower qcol upper
unquant out matrix data n row qcol bit

ifdef quantuseppl




elem type
matrix quantiz cpu elem type wait unquant async done

todo current sinc actual quantiz synchron


instanti part make linker happi
matrix quantiz cpu
matrix quantiz cpu


copyright microsoft right reserv
licens licens licens file project root full licens inform

cpu matrix full implement matrix function side


stdafx
basic
file

cpu matrix
tensor op

stdexcept

math
random
chrono
except
thread
iostream
algorithm
ifdef win32
defin nominmax
window

cfloat


ifdef leakdetect



pragma warn disabl 4127 condit express constant elem type trigger
pragma warn disabl 4702 unreach code trigger unknown reason

ifdef acml
download acml acml5 ifort64
http develop tool develop core math librari acml acml download resourc
instal ifort64 variant compil intel compil librari
environ variabl acml path acml5 ifort64 folder instal acml
point folder file link librari
acml requir acml
defin
requir


ifdef
visual studio defin standard complex type properli
defin have lapack config
defin lapack complex structur

cbla
lapack


ifdef acml addit paramet differ matrix order
defin bla colmajor

defin bla colmajor matrix order col major


defin swap





defin idx2 c base index
microsoft cntk

math trace gpu memori alloc trace level

trace gpu memori alloc set trace level trace level

trace level trace level


trace gpu memori alloc is trace enabl

trace level


pragma region help enum definit
matrix order

row major major array
col major column major array


matrix transpos

no tran tran
tran tran
conj tran tran


sym matrix type

symmetr matrix store upper part
symmetr matrix store thelow part
full full popul
not symmetr symmetr matrix


matrix op side

left left multipli
right right multipli

pragma endregion help enum definit

pragma region constructor destructor

elem type
cpu matrix elem type cpu matrix

zero init


helper alloc elem type
instead initi debug
elem type
elem type new array size

elem type elem type
debug
elem type matrix elem type make nan line
size





elem type
cpu matrix elem type cpu matrix size num row size num col

zero init

num row num row
num col num col
set size alloc get num element

get num element

set buffer new array elem type get num element get num element elem type



elem type
cpu matrix elem type cpu matrix size num row size num col elem type p array size matrix flag

zero init
set valu num row num col p array matrix flag


copi deep copi
elem type
cpu matrix elem type cpu matrix cpu matrix elem type deep copi from

zero init
set valu deep copi from


assign deep copi
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type deep copi from

set valu deep copi from



move shallow copi
elem type
cpu matrix elem type cpu matrix cpu matrix elem type move from

shallow copi from move from
move from zero valu


move assign shallow copi
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type move from

move from

shallow copi from move from
releas pointer sourc destructor releas twice
move from zero valu




elem type
cpu matrix elem type cpu matrix

clear


elem type
cpu matrix elem type clear

zero init


pragma endregion constructor destructor

pragma region basic oper

elem type
cpu matrix elem type cpu matrix elem type column slice size start column size num col

start column num col num col
invalid argument slice rang sourc matrix start column num col num col

cpu matrix elem type slice

slice shallow copi from
slice num col num col
slice slice view offset slice view offset start column num row

slice


num col from matrix start column start column num col
todo column slice
elem type
cpu matrix elem type cpu matrix elem type assign column slice cpu matrix elem type from matrix size start column size num col

start column num col from matrix num col
invalid argument slice rang sourc matrix start column num col from matrix num col

clear

shallow copi from from matrix
num col num col
slice view offset from matrix slice view offset start column num row




start column start column num col from matrix
elem type
cpu matrix elem type cpu matrix elem type set column slice cpu matrix elem type from matrix size start column size num col

start column num col num col
logic error slice rang destin matrix
num col from matrix get num col
invalid argument slice rang sourc matrix num col from matrix get num col
num row from matrix num row
logic error row sourc destin matric match

memcpi data start column num row from matrix data num col num row elem type




elem type
cpu matrix elem type copi column stride cpu matrix elem type from matrix size num col size src num col stride size dest num col stride

num col src num col stride from matrix num col
logic error num col copi src num col stride specifi rang sourc matrix
num col dest num col stride num col
logic error num col copi src num col stride specifi rang destin matrix
num row from matrix num row
logic error row sourc destin matric match

num col num row



pragma parallel


four unrol
size

dest num col stride from matrix src num col stride
dest num col stride from matrix src num col stride
dest num col stride from matrix src num col stride
dest num col stride from matrix src num col stride


handl remain
size

dest num col stride from matrix src num col stride




column row start start index
elem type
cpu matrix elem type cpu matrix elem type assign to row slice valu of cpu matrix elem type size start index size num row

get num row num row
logic error add to row slice valu of get num row num row

start index num row get num row
logic error add to row slice valu of start index num row exce get num row

get num col get num col
logic error add to row slice valu of column match

get num col num row



pragma parallel


four unrol
size start row start index start row

start row
start row
start row
start row

handl remain stuff
size start row start index start row

start row






column assign num row start start index
elem type
cpu matrix elem type cpu matrix elem type assign row slice valu of cpu matrix elem type size start index size num row

start index num row get num row
logic error assign row slice valu of start index num row exce get num row

requir size num row get num col

get num col note open mp requir indic size
get num row

pragma parallel


memori copi might faster
memcpi data num row data start index elem type num row

four unrol
start row start index start row

start row
start row
start row
start row

handl remain stuff
start row start index start row

start row






slice start start index
elem type
cpu matrix elem type cpu matrix elem type add to row slice valu of cpu matrix elem type size start index size num row

is empti
logic error add to row slice valu of input matrix

get num row num row
logic error add to row slice valu of get num row num row

start index num row get num row
logic error add to row slice valu of start index num row exce get num row

get num col get num col
logic error add to row slice valu of column match

get num col num row



pragma parallel


four unrol
start row start index start row

start row
start row
start row
start row

handl remain stuff
start row start index start row

start row






column slice start start index
elem type
cpu matrix elem type cpu matrix elem type add with row slice valu of cpu matrix elem type size start index size num row

is empti
logic error add with row slice valu of input matrix

get num row num row
logic error add with row slice valu of get num row num row

start index num row get num row
logic error add with row slice valu of start index num row exce get num row

get num col get num col
logic error add with row slice valu of column match

get num col num row



pragma parallel


four unrol
start row start index start row

start row
start row
start row
start row

handl remain stuff
start row start index start row

start row






elem type
cpu matrix elem type cpu matrix elem type diagon

num row num col
logic error diagon call squar matrix row col num row num col

cpu matrix elem type diag num col



pragma parallel
num row

diag size


diag


elem type
cpu matrix elem type minu one at cpu matrix elem type size posit

posit get num element
data posit

runtim error minu one at posit matrix size


elem type
cpu matrix elem type cpu matrix elem type assign repeat of cpu matrix elem type size num row repeat size num col repeat


logic error assign repeat of doe support inplac

is empti
logic error assign repeat of matrix

requir size get num row num row repeat get num col num col repeat
get num col get num row


pragma parallel
num col repeat

num row repeat

col offset

col offset

row offset

four unrol
row offset

row offset col offset
row offset col offset
row offset col offset
row offset col offset

handl remain stuff
row offset

row offset col offset








elem type
cpu matrix elem type cpu matrix elem type add to row repeat valu of cpu matrix elem type size num repeat

is empti
logic error add to row repeat valu of input matrix

get num row get num row num repeat
logic error add to row repeat valu of get num row get num row num repeat

get num col get num row



pragma parallel


four unrol


num repeat







handl remain stuff


num repeat









elem type
cpu matrix elem type cpu matrix elem type assign posit and shift neg sampl cpu matrix elem type size po number size neg number size shift number


po number
neg number
shift number
implement


elem type
cpu matrix elem type cpu matrix elem type add fold posit and shift neg sampl cpu matrix elem type size po number size neg number size shift number


po number
neg number
shift number
implement


elem type
cpu matrix elem type cpu matrix elem type transpos

is empti
logic error transpos matrix

cpu matrix elem type
assign transpos of



elem type
cpu matrix elem type cpu matrix elem type assign transpos of cpu matrix elem type


logic error assign transpos of doe support inplac transpos

is empti
logic error assign transpos of matrix

requir size get num col get num row
get num col get num row



pragma parallel


four unrol







handl remain stuff









alpha beta
scale column vector anoth
usual special beta read uniniti
elem type
scale and add column elem type beta elem type elem type size num row elem type alpha

alpha rare full thing
size num row
beta alpha
beta use backprop
size num row

beta plain assign
memcpi elem type num row
alpha arbitrari beta also rare
size num row
beta


alpha beta
elem type
cpu matrix elem type cpu matrix elem type do gather column of elem type beta cpu matrix elem type cpu matrix elem type elem type alpha

get num row index dimension
invalid argument do gather column of must vector

beta
verifi size get num row get num col

resiz get num row get num col


pragma parallel todo depend circumst effici parallel row
column j out

j in f j out column need
j in f neg index mean

size size j in f
get num col
invalid argument do gather column of bound get num col
scale and add column beta j out get num row alpha





alpha beta
elem type
cpu matrix elem type cpu matrix elem type do scatter column of elem type beta cpu matrix elem type cpu matrix elem type elem type alpha

get num row index dimension
invalid argument do scatter column of must vector
get num col get num col
invalid argument do scatter column of must width input vector
get num row get num row
invalid argument do scatter column of output must height input vector



scale beta upfront
scatter sourc column target must scale beta keep ad
scale beta beta memset

pragma parallel todo depend circumst effici parallel row
column

j out f column copi
j out f neg index mean

size j out size j out f
j out get num col
invalid argument do gather column of bound
scale and add column beta elem type j out get num row alpha





elem type
cpu matrix elem type set valu elem type

is empti
logic error set valu matrix
is finit numer limit elem type integ isfinit
is finit

memset data elem type get num element



elem type buf ptr data
get num element
thread parallel suffici memori bound
oper set valu
setvalu thread
pragma parallel thread setvalu thread
four unrol


buf ptr
buf ptr
buf ptr
buf ptr

handl remain stuff


buf ptr




elem type
cpu matrix elem type mask column valu cpu matrix column mask elem type

get num col column mask get num col
runtim error matrix column mask must equal column


get num col get num row
pragma parallel


column mask


four unrol
size







handl remain
size






elem type
cpu matrix elem type set column elem type col pointer size

is empti
logic error set column matrix
col pointer



get num row
pragma parallel
four unrol


col pointer
col pointer
col pointer
col pointer

handl remain stuff


col pointer



elem type
cpu matrix elem type set column elem type size

is empti
logic error set column matrix


get num row
pragma parallel
four unrol







handl remain stuff






elem type
cpu matrix elem type set column cpu matrix elem type val mat size

is empti
logic error set column matrix
val mat get num row get num row val mat get num col


get num row
pragma parallel
four unrol


val mat
val mat
val mat
val mat

handl remain stuff


val mat



elem type
cpu matrix elem type set valu cpu matrix elem type deep copi from

deep copi from


set valu deep copi from get num row deep copi from get num col deep copi from data


elem type
cpu matrix elem type set valu size num row size num col elem type p array size matrix flag

p array nullptr num row num col
invalid argument invalid p array p array nullptr matrix size num row num col num row num col

set format matrix format dens
set comput devic id cpudevic

extern manag popul structur
matrix flag matrix flag dont own buffer

free previou alloc overwrit
buffer

num row num row
num col num col
set buffer p array get num element elem type
set size alloc get num element



requir size num row num col

is empti

matrix flag matrix format row major compat structur
memcpi data p array get num element elem type
need transpos

elem type buf ptr data

elem type

pragma parallel
column

ifdef acml
dcopi num row reinterpret cast p array num col reinterpret cast buf ptr locat column

cbla dcopi num row reinterpret cast p array num col reinterpret cast buf ptr locat column





pragma parallel
column


pragma warn suppress 4244
ifdef acml
scopi num row reinterpret cast p array num col reinterpret cast buf ptr locat column

cbla scopi num row reinterpret cast p array num col reinterpret cast buf ptr locat column









elem type
cpu matrix elem type set diagon valu elem type

get num row get num col
logic error set diagon valu num row num col agre


get num row
pragma parallel
four unrol







handl remain stuff






elem type
cpu matrix elem type set diagon valu cpu matrix elem type vector

is empti vector is empti
logic error set diagon valu matrix

get num row get num col
logic error set diagon valu num row num col agre

vector get num row vector get num col
logic error set diagon valu input vector must vector

vector get num element reduc simpl form
set diagon valu vector
vector get num row get num row
logic error set diagon valu input vector dimens agre




get num row
vector get num row vector

pragma parallel
four unrol


vector
vector
vector
vector

handl remain stuff


vector




pragma parallel
four unrol


vector
vector
vector
vector

handl remain stuff


vector





elem type
cpu matrix elem type set uniform random valu elem type elem type high seed

is empti
logic error set uniform random valu matrix

ifdef todo check avail linux
ranlux64 gener
gener seed seed time base seed time seed

random engin gener seed

uniform real distribut elem type high

elem type buf ptr data
get num element
four unrol


buf ptr gener
buf ptr gener
buf ptr gener
buf ptr gener

handl remain stuff


buf ptr gener



elem type
cpu matrix elem type set gaussian random valu elem type mean elem type sigma seed

sigma
invalid argument set uniform random valu sigma must posit valu

is empti
logic error set uniform random valu matrix


ifdef todo check avail linux
ranlux64 gener
gener seed seed time base seed time seed

random engin gener seed

normal distribut elem type mean sigma
pragma parallel thread
coord

gener



elem type
cpu matrix elem type add gaussian random valu elem type mean elem type sigma seed

sigma
invalid argument set uniform random valu sigma must posit valu

is empti
logic error set uniform random valu matrix


ifdef todo check avail linux
ranlux64 gener
gener seed seed time base seed time seed

random engin gener seed

normal distribut elem type mean sigma

get num row get num col


four unrol


gener
gener
gener
gener

handl remain stuff


gener




mask rate percentag valu mask similar dropout rate
scale valu scale valu left one unmask item
elem type
cpu matrix elem type set uniform random mask elem type mask rate elem type scale valu seed

is empti
logic error set uniform random valu matrix


ifdef todo check avail linux
ranlux64 gener
gener seed seed time base seed time seed

random engin gener seed time base seed time seed

uniform real distribut elem type

get num row get num col
elem type


four unrol


gener
mask rate scale valu
gener
mask rate scale valu
gener
mask rate scale valu
gener
mask rate scale valu

handl remain stuff


gener
mask rate scale valu




elem type
elem type cpu matrix elem type adagrad cpu matrix elem type gradient need ave multipli

elem type ave multipli

is empti gradient get num col get num col gradient get num row get num row

requir size gradient get num row gradient get num col
set valu


get num row gradient get num row get num col gradient get num col

elem type data gradient data
size get num element

elem type floor
elem type

disabl ave multip need ad atom howev seem result incorrect even atom critic use
pragma parallel
four unrol






sqrt floor
sqrt floor
sqrt floor
sqrt floor






need ave multipli

ave multipli



last element




sqrt floor


need ave multipli

ave multipli



need ave multipli
ave multipli




elem type
cpu matrix elem type fs adagrad cpu matrix elem type gradient
cpu matrix elem type function valu
elem type learn rate per sampl
elem type momentum
elem type ada weight
elem type ada mul

size num col need gradient get num col

is empti get num col num col need

requir size gradient get num row num col need
set valu


get num row gradient get num row get num col num col need

size gradient get num element
elem type grad gradient data
elem type smooth ada data
elem type smooth mom data
elem type function valu data
pragma parallel
todo unrol time better perform leverag vector


elem type grad
elem type ada sqr ada weight smooth ada ada weight
smooth ada ada sqr
ada sqr

elem type sqrt ada sqr
elem type ada mul elem type






momentum

momentum smooth mom momentum
smooth mom


learn rate per sampl




elem type
elem type cpu matrix elem type rm prop cpu matrix elem type gradient
elem type gamma
elem type
elem type
elem type
elem type
need ave multipli

elem type floor

size gradient get num element
elem type curr grad gradient data

is empti get num col gradient get num col

requir size gradient get num row gradient get num col
set valu

elem type avar data accumul varianc scale
elem type step data current step size

initi move averag gradient squar

avar curr grad curr grad

initi start step size

step elem type


elem type avar data accumul varianc scale
elem type sign data sign previou gradient
elem type step data current step size

get num row gradient get num row get num col gradient get num col

elem type minu gamma elem type gamma














avar gamma avar minu gamma curr grad curr grad
grad sign zero
grad sign elem type curr grad curr grad elem type

sign contain three consecut grad sign
sign sign grad sign

sign


step step


step step


curr grad step sqrt avar floor


elem type ave multipli


avar gamma avar minu gamma curr grad curr grad
grad sign elem type curr grad curr grad elem type

sign grad sign
step step

step step

step sqrt avar floor
curr grad
sign elem type grad sign

need ave multipli
ave multipli


need ave multipli
ave multipli




elem type
cpu matrix elem type reshap size num row size num col

num row num col get num element
num row num col get num element
invalid argument reshap total element match

num row num row
num col num col


requir size test matrix right size resiz matrix thi avoid verifi resiz check alreadi right size
elem type
cpu matrix elem type requir size size num row size num col grow onli

get num row num row get num col num col
resiz num row num col grow onli


resiz chang matrix size
thi cheap matrix size chang
current content preserv
bugbug there code reli zero initi without subtl variat output that wrong initi q na n fail
grow onli resiz realloc memori current memori larg enough shrink
memori memori cannot alloc still shrink reshap
elem type
cpu matrix elem type resiz size num row size num col grow onli

verifi resiz func

get num row num row get num col num col


size num element num row num col
num element get size alloc grow alloc
grow onli num element get size alloc shrink alloc grow onli

realloc buffer
elem type p array nullptr
num element

p array new array elem type num element

success updat
buffer

set buffer p array num element elem type
set size alloc num element


success
num row num row
num col num col


alloc calle delet caller
todo chang vector instead
elem type
elem type cpu matrix elem type copi to array

size num element get num element
num element

elem type array copi to new array elem type num element
memcpi array copi to data elem type num element
array copi to



nullptr



memori alloc calle enough need delet caller done
element copi
elem type
size cpu matrix elem type copi to array elem type array copi to size current array size

size num element get num element

num element current array size

array copi to
array copi to new array elem type num element
current array size num element


num element

memcpi array copi to data elem type num element


num element


elem type
cpu matrix elem type copi section size num row size num col elem type size col stride

review alexeyk current use implement possibl
runtim error implement


elem type
size cpu matrix elem type locat column size

get num col
num row matrix column wise storag


elem type
size cpu matrix elem type locat element size size

num row
locat column matrix column wise storag


pragma endregion basic oper

pragma region member bla function

elem type
cpu matrix elem type cpu matrix elem type elem type alpha

assign sum of alpha


elem type
cpu matrix elem type cpu matrix elem type elem type alpha

cpu matrix elem type get num row get num col
assign sum of alpha



elem type
cpu matrix elem type cpu matrix elem type assign sum of elem type alpha cpu matrix elem type

is empti
logic error assign sum of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


alpha
alpha
alpha
alpha

handl remain stuff


alpha






dimens
column vector column
vector row
scalar element
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type

get num element


scale and add




dimens output
column vector column
vector row
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type

get num element

cpu matrix elem type



get num element

cpu matrix elem type





cpu matrix elem type implement introduc copi overhead make resu code





elem type
cpu matrix elem type cpu matrix elem type assign sum of cpu matrix elem type cpu matrix elem type

get num element

set valu




set valu





elem type
cpu matrix elem type cpu matrix elem type elem type alpha

assign differ of alpha


elem type
cpu matrix elem type cpu matrix elem type elem type alpha

cpu matrix elem type get num row get num col
assign differ of alpha



elem type
cpu matrix elem type cpu matrix elem type assign differ of elem type alpha cpu matrix elem type



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


alpha
alpha
alpha
alpha

handl remain stuff


alpha






elem type
cpu matrix elem type cpu matrix elem type assign differ of cpu matrix elem type elem type alpha



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


alpha
alpha
alpha
alpha

handl remain stuff


alpha





dimens
column vector minu column
vector minu row
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type

scale and add




dimens output
column vector minu column
vector minu row
elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type

cpu matrix elem type implement introduc copi overhead make resu code




elem type
cpu matrix elem type cpu matrix elem type assign differ of cpu matrix elem type cpu matrix elem type



requir size get num row get num col
set valu





elem type
cpu matrix elem type cpu matrix elem type elem type alpha

scale alpha



elem type
cpu matrix elem type cpu matrix elem type elem type alpha

cpu matrix elem type get num row get num col
scale alpha



elem type
cpu matrix elem type cpu matrix elem type assign product of elem type alpha cpu matrix elem type

scale alpha




elem type
cpu matrix elem type cpu matrix elem type assign product of cpu matrix elem type transpos a cpu matrix elem type transpos b

get num element

transpos b
assign transpos of


get num element

transpos a
assign transpos of



multipli transpos a transpos b




elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type


get num element

cpu matrix elem type
assign product of


get num element

cpu matrix elem type
assign product of




cpu matrix elem type
multipli




elem type
cpu matrix elem type cpu matrix elem type elem type alpha

alpha



elem type
cpu matrix elem type cpu matrix elem type elem type alpha

alpha


element wise power
elem type
cpu matrix elem type cpu matrix elem type elem type alpha


element wise power alpha



element wise power
elem type
cpu matrix elem type cpu matrix elem type elem type alpha

cpu matrix elem type get num row get num col
element wise power alpha



elem type
cpu matrix elem type cpu matrix elem type assign element power of cpu matrix elem type elem type power

element wise power power



cannot
elem type
cpu matrix elem type cpu matrix elem type element multipli with cpu matrix elem type

assign element product of


cannot
elem type
cpu matrix elem type cpu matrix elem type element divid by cpu matrix elem type

assign element divis of



elem type
cpu matrix elem type cpu matrix elem type assign element product of cpu matrix elem type cpu matrix elem type

is empti is empti
logic error assign element product of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument assign element product of input matrix dimens match



requir size get num row get num col

get num row get num col
pragma parallel


four unrol







handl remain stuff









elem type
cpu matrix elem type cpu matrix elem type add element product of cpu matrix elem type cpu matrix elem type

is empti is empti
logic error add element product of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument add element product of input matrix dimens match

get num row get num row get num col get num col
invalid argument add element product of input matrix dimens match



get num row get num col
pragma parallel


four unrol







handl remain stuff










todo thi clip divisor small valu realli would want
elem type
cpu matrix elem type cpu matrix elem type assign element divis of cpu matrix elem type cpu matrix elem type

is empti is empti
logic error assign element divis of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument assign element divis of input matrix dimens match



requir size get num row get num col

elem type small valu invers

pragma parallel
coord

elem type
small valu
small valu
small valu
small valu







elem type
cpu matrix elem type cpu matrix elem type column element multipli with cpu matrix elem type

is empti is empti
logic error column element multipli with matrix

get num row get num row get num col
get num row get num row get num col
invalid argument column element multipli with input matrix vector match row



get num row get num col
pragma parallel


four unrol







handl remain stuff









elem type
cpu matrix elem type cpu matrix elem type row element multipli with cpu matrix elem type

is empti is empti
logic error row element multipli with matrix

get num row get num col get num col
get num row get num col get num col
invalid argument row element multipli with input matrix vector match column



get num row get num col
pragma parallel


elem type
four unrol







handl remain stuff









elem type
cpu matrix elem type cpu matrix elem type row element divid by cpu matrix elem type

is empti is empti
logic error row element divid by matrix

get num row get num col get num col
get num row get num col get num col
invalid argument row element divid by input matrix vector match column



get num row get num col
pragma parallel


elem type
invers
invers
invers
invers

four unrol







handl remain stuff








elem type
cpu matrix elem type cpu matrix elem type column element divid by cpu matrix elem type

is empti is empti
logic error column element divid by matrix

get num row get num row get num col
get num row get num row get num col
invalid argument column element divid by input matrix vector match row



get num row get num col

elem type small valu invers
pragma parallel




elem type
small valu
small valu
small valu
small valu









elem type
cpu matrix elem type cpu matrix elem type element invers

assign element invers of


elem type
cpu matrix elem type cpu matrix elem type assign element invers of cpu matrix elem type

elem type small valu invers

is empti
logic error assign element invers of matrix



requir size get num row get num col

pragma parallel
coord

small valu
small valu
small valu
small valu







sigmoid element wise
elem type
cpu matrix elem type cpu matrix elem type inplac sigmoid

assign sigmoid of


elem type
cpu matrix elem type cpu matrix elem type assign sigmoid of cpu matrix elem type

is empti
logic error assign sigmoid of matrix



requir size get num row get num col

pragma parallel
coord





elem type







elem type
cpu matrix elem type cpu matrix elem type inplac linear rectifi deriv

assign linear rectifi deriv of


elem type
cpu matrix elem type cpu matrix elem type assign linear rectifi deriv of cpu matrix elem type

is empti
logic error assign linear rectifi deriv of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol







handl remain stuff









elem type
cpu matrix elem type cpu matrix elem type inplac sigmoid deriv

assign sigmoid deriv of


elem type
cpu matrix elem type cpu matrix elem type assign sigmoid deriv of cpu matrix elem type

is empti
logic error assign sigmoid deriv of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


elem type


elem type


elem type


elem type


handl remain stuff


elem type







tanh element wise
elem type
cpu matrix elem type cpu matrix elem type inplac tanh

assign tanh of


elem type
cpu matrix elem type cpu matrix elem type assign tanh of cpu matrix elem type

is empti
logic error assign tanh of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


tanh
tanh
tanh
tanh

handl remain stuff


tanh






softmax element wise
elem type
cpu matrix elem type cpu matrix elem type inplac log softmax is col wise

assign log softmax of is col wise


elem type
cpu matrix elem type cpu matrix elem type assign log softmax of cpu matrix elem type is col wise

is empti
logic error assign log softmax of matrix



requir size get num row get num col

is col wise

pragma parallel
column

need extract appli avoid overflow
elem type max v

max v max v

elem type

max v







pragma parallel


need extract appli avoid overflow
elem type max v
column
max v max v

elem type
column
max v

column







hardmax
element
elem type
cpu matrix elem type cpu matrix elem type inplac hardmax is col wise

assign hardmax of is col wise


elem type
cpu matrix elem type cpu matrix elem type assign hardmax of cpu matrix elem type is col wise

is empti
logic error assign hardmax of matrix



requir size get num row get num col

is col wise

pragma parallel
column

need extract
elem type max v
max i


max v

max v
max i




max i




pragma parallel


need extract
elem type max v
max j
column

max v

max v
max j



column
max j






sqrt element wise
elem type
cpu matrix elem type cpu matrix elem type inplac sqrt

assign sqrt of


prevent neg valu caus float oper forc input
howev hide problem caller
elem type
cpu matrix elem type cpu matrix elem type assign sqrt of cpu matrix elem type

is empti
logic error assign sqrt of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol


sqrt elem type
sqrt elem type
sqrt elem type
sqrt elem type

remain


sqrt elem type






element wise
elem type
cpu matrix elem type cpu matrix elem type inplac exp

assign exp of


elem type
cpu matrix elem type cpu matrix elem type assign exp of cpu matrix elem type

is empti
logic error assign exp of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol







handl remain stuff









element wise
elem type
cpu matrix elem type cpu matrix elem type inplac ab

assign ab of


elem type
cpu matrix elem type cpu matrix elem type assign ab of cpu matrix elem type

is empti
logic error assign ab of matrix



requir size get num row get num col

get num row get num col
pragma parallel


four unrol







handl remain stuff









element wise
elem type
cpu matrix elem type cpu matrix elem type inplac log

assign log of


element wise
elem type
cpu matrix elem type cpu matrix elem type inplac log10

assign log10 of


elem type
cpu matrix elem type cpu matrix elem type assign log of cpu matrix elem type

is empti
logic error assign log of matrix



requir size get num row get num col

pragma parallel
coord

elem type











elem type
cpu matrix elem type cpu matrix elem type assign log10 of cpu matrix elem type

is empti
logic error assign log of matrix



requir size get num row get num col

pragma parallel
coord

elem type

logic error assign log of appli number larger


log10


log10





element wise
elem type
cpu matrix elem type cpu matrix elem type inplac cosin

assign cosin of


elem type
cpu matrix elem type cpu matrix elem type assign cosin of cpu matrix elem type

is empti
logic error assign cosin of matrix



requir size get num row get num col

pragma parallel
coord

elem type






element wise
elem type
cpu matrix elem type cpu matrix elem type inplac neg sine

assign neg sine of


elem type
cpu matrix elem type cpu matrix elem type assign neg sine of cpu matrix elem type

is empti
logic error assign cosin of matrix



requir size get num row get num col

pragma parallel
coord

elem type






threshold truncat threshold
elem type
cpu matrix elem type cpu matrix elem type inplac truncat bottom elem type threshold

is empti
logic error inplac truncat bottom matrix



get num row get num col
pragma parallel


four unrol


threshold
threshold

threshold
threshold

threshold
threshold

threshold
threshold

handl remain stuff


threshold
threshold






elem type
cpu matrix elem type cpu matrix elem type inplac truncat elem type threshold

is empti
logic error inplac truncat matrix


elem type loc threshold po threshold
elem type loc t hreshold neg loc threshold po

get num row get num col
pragma parallel


four unrol


loc threshold po
loc threshold po
loc t hreshold neg
loc t hreshold neg

loc threshold po
loc threshold po
loc t hreshold neg
loc t hreshold neg

loc threshold po
loc threshold po
loc t hreshold neg
loc t hreshold neg

loc threshold po
loc threshold po
loc t hreshold neg
loc t hreshold neg

handl remain stuff


loc threshold po
loc threshold po
loc t hreshold neg
loc t hreshold neg






threshold threshold threshold threshold otherwis
elem type
cpu matrix elem type cpu matrix elem type inplac soft threshold elem type threshold

is empti
logic error inplac truncat matrix

get num element

elem type buf ptr data
pragma parallel
four unrol

buf ptr threshold
buf ptr threshold
buf ptr threshold
buf ptr threshold

buf ptr

buf ptr threshold
buf ptr threshold
buf ptr threshold
buf ptr threshold

buf ptr

buf ptr threshold
buf ptr threshold
buf ptr threshold
buf ptr threshold

buf ptr

buf ptr threshold
buf ptr threshold
buf ptr threshold
buf ptr threshold

buf ptr

handl remain stuff


buf ptr threshold
buf ptr threshold
buf ptr threshold
buf ptr threshold

buf ptr





threshold truncat threshold
elem type
cpu matrix elem type cpu matrix elem type assign truncat bottom of cpu matrix elem type elem type threshold

is empti
logic error assign truncat bottom of matrix



requir size get num row get num col

pragma parallel
coord

threshold
threshold







threshold truncat threshold
elem type
cpu matrix elem type cpu matrix elem type inplac truncat top elem type threshold

is empti
logic error inplac truncat top matrix



pragma parallel
coord

threshold
threshold





threshold truncat threshold
elem type
cpu matrix elem type cpu matrix elem type assign truncat top of cpu matrix elem type elem type threshold

is empti
logic error assign truncat top of matrix



requir size get num row get num col

pragma parallel
coord

threshold
threshold






threshold truncat threshold

elem type
cpu matrix elem type cpu matrix elem type set to zero if ab less than elem type threshold

is empti
logic error set to zero if ab less than matrix



pragma parallel
coord

threshold






element
elem type
elem type cpu matrix elem type sum of ab element

is empti
logic error sum of ab element matrix

elem type

ifdef acml
elem type dasum get num element reinterpret cast data

elem type cbla dasum get num element reinterpret cast data




pragma warn suppress 4244
ifdef acml
sasum get num element reinterpret cast data

cbla sasum get num element reinterpret cast data




element
elem type
elem type cpu matrix elem type sum of element

is empti
logic error sum of element matrix

elem type
get num element note open mp requir indic size

elem type buf ptr data
four unrol
pragma parallel reduct


buf ptr buf ptr buf ptr buf ptr

handl remain stuff


buf ptr





elem type
cpu matrix elem type cpu matrix elem type assign sum of element cpu matrix elem type

is empti
logic error assign sum of element matrix


requir size
sum of element




elem type
cpu matrix elem type is equal to cpu matrix elem type elem type threshold

are equal threshold


elem type
cpu matrix elem type vector sum cpu matrix elem type cpu matrix elem type is col wise

is empti
logic error vector sum input matrix

get num row
get num col

convert size caus overflow

is col wise wise

requir size

pragma parallel
column

elem type


pragma atom







requir size

pragma parallel


elem type
column

pragma atom







elem type
cpu matrix elem type vector norm1 cpu matrix elem type is col wise

is empti
logic error vector norm1 matrix



get num row
get num col

convert size caus overflow

is col wise wise

requir size

pragma parallel
column

elem type


pragma atom







requir size

pragma parallel


elem type
column

pragma atom







elem type
cpu matrix elem type cpu matrix elem type assign vector norm1 of cpu matrix elem type is col wise

vector norm1 is col wise



elem type
cpu matrix elem type vector norm2 cpu matrix elem type is col wise

is empti
logic error vector norm2 matrix



get num row
get num col

convert size caus overflow

elem type buf ptr data
is col wise wise

requir size

elem type

pragma parallel
column

ifdef acml
elem type dnrm2 reinterpret cast buf ptr locat column

elem type cbla dnrm2 reinterpret cast buf ptr locat column





pragma parallel
column

pragma warn suppress 4244
ifdef acml
snrm2 reinterpret cast buf ptr locat column

cbla snrm2 reinterpret cast buf ptr locat column






requir size

elem type

pragma parallel


ifdef acml
dnrm2 reinterpret cast buf ptr

cbla dnrm2 reinterpret cast buf ptr





pragma parallel


pragma warn suppress 4244
ifdef acml
snrm2 reinterpret cast buf ptr

cbla snrm2 reinterpret cast buf ptr






elem type
cpu matrix elem type cpu matrix elem type assign vector norm2 of cpu matrix elem type is col wise

vector norm2 is col wise



elem type
cpu matrix elem type vector norm inf cpu matrix elem type is col wise

is empti
logic error vector norm inf matrix



get num row
get num col

convert size caus overflow

is col wise wise

requir size

pragma parallel
column

elem type









requir size

pragma parallel


elem type
column








elem type
cpu matrix elem type cpu matrix elem type assign vector norm inf of cpu matrix elem type is col wise

vector norm inf is col wise



elem type
cpu matrix elem type cpu matrix elem type assign inner product of cpu matrix elem type cpu matrix elem type is col wise

inner product is col wise



column wise crossproduct
elem type
cpu matrix elem type cpu matrix elem type assign khatri rao product of cpu matrix elem type cpu matrix elem type

is empti is empti
logic error assign khatri rao product of matrix

col get num col
col get num col
col get num col
invalid argument get num col get num col

row a get num row
row b get num row
requir size row a row b col

ifdef intel compil todo check
pragma simd statement

pragma parallel
col


row b

row a









column wise reshap product use comput khatri rao product gradient
reshap column k1x k2
column transpos time column frame
output frame matrix
column tranpos time column frame output frame
elem type
cpu matrix elem type cpu matrix elem type add column reshap product of cpu matrix elem type cpu matrix elem type transpos a column

is empti is empti
logic error add column reshap product of matrix

col get num col
col get num col
col get num col
invalid argument add column reshap product of get num col get num col

row a get num row
row b get num row

row a row b
invalid argument add column reshap product of row multipl

row c row a row b
row c get num row col get num col
invalid argument add column reshap product of thi matrix right size



transpos a column

find nrow ncol reshap
nrow row b
ncol row c

ifdef intel compil todo check
pragma simd statement

pragma parallel
column

size
size ncol transpos

elem type
size nrow










size ncol row b
size nrow row c

ifdef intel compil todo check
pragma simd statement

pragma parallel
column

size
size ncol

size nrow











elem type
cpu matrix elem type cpu matrix elem type add with scale of elem type alpha cpu matrix elem type

scale and add alpha



elem type
elem type cpu matrix elem type frobeniu norm

is empti
logic error frobeniu norm matrix

elem type

get num element

elem type buf ptr data
four unrol
pragma parallel reduct


buf ptr buf ptr buf ptr buf ptr buf ptr buf ptr buf ptr buf ptr

handl remain stuff


buf ptr buf ptr


sqrt


elem type
cpu matrix elem type cpu matrix elem type assign frobeniu norm of cpu matrix elem type

is empti
logic error assign frobeniu norm of matrix


requir size
frobeniu norm




elem type
elem type cpu matrix elem type matrix norm inf

is empti
logic error matrix norm inf matrix



elem type
pragma parallel
coord

pragma critic







elem type
elem type cpu matrix elem type matrix norm0

is empti
logic error matrix norm0 matrix



elem type
pragma parallel
coord



pragma critic








elem type
elem type cpu matrix elem type matrix norm1

is empti
logic error matrix norm1 matrix



elem type
pragma parallel reduct
coord






elem type
cpu matrix elem type cpu matrix elem type assign sign of cpu matrix elem type

is empti
logic error assign sign of matrix



requir size get num row get num col

pragma parallel
column



elem type
isnan
elem type elem type elem type elem type








elem type
cpu matrix elem type cpu matrix elem type add sign of cpu matrix elem type

is empti
logic error add sign of matrix



requir size get num row get num col

pragma parallel
column



elem type
isnan
elem type elem type elem type elem type







decid cpu matrix elem type max index instead integ vector result use addit calcul
elem type
cpu matrix elem type vector max cpu matrix elem type max index cpu matrix elem type max valu is col wise top k

is empti
logic error vector max matrix


get num row
get num col
top k

convert size caus overflow

is col wise wise

max valu requir size top k
max index requir size top k

top k

pragma parallel


elem type
size index




index



max valu
max index elem type index




vector indic

gener indic indic




elem type cur val data
elem type cur idx max index data
elem type cur max max valu data
icol icol icol cur val cur idx top k cur max top k

partial sort descend order
element indic indic top k indic
cur val

cur val cur val

review alexeyk follow produc warn secur warn instead
transform indic indic top k cur idx cast elem type
top k

cur idx cast elem type indic
cur max cur val indic






top k
runtim error wise top k support

max valu requir size
max index requir size

pragma parallel


elem type
size index
column



index



max valu
max index elem type index




elem type
cpu matrix elem type vector min cpu matrix elem type min index cpu matrix elem type min valu is col wise

is empti
logic error vector min matrix


get num row
get num col

convert size caus overflow

is col wise wise

min valu requir size
min index requir size

pragma parallel


elem type
size index




index



min valu
min index elem type index




min valu requir size
min index requir size

pragma parallel


elem type
size index
column



index



min valu
min index elem type index




elem type
cpu matrix elem type cpu matrix elem type assign num of diff cpu matrix elem type cpu matrix elem type search in col

get num col get num col
invalid argument assign num of diff must column
search in col get num row get num row
invalid argument assign num of diff must row

elem type
search in col

coord






size crow get num row
elem type cur col data
size icol icol get num col icol cur col crow

find cur col cur col crow icol
cur col crow




requir size result element





pragma endregion member bla function

pragma region other helper function

print rang

skip begin skip end
skip begin split
size
size skip begin
size skip end
size
is empti

exampl


print rang ptrdiff first ptrdiff last size total

first last

size first
size last
total allow mean
total
skip begin
skip end

first last


skip begin size last
skip end size total first
skip end skip begin
skip begin skip end total
total

combin ever interest implement
logic error print bound must either posit neg



neg rang corner print name first last row col
elem type
cpu matrix elem type print matrix name ptrdiff row first ptrdiff row last ptrdiff col first ptrdiff col last

fprintf stderr
matrix name nullptr
fprintf stderr matrix name
fprintf stderr get num row get num col
row first col first size row last get num row size col last get num col
fprintf stderr row first row last col first col last
fprintf stderr

is empti

fprintf stderr



print rang row rang row first row last get num row
print rang col rang col first col last get num col

row rang is empti col rang is empti

fprintf stderr




row rang
fprintf stderr
size row rang row rang

row rang skip begin insert block

fprintf stderr
row rang skip end

col rang line start
fprintf stderr
size col rang col rang

col rang skip begin

fprintf stderr
col rang skip end

fprintf stderr

col rang get num col line
fprintf stderr
fprintf stderr

row rang get num row
fprintf stderr


elem type
cpu matrix elem type print matrix name nullptr

print matrix name get num row get num col


file
matrix name use verifi correct matrix read
elem type
cpu matrix elem type read from file file matrix name

runtim error implement


matrix name use verifi correct matrix read
elem type
cpu matrix elem type write to file file matrix name

runtim error implement


assum column input sampl each sampl store channel
elem type
cpu matrix elem type cpu matrix elem type assign pack convolut input cpu matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad

vertic subsampl kernel height horizont subsampl kernel width

size pack input row kernel width kernel height input channel
size pack input col per sampl output width output height output size channel
size input dim input width input height input channel
size small batch size input sub batch get num col
input height time channel input height input channel
requir size pack input row pack input col per sampl small batch size
zero pad
set valu elem type

half kernel width kernel width
half kernel height kernel height

pragma parallel input element copi mani place
sampl sampl small batch size sampl

input dim

elem rowpo channel channel input height input channel
elem colpo sampl

input height time channel input col
input height time channel channel input row input channel
input channel input row
input channel channel


zero pad

elem type ceil elem type kernel height half kernel height elem type vertic subsampl first wrow
half kernel height vertic subsampl first posx in kernel
elem type ceil elem type kernel width half kernel width elem type horizont subsampl first wcol
half kernel width horizont subsampl first posi in kernel



elem type ceil elem type kernel height elem type vertic subsampl first wrow
vertic subsampl first posx in kernel
elem type ceil elem type kernel width elem type horizont subsampl first wcol
horizont subsampl first posi in kernel


kernel height kernel width

pack elem rowpo channel posx in kernel posi in kernel channel kernel width kernel height posx in kernel posi in kernel kernel height
pack elem colpo sampl wrow wcol sampl pack input col per sampl output height wcol wrow

elem type current input valu input sub batch sampl
pack col base sampl pack input col per sampl output height
wcol posi in kernel wcol output width posi in kernel wcol posi in kernel horizont subsampl

pack row base kernel width kernel height posi in kernel kernel height
wrow posx in kernel wrow output height posx in kernel wrow posx in kernel vertic subsampl

pack row pack row base posx in kernel
pack col pack col base wrow
pack row pack col current input valu

pack col base output height






assum column input sampl each sampl store channel
elem type
cpu matrix elem type cpu matrix elem type unpack convolut input cpu matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad

vertic subsampl kernel height horizont subsampl kernel width

size pack input col per sampl output width output height output size channel
size input dim input width input height input channel
size small batch size input sub batch get num col
input height time channel input height input channel

half kernel width kernel width
half kernel height kernel height

pragma parallel input element copi mani place
sampl sampl small batch size sampl

input dim

elem rowpo channel channel input height input channel
elem colpo sampl

input height time channel input col
input height time channel channel input row input channel
input channel input row
input channel channel


zero pad

elem type ceil elem type kernel height half kernel height elem type vertic subsampl first wrow
half kernel height vertic subsampl first posx in kernel
elem type ceil elem type kernel width half kernel width elem type horizont subsampl first wcol
half kernel width horizont subsampl first posi in kernel



elem type ceil elem type kernel height elem type vertic subsampl first wrow
vertic subsampl first posx in kernel
elem type ceil elem type kernel width elem type horizont subsampl first wcol
horizont subsampl first posi in kernel


kernel height kernel width

pack elem rowpo channel posx in kernel posi in kernel channel kernel width kernel height posx in kernel posi in kernel kernel height
pack elem colpo sampl wrow wcol sampl pack input col per sampl output height wcol wrow

elem type current input valu input sub batch sampl
pack col base sampl pack input col per sampl output height
wcol posi in kernel wcol output width posi in kernel wcol posi in kernel horizont subsampl

pack row base kernel width kernel height posi in kernel kernel height
wrow posx in kernel wrow output height posx in kernel wrow posx in kernel vertic subsampl

pack row pack row base posx in kernel
pack col pack col base wrow
current input valu pack row pack col

pack col base output height

input sub batch sampl current input valu



input sub batch


assum column input sampl each sampl store
elem type
cpu matrix elem type cpu matrix elem type assign max pool result cpu matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

input height time channel input height channel
output height time channel output height channel
size batch size input batch get num col
requir size output size per sampl batch size

elem rowpo channel channel input height channel
elem colpo sampl

elem rowpo channel wrow wcol channel wrow wcol output height channel
elem colpo sampl

pragma parallel
sampl sampl batch size sampl

output index within sampl output index within sampl output size per sampl output index within sampl

output index within sampl output height time channel wcol
output index within sampl output height time channel channel wrow channel
channel wrow
channel channel

elem type max val
elem type min val
row in window base vertic subsampl horizont subsampl input height channel
col in window col in window window width col in window

row in input row in window base col in window input height time channel
row in window row in window window height row in window

elem type input batch row in input sampl row in window channel
max val max val
min val min val
row in input channel



output index within sampl sampl max val






elem type
cpu matrix elem type cpu matrix elem type add max pool gradient cpu matrix elem type output gradient batch cpu matrix elem type input batch cpu matrix elem type output batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

size batch size input batch get num col
input height time channel input height channel
output height time channel output height channel

elem rowpo channel channel input height channel
elem colpo sampl

elem rowpo channel wrow wcol channel wrow wcol output height channel
elem colpo sampl

pragma parallel
sampl sampl batch size sampl

input index within sampl input index within sampl input size per sampl input index within sampl

input index within sampl input height time channel input
input index within sampl input height time channel channel chanel
channel input
channel channel

start out x elem type ceil elem type window height elem type vertic subsampl inclus start
end out x vertic subsampl output height vertic subsampl output height inclus
start out y elem type ceil elem type window width elem type horizont subsampl inclus start
end out y horizont subsampl output width horizont subsampl output width inclus

elem type input valu input batch input index within sampl sampl
out y start out y out y end out y out y

out x start out x out x end out x out x

output index out y output height time channel out x channel
input valu output batch output index sampl
input index within sampl sampl output gradient batch output index sampl







elem type
cpu matrix elem type cpu matrix elem type assign averag pool result cpu matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

input height time channel input height channel
output height time channel output height channel
size batch size input batch get num col
size window size window width window height
requir size output size per sampl batch size

elem rowpo channel channel input height channel
elem colpo sampl

elem rowpo channel wrow wcol channel wrow wcol output height channel
elem colpo sampl

pragma parallel
sampl sampl batch size sampl

output index within sampl output index within sampl output size per sampl output index within sampl

output index within sampl output height time channel wcol
output index within sampl output height time channel channel wrow channel
channel wrow
channel channel

elem type
row in window base vertic subsampl horizont subsampl input height channel
col in window col in window window width col in window

row in input row in window base col in window input height time channel
row in window row in window window height row in window

input batch row in input sampl
row in input channel



output index within sampl sampl window size






elem type
cpu matrix elem type cpu matrix elem type add averag pool gradient cpu matrix elem type output gradient batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

size batch size output gradient batch get num col
input height time channel input height channel
output height time channel output height channel
window size window width window height

elem rowpo channel channel input height channel
elem colpo sampl

elem rowpo channel wrow wcol channel wrow wcol output height channel
elem colpo sampl

pragma parallel
sampl sampl batch size sampl

input index within sampl input index within sampl input size per sampl input index within sampl

input index within sampl input height time channel input
input index within sampl input height time channel channel chanel
channel input
channel channel

start out x elem type ceil elem type window height elem type vertic subsampl inclus start
end out x vertic subsampl output height vertic subsampl output height inclus
start out y elem type ceil elem type window width elem type horizont subsampl inclus start
end out y horizont subsampl output width horizont subsampl output width inclus

out y start out y out y end out y out y

out x start out x out x end out x out x

output index out y output height time channel out x channel
input index within sampl sampl output gradient batch output index sampl window size







pragma endregion other helper function

elem type
cpu matrix elem type convolut forward cpu matrix elem type kernel cpu matrix mp row col cpu matrix mp row iwht
cpu matrix mp row run cpu matrix run cpu matrix elem type output

pragma parallel
int64 sampl sampl int64 output get num col sampl

size output get num row

col base mp row col
iv base mp row iwht
col base col base get num row

elem type
mp row run
skip run
size run
imask size
size

run imask

dcol run
col base dcol col base dcol get num row
kernel data iv base skip col base dcol sampl

output sampl




elem type
cpu matrix elem type convolut backward data cpu matrix elem type kernel cpu matrix mp row col cpu matrix mp row iwht
cpu matrix mp row run cpu matrix run cpu matrix elem type grad

pragma parallel
int64 sampl sampl int64 get num col sampl

size get num row

col base mp row col
iv base mp row iwht
col base col base grad get num row

elem type cur grad sampl

mp row run
skip run
size run
imask size
size

run imask

dcol run
col base dcol col base dcol grad get num row
grad col base dcol sampl cur grad kernel data iv base skip





elem type
cpu matrix elem type convolut backward kernel cpu matrix elem type cpu matrix mp row col cpu matrix mp row iwht
cpu matrix mp row run cpu matrix run cpu matrix elem type kernel grad

parallel loop
size sampl sampl get num col sampl

size get num row

col base mp row col
iv base mp row iwht
col base col base get num row

elem type cur grad sampl

mp row run
skip run
size run
imask size
size

run imask

dcol run
col base dcol col base dcol get num row
kernel grad data iv base skip cur grad col base dcol sampl





elem type
cpu matrix elem type unrol convolut input size unrol col size map out size cpu matrix mp row col
cpu matrix mp row run cpu matrix run cpu matrix elem type output

size batch size get num col

pragma parallel
int64 sampl sampl int64 batch size sampl

size map out size

col base mp row col
col base col base get num row

mp row run
skip run
size run
imask size
size

run imask

dcol run
col base dcol col base dcol get num row
output data batch size sampl unrol col skip col base dcol sampl





elem type
cpu matrix elem type unrol convolut output size unrol col size map in count size map out count cpu matrix mp row col
cpu matrix mp row run cpu matrix run cpu matrix elem type output

mp row col get num row map out count
size map out size mp row col get num row map out count
size batch size get num col

size kernel size run
kernel size map in count
size kernel map size kernel size map in count

pragma parallel
int64 sampl sampl int64 get num col sampl

size map out size

col base mp row col

mp row run
skip run
size run
imask size
size kernel map size

run imask

dcol run
size isrc
size idst col base dcol batch size sampl unrol col skip kernel map size map out count
size out map out map map out count out map isrc map out size

isrc get num element
idst out map output get num element

output data idst out map isrc sampl






elem type
cpu matrix elem type unrol convolut input for kernel backprop size map out size cpu matrix mp row col
cpu matrix mp row run cpu matrix run cpu matrix elem type output

size batch size get num col
size unrol col map out size batch size

pragma parallel
int64 sampl sampl int64 batch size sampl

size map out size

col base mp row col
col base col base get num row

mp row run
skip run
size run
imask size
size

run imask

dcol run
col base dcol col base dcol get num row
size idst skip unrol col batch size sampl
idst output get num element
output data idst col base dcol sampl





elem type
cpu matrix elem type max pool forward cpu matrix mp row col cpu matrix mp row indic cpu matrix indic cpu matrix elem type output

pragma parallel
int64 sampl sampl int64 output get num col sampl

size output get num row

col base mp row col
col base col base get num row

numer limit elem type infin
elem type numer limit elem type infin

mp row indic
size indic
size
size

dcol indic
col base dcol col base dcol get num row
col base dcol sampl

output sampl




elem type
cpu matrix elem type max pool backward cpu matrix elem type cpu matrix elem type
cpu matrix mp row col cpu matrix mp row indic cpu matrix indic
cpu matrix elem type grad

pragma parallel
int64 sampl sampl int64 get num col sampl

size get num row

col base mp row col
col base col base grad get num row

mp row indic
size indic
size
elem type sampl
elem type sampl
size

dcol indic
col base dcol col base dcol grad get num row
col base dcol sampl
grad col base dcol sampl





elem type
cpu matrix elem type averag pool forward cpu matrix mp row col cpu matrix mp row indic cpu matrix indic cpu matrix elem type output

pragma parallel
int64 sampl sampl int64 output get num col sampl

size output get num row

col base mp row col
col base col base get num row

elem type

mp row indic
size indic
size
size

dcol indic
col base dcol col base dcol get num row
col base dcol sampl

note divid size actual element pad
output sampl size




elem type
cpu matrix elem type averag pool backward cpu matrix mp row col cpu matrix mp row indic cpu matrix indic cpu matrix elem type grad

pragma parallel
int64 sampl sampl int64 get num col sampl

size get num row

col base mp row col
col base col base grad get num row

mp row indic
size indic
size
elem type sampl size
size

dcol indic
col base dcol col base dcol grad get num row
grad col base dcol sampl





elem type
cpu matrix elem type batch normal forward cpu matrix elem type scale cpu matrix elem type bia exp avg factor blend factor
cpu matrix elem type run mean cpu matrix elem type run inv std dev cpu matrix elem type epsilon
cpu matrix elem type save mean cpu matrix elem type save inv std dev

unus epsilon unus save mean unus save inv std dev

get num row scale get num row

exp avg factor blend factor
runtim error batch normal train implement

spatial get num row scale get num row
spatial

size spatial size get num row scale get num row
pragma parallel
icol icol get num col icol

irow irow get num row irow

size imap irow spatial size
irow icol scale imap irow icol run mean imap run inv std dev imap bia imap





pragma parallel
icol icol get num col icol

irow irow get num row irow

irow icol scale irow irow icol run mean irow run inv std dev irow bia irow





elem type
cpu matrix elem type batch normal backward cpu matrix elem type cpu matrix elem type grad cpu matrix elem type scale cpu matrix elem type save mean cpu matrix elem type save inv std dev
cpu matrix elem type scale grad cpu matrix elem type bia grad

unus unus grad unus scale unus save mean unus save inv std dev unus scale grad unus bia grad
runtim error batch normal train implement



pragma region static bla function

summari matrix matrix multipli major matric transpos alpha beta summari
param name alpha scalar param
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name beta scalar param
param name result matrix user respons alloc param
elem type
cpu matrix elem type multipli and weight add elem type alpha cpu matrix elem type transpos a cpu matrix elem type transpos b
elem type beta cpu matrix elem type

is empti is empti




ifdef acml
tran a tran b

cbla transpos mkl tran a
cbla transpos mkl tran b


transpos a

get num col
get num row

ifdef acml
tran a matrix transpos tran

mkl tran a cbla transpos cbla tran




get num row
get num col

ifdef acml
tran a matrix transpos no tran

mkl tran a cbla transpos cbla no tran



transpos b

get num col
get num row

ifdef acml
tran b matrix transpos tran

mkl tran b cbla transpos cbla tran




get num row
get num col

ifdef acml
tran b matrix transpos no tran

mkl tran b cbla transpos cbla no tran



convert size caus overflow


invalid argument cpu matrix elem type multipli and weight add inner dimens must match

beta
requir size

verifi size resiz beta

get num row

elem type

ifdef acml
dgemm tran a tran b alpha reinterpret cast data reinterpret cast data beta reinterpret cast data

cbla dgemm cbla order bla colmajor mkl tran a mkl tran b alpha reinterpret cast data reinterpret cast data beta reinterpret cast data




pragma warn suppress 4244
ifdef acml
sgemm bla colmajor tran a tran b alpha reinterpret cast data reinterpret cast data beta reinterpret cast data

cbla sgemm cbla order bla colmajor mkl tran a mkl tran b alpha reinterpret cast data reinterpret cast data beta reinterpret cast data




elem type
cpu matrix elem type multiply1x1 and weight add elem type alpha cpu matrix elem type cpu matrix elem type
elem type beta cpu matrix elem type

get num element scalar

elem type alpha get00 element
beta even read memori beta
pragma parallel
coord


pragma parallel
coord
beta


comput singular valu decomposit
sigma
use temp work memori

elem type
cpu matrix elem type cpu matrix elem type cpu matrix elem type sigma cpu matrix elem type cpu matrix elem type cpu matrix elem type

is empti
logic error input matrix

info
ldvt
get num row
get num col
get num row use temp work memori


ldvt
requir size
sigma requir size
requir size

elem type

ifdef acml
dgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt info
defin
wkopt
lwork
dgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt wkopt lwork info
lwork wkopt
requir size lwork
dgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt reinterpret cast data lwork info

vector superb
info lapack dgesvd bla colmajor reinterpret cast data reinterpret cast sigma data
reinterpret cast data reinterpret cast data ldvt superb




ifdef acml
pragma warn suppress 4244
sgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt info
defin
wkopt
lwork
sgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt wkopt lwork info
lwork wkopt
requir size lwork
sgesvd reinterpret cast data reinterpret cast sigma data reinterpret cast data reinterpret cast data ldvt reinterpret cast data lwork info

vector superb
info lapack sgesvd bla colmajor reinterpret cast data reinterpret cast sigma data
reinterpret cast data reinterpret cast data ldvt superb



info

runtim error algorithm comput fail converg



summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name result matrix user respons alloc param
elem type
cpu matrix elem type multipli and add cpu matrix elem type transpos a cpu matrix elem type transpos b
cpu matrix elem type

cpu matrix elem type multipli and weight add transpos a transpos b

elem type
cpu matrix elem type assign softmax sum cpu matrix elem type softmax cpu matrix elem type

elem type likelihood
size batch size get num col
pragma parallel reduct likelihood
batch size

sampl
likelihood softmax sampl

likelihood


elem type
cpu matrix elem type assign nce unnorm eval cpu matrix elem type
cpu matrix elem type cpu matrix elem type bia cpu matrix elem type
sampl prob
hidden
embed
softmax
loglikelihood

elem type likelihood
size batch size get num col
pragma parallel reduct likelihood
batch size

sampl
elem type score bia sampl
get num row
score sampl
likelihood score

likelihood


sampl prob gradient hidden embed embed hidden
cpu matrix assign nce deriv cpu matrix cpu matrix cpu matrix input index cpu matrix
elem type
cpu matrix elem type cpu matrix elem type assign nce deriv cpu matrix elem type cpu matrix elem type cpu matrix elem type size input index cpu matrix elem type

size sampl size get num row
size batch size get num col
input index

pragma parallel
batch size
sampl sampl sampl size sampl

sampl sampl
get num row
sampl sampl


input index

block thread
assum block direct
need explicitli block direct
pragma parallel
block
batch size
sampl sampl sampl size sampl

sampl sampl
sampl block
get num row
sampl sampl




input index
assum block direct
need explicitli block direct
batch size
sampl sampl sampl size sampl

sampl sampl
sampl sampl





elem type
cpu matrix elem type assign nois contrast estim cpu matrix elem type
cpu matrix elem type cpu matrix elem type bia cpu matrix elem type cpu matrix elem type
sampl prob
hidden
embed
softmax
loglikelihood

likelihood
size sampl size get num row
size batch size get num col
size nois sampl sampl size
nois sampl nois sampl
pragma parallel reduct likelihood
batch size
sampl sampl sampl size sampl

sampl sampl
score bia sampl
get num row
score sampl
sampl prob sampl
sampl
sampl prob sampl prob
score nois nois sampl sampl prob
log add score score nois
logprob score
logprob nois score nois
sampl elem type logprob
sampl
sampl
likelihood sampl logprob logprob nois

elem type likelihood


summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name result matrix user respons alloc param
elem type
cpu matrix elem type multipli cpu matrix elem type transpos a cpu matrix elem type transpos b
cpu matrix elem type

cpu matrix elem type multipli and weight add transpos a transpos b


summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type multipli cpu matrix elem type cpu matrix elem type cpu matrix elem type

cpu matrix elem type multipli and weight add


summari matrix scalar multipli major matric alpha summari
column vector column
vector row
scalar row
param name alpha scalar param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type scale and add elem type alpha cpu matrix elem type cpu matrix elem type

is empti is empti
logic error scale and add input matric

get num row get num col vector

get num row
get num col

incx
inci

convert size caus overflow
get num row get num col
get num row get num col
invalid argument dimens matrix match dimens matrix

elem type

ifdef acml
daxpi alpha reinterpret cast data incx reinterpret cast data inci

cbla daxpi alpha reinterpret cast data incx reinterpret cast data inci




pragma warn suppress 4244
ifdef acml
saxpi alpha reinterpret cast data incx reinterpret cast data inci

cbla saxpi alpha reinterpret cast data incx reinterpret cast data inci



get num element scalar element

elem type alpha
get num row get num col
pragma parallel


four unrol







handl remain stuff






get num col vector column

get num row
get num row
get num row
invalid argument column vector row match

elem type a buf ptr data
elem type c buf ptr data
elem type

pragma parallel
column

ifdef acml
daxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr locat column

cbla daxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr locat column





pragma parallel
column

pragma warn suppress 4244
ifdef acml
saxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr locat column

cbla saxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr locat column




vector row

get num row
get num col
get num col
get num col
invalid argument vector col match

elem type a buf ptr data
elem type c buf ptr data
elem type

pragma parallel


ifdef acml
daxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr

cbla daxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr





pragma parallel


pragma warn suppress 4244
ifdef acml
saxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr

cbla saxpi alpha reinterpret cast a buf ptr reinterpret cast c buf ptr





summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type add scale differ elem type alpha cpu matrix elem type cpu matrix elem type cpu matrix elem type

get num row get num row get num row get num row
get num col get num col get num col get num col

get num row get num row get num row get num row
get num col get num col get num col get num col

invalid argument add scale differ must dimens


is empti
logic error add scale differ input matrix

elem type a buf ptr data
elem type b buf ptr data
elem type c buf ptr data
get num element
pragma parallel
four unrol


c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr

handl remain stuff


c buf ptr alpha a buf ptr b buf ptr



summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type assign scale differ elem type alpha cpu matrix elem type cpu matrix elem type cpu matrix elem type

get num row get num row get num col get num col

get num row get num row get num col get num col

invalid argument assign scale differ must dimens


is empti
logic error assign scale differ input matrix


requir size get num row get num col

elem type a buf ptr data
elem type b buf ptr data
elem type c buf ptr data
get num element
pragma parallel
four unrol


c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr
c buf ptr alpha a buf ptr b buf ptr

handl remain stuff


c buf ptr alpha a buf ptr b buf ptr




elem type
cpu matrix elem type add element to element elem type beta cpu matrix elem type size size cpu matrix elem type size size

get num row get num col
get num row get num col
invalid argument add element to element index rang

elem type beta beta multipli beta could





elem type
cpu matrix elem type add log element to element cpu matrix elem type size size cpu matrix elem type size size

get num row get num col
get num row get num col
invalid argument add element to element index rang

elem type



done add element to element beta

elem type
cpu matrix elem type assign element to element cpu matrix elem type size size cpu matrix elem type size size

get num row get num col
get num row get num col
invalid argument assign element to element index rang





summari alpha summari
must
param name alpha matrix param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type add scale differ cpu matrix elem type alpha cpu matrix elem type cpu matrix elem type cpu matrix elem type

alpha get num element
alpha get num element
invalid argument add scale differ alpha must matrix

add scale differ alpha


summari alpha summari
must
param name alpha matrix param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type assign scale differ cpu matrix elem type alpha cpu matrix elem type cpu matrix elem type cpu matrix elem type

alpha get num element
alpha get num element
invalid argument add scale differ alpha must matrix

assign scale differ alpha

summari matrix scalar multipli major matric alpha summari
param name alpha scalar param
param name input matrix param
param name result matrix user respons alloc param
elem type
cpu matrix elem type scale elem type alpha cpu matrix elem type cpu matrix elem type

is empti
logic error scale input matrix

get num row
get num col

convert size caus overflow
requir size

elem type a buf ptr data
elem type c buf ptr data

alpha

memset c buf ptr elem type get num element



size get num element
pragma parallel
four unrol
size

c buf ptr alpha a buf ptr
c buf ptr alpha a buf ptr
c buf ptr alpha a buf ptr
c buf ptr alpha a buf ptr

remain element
size size

c buf ptr alpha a buf ptr



summari matrix scalar multipli major matric alpha summari
param name alpha scalar param
param name input matrix param
elem type
cpu matrix elem type scale elem type alpha cpu matrix elem type

is empti
logic error scale input matrix

get num row
get num col

incx

convert size caus overflow

alpha incx

memset data elem type

elem type

ifdef acml
dscal alpha reinterpret cast data incx todo overload

cbla dscal alpha reinterpret cast data incx




pragma warn suppress 4244
ifdef acml
sscal alpha reinterpret cast data incx

cbla sscal alpha reinterpret cast data incx




summari matrix multipli major matric alpha summari
param name alpha matrix param
param name input matrix param
elem type
cpu matrix elem type scale cpu matrix elem type alpha cpu matrix elem type

is empti
logic error scale input matrix
alpha get num element
logic error matrix alpha must
cpu matrix elem type scale alpha


elem type
cpu matrix elem type inner product cpu matrix elem type cpu matrix elem type cpu matrix elem type is col wise

is empti is empti
logic error inner product input matric

get num row
get num col
get num row
get num col

convert size caus overflow
convert size caus overflow

invalid argument inner product matric dimens

is col wise is col wise equival element wise product

assign element product of

is col wise wise

requir size

elem type a buf ptr data
elem type b buf ptr data
elem type

pragma parallel
column

ifdef acml
elem type ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column

elem type cbla ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column





pragma parallel
column

pragma warn suppress 4244
ifdef acml
elem type sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column

elem type cbla sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column






requir size

elem type a buf ptr data
elem type b buf ptr data
elem type

pragma parallel


ifdef acml
ddot reinterpret cast a buf ptr reinterpret cast b buf ptr

cbla ddot reinterpret cast a buf ptr reinterpret cast b buf ptr





pragma parallel


pragma warn suppress 4244
ifdef acml
sdot reinterpret cast a buf ptr reinterpret cast b buf ptr

cbla sdot reinterpret cast a buf ptr reinterpret cast b buf ptr






treat matric vector
elem type
elem type cpu matrix elem type inner product of matric cpu matrix elem type cpu matrix elem type

is empti is empti
logic error inner product of matric input matric

get num row
get num col
get num row
get num col

convert size caus overflow
convert size caus overflow

invalid argument inner product of matric matric dimens

elem type

ifdef acml
elem type ddot get num element reinterpret cast data reinterpret cast data

elem type cbla ddot get num element reinterpret cast data reinterpret cast data




pragma warn suppress 4244
ifdef acml
elem type sdot get num element reinterpret cast data reinterpret cast data

elem type cbla sdot get num element reinterpret cast data reinterpret cast data




elem type
cpu matrix elem type element wise power elem type alpha cpu matrix elem type cpu matrix elem type

is empti
logic error scale input matrix

requir size get num row get num col

alpha

pragma parallel
coord




alpha

pragma parallel
coord






pragma parallel
coord

alpha




elem type
cpu matrix elem type are equal cpu matrix elem type cpu matrix elem type elem type threshold

get num row get num row get num col get num col


result
pragma parallel
coord

threshold

result




result


matrix elem type tensor shuffl scale and add comment
elem type
cpu matrix elem type tensor shuffl scale and add elem type keep weight cpu matrix elem type size size size size size elem type scale factor cpu matrix elem type cpu matrix elem type

size
data
data
data
note thi code written match implement effici
size element

recov indic counter
size
size
size
size
size
comput index tensor
input tensor dimens
size output tensor dimens swap

perform comput
elem type cval keep weight keep weight weight bother read memori effici multipli
cval scale factor
cval



elem type
cpu matrix elem type cpu matrix elem type one size row size col

cpu matrix elem type row col initi
set valu



elem type
cpu matrix elem type cpu matrix elem type zero size row size col

cpu matrix elem type row col initi
set valu



elem type
cpu matrix elem type cpu matrix elem type size row

cpu matrix elem type row row initi
set diagon valu



elem type
cpu matrix elem type cpu matrix elem type random uniform size row size col elem type elem type high seed

cpu matrix elem type row col initi
set uniform random valu high seed



elem type
cpu matrix elem type cpu matrix elem type random gaussian size row size col elem type mean elem type sigma seed

cpu matrix elem type row col initi
set gaussian random valu mean sigma seed



elem type
cpu matrix elem type ha element cpu matrix elem type elem type

b ha

isv finit isfinit
pragma parallel
get num element

pragma flush b ha
b ha

elem type data
isv finit isfinit


b ha

isnan isnan
b ha
isinf isinf signbit signbit
b ha



b ha


cpu matrix elem type assign element product of with shift neg cpu matrix elem type cpu matrix elem type size shift size negnumb

must vector size
input vector
output matrix size
elem type
cpu matrix elem type cpu matrix elem type assign element product of with shift neg cpu matrix elem type cpu matrix elem type size shift size negnumb

is empti is empti
logic error assign element product of with shift neg matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument assign element product of with shift neg input matrix dimens match

get num row
invalid argument assign element product of with shift neg input matrix must vector




requir size negnumb get num col
requir size get num row get num col


get num row get num col size
pragma parallel









shift






elem type
cpu matrix elem type inner product with shift neg cpu matrix elem type cpu matrix elem type cpu matrix elem type is col wise size shift size negnumb

is empti is empti
logic error inner product input matric

get num row
get num col
get num row
get num col

convert size caus overflow
convert size caus overflow

invalid argument inner product matric dimens

is col wise is col wise equival element wise product

invalid argument inner product both matric normal one vector
assign element product of

is col wise wise

requir size negnumb line ischang

elem type a buf ptr data
elem type b buf ptr data
elem type



ifdef acml
elem type ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column

elem type cbla ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column




negnumb

ifdef acml
elem type ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column shift

elem type cbla ddot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column shift








ifdef acml
elem type sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column

elem type cbla sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column




negnumb

ifdef acml
elem type sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column shift

elem type cbla sdot reinterpret cast a buf ptr locat column reinterpret cast b buf ptr locat column shift







invalid argument inner product rowwis support

requir size

elem type a buf ptr data
elem type b buf ptr data
elem type

pragma parallel


ifdef acml
elem type ddot reinterpret cast a buf ptr reinterpret cast b buf ptr

elem type cbla ddot reinterpret cast a buf ptr reinterpret cast b buf ptr





pragma parallel


pragma warn suppress 4244
ifdef acml
sdot reinterpret cast a buf ptr reinterpret cast b buf ptr

cbla sdot reinterpret cast a buf ptr reinterpret cast b buf ptr






elem type
cpu matrix elem type cpu matrix elem type get a row by index cpu matrix elem type size index

is empti
logic error get a row by index input matric

get num row
get num col

index index
logic error get a row by index index rang

convert size caus overflow


requir size


index





input vector
input matrix
input firstmatrixfix keep order otherwis keep order
output matrix size size

exampl




shift




shift


column wise shift


shift




shift






elem type
cpu matrix elem type conduct row element multipli with shift cpu matrix elem type cpu matrix elem type cpu matrix elem type size shift b firstmatrixfix

is empti is empti
logic error inner product input matric

get num row
get num col
get num row
get num col

convert size caus overflow
convert size caus overflow

invalid argument inner product matric dimens

requir size must size

b firstmatrixfix





shift









shift





cpu matrix elem type assign element product of with shift cpu matrix elem type cpu matrix elem type size shift

must vector size element product shift
input vector
output vector
elem type
cpu matrix elem type cpu matrix elem type assign element product of with shift cpu matrix elem type cpu matrix elem type size shift

is empti is empti
logic error assign element product of with shift neg matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument assign element product of with shift neg input matrix dimens match

get num row
invalid argument assign element product of with shift neg input matrix must vector




requir size get num col
requir size get num row get num col


get num row get num col size
get num col size
pragma parallel


shift




pragma endregion static bla function

version log add
log add d

log add


elem type
elem type cpu matrix elem type log sum of element

elem type f alpha elem type lzero
elem type buf ptr data
get num element
f alpha elem type log add d f alpha buf ptr
f alpha


elem type
cpu matrix elem type rcrf backward comput cpu matrix elem type alpha cpu matrix elem type beta
cpu matrix elem type lbl
cpu matrix elem type pair score

i num po lbl get num col
i num lab lbl get num row

last lbl
lbl get num row
lbl i num po

last lbl



beta requir size i num lab i num po

i num po

pragma parallel
i num lab

rcrf backward comput alpha beta pair score




kernel rcrf backward comput
elem type
cpu matrix elem type rcrf backward comput size size cpu matrix elem type alpha
cpu matrix elem type beta
cpu matrix elem type pair score

size i num lab alpha get num row
size i num po alpha get num col

elem type f sum
elem type f tmp elem type lzero
i num po

f sum elem type lzero
i num lab

f sum elem type log add d f sum alpha


f tmp alpha f sum
beta f tmp



i num lab

f sum elem type lzero
i num lab

f sum elem type log add d f sum alpha pair score


f tmp elem type log add d f tmp beta alpha pair score f sum

beta f tmp



elem type
cpu matrix elem type rcrf tran grd comput cpu matrix elem type lbl
cpu matrix elem type alpha
cpu matrix elem type beta
cpu matrix elem type pair score
cpu matrix elem type

i num po alpha get num col
i num lab alpha get num row

first lbl
lbl get num row
lbl

first lbl



size t po t po i num po t po

cpu matrix elem type beta column slice t po
cpu matrix elem type
t po
alpha column slice t po

pragma parallel
i num lab

rcrf tran grd comput lbl alpha beta pair score t po


transit score

t po
first lbl


lbl get num row
lbl t po







lbl get num row

lbl t po










elem type
cpu matrix elem type rcrf tran grd comput size
cpu matrix elem type lbl
cpu matrix elem type alpha
cpu matrix elem type beta
cpu matrix elem type pair score
cpu matrix elem type
size t po posit


i num lab alpha get num row

first lbl
lbl get num row
lbl

first lbl



cpu matrix elem type beta column slice t po
cpu matrix elem type
t po
alpha column slice t po


elem type f tmp elem type lzero
i num lab

t po

first lbl

f tmp



f tmp elem type lzero




f tmp

f tmp pair score

elem type f sum elem type lzero
i num lab

elem type f tmp2
t po

first lbl

f tmp2



f tmp2 elem type lzero




f tmp2

f sum elem type log add d f sum f tmp2 pair score


f tmp f sum
f tmp

f tmp



elem type
cpu matrix elem type cpu matrix elem type drop frame cpu matrix elem type label cpu matrix elem type gamma elem type threshhold


get num col gamma get num col get num row gamma get num row
logic error drop frame target matrix size gamm matrix

pragma parallel
column label


dropfram
label

fab label

gamma threshhold
dropfram




label








elem type
cpu matrix elem type cpu matrix elem type assign sequenc error elem type hsmooth weight cpu matrix elem type label
cpu matrix elem type dnnoutput cpu matrix elem type gamma elem type alpha


coord
alpha label hsmooth weight dnnoutput hsmooth weight gamma



note depend elem type paramet
elem type
cpu matrix elem type set num thread num thread

num thread
num thread

mthread thread hardwar concurr

num thread
num thread mthread num thread
num thread mthread
num thread mthread

ifdef openmp
thread num thread
num thread thread

ifdef acml
acmlsetnumthread num thread
defin
thread num thread
defin openbla
openbla thread num thread


num thread



tensor view support


save time make extens templat macro


comput valu given output locat perform reduct need


perform reduct index
thi declar insid wrapper allow partial special
elem type opfn size
tensor op reduct

reduct reduct special
elem type loop elem type pointer opfn opfn
small vector size reduc op dim small vector ptrdiff reduc stride

ptrdiff stride last result pointer unus reduct
size small constant unrol
stride reduc stride size
elem type aggreg
size reduc op dim size

need descend deeper
aggreg tensor op reduct elem type opfn loop pointer opfn reduc op dim reduc stride
advanc pointer
size
pointer stride note last pointer result unus untouch

elem type aggreg



perform reduct index
thi special version termin recurs
elem type opfn size
tensor op reduct elem type opfn

elem type loop elem type pointer opfn opfn
small vector size small vector ptrdiff

opfn pointer work




perform regular index nari oper count output


perform regular index reduc index operand count output
elem type opfn size vectoriz
tensor op iter

loop elem type beta elem type pointer elem type alpha opfn opfn
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

scalar still nest result loop left
ptrdiff stride
size small constant unrol
stride regular stride size
size regular op dim size

need descend deeper
tensor op iter elem type opfn vectoriz loop beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride
advanc pointer
size
pointer stride




special version innermost stride reduct compil
thi common ad vector comput sigmoid
elem type opfn
tensor op iter elem type opfn vectoriz reduct innermost

loop elem type beta elem type pointer elem type alpha opfn opfn
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

elem type pointer
elem type pointer
elem type pointer
size regular op dim
special beta alpha allow compil circuit
beta
pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop beta elem type alpha opfn regular op dim regular stride reduc op dim reduc stride
alpha
pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop elem type alpha opfn regular op dim regular stride reduc op dim reduc stride

pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop elem type opfn regular op dim regular stride reduc op dim reduc stride
todo accord amit compil abl vector lambda solut chang take implement insid element
todo signed requir caus extra sign extend
todo add lot overhead need guard size


unari
elem type opfn
tensor op iter elem type opfn vectoriz reduct innermost

loop elem type beta elem type pointer elem type alpha opfn opfn
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

elem type pointer
elem type pointer
size regular op dim
special beta alpha allow compil circuit
beta
pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop beta elem type alpha opfn regular op dim regular stride reduc op dim reduc stride
alpha
pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop elem type alpha opfn regular op dim regular stride reduc op dim reduc stride

pragma parallel

tensor op iter elem type opfn vectoriz reduct scalar loop elem type opfn regular op dim regular stride reduc op dim reduc stride



elem type opfn size vectoriz
tensor op iter elem type opfn vectoriz

loop elem type beta elem type pointer elem type alpha opfn opfn
small vector size small vector ptrdiff
small vector size reduc op dim small vector ptrdiff reduc stride

element level result perform still reduct
elem type tensor op reduct elem type opfn loop pointer opfn reduc op dim reduc stride
scale
alpha
combin previou valu target matrix write
pout pointer back
beta
beta pout
save
pout





runtim paramet paramet


tensor oper dimens mean scalar
elem type opfn size
tensor op with regular loop elem type beta elem type pointer elem type alpha opfn opfn
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

size dim reduc op dim size
dim


tensor op iter elem type opfn vectoriz loop beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op iter elem type opfn vectoriz loop beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride


lead dimens compil unrol
lead all one
size
lead all one regular stride
lead all one special version use hard code increment lead dimens
tensor op iter elem type opfn vectoriz loop beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op iter elem type opfn vectoriz loop beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride


logic error tensor op flatten reduct dimens support dim



tensor oper gener oper alreadi provid
thi expand differ
elem type opfn size
tensor op with fn elem type beta elem type pointer elem type alpha opfn opfn
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

size small constant unrol
pointer offset
size dim regular op dim size
dim


tensor op with regular loop elem type opfn beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op with regular loop elem type opfn beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op with regular loop elem type opfn beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op with regular loop elem type opfn beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

tensor op with regular loop elem type opfn beta pointer alpha opfn regular op dim regular stride reduc op dim reduc stride

logic error tensor op flatten input dimens support dim




entri point matrix also


perform unari oper give reinterpret matric tensor specifi dim stride
thi map
elem type
cpu matrix elem type tensor op elem type beta cpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

reduct op element wise oper op sum todo enabl reduct
invalid argument tensor op unari reduct oper op sum implement

todo chang take pointer element element order vector
defin case unari tensor op oper
element wise oper oper
tensor op with fn beta pointer alpha elem type

oper

offset regular op dim regular stride reduc op dim reduc stride

elem type pointer data data


for all unari op case unari tensor op

logic error tensor op unknown unari code



perform binari oper give reinterpret matric tensor specifi dim stride
thi map
elem type
cpu matrix elem type tensor op elem type beta cpu matrix elem type cpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

reduct op element wise oper op sum
invalid argument tensor op binari permit binari reduct oper op sum

defin case binari tensor op oper
element wise oper oper
tensor op with fn beta pointer alpha elem type

oper

offset regular op dim regular stride reduc op dim reduc stride

elem type pointer data data data


for all binari op case binari tensor op

logic error tensor op unknown binari code



perform ternari oper give reinterpret matric tensor specifi dim stride
thi map
elem type
cpu matrix elem type tensor op elem type beta cpu matrix elem type cpu matrix elem type cpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

reduct op element wise oper op sum
invalid argument tensor op permit ternari reduct oper op sum

defin case ternari tensor op oper
element wise oper oper
tensor op with fn beta pointer alpha elem type

oper

offset regular op dim regular stride reduc op dim reduc stride

elem type pointer data data data data


for all ternari op case ternari tensor op

logic error tensor op unknown ternari code




instanti

math cpu matrix
math cpu matrix

matrix back store quantiz matrix
explicitli instanti method need purpos
cpu matrix cpu matrix size num row size num col
cpu matrix cpu matrix size num row size num col p array size matrix flag
cpu matrix cpu matrix
cpu matrix cpu matrix cpu matrix
cpu matrix cpu matrix cpu matrix
size cpu matrix locat element size size
cpu matrix cpu matrix
cpu matrix cpu matrix column slice size start column size num col
cpu matrix cpu matrix cpu matrix
cpu matrix set valu
cpu matrix set valu size num row size num col p array size matrix flag
cpu matrix set valu cpu matrix
cpu matrix resiz size num row size num col grow onli

cpu matrix cpu matrix size size size
cpu matrix cpu matrix



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
best gpu

ifdef cpuonli

common matrix
gpu matrix
gpu spars matrix
matrix quantiz gpu
cu dnn factori
tensor shape
gpu data transfer

pragma warn disabl 4100 unreferenc formal paramet sinc function dummi disabl allow copi past prototyp function
pragma warn disabl 4702 unreach code implement macro

microsoft cntk

reset dummi implement

prepar devic deviceid type devic id

elem type
gpuspars index type gpu spars matrix elem type secondari index valu at size

gpuspars index type


pragma region constructor destructor

elem type
gpu spars matrix elem type gpu spars matrix deviceid type comput devic matrix format matrix format matrix format matrix format spars csr



elem type
gpu spars matrix elem type zero init matrix format matrix format deviceid type comput devic



elem type
gpu spars matrix elem type gpu spars matrix gpu matrix elem type deep copi matrix format matrix format matrix format matrix format spars csr



elem type
gpu spars matrix elem type gpu spars matrix gpu spars matrix elem type deep copi



elem type
gpu spars matrix elem type gpu spars matrix size num row size num col size num nz deviceid type comput devic matrix format matrix format matrix format matrix format spars csr



prepar devic setup correct cuda context oper
devic id devic oper take place
default mean matric current devic
elem type
deviceid type gpu spars matrix elem type prepar devic deviceid type devic id

devic id


elem type
gpu spars matrix elem type deep copi gpu spars matrix elem type deep copi



elem type
gpu spars matrix elem type set valu gpu spars matrix elem type deep copi



elem type
gpu spars matrix elem type set valu gpu matrix elem type dens matrix



elem type
gpu spars matrix elem type set valu gpu matrix elem type dens matrix matrix format matrix format



elem type
gpu spars matrix elem type set valu cpu spars matrix elem type deep copi from



elem type
gpuspars index type gpu spars matrix elem type get condens vector




elem type
gpu spars matrix elem type mask column valu gpu matrix column mask elem type



elem type
gpu spars matrix elem type gpu spars matrix elem type gpu spars matrix elem type deep copi




elem type
gpu spars matrix elem type gpu spars matrix gpu spars matrix elem type move from


elem type
gpu spars matrix elem type gpu spars matrix elem type gpu spars matrix elem type move from




elem type
gpu spars matrix elem type gpu spars matrix



resiz as and copi index from resiz spars matrix element structur pass matrix
spars matrix whose structur want
remark done element wise oper structur ident oper
elem type
gpu spars matrix elem type resiz as and copi index from gpu spars matrix elem type grow onli




start spars matrix code


elem type
gpu spars matrix elem type clear nz count


elem type
gpu spars matrix elem type alloc size num row size num col size num nz elem to reserv grow onli keep exist valu


elem type
gpu spars matrix elem type requir size and alloc size num row size num col size num nz elem to reserv matrix format matrix format grow onli keep exist valu


elem type
gpu spars matrix elem type requir size and alloc size num row size num col size num nz elem to reserv grow onli keep exist valu


elem type
gpu spars matrix elem type requir size size num row size num col matrix format format grow onli


elem type
gpu spars matrix elem type requir size size num row size num col grow onli


elem type
gpu spars matrix elem type resiz size num row size num col size num nz elem to reserv matrix format matrix format grow onli


elem type
gpu spars matrix elem type resiz size num row size num col size num nz elem to reserv grow onli



elem type
gpu matrix elem type gpu spars matrix elem type copi to dens matrix

gpu matrix elem type


elem type
gpu spars matrix elem type copi to dens matrix gpu matrix elem type dens matrix


elem type
gpu spars matrix elem type copi to cpu spars matrix cpu spars matrix elem type cpu spars matrix


elem type
gpu spars matrix elem type chang devic to deviceid type to id



reset matrix reus
elem type
gpu spars matrix elem type reset



pragma endregion constructor destructor

pragma region static bla function

copi featur matrix
elem type
gpu spars matrix elem type set matrix from csc format cpuspars index type csc col cpuspars index type elem type
size size num row size num col is on devic deviceid type dev id



forward featur hidden layer
elem type
gpu spars matrix elem type multipli and weight add elem type alpha gpu matrix elem type transpos a
gpu spars matrix elem type transpos b elem type beta gpu matrix elem type



backward hidden layer featur weight
elem type
gpu spars matrix elem type multipli and add elem type alpha gpu matrix elem type transpos a
gpu spars matrix elem type transpos b gpu spars matrix elem type



use gradient udpat
elem type
gpu spars matrix elem type scale and add elem type alpha gpu spars matrix elem type gpu matrix elem type



elem type
gpu spars matrix elem type gpu spars matrix elem type inplac truncat elem type threshold




normal updat smooth gradient current gradient
elem type
gpu spars matrix elem type normal grad gpu matrix elem type elem type momentum


elem type
elem type gpu spars matrix elem type adagrad gpu matrix elem type need ave multipli



elem type
gpu spars matrix elem type fs adagrad cpu matrix elem type gradient cpu matrix elem type elem type elem type elem type elem type

elem type
gpu spars matrix elem type multipli and weight add elem type alpha gpu spars matrix elem type transpos a
gpu matrix elem type transpos d elem type beta gpu matrix elem type


elem type
gpu spars matrix elem type multipli gpu spars matrix elem type gpu matrix elem type gpu matrix elem type


elem type
gpu spars matrix elem type multipli gpu matrix elem type gpu spars matrix elem type gpu matrix elem type



elem type
size gpu spars matrix elem type elem count from buffer size size num row size num col matrix format format size total buffer size



elem type
size gpu spars matrix elem type elem count from buffer size




prepar buffer dimens start buffer comput start column valu
row sourc
col sourc
can reus buffer target matrix reus temporari space
func call count element result return count fill csr row ptr
elem type
gpu spars matrix elem type prepar buffer size size can reus buffer size csr row ptr c func



multipli multipli spare matrix anoth spars matrix
first spars matrix
transpos s1 transpos first matrix
second spars matrix
transpos s2 tanspos second matrix
result matrix
note enough space alloc reus otherwis freed memori block use
elem type
gpu spars matrix elem type multipli gpu spars matrix elem type transpos s1 gpu spars matrix elem type transpos s2 gpu spars matrix elem type



elem type
gpu spars matrix elem type gpu spars matrix elem type assign product of gpu spars matrix elem type transpos a gpu spars matrix elem type transpos b




elem type
gpu spars matrix elem type scale and add elem type alpha gpu spars matrix elem type elem type beta gpu spars matrix elem type gpu spars matrix elem type



elem type
gpu spars matrix elem type scale and add elem type alpha gpu spars matrix elem type elem type beta gpu matrix elem type gpu matrix elem type



elem type
gpu spars matrix elem type scale and add elem type alpha gpu matrix elem type elem type beta gpu spars matrix elem type gpu matrix elem type



elem type
gpu spars matrix elem type scale elem type alpha gpu spars matrix elem type



elem type
gpu spars matrix elem type element wise power elem type alpha gpu spars matrix elem type gpu spars matrix elem type



elem type
elem type gpu spars matrix elem type inner product of matric gpu spars matrix elem type gpu matrix elem type

elem type


elem type
elem type gpu spars matrix elem type inner product of matric gpu matrix elem type gpu spars matrix elem type

elem type


elem type
gpu spars matrix elem type are equal gpu spars matrix elem type gpu spars matrix elem type
elem type threshold




elem type
gpu spars matrix elem type are equal gpu matrix elem type gpu spars matrix elem type
elem type threshold




elem type
gpu spars matrix elem type are equal gpu spars matrix elem type gpu matrix elem type
elem type threshold




elem type
gpu spars matrix elem type is equal to gpu spars matrix elem type elem type threshold




elem type
gpu spars matrix elem type is equal to gpu matrix elem type elem type threshold



pragma endregion static bla function

pragma region member bla function

elem type
gpu matrix elem type gpu spars matrix elem type element product of gpu spars matrix elem type gpu matrix elem type

gpu matrix elem type



elem type
gpu matrix elem type gpu spars matrix elem type element product of gpu matrix elem type gpu spars matrix elem type

gpu spars matrix elem type element product of


elem type
gpu spars matrix elem type gpu spars matrix elem type gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type elem type alpha




elem type
gpu spars matrix elem type gpu spars matrix elem type elem type alpha




elem type
gpu spars matrix elem type gpu spars matrix elem type elem type alpha




elem type
gpu spars matrix elem type gpu spars matrix elem type elem type alpha




elem type
gpu spars matrix elem type gpu spars matrix elem type assign element power of gpu spars matrix elem type elem type power




elem type
gpu spars matrix elem type gpu spars matrix elem type transpos




elem type
gpu spars matrix elem type gpu spars matrix elem type assign transpos of gpu spars matrix elem type




elem type
gpu spars matrix elem type inplac transpos



elem type
gpu spars matrix elem type gpu spars matrix elem type column slice size start column size num col

gpu spars matrix elem type


elem type
gpu matrix elem type gpu spars matrix elem type copi column slice to dens size start column size num col

gpu matrix elem type


elem type
gpu matrix elem type gpu spars matrix elem type diagon to dens

gpu matrix elem type



elem type
elem type gpu spars matrix elem type sum of ab element

elem type


elem type
elem type gpu spars matrix elem type sum of element

elem type


elem type
elem type gpu spars matrix elem type frobeniu norm

elem type


elem type
elem type gpu spars matrix elem type matrix norm inf

elem type


elem type
elem type gpu spars matrix elem type matrix norm1

elem type


pragma endregion member bla function

pragma region other function

elem type
gpu spars matrix elem type gpu spars matrix elem type element invers




elem type
gpu spars matrix elem type gpu spars matrix elem type assign element invers of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac sigmoid




elem type
gpu spars matrix elem type gpu spars matrix elem type assign sigmoid of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac linear rectifi deriv




elem type
gpu spars matrix elem type gpu spars matrix elem type assign linear rectifi deriv of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac tanh




elem type
gpu spars matrix elem type gpu spars matrix elem type assign tanh of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac sqrt




elem type
gpu spars matrix elem type gpu spars matrix elem type assign sqrt of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac exp




elem type
gpu spars matrix elem type gpu spars matrix elem type assign exp of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac log




elem type
gpu spars matrix elem type gpu spars matrix elem type assign log of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac ab




elem type
gpu spars matrix elem type gpu spars matrix elem type assign ab of gpu spars matrix elem type




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac truncat bottom elem type threshold




elem type
gpu spars matrix elem type gpu spars matrix elem type assign truncat bottom of gpu spars matrix elem type elem type threshold




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac truncat top elem type threshold




elem type
gpu spars matrix elem type gpu spars matrix elem type assign truncat top of gpu spars matrix elem type elem type threshold




elem type
gpu spars matrix elem type gpu spars matrix elem type set to zero if ab less than elem type threshold




elem type
gpu spars matrix elem type gpu spars matrix elem type inplac soft threshold elem type threshold




elem type
size gpu spars matrix elem type identifi row with valu




pragma endregion

pragma region helper function
elem type
gpu spars matrix elem type reserv temp host buffer size size in byte

nullptr


elem type
gpu spars matrix elem type perform element wise function element wise oper kind gpu spars matrix elem type



elem type
gpu spars matrix elem type set matrix from csr format cpuspars index type csr row cpuspars index type elem type
size size num row size num col is on devic deviceid type dev id



elem type
gpu spars matrix elem type get matrix from csr format cpuspars index type csr row cpuspars index type elem type size num elem alloc size size num row size num col



elem type
gpu spars matrix elem type get matrix from csc format cpuspars index type csc col cpuspars index type elem type size num elem alloc size size num row size num col



elem type
gpu spars matrix elem type convert to spars format matrix format new format


elem type
gpu spars matrix elem type convert to spars format matrix format new format gpu spars matrix elem type out matrix



elem type
gpu spars matrix elem type convolv and weight add elem type alpha gpu matrix elem type transpos a gpu spars matrix elem type transpos b elem type beta gpu matrix elem type size num channel size horizont subsampl pad channelwis
elem type
gpu spars matrix elem type tensor shuffl scale and add elem type keep weight gpu spars matrix elem type size size size size size elem type scale factor gpu spars matrix elem type gpu spars matrix elem type


elem type
gpu spars matrix elem type reshap size num row size num col



elem type
gpu spars matrix elem type is valid




elem type
out type in type
gpu spars matrix elem type convert buffer out type out buffer in type in buffer size size



pragma endregion helper function

math gpu spars matrix
math gpu spars matrix
math gpu spars matrix
math gpu spars matrix

elem type
math file file stream gpu spars matrix elem type

stream


math file file stream gpu spars matrix
math file file stream gpu spars matrix

elem type
math file file stream gpu spars matrix elem type

stream

math file file stream gpu spars matrix
math file file stream gpu spars matrix

pragma region devic bound number

elem type
devic bound number elem type devic bound number devic bound number elem type deep copi

implement


elem type
devic bound number elem type devic bound number devic bound number elem type shallow copi

shallow copi from shallow copi shallow copi comput devic
shallow copi


elem type
devic bound number elem type shallow copi from elem type new val new val devc id



elem type
devic bound number elem type devic bound number



pragma endregion devic bound number

pragma region helper function

elem type
gpu matrix elem type set devic deviceid type devic id

prepar devic setup correct cuda context oper
devic id devic oper take place
default mean matric current devic
elem type
deviceid type gpu matrix elem type prepar devic deviceid type devic id

devic id


elem type
elem type gpu matrix elem type copi to array




elem type
gpu matrix elem type copi section size num row size num col elem type size col stride



memori alloc calle enough need delet caller done
element copi
elem type
size gpu matrix elem type copi to array elem type array copi to size current array size




elem type
gpu matrix elem type chang devic to



elem type
gpu matrix elem type perform element wise function element wise oper kind elem type



pragma endregion helper function

pragma region constructor destructor

use constructor
elem type
gpu matrix elem type zero init devic id



elem type
gpu matrix elem type gpu matrix devic id

elem type
gpu matrix elem type gpu matrix size num row size num col devic id

elem type
gpu matrix elem type gpu matrix size num row size num col devic id elem type p array size matrix flag

elem type
gpu matrix elem type gpu matrix gpu matrix elem type deep copi from



elem type
gpu matrix elem type gpu matrix gpu matrix elem type move from



assign deep copi
elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type deep copi from




move assign shallow copi
elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type move from




elem type
gpu matrix elem type gpu matrix



elem type
gpu matrix elem type clear


pragma endregion constructor destructor

pragma region basic oper
elem type
gpu matrix elem type gpu matrix elem type column slice size start column size num col

gpu matrix elem type slice
slice


elem type
gpu matrix elem type gpu matrix elem type assign column slice gpu matrix elem type from matrix size start column size num col




elem type
gpu matrix elem type gpu matrix elem type set column slice gpu matrix elem type from matrix size start column size num col



elem type
gpu matrix elem type gpu matrix elem type diagon

gpu matrix elem type diag
diag


column assign num row start start index
elem type
gpu matrix elem type gpu matrix elem type assign row slice valu of gpu matrix elem type size start index size num row



column assign row start start index
elem type
gpu matrix elem type gpu matrix elem type assign to row slice valu of gpu matrix elem type size start index size num row




column row start start index
elem type
gpu matrix elem type gpu matrix elem type add to row slice valu of gpu matrix elem type size start index size num row



elem type
gpu matrix elem type gpu matrix elem type add with row slice valu of gpu matrix elem type size start index size num row



elem type gpu matrix elem type gpu matrix elem type assign row stack valu of vector gpu matrix elem type input matric size slice start col size slice num col

elem type
gpu matrix elem type gpu matrix elem type assign repeat of gpu matrix elem type size num row repeat size num col repeat



elem type
gpu matrix elem type gpu matrix elem type add to row repeat valu of gpu matrix elem type size num row repeat




elem type
gpu matrix elem type gpu matrix elem type assign posit and shift neg sampl gpu matrix elem type size po number size neg number size shift number



elem type
gpu matrix elem type gpu matrix elem type add fold posit and shift neg sampl gpu matrix elem type size po number size neg number size shift number




elem type
gpu matrix elem type gpu matrix elem type transpos




get cubla handl cubla handl given need
comput devic comput devic cubla handl desir
return cubla handl
note current bother ever free cubla handl freed automat cuda process end
elem type
cubla handl gpu matrix elem type get cubla handl comput devic

cubla handl cu handl
cu handl


elem type
gpu matrix elem type gpu matrix elem type assign transpos of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type do gather column of elem type beta gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type do scatter column of elem type beta gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type set valu elem type



elem type
gpu matrix elem type set valu elem type pointer valu memori



elem type
gpu matrix elem type set column elem type col pointer size col ind


elem type
gpu matrix elem type set column gpu matrix elem type val mat size col ind



elem type
gpu matrix elem type mask column valu gpu matrix column mask elem type



elem type
gpu matrix elem type copi column stride gpu matrix elem type from matrix size num col size src num col stride size dest num col stride


elem type
gpu matrix elem type set valu gpu matrix elem type deep copi from



elem type
gpu matrix elem type set valu size num row size num col devic id elem type p array size matrix flag



elem type
gpu matrix elem type set diagon valu elem type



elem type
gpu matrix elem type set diagon valu gpu matrix elem type vector



elem type
gpu matrix elem type set uniform random valu elem type elem type high seed



elem type
gpu matrix elem type set gaussian random valu elem type mean elem type sigma seed



mask rate percentag valu mask similar dropout rate
scale valu scale valu left one unmask item
elem type
gpu matrix elem type set uniform random mask elem type mask rate elem type scale valu seed



elem type
elem type gpu matrix elem type adagrad gpu matrix elem type gradient need ave multipli



elem type
gpu matrix elem type fs adagrad gpu matrix elem type gradient gpu matrix elem type function valu elem type learn rate per sampl elem type momentum elem type ada weight elem type ada mul



elem type
elem type gpu matrix elem type rm prop gpu matrix elem type gradient elem type gamma elem type elem type elem type elem type need ave multipli




elem type
gpu matrix elem type reshap size num row size num col



elem type
gpu matrix elem type requir size size num row size num col grow onli



elem type
gpu matrix elem type resiz size num row size num col grow onli



elem type
size gpu matrix elem type locat element size size




elem type
uniqu gpu matrix elem type gpu matrix elem type get or creat workspac




elem type
gpu matrix elem type releas workspac uniqu gpu matrix elem type



elem type
size gpu matrix elem type locat column size




elem type
elem type gpu matrix elem type get00 element

elem type


pragma endregion basic oper

pragma region member bla function
elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type assign sum of elem type alpha gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign sum of gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type assign differ of elem type alpha gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign differ of gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign differ of gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type assign product of elem type alpha gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign product of gpu matrix elem type transpos a gpu matrix elem type transpos b




elem type
gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




element wise power
elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type elem type alpha




elem type
gpu matrix elem type gpu matrix elem type assign element power of gpu matrix elem type elem type power




elem type
gpu matrix elem type gpu matrix elem type add element product of gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type column element multipli with gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type row element multipli with gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type column element divid by gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type row element divid by gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type element invers




elem type
gpu matrix elem type gpu matrix elem type assign element invers of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac sigmoid




elem type
gpu matrix elem type gpu matrix elem type assign sigmoid of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac sigmoid deriv




elem type
gpu matrix elem type gpu matrix elem type assign sigmoid deriv of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac tanh




elem type
gpu matrix elem type gpu matrix elem type assign tanh of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac log softmax is col wise




elem type
gpu matrix elem type gpu matrix elem type assign log softmax of gpu matrix elem type is col wise




elem type
gpu matrix elem type gpu matrix elem type inplac hardmax is col wise




elem type
gpu matrix elem type gpu matrix elem type assign hardmax of gpu matrix elem type is col wise




elem type
gpu matrix elem type gpu matrix elem type drop frame gpu matrix elem type label gpu matrix elem type gamma elem type threshhold



elem type
gpu matrix elem type gpu matrix elem type assign sequenc error elem type hsmooth weight gpu matrix elem type label gpu matrix elem type dnnoutput gpu matrix elem type gamma elem type alpha




elem type
gpu matrix elem type gpu matrix elem type inplac sqrt




elem type
gpu matrix elem type gpu matrix elem type assign sqrt of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac exp




elem type
gpu matrix elem type gpu matrix elem type assign exp of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac log




elem type
gpu matrix elem type gpu matrix elem type assign log of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac ab




elem type
gpu matrix elem type gpu matrix elem type assign ab of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac linear rectifi deriv




elem type
gpu matrix elem type gpu matrix elem type assign linear rectifi deriv of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac cosin




elem type
gpu matrix elem type gpu matrix elem type assign cosin of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac neg sine




elem type
gpu matrix elem type gpu matrix elem type assign neg sine of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type inplac truncat bottom elem type threshold




elem type
gpu matrix elem type gpu matrix elem type assign truncat bottom of gpu matrix elem type elem type threshold




elem type
gpu matrix elem type gpu matrix elem type inplac truncat top elem type threshold




elem type
gpu matrix elem type gpu matrix elem type assign truncat top of gpu matrix elem type elem type threshold



elem type
gpu matrix elem type gpu matrix elem type set to zero if ab less than elem type threshold




elem type
elem type gpu matrix elem type sum of ab element

elem type


elem type
elem type gpu matrix elem type sum of element

elem type


elem type
gpu matrix elem type gpu matrix elem type assign sum of element gpu matrix elem type



elem type
gpu matrix elem type minu one at gpu matrix elem type size posit



elem type
gpu matrix elem type vector sum gpu matrix elem type gpu matrix elem type is col wise



elem type
gpu matrix elem type gpu matrix elem type inplac truncat elem type threshold




elem type
gpu matrix elem type gpu matrix elem type inplac soft threshold elem type threshold




elem type
gpu matrix elem type gpu matrix elem type get a row by index gpu matrix elem type size




elem type
gpu matrix elem type gpu matrix elem type assign element product of with shift neg gpu matrix elem type gpu matrix elem type size shift size




elem type
gpu matrix elem type gpu matrix elem type assign element product of with shift gpu matrix elem type gpu matrix elem type size shift




elem type
gpu matrix elem type inner product with shift neg gpu matrix elem type gpu matrix elem type gpu matrix elem type size shift size



elem type
gpu matrix elem type conduct row element multipli with shift gpu matrix elem type gpu matrix elem type gpu matrix elem type size shift isafix



elem type
devic bound number elem type gpu matrix elem type as devic bound num

devic bound number elem type result
result


elem type
elem type gpu matrix elem type

elem type


elem type
gpu matrix elem type gpu matrix elem type element multipli with gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign element product of gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type assign element divis of gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type element divid by gpu matrix elem type




elem type
gpu matrix elem type is equal to gpu matrix elem type elem type threshold

are equal threshold


elem type
gpu matrix elem type vector norm1 gpu matrix elem type is col wise



elem type
gpu matrix elem type gpu matrix elem type assign vector norm1 of gpu matrix elem type is col wise




elem type
gpu matrix elem type vector norm2 gpu matrix elem type is col wise



elem type
gpu matrix elem type gpu matrix elem type assign vector norm2 of gpu matrix elem type is col wise




elem type
gpu matrix elem type vector norm inf gpu matrix elem type is col wise



elem type
gpu matrix elem type gpu matrix elem type assign vector norm inf of gpu matrix elem type is col wise




elem type
gpu matrix elem type gpu matrix elem type assign inner product of gpu matrix elem type gpu matrix elem type is col wise




elem type
gpu matrix elem type gpu matrix elem type assign khatri rao product of gpu matrix elem type gpu matrix elem type




column wise reshap product use comput khatri rao product gradient
reshap column k1x k2
column transpos time column frame
output frame matrix
column tranpos time column frame output frame
elem type
gpu matrix elem type gpu matrix elem type add column reshap product of gpu matrix elem type gpu matrix elem type transpos a column




elem type
gpu matrix elem type gpu matrix elem type add with scale of elem type alpha gpu matrix elem type




elem type
elem type gpu matrix elem type frobeniu norm

elem type



elem type
gpu matrix elem type gpu matrix elem type assign frobeniu norm of gpu matrix elem type




elem type
elem type gpu matrix elem type matrix norm inf

elem type max ab
max ab


elem type
elem type gpu matrix elem type matrix norm1

elem type


elem type
elem type gpu matrix elem type matrix norm0

elem type


elem type
gpu matrix elem type gpu matrix elem type assign sign of gpu matrix elem type




elem type
gpu matrix elem type gpu matrix elem type add sign of gpu matrix elem type




elem type
gpu matrix elem type vector max gpu matrix elem type max index gpu matrix elem type max valu is col wise



elem type
gpu matrix elem type vector max gpu matrix elem type max index gpu matrix elem type max valu is col wise top k



elem type
gpu matrix elem type vector min gpu matrix elem type min index gpu matrix elem type min valu is col wise



elem type
gpu matrix elem type gpu matrix elem type assign num of diff gpu matrix elem type gpu matrix elem type search in col




pragma endregion member bla function

pragma region other helper function
elem type
gpu matrix elem type print matrix name size row start size row end size col start size col end



elem type
gpu matrix elem type print matrix name nullptr



helpfer use convolut neural network
elem type
gpu matrix elem type gpu matrix elem type assign pack convolut input gpu matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad




helpfer use convolut neural network
elem type
gpu matrix elem type gpu matrix elem type unpack convolut input gpu matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad

input sub batch


elem type
gpu matrix elem type gpu matrix elem type assign max pool result gpu matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl




elem type
gpu matrix elem type gpu matrix elem type add max pool gradient gpu matrix elem type output gradient batch gpu matrix elem type input batch gpu matrix elem type output batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl




elem type
gpu matrix elem type gpu matrix elem type assign averag pool result gpu matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl




elem type
gpu matrix elem type gpu matrix elem type add averag pool gradient gpu matrix elem type output gradient batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl




elem type
gpu matrix elem type convolut forward gpu matrix elem type kernel gpu matrix mp row col gpu matrix mp row iwht
gpu matrix mp row run gpu matrix run gpu matrix elem type output



elem type
gpu matrix elem type convolut backward data gpu matrix elem type kernel gpu matrix mp row col gpu matrix mp row iwht
gpu matrix mp row run gpu matrix run gpu matrix elem type grad



elem type
gpu matrix elem type convolut backward kernel gpu matrix elem type gpu matrix mp row col gpu matrix mp row iwht
gpu matrix mp row run gpu matrix run gpu matrix elem type kernel grad



elem type
gpu matrix elem type max pool forward gpu matrix mp row col gpu matrix mp row indic gpu matrix indic gpu matrix elem type output



elem type
gpu matrix elem type max pool backward gpu matrix elem type gpu matrix elem type
gpu matrix mp row col gpu matrix mp row indic gpu matrix indic
gpu matrix elem type grad



elem type
gpu matrix elem type averag pool forward gpu matrix mp row col gpu matrix mp row indic gpu matrix indic gpu matrix elem type output



elem type
gpu matrix elem type averag pool backward gpu matrix mp row col gpu matrix mp row indic gpu matrix indic gpu matrix elem type grad



elem type
gpu matrix elem type batch normal forward gpu matrix elem type scale gpu matrix elem type bia exp avg factor blend factor
gpu matrix elem type run mean gpu matrix elem type run inv std dev gpu matrix elem type epsilon
gpu matrix elem type save mean gpu matrix elem type save inv std dev



elem type
gpu matrix elem type batch normal backward gpu matrix elem type gpu matrix elem type grad gpu matrix elem type scale
gpu matrix elem type save mean gpu matrix elem type save inv std dev
gpu matrix elem type scale grad gpu matrix elem type bia grad



pragma endregion other helper function

pragma region static bla function
elem type
gpu matrix elem type multipli and weight add elem type alpha gpu matrix elem type transpos a gpu matrix elem type transpos b
elem type beta gpu matrix elem type


elem type
gpu matrix elem type multiply1x1 and weight add elem type alpha gpu matrix elem type gpu matrix elem type elem type beta gpu matrix elem type



elem type
gpu matrix elem type multipli and add gpu matrix elem type transpos a gpu matrix elem type transpos b gpu matrix elem type



elem type
gpu matrix elem type multipli gpu matrix elem type transpos a gpu matrix elem type transpos b gpu matrix elem type



elem type
gpu matrix elem type multipli gpu matrix elem type gpu matrix elem type gpu matrix elem type



summari matrix scalar multipli major matric alpha summari
column vector column
vector row
scalar element
param name alpha scalar param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type scale and add elem type alpha gpu matrix elem type gpu matrix elem type



summari matrix scalar multipli major matric alpha summari
column vector column
vector row
scalar element
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type scale and add elem type alpha gpu matrix elem type gpu matrix elem type gpu matrix elem type



summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type add scale differ elem type alpha gpu matrix elem type gpu matrix elem type gpu matrix elem type



summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type assign scale differ elem type alpha gpu matrix elem type gpu matrix elem type gpu matrix elem type



summari alpha summari
must
param name alpha matrix param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type add scale differ gpu matrix elem type alpha gpu matrix elem type gpu matrix elem type gpu matrix elem type



summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
gpu matrix elem type assign scale differ gpu matrix elem type alpha gpu matrix elem type gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type add element to element elem type beta gpu matrix elem type size size gpu matrix elem type size size



elem type
gpu matrix elem type scale elem type alpha gpu matrix elem type



elem type
gpu matrix elem type scale gpu matrix elem type alpha gpu matrix elem type



elem type alpha
gpu matrix elem type scale elem type alpha gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type ha element gpu matrix elem type elem type valu




elem type
gpu matrix elem type inner product gpu matrix elem type gpu matrix elem type gpu matrix elem type is col wise



elem type
elem type gpu matrix elem type inner product of matric gpu matrix elem type gpu matrix elem type

elem type


elem type
gpu matrix elem type gpu matrix elem type assign inner product of matric gpu matrix elem type gpu matrix elem type




elem type
gpu matrix elem type element wise power elem type alpha gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type are equal gpu matrix elem type gpu matrix elem type elem type threshold




elem type
gpu matrix elem type tensor shuffl scale and add elem type keep weight gpu matrix elem type size size size size size elem type scale factor gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type tensor op elem type beta gpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride


elem type
gpu matrix elem type tensor op elem type beta gpu matrix elem type gpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride


elem type
gpu matrix elem type tensor op elem type beta gpu matrix elem type gpu matrix elem type gpu matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride



elem type
gpu matrix elem type creat curand object seed caller



elem type
gpu matrix elem type reset curand object seed caller



elem type
gpu matrix elem type gpu matrix elem type one size row size col devic id

gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type zero size row size col devic id

gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type size row devic id

gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type random uniform size row size col devic id elem type elem type high seed

gpu matrix elem type



elem type
gpu matrix elem type gpu matrix elem type random gaussian size row size col devic id elem type mean elem type sigma seed

gpu matrix elem type



elem type
elem type gpu matrix elem type get learn rate for block helper gpu matrix elem type gradient gpu matrix elem type smooth gradient

elem type


elem type
elem type gpu matrix elem type log sum of element

elem type


elem type
gpu matrix elem type rcrf backward comput
gpu matrix elem type alpha gpu matrix elem type beta
gpu matrix elem type lbl
gpu matrix elem type score gpu matrix elem type pair score shift



elem type
gpu matrix elem type rcrf tran grd comput gpu matrix elem type lbl
gpu matrix elem type alpha
gpu matrix elem type beta
gpu matrix elem type pair score
gpu matrix elem type
start lbl
shift



elem type
gpu matrix elem type assign nois contrast estim gpu matrix elem type
gpu matrix elem type gpu matrix elem type bia size sampl count gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type assign nce deriv gpu matrix elem type gpu matrix elem type
gpu matrix elem type size input index gpu matrix elem type



elem type
gpu matrix elem type assign softmax sum gpu matrix elem type gpu matrix elem type



elem type
gpu matrix elem type assign nce unnorm eval gpu matrix elem type gpu matrix elem type gpu matrix elem type


pragma endregion static bla function

pragma region matrix quantiz gpu function
elem type
matrix quantiz gpu elem type matrix quantiz gpu devic id use dedic comput stream forc sync



elem type
matrix quantiz gpu elem type matrix quantiz gpu



elem type
matrix quantiz gpu elem type quantiz async matrix elem type in matrix matrix elem type in residu quantiz matrix elem type out q matrix matrix elem type out residu zero threshold for1 bit



elem type
matrix quantiz gpu elem type wait quantiz async done



elem type
matrix quantiz gpu elem type unquant async quantiz matrix elem type in q matrix matrix elem type out matrix



elem type
matrix quantiz gpu elem type wait unquant async done



pragma endregion matrix quantiz gpu function

pragma region gpu matrix comput stream event function

gpu matrix comput stream event gpu matrix comput stream event devic id
matrix comput stream event devic id



gpu matrix comput stream event gpu matrix comput stream event
gpu matrix comput stream event synchron event

gpu matrix comput stream event synchron quantiz comput stream with event

gpu matrix comput stream event synchron quantiz comput stream with event

gpu matrix comput stream event synchron data transfer fetch stream with event

gpu matrix comput stream event synchron data transfer fetch stream with event

pragma endregion gpu matrix comput stream event function

pragma region gpu data transfer function

elem type
gpu data transfer elem type gpu data transfer



elem type
gpu data transfer elem type gpu data transfer



elem type
gpu data transfer elem type copi gpu to cpu async elem type size elem type



elem type
gpu data transfer elem type wait for copi gpu to cpu async



elem type
gpu data transfer elem type copi cpu to gpu async elem type size elem type



elem type
gpu data transfer elem type wait for copi cpu to gpu async



pragma endregion gpu data transfer function

gpu matrix
gpu matrix
gpu matrix
gpu matrix
devic bound number
devic bound number
matrix quantiz gpu matrix quantiz gpu
matrix quantiz gpu matrix quantiz gpu
matrix quantiz gpu quantiz async matrix matrix quantiz matrix matrix
matrix quantiz gpu quantiz async matrix matrix quantiz matrix matrix

gpu data transfer
gpu data transfer

elem type
cubla handl gpu matrix elem type cu handl gpu matrix elem type max gpu

elem type
gpu matrix elem type curand gener

elem type
uniqu convolut engin elem type cu dnn convolut engin factori elem type creat convolv geometri ptr deviceid type
imag layout kind size pool kind

runtim error code compil cpuonli macro


elem type
cu dnn convolut engin factori elem type is support deviceid type convolv geometri ptr pool kind




cu dnn convolut engin factori
cu dnn convolut engin factori

elem type
uniqu batch norm engin elem type cu dnn batch norm engin factori elem type creat deviceid type devic id tensor shape in out t
spatial imag layout kind imag layout

runtim error code compil cpuonli macro


cu dnn batch norm engin factori
cu dnn batch norm engin factori

cuda timer cuda timer


cuda timer start


cuda timer stop


cuda timer elaps






defin dummi gpu watcher
gpu watcher

gpu watcher get gpu id with the most free memori




size gpu watcher get free memori on cuda devic dev id




gpu watcher gpu watcher



gpu watcher gpu watcher



cpuonli
stdafx
matrix
matrix quantiz impl
matrix quantiz cpu
matrix quantiz gpu

microsoft cntk

elem type
matrix quantiz impl elem type matrix quantiz impl elem type creat devic id use async

devic id

ifndef cpuonli
use dedic comput stream use async
matrix quantiz gpu elem type devic id use dedic comput stream

use async
runtim error creat matrix quantiz attempt compil without support




matrix quantiz cpu elem type



matrix quantiz impl
matrix quantiz impl

matrix comput stream event matrix comput stream event creat devic id

devic id
gpu matrix comput stream event devic id

matrix comput stream event devic id


matrix comput stream event matrix comput stream event



matrix comput stream event synchron event



elem type
matrix comput stream event synchron quantiz comput stream with event

devic id

gpu matrix comput stream event gpu event dynam cast gpu matrix comput stream event
gpu event synchron quantiz comput stream with event elem type



elem type
matrix comput stream event synchron data transfer fetch stream with event

devic id

gpu matrix comput stream event gpu event dynam cast gpu matrix comput stream event
gpu event synchron data transfer fetch stream with event elem type



matrix comput stream event matrix comput stream event devic id
devic id devic id



explicit instanti
math matrix comput stream event synchron quantiz comput stream with event
math matrix comput stream event synchron quantiz comput stream with event
math matrix comput stream event synchron data transfer fetch stream with event
math matrix comput stream event synchron data transfer fetch stream with event


copyright microsoft right reserv
licens licens licens file project root full licens inform

matrix main file contain matrix function export cntk math

stdafx
basic
matrix
cpu matrix
cpu spars matrix
gpu matrix
gpu spars matrix
file

math
gpu watcher bring well get export
memori
ifndef cpuonli
pragma comment math cuda built cntk math cuda project


pragma warn disabl 4127 condit express constant elem type trigger
pragma warn disabl 4239 nonstandard extens trigger pattern second transpos b gpu matrix transpos gpu matrix
pragma warn disabl 4702 unreach code trigger unknown reason

ifndef
defin


helper dispath matrix call underli matrix librari dens spars
matrix pointer to check determin oper take place
matrix pointer to set flag output locat both collaps
defin dispatch matrix flag matrix pointer to check matrix pointer to set flag cpu dens gpu dens cpu spars gpu spars

current data locat cur locat matrix pointer to check get current matrix locat
cur locat current data locat cur locat current data locat both

matrix pointer to check get matrix type matrix type spars

gpu dens
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type dens



gpu spars
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type spars


cur locat current data locat

matrix pointer to check get matrix type matrix type spars

cpu dens
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type dens



cpu spars
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type spars




runtim error matric exist either



version dispatch macro prefer matrix pointer to check locat both
defin dispatch matrix flag usecpu 4 both matrix pointer to check matrix pointer to set flag cpu dens gpu dens cpu spars gpu spars

current data locat cur locat matrix pointer to check get current matrix locat
cur locat current data locat

matrix pointer to check get matrix type matrix type spars

gpu dens
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type dens



gpu spars
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type spars


cur locat current data locat cur locat current data locat both

matrix pointer to check get matrix type matrix type spars

cpu dens
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type dens



cpu spars
matrix pointer to set flag nullptr
matrix matrix pointer to set flag set data locat current data locat matrix type spars




runtim error matric exist either



version helper macro execut macro matrix pointer locat both
defin dispatch matrix flag useboth 4 both matrix pointer cpu dens gpu dens cpu spars gpu spars

cur locat matrix pointer get current matrix locat
cur matrix type matrix pointer get matrix type
cur locat current data locat none
logic error matric exist either
cur matrix type matrix type undetermin
logic error matric must spars dens
cur locat current data locat both

cur matrix type matrix type dens

gpu dens



gpu spars


cur locat current data locat both

cur matrix type matrix type dens

cpu dens



cpu spars




microsoft cntk

matrix base matrix base

pragma region constructor destructor matrix builder


todo reformat dispatch macro follow form
dispatch
code
code


initi member virgin memori
thi initi bland matrix actual matric need alloc
call flag need correctli call set data locat
thi clear entir bring destruct state
note keep sync member definit shallow copi from
elem type
matrix elem type init deviceid type devic id

base matrix nullptr
gpu matrix nullptr
cpu matrix nullptr
gpu spars matrix nullptr
cpu spars matrix nullptr

matrix type matrix type undetermin
current data locat current data locat none

prefer devic id devic id
num time devic chang
num time matrix type chang
devic transfer to devic transfer to cpudevic valu differ valid valu


shallow copi member
elem type
matrix elem type shallow copi from matrix elem type

base matrix base matrix
gpu matrix gpu matrix
cpu matrix cpu matrix
gpu spars matrix gpu spars matrix
cpu spars matrix cpu spars matrix

matrix type matrix type
current data locat current data locat

prefer devic id prefer devic id
num time devic chang num time devic chang
num time matrix type chang num time matrix type chang
devic transfer to devic transfer to todo spell
devic transfer to devic transfer to


call updat oper creat updat respect pointer
locat both
both read allow write call
current both written
what get updat
current data locat argument
matrix type argument undetermin matrix type remain unmodifi
base matrix current valu spars matrix
thi heavili overload respons
first time initi column slice none none
creat temp copi read
collaps temp copi write
set matrix type
elem type
matrix elem type set data locat current data locat locat matrix type

locat current data locat locat current data locat locat current data locat both

use live both collaps locat actual wrote both
saniti check singleton view
sinc otherwis collaps would unnot view
case cover
everyth allow singleton view
current state both
result written locat collaps
multipl view much forbidden sinc cannot notifi view written
forbidden
both current state both locat say side written
forbidden write
both current state
view onto both state
ineffic read sinc like happen cannot view both state
both both
read
write forbidden call
none none forbidden
current data locat locat attempt chang locat
current data locat current data locat none valid none mean fresh column slice
locat current data locat both chang temporari copi read

wrote both longer move
both forbidden share view sinc cannot inform view chang
check valid pointer uniqu there mismatch left pointer kept around reviv
matrix type matrix type dens note check current pass asssumpt tell pointer valid

current data locat current data locat cpu matrix
current data locat current data locat gpu matrix
current data locat current data locat base matrix elem type cpu matrix verifi migrat set data locat cpu matrix
current data locat current data locat base matrix elem type gpu matrix verifi migrat set data locat gpu matrix

matrix type matrix type spars

current data locat current data locat cpu spars matrix
current data locat current data locat gpu spars matrix
current data locat current data locat base matrix elem type cpu spars matrix verifi migrat set data locat cpu spars matrix
current data locat current data locat base matrix elem type gpu spars matrix verifi migrat set data locat gpu spars matrix

todo need typecast without fail cannot access member declar microsoft cntk cpu matrix

base matrix own buffer extern own matric read temp write
logic error set data locat own cannot written both state

pass valid updat state

current data locat locat

updat matrix pass
matrix type undetermin
matrix type

base matrix locat unchang chang pointer
note current data locat also current data locat both matrix
matrix type matrix type dens
base matrix current data locat current data locat dynam pointer cast base matrix elem type cpu matrix dynam pointer cast base matrix elem type gpu matrix
matrix type matrix type spars
base matrix current data locat current data locat dynam pointer cast base matrix elem type cpu spars matrix dynam pointer cast base matrix elem type gpu spars matrix
note typecast necessari sinc cannot figur common probabl share
saniti check
base matrix matrix type matrix type undetermin
logic error set data locat base matrix must


use intern initi blank matrix
elem type
matrix elem type matrix matrix flag matrix flag matrix type matrix type matrix format matrix format deviceid type devic id

init devic id

matrix flag matrix flag dont own buffer
switch to matrix type matrix type matrix format


use intern initi blank matrix
elem type
matrix elem type matrix matrix flag matrix flag matrix type matrix type deviceid type devic id

init devic id

matrix flag matrix flag dont own buffer
switch to matrix type matrix type matrix type matrix type dens matrix format matrix format dens matrix format matrix format spars csc


use intern initi blank matrix
elem type
matrix elem type matrix matrix flag matrix flag deviceid type devic id

init devic id

matrix flag matrix flag dont own buffer
switch to matrix type matrix type dens matrix format matrix format dens


elem type
matrix elem type matrix deviceid type devic id

init devic id

switch to matrix type matrix type dens matrix format matrix format dens


matrix wrap extern manag base matrix indic share
appropri destructor pass caller
base matrix matrix element
p array pointer current replac exist pointer base matrix
devic id devic id p array exist

elem type
matrix elem type matrix share base matrix elem type base matrix elem type p array deviceid type devic id set matrix matrix

init devic id

base matrix get format matrix format spars

prefer devic id cpudevic

cpu spars matrix down cast cpu spars matrix elem type base matrix
set data locat spars



gpu spars matrix down cast gpu spars matrix elem type base matrix
set data locat spars




prefer devic id cpudevic

cpu matrix down cast cpu matrix elem type base matrix
set data locat dens



gpu matrix down cast gpu matrix elem type base matrix
set data locat dens


base matrix base matrix
base matrix set buffer p array



elem type
matrix elem type matrix size num row size num col deviceid type devic id matrix type matrix type matrix format matrix format

init devic id

matrix type matrix type spars

prefer devic id cpudevic

cpu spars matrix make share cpu spars matrix elem type matrix format num row num col
set data locat spars



gpu spars matrix make share gpu spars matrix elem type num row num col prefer devic id matrix format
set data locat spars




matrix format matrix format dens

implement


prefer devic id cpudevic

cpu matrix make share cpu matrix elem type num row num col
set data locat dens



gpu matrix make share gpu matrix elem type num row num col prefer devic id
set data locat dens


set valu



elem type
matrix elem type matrix size num row size num col elem type p array deviceid type devic id size matrix flag size

init devic id

prefer devic id cpudevic

matrix flag matrix format spars

warn matrix flag pass extern manag cannot pass
cpu spars matrix make share cpu spars matrix elem type matrix format spars csc num row num col
set data locat spars



cpu matrix make share cpu matrix elem type num row num col p array matrix flag
set data locat dens




matrix flag matrix format spars

gpu spars matrix gpu spars matrix elem type num row num col p array matrix flag prefer devic id
gpu spars matrix make share gpu spars matrix elem type prefer devic id matrix format matrix flag matrix format matrix format mask
gpu spars matrix requir size and alloc num row num col
set data locat spars



gpu matrix make share gpu matrix elem type num row num col prefer devic id p array matrix flag
set data locat dens





matrix flag dont own buffer matrix flag
base matrix set own buffer



copi deep copi
elem type
matrix elem type matrix elem type deep clone

matrix elem type get devic id


elem type
matrix elem type matrix matrix elem type deep copi from deviceid type devic id

orig copi from devic id deep copi from get devic id

init devic id prefer devic id

deep copi from transfer to devic prefer devic id

dispatch matrix flag deep copi from

cpu matrix make share cpu matrix elem type deep copi from cpu matrix
gpu matrix make share gpu matrix elem type deep copi from gpu matrix
cpu spars matrix make share cpu spars matrix elem type deep copi from cpu spars matrix
gpu spars matrix make share gpu spars matrix elem type deep copi from gpu spars matrix

move back
deep copi from transfer to devic orig copi from devic id

prefer devic id deep copi from prefer devic id



move shallow copi
elem type
matrix elem type matrix matrix elem type move from

init deviceid type move from get devic id


move move from

dispatch matrix flag move from

cpu matrix cpu matrix elem type cast cpu matrix elem type move from cpu matrix
gpu matrix gpu matrix elem type cast gpu matrix elem type move from gpu matrix
cpu spars matrix cpu spars matrix elem type cast cpu spars matrix elem type move from cpu spars matrix
gpu spars matrix gpu spars matrix elem type cast gpu spars matrix elem type move from gpu spars matrix

prefer devic id move from prefer devic id



move assign shallow copi
elem type
matrix elem type matrix elem type matrix elem type move from

move from
logic error matrix move assign forbidden

shallow copi member
shallow copi from move from
virgin init sourc
move from init cpudevic

prefer devic id move from prefer devic id

dispatch matrix flag move from

cpu matrix nullptr cpu matrix cast cpu matrix elem type move from cpu matrix
cpu matrix cpu matrix elem type cast cpu matrix elem type move from cpu matrix

gpu matrix nullptr gpu matrix cast gpu matrix elem type move from gpu matrix
gpu matrix gpu matrix elem type cast gpu matrix elem type move from gpu matrix

cpu spars matrix nullptr cpu spars matrix cast cpu spars matrix elem type move from cpu spars matrix
cpu spars matrix cpu spars matrix elem type cast cpu spars matrix elem type move from cpu spars matrix

gpu spars matrix nullptr gpu spars matrix cast gpu spars matrix elem type move from gpu spars matrix
gpu spars matrix gpu spars matrix elem type cast gpu spars matrix elem type move from gpu spars matrix





elem type
matrix elem type releas memori

cpu matrix nullptr
gpu matrix nullptr
gpu spars matrix nullptr
cpu spars matrix nullptr

matrix type matrix type undetermin
current data locat current data locat none


elem type
matrix elem type matrix

releas memori


elem type
matrix elem type matrix elem type one size row size col deviceid type devic id

matrix elem type row col devic id initi
set valu



elem type
matrix elem type matrix elem type zero size row size col deviceid type devic id

matrix elem type row col devic id initi
set valu



elem type
matrix elem type matrix elem type size row deviceid type devic id

matrix elem type row row devic id initi
set diagon valu



elem type
matrix elem type matrix elem type random uniform size row size col deviceid type devic id elem type elem type high seed

matrix elem type row col devic id initi
set uniform random valu high seed



elem type
matrix elem type matrix elem type random gaussian size row size col deviceid type devic id elem type mean elem type sigma seed

matrix elem type row col devic id initi
set gaussian random valu mean sigma seed



elem type
matrix elem type set devic deviceid type devic id

devic id
gpu matrix elem type set devic devic id


elem type
matrix elem type read file stream

matrix elem type

stream


get devic id

cpu matrix
cpu matrix make share cpu matrix elem type
stream cpu matrix
set data locat dens



gpu matrix
gpu matrix make share gpu matrix elem type get devic id
stream gpu matrix
set data locat dens




get devic id

implement might want tranfer matrix



gpu spars matrix
gpu spars matrix make share gpu spars matrix elem type get devic id
stream gpu spars matrix
set data locat spars



logic error read input file corrupt invalid matrix field


elem type
matrix elem type write file stream

matrix elem type
get matrix type matrix type dens

stream
get devic id
stream cpu matrix

stream gpu matrix



stream
get devic id
implement stream cpu matrix
stream
gpu spars matrix



pragma endregion constructor destructor matrix builder

pragma region basic oper

elem type
size matrix elem type buffer size

dispatch matrix flag
nullptr
base matrix get size alloc elem type
base matrix get size alloc elem type
cpu spars matrix buffer size
gpu spars matrix buffer size alloc


bugbug thi ugli code outsid world access pointer
use least also byte well
elem type
elem type matrix elem type data

dispatch matrix flag
nullptr
cpu matrix data
gpu matrix data
cpu spars matrix data
gpu spars matrix data


elem type
elem type matrix elem type copi to array

dispatch matrix flag
nullptr
cpu matrix copi to array
gpu matrix copi to array
implement
implement


memori alloc calle enough need delet caller done
element copi
elem type
size matrix elem type copi to array elem type array copi to size current array size

dispatch matrix flag
nullptr
cpu matrix copi to array array copi to current array size
gpu matrix copi to array array copi to current array size
implement
implement


elem type
matrix elem type copi section size num row size num col elem type size col stride

dispatch matrix flag
nullptr
cpu matrix copi section num row num col col stride
gpu matrix copi section num row num col col stride
implement
implement


bugbug some code check call whether dimens
thi must handl properli preserv zero dimens
elem type
matrix elem type matrix elem type column slice size start column size num col

dev id get devic id

matrix elem type slice matrix flag dont own buffer deviceid type dev id alreadi creat pointer

slice prefer devic id prefer devic id

creat slice underli
note locat both creat object like sourc
get matrix type matrix type dens

get current matrix locat get current matrix locat both

slice cpu matrix
slice cpu matrix cast cpu matrix elem type cpu matrix column slice start column num col

slice cpu matrix make share cpu matrix elem type cast cpu matrix elem type cpu matrix column slice start column num col

get current matrix locat get current matrix locat both

slice gpu matrix
slice gpu matrix cast gpu matrix elem type gpu matrix column slice start column num col

slice gpu matrix make share gpu matrix elem type cast gpu matrix elem type gpu matrix column slice start column num col


get matrix type matrix type spars

get current matrix locat get current matrix locat both

slice cpu spars matrix
slice cpu spars matrix cast cpu spars matrix elem type cpu spars matrix column slice start column num col

slice cpu spars matrix make share cpu spars matrix elem type cast cpu spars matrix elem type cpu spars matrix column slice start column num col

get current matrix locat get current matrix locat both

slice gpu spars matrix
slice gpu spars matrix cast gpu spars matrix elem type gpu spars matrix column slice start column num col

slice gpu spars matrix make share gpu spars matrix elem type cast gpu spars matrix elem type gpu spars matrix column slice start column num col



logic error undetermin matrix

updat slice current data locat matrix type base matrix
thi work both
slice set data locat get current matrix locat get matrix type

slice


elem type
matrix elem type matrix elem type assign column slice matrix elem type from matrix size start column size num col

releas memori
prefer devic id from matrix prefer devic id

dispatch matrix flag from matrix

cpu matrix cpu matrix assign column slice from matrix cpu matrix start column num col
cpu matrix make share cpu matrix elem type from matrix cpu matrix column slice start column num col

gpu matrix gpu matrix assign column slice from matrix gpu matrix start column num col
gpu matrix make share gpu matrix elem type from matrix gpu matrix column slice start column num col

implement

implement




elem type
matrix elem type matrix elem type set column slice matrix elem type from matrix size start column size num col

cpu matrix gpu matrix
must alreadi alloc

dispatch matrix flag from matrix

cpu matrix set column slice from matrix cpu matrix start column num col
gpu matrix set column slice from matrix gpu matrix start column num col
implement
implement




elem type
matrix elem type copi column stride matrix elem type from matrix size num col size src num col stride size dest num col stride

cpu matrix gpu matrix

dispatch matrix flag from matrix

cpu matrix copi column stride from matrix cpu matrix num col src num col stride dest num col stride
gpu matrix copi column stride from matrix gpu matrix num col src num col stride dest num col stride
implement
implement


elem type
matrix elem type matrix elem type diagon

dev id get devic id

matrix elem type diag matrix flag dont own buffer deviceid type dev id
diag prefer devic id prefer devic id

assign diagon valu to diag

diag


elem type
matrix elem type assign diagon valu to matrix elem type diag

dev id get devic id
decid and move to right devic diag

get matrix type matrix type dens

dev id cpudevic

diag cpu matrix
diag cpu matrix cast cpu matrix elem type cpu matrix diagon

diag cpu matrix make share cpu matrix elem type cast cpu matrix elem type cpu matrix diagon
diag set data locat dens



diag gpu matrix
diag gpu matrix cast gpu matrix elem type gpu matrix diagon

diag gpu matrix make share gpu matrix elem type cast gpu matrix elem type gpu matrix diagon
diag set data locat dens


get matrix type matrix type spars

todo implement optim diagon function spars matric diagon to dens instead
dev id cpudevic

diag cpu matrix
diag cpu matrix cast cpu matrix elem type cpu spars matrix diagon to dens

diag cpu matrix make share cpu matrix elem type cast cpu matrix elem type cpu spars matrix diagon to dens
diag set data locat dens



diag gpu matrix
diag gpu matrix cast gpu matrix elem type gpu spars matrix diagon to dens

diag gpu matrix make share gpu matrix elem type cast gpu matrix elem type gpu spars matrix diagon to dens
diag set data locat dens



logic error undetermin matrix



thi chang matrix dens spars
warn correct implement copi matrix dens spars
howev convers function implement alway creat
blank matrix destroy info origin matrix differ matrix ask
keep valu matrix content
elem type
matrix elem type switch to matrix type matrix type new matrix type matrix format new matrix format keep valu

thi check uncom unfortun still place
call incorrect format valu
matrix type new matrix type get format new matrix format
implement

matrix type new matrix type


base matrix
keep valu

defin matrixtyp chang warn
num time matrix type chang

num time matrix type chang matrixtyp chang warn
fprintf stderr warn matrix transfer differ devic time get num row get num col matrixtyp chang warn

get devic id

new matrix type matrix type spars

base matrix
cpu spars matrix make share cpu spars matrix elem type new matrix format

cpu spars matrix make share cpu spars matrix elem type new matrix format get num row get num col

keep valu
copi element from dens to spars cpu matrix cpu spars matrix

set data locat spars
cpu matrix nullptr

new matrix type matrix type dens

base matrix
cpu matrix make share cpu matrix elem type

cpu matrix make share cpu matrix elem type get num row get num col

keep valu
cpu matrix set valu cpu spars matrix copi column slice to dens get num col

set data locat dens
cpu spars matrix nullptr


logic error switch to matrix type unexpect invalid matrix



new matrix type matrix type spars

base matrix
gpu spars matrix make share gpu spars matrix elem type get devic id new matrix format

gpu spars matrix make share gpu spars matrix elem type get num row get num col get devic id new matrix format

keep valu
gpu spars matrix set valu gpu matrix

set data locat spars
gpu matrix nullptr

new matrix type matrix type dens

base matrix
gpu matrix make share gpu matrix elem type get devic id

gpu matrix make share gpu matrix elem type get num row get num col get devic id

keep valu
gpu spars matrix copi to dens matrix gpu matrix

set data locat dens
gpu spars matrix nullptr


logic error switch to matrix type unexpect invalid matrix



elem type
matrix elem type copi element from dens to spars cpu matrix elem type cpu spars matrix elem type dest

coord


dest set valu



elem type
elem type matrix elem type get00 element

dispatch matrix flag nullptr
cpu matrix get00 element
gpu matrix get00 element
implement
implement



elem type
elem type matrix elem type size size

dispatch matrix flag usecpu 4 both nullptr
cpu matrix
transfer from devic to devic get devic id cpudevic cpu matrix
implement
implement



warn thi slow gp us sinc requir copi valu cp us gp us
addit column slice use valu copi back
oper fail sinc memori manag slice
need modifi valu call version get valu unambigu
todo remov user set valu instead avoid potenti error
elem type
elem type matrix elem type size size

dispatch matrix flag usecpu 4 both nullptr
cpu matrix

transfer from devic to devic get devic id cpudevic
set data locat dens
cpu matrix

implement
implement


elem type
matrix elem type matrix elem type transpos

is empti
logic error transpos matrix

matrix elem type get num col get num row deviceid type get devic id get matrix type get format
assign transpos of



elem type
matrix elem type matrix elem type assign transpos of matrix elem type

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag
cpu matrix assign transpos of cpu matrix
gpu matrix assign transpos of gpu matrix
implement
gpu spars matrix assign transpos of gpu spars matrix




alpha beta
width contain valu
invalid entri column denot
elem type
matrix elem type matrix elem type do gather column of elem type beta matrix elem type matrix elem type elem type alpha

decid and move to right devic todo move target beta

dispatch matrix flag
cpu matrix do gather column of beta cpu matrix cpu matrix alpha
gpu matrix do gather column of beta gpu matrix gpu matrix alpha
implement
implement




alpha beta
width contain valu
unlik gather scatter must size alreadi
invalid entri column denot
elem type
matrix elem type matrix elem type do scatter column of elem type beta matrix elem type matrix elem type elem type alpha

decid and move to right devic todo move target beta

dispatch matrix flag
cpu matrix do scatter column of beta cpu matrix cpu matrix alpha
gpu matrix do scatter column of beta gpu matrix gpu matrix alpha
implement
implement




element matrix scalar valu
spars matric allow valu
elem type
matrix elem type set valu elem type

is empti done


get matrix type matrix type spars spars set special

reset



dispatch matrix flag
cpu matrix set valu
gpu matrix set valu
implement
implement


elem type
matrix elem type set valu devic bound number elem type

is empti done


dispatch matrix flag
cpu matrix set valu expos pointer2 valu

get devic id get devic id
runtim error matrix devic bound must devic
gpu matrix set valu expos pointer2 valu

implement
implement



matrix make nan size payload

nanf


matrix make nan size payload




matrix make nan size


need complet

elem type
matrix elem type mask column valu matrix column mask elem type

get num col column mask get num col
runtim error mask column valu matrix column mask must equal column

get current matrix locat column mask get current matrix locat column mask get current matrix locat both

get devic id column mask get devic id column mask get current matrix locat both
runtim error mask column valu matrix column mask must devic

dispatch matrix flag
cpu matrix mask column valu column mask cpu matrix
gpu matrix mask column valu column mask gpu matrix
cpu spars matrix mask column valu column mask cpu matrix
gpu spars matrix mask column valu column mask gpu matrix


elem type
matrix elem type set column elem type col pointer size col ind

col pointer nullptr
invalid argument set column col pointer

dispatch matrix flag

cpu matrix set column col pointer col ind
gpu matrix set column col pointer col ind
implement
implement


elem type
matrix elem type set column elem type size col ind

dispatch matrix flag

cpu matrix set column col ind
implement
implement
implement


elem type
matrix elem type set column matrix elem type col mat size col ind

decid and move to right devic col mat

dispatch matrix flag

cpu matrix set column col mat cpu matrix col ind
gpu matrix set column col mat gpu matrix col ind
implement
implement


elem type
matrix elem type set valu matrix elem type deep copi from matrix format format matrix format spars csr

deep copi from


prefer devic id deep copi from prefer devic id
decid and move to right devic deep copi from
switch to matrix type deep copi from get matrix type format

dispatch matrix flag deep copi from

cpu matrix set valu deep copi from cpu matrix
gpu matrix set valu deep copi from gpu matrix
cpu spars matrix set valu deep copi from cpu spars matrix
gpu spars matrix set valu deep copi from gpu spars matrix


elem type
matrix elem type set valu size num row size num col devic id elem type p array size matrix flag

num row num col p array nullptr
invalid argument invalid p array

dispatch matrix flag

cpu matrix set valu num row num col p array matrix flag
gpu matrix set valu num row num col devic id p array matrix flag
implement
implement


elem type
matrix elem type set valu size r idx size c idx elem type

dispatch matrix flag usecpu 4 both

cpu matrix r idx c idx
implement
cpu spars matrix set valu r idx c idx
implement


read featur
elem type
matrix elem type set matrix from csc format cpuspars index type csc col cpuspars index type elem type
size size num row size num col

dispatch matrix flag

implement
implement
cpu spars matrix set matrix from csc format csc col num row num col
gpu spars matrix set matrix from csc format csc col num row num col


elem type
matrix elem type set diagon valu elem type

is empti
logic error set diagon valu matrix

get num row get num col
logic error set diagon valu num row num col agre

dispatch matrix flag

cpu matrix set diagon valu
gpu matrix set diagon valu
implement
implement


elem type
matrix elem type set diagon valu matrix elem type vector

get num row get num col
logic error set diagon valu num row num col agre

vector get num row vector get num col
logic error set diagon valu input vector must vector

vector get num row vector get num col get num row
logic error set diagon valu input vector must match matrix dimens

is empti


decid and move to right devic vector

vector get num element reduc simpl form

dispatch matrix flag vector
nullptr
set diagon valu vector
set diagon valu vector gpu matrix get00 element bugbug effici
set diagon valu vector
set diagon valu vector gpu matrix get00 element bugbug effici


vector get num row get num row
logic error set diagon valu input vector dimens agre


warn pointer decid call howev vector store differ matrix dens spars
dispatch matrix flag

vector cpu matrix
cpu matrix set diagon valu vector cpu matrix
vector gpu matrix
gpu matrix set diagon valu vector gpu matrix
implement
implement



elem type
matrix elem type set uniform random valu elem type elem type high seed

is empti


dispatch matrix flag

cpu matrix set uniform random valu high seed
gpu matrix set uniform random valu high seed
implement
implement


elem type
matrix elem type set gaussian random valu elem type mean elem type sigma seed

sigma
invalid argument set uniform random valu sigma must posit valu

is empti


dispatch matrix flag

cpu matrix set gaussian random valu mean sigma seed
gpu matrix set gaussian random valu mean sigma seed
implement
implement


elem type
matrix elem type add gaussian random valu elem type mean elem type sigma seed

sigma
invalid argument set uniform random valu sigma must posit valu

is empti


dispatch matrix flag

cpu matrix add gaussian random valu mean sigma seed
implement
implement
implement


mask rate percentag valu mask similar dropout rate
scale valu scale valu left one unmask item
elem type
matrix elem type set uniform random mask elem type mask rate elem type scale valu seed

is empti


dispatch matrix flag

cpu matrix set uniform random mask mask rate scale valu seed
gpu matrix set uniform random mask mask rate scale valu seed
implement
implement


elem type
matrix elem type normal grad matrix elem type gradient
matrix elem type function valu
elem type learn rate per sampl
elem type momentum
use nesterov momentum

decid and move to right devic gradient function valu

use nesterov momentum

dispatch matrix flag gradient
nullptr
scale and add momentum learn rate per sampl gradient momentum
function valu
scale and add momentum learn rate per sampl gradient momentum
function valu
momentum gradient cpu spars matrix normal grad cpu matrix momentum
scale and add learn rate per sampl gradient function valu
momentum gradient gpu spars matrix normal grad gpu matrix momentum
scale and add learn rate per sampl gradient function valu



dispatch matrix flag gradient
nullptr
dens
scale and add momentum learn rate per sampl gradient momentum
scale and add momentum function valu
scale and add momentum learn rate per sampl gradient function valu
momentum momentum learn rate per sampel gardient

dens
scale and add momentum learn rate per sampl gradient momentum
scale and add momentum function valu
scale and add momentum learn rate per sampl gradient function valu

spars
momentum

matrix elem type gradient cach gradient get devic id
gradient cach set valu gradient
gradient cpu spars matrix normal grad cpu matrix momentum
scale and add momentum function valu
scale and add momentum learn rate per sampl gradient cach function valu


spars
momentum

matrix elem type gradient cach gradient get devic id
gradient cach set valu gradient
gradient gpu spars matrix normal grad gpu matrix momentum
scale and add momentum function valu
scale and add momentum learn rate per sampl gradient cach function valu





gradient chang
elem type
elem type matrix elem type adagrad matrix elem type gradient need ave multipli

decid and move to right devic gradient

dispatch matrix flag gradient gradient
cpu matrix adagrad gradient cpu matrix need ave multipli set data locat
gpu matrix adagrad gradient gpu matrix need ave multipli set data locat
gradient cpu spars matrix adagrad cpu matrix need ave multipli set data locat
gradient gpu spars matrix adagrad gpu matrix need ave multipli set data locat
note sinc gradient chang must call set data locat well


elem type
matrix elem type fs adagrad size mb size matrix elem type gradient matrix elem type function valu elem type learn rate per sampl elem type momentum

todo valu adagrad t targetadagradavdenom current hardcod constant taken empir determin
these made configur need
size adagrad t 3600
elem type targetadagradavdenom 0025 magic constant
elem type adagradkeepweight cast elem type mb size adagrad t

elem type aggadagradsqrfram
aggadagradsqrfram adagradkeepweight aggadagradsqrfram adagradkeepweight mb size
elem type targetadagradavdenom sqrtadagradsqrfram cast elem type targetadagradavdenom sqrt aggadagradsqrfram

dispatch matrix flag gradient gradient
cpu matrix fs adagrad gradient cpu matrix function valu cpu matrix learn rate per sampl momentum adagradkeepweight targetadagradavdenom sqrtadagradsqrfram set data locat
gpu matrix fs adagrad gradient gpu matrix function valu gpu matrix learn rate per sampl momentum adagradkeepweight targetadagradavdenom sqrtadagradsqrfram set data locat
implement
implement
note sinc gradient chang must call set data locat well


elem type
elem type matrix elem type rm prop matrix elem type gradient
elem type gamma
elem type
elem type
elem type
elem type
need ave multipli

decid and move to right devic gradient

dispatch matrix flag gradient
cpu matrix rm prop gradient cpu matrix gamma need ave multipli set data locat
gpu matrix rm prop gradient gpu matrix gamma need ave multipli set data locat
implement
implement
note sinc gradient chang must call set data locat well


elem type
matrix elem type reshap size num row size num col

num row get num row num col get num col

dispatch matrix flag
cpu matrix reshap num row num col
gpu matrix reshap num row num col
implement
gpu spars matrix reshap num row num col



note resiz leav matrix content
note resiz call requir size and alloc spars version perform reason extern caller know
elem type
matrix elem type resiz size num row size num col size num nz elem to reserv grow onli

todo test whether size chang skip least test code call recurr node
dispatch matrix flag useboth 4 both
cpu matrix resiz num row num col grow onli
gpu matrix resiz num row num col grow onli
cpu spars matrix requir size and alloc num row num col num nz elem to reserv grow onli
gpu spars matrix requir size and alloc num row num col num nz elem to reserv grow onli
ifdef debug
get matrix type matrix type spars
invalid fill matrix na ns detect content unfortun work spars matric



elem type
matrix elem type matrix elem type rep mat matrix elem type frm mat size row ratio size col ratio

size n col frm mat get num col
size n row frm mat get num row

row ratio
runtim error rep mat support ratio larger
size new col col ratio n col

matrix elem type n row new col frm mat get devic id
size col ratio

column slice n col n col set valu frm mat





elem type
size matrix elem type get alloc size

base matrix get size alloc


reset spars matrix semant set valu
elem type
matrix elem type reset

dispatch matrix flag useboth 4 both
implement
implement
cpu spars matrix reset
gpu spars matrix reset


elem type
size matrix elem type get num row

base matrix get num row


elem type
size matrix elem type get num col

base matrix get num col


elem type
size matrix elem type get num element

get num row get num col


elem type
matrix elem type is empti

base matrix is empti


pragma endregion basic oper

pragma region member bla function

elem type
matrix elem type matrix elem type elem type alpha

assign sum of alpha


elem type
matrix elem type matrix elem type elem type alpha

matrix elem type get num row get num col get devic id
assign sum of alpha



elem type
matrix elem type matrix elem type assign sum of elem type alpha matrix elem type

is empti
logic error assign sum of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sum of alpha cpu matrix
gpu matrix assign sum of alpha gpu matrix
implement
implement




dimens
column vector column
vector row
scalar element
elem type
matrix elem type matrix elem type matrix elem type

decid and move to right devic

get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix cpu matrix
gpu matrix gpu matrix
implement
implement




dimens output
column vector column
vector row
elem type
matrix elem type matrix elem type matrix elem type

get num element

matrix elem type deep clone

dispatch matrix flag


gpu matrix get00 element bugbug effici

implement


get num element

matrix elem type deep clone

dispatch matrix flag


gpu matrix get00 element bugbug effici

implement




matrix elem type deep clone implement introduc copi overhead make resu code





elem type
matrix elem type matrix elem type assign sum of matrix elem type matrix elem type

get num element

set valu




set valu





elem type
matrix elem type matrix elem type elem type alpha

assign differ of alpha


elem type
matrix elem type matrix elem type elem type alpha

matrix elem type get num row get num col get devic id
assign differ of alpha



column assign num row start start index
elem type
matrix elem type matrix elem type assign row slice valu of matrix elem type size start index size num row

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign row slice valu of cpu matrix start index num row
gpu matrix assign row slice valu of gpu matrix start index num row
implement
implement



column assign row start start index
elem type
matrix elem type matrix elem type assign to row slice valu of matrix elem type size start index size num row

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix assign to row slice valu of cpu matrix start index num row
gpu matrix assign to row slice valu of gpu matrix start index num row
implement
implement




slice start start index
elem type
matrix elem type matrix elem type add to row slice valu of matrix elem type size start index size num row

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add to row slice valu of cpu matrix start index num row
gpu matrix add to row slice valu of gpu matrix start index num row
implement
implement




column slice start start index
elem type
matrix elem type matrix elem type add with row slice valu of matrix elem type size start index size num row

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add with row slice valu of cpu matrix start index num row
gpu matrix add with row slice valu of gpu matrix start index num row
implement
implement




elem type
matrix elem type matrix elem type assign repeat of matrix elem type size num row repeat size num col repeat

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix assign repeat of cpu matrix num row repeat num col repeat
gpu matrix assign repeat of gpu matrix num row repeat num col repeat
implement
implement




elem type
matrix elem type matrix elem type add to row repeat valu of matrix elem type size num repeat

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add to row repeat valu of cpu matrix num repeat
gpu matrix add to row repeat valu of gpu matrix num repeat
implement
implement




use dssm model result get row neg number get col matrix
column contain po number posit sampl origin neg number neg sampl gener copi
sampl shift shift number column
elem type
matrix elem type matrix elem type assign posit and shift neg sampl matrix elem type size po number size neg number size shift number

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix assign posit and shift neg sampl cpu matrix po number neg number shift number
gpu matrix assign posit and shift neg sampl gpu matrix po number neg number shift number
implement
implement




use dssm model posit neg sampl fold back right place
column contain po number posit sampl origin neg number neg sampl gener copi
sampl shift shift number column
elem type
matrix elem type matrix elem type add fold posit and shift neg sampl matrix elem type size po number size neg number size shift number

decid and move to right devic

warn must
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add fold posit and shift neg sampl cpu matrix po number neg number shift number
gpu matrix add fold posit and shift neg sampl gpu matrix po number neg number shift number
implement
implement




elem type
matrix elem type matrix elem type assign differ of elem type alpha matrix elem type

is empti
logic error assign differ of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign differ of alpha cpu matrix
gpu matrix assign differ of alpha gpu matrix
implement
implement




elem type
matrix elem type matrix elem type assign differ of matrix elem type elem type alpha

is empti
logic error assign differ of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign differ of cpu matrix alpha
gpu matrix assign differ of gpu matrix alpha
implement
implement




dimens
column vector minu column
vector minu row
elem type
matrix elem type matrix elem type matrix elem type

is empti
logic error minu oper matrix
decid and move to right devic

dispatch matrix flag

cpu matrix cpu matrix
gpu matrix gpu matrix
implement
implement




dimens output
column vector minu column
vector minu row
elem type
matrix elem type matrix elem type matrix elem type

matrix elem type deep clone implement introduc copi overhead make resu code
scale and add



elem type
matrix elem type matrix elem type assign differ of matrix elem type matrix elem type

first broadcast swap first flip sign
thi equival work round
todo need ternari output storag separ
get num row get num row get num col get num col

get num row get num row get num col get num col
logic error assign differ of invalid dimens
assign differ of




set valu




elem type
matrix elem type matrix elem type elem type alpha

scale alpha



elem type
matrix elem type matrix elem type elem type alpha

matrix elem type get num row get num col deviceid type prefer devic id
scale alpha



elem type
matrix elem type matrix elem type assign product of elem type alpha matrix elem type

scale alpha




elem type
matrix elem type matrix elem type assign product of matrix elem type transpos a matrix elem type transpos b

get num element

transpos b
assign transpos of

set valu

dispatch matrix flag
nullptr

gpu matrix get00 element

implement

get num element

transpos a
assign transpos of

set valu

dispatch matrix flag
nullptr

gpu matrix get00 element

implement


multipli transpos a transpos b




elem type
matrix elem type matrix elem type matrix elem type

get num element

matrix elem type deviceid type get prefer devic id

dispatch matrix flag
nullptr
assign product of
assign product of gpu matrix get00 element bugbug effici
assign product of
implement



get num element

matrix elem type deviceid type get prefer devic id

dispatch matrix flag
nullptr
assign product of
assign product of gpu matrix get00 element bugbug effici
assign product of
implement





matrix elem type get num row get num col deviceid type get prefer devic id
multipli




scalar
elem type
matrix elem type matrix elem type assign1x1 product of matrix elem type matrix elem type

multiply1x1 and weight add



elem type
matrix elem type matrix elem type elem type alpha

alpha



elem type
matrix elem type matrix elem type elem type alpha

alpha


element wise power
elem type
matrix elem type matrix elem type elem type alpha


element wise power alpha



element wise power
elem type
matrix elem type matrix elem type elem type alpha

matrix elem type get num row get num col deviceid type get devic id
element wise power alpha



elem type
matrix elem type matrix elem type assign element power of matrix elem type elem type power

element wise power power



cannot
elem type
matrix elem type matrix elem type element multipli with matrix elem type

assign element product of


elem type
matrix elem type matrix elem type element divid by matrix elem type

assign element divis of



elem type
matrix elem type matrix elem type assign element product of matrix elem type matrix elem type

is empti is empti
logic error assign element product of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument input matrix dimens match

decid and move to right devic
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign element product of cpu matrix cpu matrix
gpu matrix assign element product of gpu matrix gpu matrix
implement
implement




elem type
matrix elem type matrix elem type add element product of matrix elem type matrix elem type

is empti is empti
logic error add element product of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument input matrix dimens match

get num row get num row get num col get num col
invalid argument input matrix dimens match

decid and move to right devic

get matrix type get matrix type get matrix type get matrix type
implement

dispatch matrix flag
nullptr
cpu matrix add element product of cpu matrix cpu matrix
gpu matrix add element product of gpu matrix gpu matrix
implement
implement





elem type
matrix elem type matrix elem type assign element divis of matrix elem type matrix elem type

is empti is empti
logic error assign element divis of matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument input matrix dimens match

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign element divis of cpu matrix cpu matrix
gpu matrix assign element divis of gpu matrix gpu matrix
implement
implement




elem type
matrix elem type matrix elem type column element multipli with matrix elem type

is empti is empti
logic error column element multipli with matrix

get num row get num row get num col
invalid argument column element multipli with input matrix vector match row

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix column element multipli with cpu matrix
gpu matrix column element multipli with gpu matrix
implement
implement




elem type
matrix elem type matrix elem type row element multipli with matrix elem type

is empti is empti
logic error row element multipli with matrix

get num col get num col get num row
invalid argument row element multipli with input matrix vector match column

warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix row element multipli with cpu matrix
gpu matrix row element multipli with gpu matrix
implement
implement




elem type
matrix elem type matrix elem type row element divid by matrix elem type

is empti is empti
logic error row element divid by matrix

get num col get num col get num row
invalid argument row element divid by input matrix vector match column

warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix row element divid by cpu matrix
gpu matrix row element divid by gpu matrix
implement
implement




elem type
matrix elem type matrix elem type column element divid by matrix elem type

is empti is empti
logic error column element divid by matrix

get num row get num row get num col
invalid argument column element divid by input matrix vector match row

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix column element divid by cpu matrix
gpu matrix column element divid by gpu matrix
implement
implement





elem type
matrix elem type matrix elem type element invers

dispatch matrix flag

cpu matrix element invers
gpu matrix element invers
implement
gpu spars matrix element invers




elem type
matrix elem type matrix elem type assign element invers of matrix elem type

is empti
logic error assign element invers of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign element invers of cpu matrix
gpu matrix assign element invers of gpu matrix
implement
gpu spars matrix assign element invers of gpu spars matrix




elem type
matrix elem type matrix elem type inplac sigmoid

dispatch matrix flag

cpu matrix inplac sigmoid
gpu matrix inplac sigmoid
implement
gpu spars matrix inplac sigmoid




elem type
matrix elem type matrix elem type assign sigmoid of matrix elem type

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sigmoid of cpu matrix
gpu matrix assign sigmoid of gpu matrix
implement
gpu spars matrix assign sigmoid of gpu spars matrix




sigmoid element wise
elem type
matrix elem type matrix elem type inplac linear rectifi deriv

dispatch matrix flag

cpu matrix inplac linear rectifi deriv
gpu matrix inplac linear rectifi deriv
implement
gpu spars matrix inplac linear rectifi deriv




elem type
matrix elem type matrix elem type assign linear rectifi deriv of matrix elem type

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign linear rectifi deriv of cpu matrix
gpu matrix assign linear rectifi deriv of gpu matrix
implement
gpu spars matrix assign linear rectifi deriv of gpu spars matrix




sigmoid element wise
elem type
matrix elem type matrix elem type inplac sigmoid deriv

dispatch matrix flag

cpu matrix inplac sigmoid deriv
gpu matrix inplac sigmoid deriv
implement
implement




elem type
matrix elem type matrix elem type assign sigmoid deriv of matrix elem type

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sigmoid deriv of cpu matrix
gpu matrix assign sigmoid deriv of gpu matrix
implement
implement




elem type
matrix elem type matrix elem type assign num of diff matrix elem type matrix elem type search in col

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign num of diff cpu matrix cpu matrix search in col
gpu matrix assign num of diff gpu matrix gpu matrix search in col
implement
implement



tanh element wise
elem type
matrix elem type matrix elem type inplac tanh

dispatch matrix flag

cpu matrix inplac tanh
gpu matrix inplac tanh
implement
gpu spars matrix inplac tanh




elem type
matrix elem type matrix elem type assign tanh of matrix elem type

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign tanh of cpu matrix
gpu matrix assign tanh of gpu matrix
implement
gpu spars matrix assign tanh of gpu spars matrix




softmax element wise
elem type
matrix elem type matrix elem type inplac log softmax is col wise

dispatch matrix flag

cpu matrix inplac log softmax is col wise
gpu matrix inplac log softmax is col wise
implement
implement




elem type
matrix elem type matrix elem type assign log softmax of matrix elem type is col wise

is empti
logic error assign log softmax of matrix
decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign log softmax of cpu matrix is col wise
gpu matrix assign log softmax of gpu matrix is col wise
implement
implement




softmax element wise
elem type
matrix elem type matrix elem type inplac hardmax is col wise

dispatch matrix flag

cpu matrix inplac hardmax is col wise
gpu matrix inplac hardmax is col wise
implement
implement




elem type
matrix elem type matrix elem type assign hardmax of matrix elem type is col wise

is empti
logic error assign hardmax of matrix
decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign hardmax of cpu matrix is col wise
gpu matrix assign hardmax of gpu matrix is col wise
implement
implement




elem type
matrix elem type matrix elem type inplac sqrt

dispatch matrix flag

cpu matrix inplac sqrt
gpu matrix inplac sqrt
implement
gpu spars matrix inplac sqrt




elem type
matrix elem type matrix elem type assign sqrt of matrix elem type

is empti
logic error assign sqrt of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sqrt of cpu matrix
gpu matrix assign sqrt of gpu matrix
implement
gpu spars matrix assign sqrt of gpu spars matrix




element wise
elem type
matrix elem type matrix elem type inplac exp

dispatch matrix flag

cpu matrix inplac exp
gpu matrix inplac exp
implement
gpu spars matrix inplac exp




elem type
matrix elem type matrix elem type assign exp of matrix elem type

is empti
logic error assign exp of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign exp of cpu matrix
gpu matrix assign exp of gpu matrix
implement
gpu spars matrix assign exp of gpu spars matrix




element wise
elem type
matrix elem type matrix elem type inplac ab

dispatch matrix flag
nullptr
cpu matrix inplac ab
gpu matrix inplac ab
implement
gpu spars matrix inplac ab




elem type
matrix elem type matrix elem type assign ab of matrix elem type

is empti
logic error assign ab of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign ab of cpu matrix
gpu matrix assign ab of gpu matrix
implement
gpu spars matrix assign ab of gpu spars matrix




element wise
elem type
matrix elem type matrix elem type inplac log

dispatch matrix flag

cpu matrix inplac log
gpu matrix inplac log
implement
gpu spars matrix inplac log




element wise
elem type
matrix elem type matrix elem type inplac log10

dispatch matrix flag

cpu matrix inplac log10
implement
implement
implement




elem type
matrix elem type matrix elem type assign log of matrix elem type

is empti
logic error assign log of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign log of cpu matrix
gpu matrix assign log of gpu matrix
implement
gpu spars matrix assign log of gpu spars matrix




elem type
matrix elem type matrix elem type assign log10 of matrix elem type

is empti
logic error assign log of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign log10 of cpu matrix
implement
implement
gpu spars matrix assign log of gpu spars matrix




element wise
elem type
matrix elem type matrix elem type inplac cosin

dispatch matrix flag

cpu matrix inplac cosin
gpu matrix inplac cosin
implement
implement




elem type
matrix elem type matrix elem type assign cosin of matrix elem type

is empti
logic error assign cosin of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign cosin of cpu matrix
gpu matrix assign cosin of gpu matrix
implement
implement




element wise
elem type
matrix elem type matrix elem type inplac neg sine

dispatch matrix flag

cpu matrix inplac neg sine
gpu matrix inplac neg sine
implement
implement




elem type
matrix elem type matrix elem type assign neg sine of matrix elem type

is empti
logic error assign neg sine of matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign neg sine of cpu matrix
gpu matrix assign neg sine of gpu matrix
implement
implement




elem type
matrix elem type matrix elem type inplac truncat elem type threshold

is empti
logic error inplac truncat matrix

elem type

isfinit threshold




isfinit threshold



dispatch matrix flag

cpu matrix inplac truncat threshold
gpu matrix inplac truncat threshold
cpu spars matrix inplac truncat threshold
gpu spars matrix inplac truncat threshold




elem type
matrix elem type inplac transpos

is empti


dispatch matrix flag

implement
implement
implement
gpu spars matrix inplac transpos


elem type
matrix elem type matrix elem type inplac soft threshold elem type threshold

threshold

is empti
logic error inplac soft threshold matrix

threshold


dispatch matrix flag

cpu matrix inplac soft threshold threshold
gpu matrix inplac soft threshold threshold
cpu spars matrix inplac soft threshold threshold
gpu spars matrix inplac soft threshold threshold



threshold truncat threshold
elem type
matrix elem type matrix elem type inplac truncat bottom elem type threshold

is empti
logic error inplac truncat bottom matrix

elem type

isfinit threshold




isfinit threshold



dispatch matrix flag

cpu matrix inplac truncat bottom threshold
gpu matrix inplac truncat bottom threshold
cpu spars matrix inplac truncat bottom threshold
gpu spars matrix inplac truncat bottom threshold




threshold truncat threshold
elem type
matrix elem type matrix elem type assign truncat bottom of matrix elem type elem type threshold

is empti
logic error assign truncat bottom of matrix

elem type

isfinit threshold

set valu





isfinit threshold

set valu




decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign truncat bottom of cpu matrix threshold
gpu matrix assign truncat bottom of gpu matrix threshold
implement
gpu spars matrix assign truncat bottom of gpu spars matrix threshold




threshold truncat threshold
elem type
matrix elem type matrix elem type inplac truncat top elem type threshold

is empti
logic error inplac truncat top matrix

elem type

isfinit threshold




isfinit threshold



dispatch matrix flag

cpu matrix inplac truncat top threshold
gpu matrix inplac truncat top threshold
cpu spars matrix inplac truncat top threshold
gpu spars matrix inplac truncat top threshold



threshold truncat threshold
elem type
matrix elem type matrix elem type assign truncat top of matrix elem type elem type threshold

is empti
logic error assign truncat top of matrix

elem type

isfinit threshold

set valu





isfinit threshold

set valu




decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign truncat top of cpu matrix threshold
gpu matrix assign truncat top of gpu matrix threshold
implement
gpu spars matrix assign truncat top of gpu spars matrix threshold




threshold truncat threshold
elem type
matrix elem type matrix elem type set to zero if ab less than elem type threshold

is empti
logic error set to zero if ab less than matrix

dispatch matrix flag

cpu matrix set to zero if ab less than threshold
gpu matrix set to zero if ab less than threshold
implement
gpu spars matrix set to zero if ab less than threshold




element
elem type
elem type matrix elem type sum of element

is empti
logic error sum of element matrix

dispatch matrix flag
nullptr
cpu matrix sum of element
gpu matrix sum of element
cpu spars matrix sum of element
gpu spars matrix sum of element


elem type
matrix elem type matrix elem type assign sum of element matrix elem type

is empti
logic error assign sum of element matrix

warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sum of element cpu matrix
gpu matrix assign sum of element gpu matrix
implement
implement




elem type
devic bound number elem type matrix elem type as devic bound num

devic bound number elem type result

dispatch matrix flag
nullptr
elem type elem type
cpu matrix sum of element result shallow copi from result
gpu matrix as devic bound num
implement
implement


element
elem type
elem type matrix elem type sum of ab element

is empti
logic error sum of ab element matrix

dispatch matrix flag nullptr
cpu matrix sum of ab element
gpu matrix sum of ab element
implement
gpu spars matrix sum of ab element


element
elem type
elem type matrix elem type log sum of element

is empti
logic error log sum of element matrix

dispatch matrix flag nullptr
cpu matrix log sum of element
gpu matrix log sum of element
implement
implement


elem type
matrix elem type is valid

current data locat current data locat get matrix type matrix type spars

gpu spars matrix is valid



implement





elem type
matrix elem type is equal to matrix elem type elem type threshold

are equal threshold


elem type
matrix elem type vector sum matrix elem type matrix elem type is col wise

decid and move to right devic
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix elem type vector sum cpu matrix cpu matrix is col wise
gpu matrix elem type vector sum gpu matrix gpu matrix is col wise
implement
implement


elem type
matrix elem type vector norm1 matrix elem type is col wise

is empti
logic error vector norm inf matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix vector norm1 cpu matrix is col wise
gpu matrix vector norm1 gpu matrix is col wise
implement
implement


elem type
matrix elem type matrix elem type assign vector norm1 of matrix elem type is col wise

vector norm1 is col wise



elem type
matrix elem type vector norm2 matrix elem type is col wise

is empti
logic error vector norm2 matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix vector norm2 cpu matrix is col wise
gpu matrix vector norm2 gpu matrix is col wise
implement
implement


elem type
matrix elem type matrix elem type assign vector norm2 of matrix elem type is col wise

vector norm2 is col wise



elem type
matrix elem type vector norm inf matrix elem type is col wise

is empti
logic error vector norm inf matrix

decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix vector norm inf cpu matrix is col wise
gpu matrix vector norm inf gpu matrix is col wise
implement
implement


elem type
matrix elem type matrix elem type assign vector norm inf of matrix elem type is col wise

vector norm inf is col wise



elem type
matrix elem type matrix elem type assign inner product of matrix elem type matrix elem type is col wise

inner product is col wise



column wise crossproduct
elem type
matrix elem type matrix elem type assign khatri rao product of matrix elem type matrix elem type

is empti is empti
logic error assign khatri rao product of matrix

get num col get num col
get num col get num col
invalid argument assign khatri rao product of input matrix dimens match

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign khatri rao product of cpu matrix cpu matrix
gpu matrix assign khatri rao product of gpu matrix gpu matrix
implement
implement




column wise reshap product use comput khatri rao product gradient
reshap column k1x k2
column transpos time column frame
output frame matrix
column tranpos time column frame output frame
column wise crossproduct
elem type
matrix elem type matrix elem type add column reshap product of matrix elem type matrix elem type transpos a column

is empti is empti
logic error add column reshap product of matrix

get num col get num col
get num col get num col
invalid argument add column reshap product of input matrix dimens match

decid and move to right devic
warn must
get matrix type get matrix type get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add column reshap product of cpu matrix cpu matrix transpos a column
gpu matrix add column reshap product of gpu matrix gpu matrix transpos a column
implement
implement




elem type
matrix elem type matrix elem type add with scale of elem type alpha matrix elem type

scale and add alpha



elem type
elem type matrix elem type frobeniu norm

is empti
logic error frobeniu norm matrix

dispatch matrix flag
nullptr
cpu matrix frobeniu norm
gpu matrix frobeniu norm
cpu spars matrix frobeniu norm
gpu spars matrix frobeniu norm


elem type
matrix elem type matrix elem type assign frobeniu norm of matrix elem type

is empti
logic error assign frobeniu norm of matrix

resiz

warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign frobeniu norm of cpu matrix
gpu matrix assign frobeniu norm of gpu matrix
implement
implement




elem type
elem type matrix elem type matrix norm inf

is empti
logic error matrix norm inf matrix

dispatch matrix flag
nullptr
cpu matrix matrix norm inf
gpu matrix matrix norm inf
implement
gpu spars matrix matrix norm inf


elem type
elem type matrix elem type matrix norm1

is empti
logic error matrix norm1 matrix

dispatch matrix flag
nullptr
cpu matrix matrix norm1
gpu matrix matrix norm1
implement
gpu spars matrix matrix norm1


elem type
elem type matrix elem type matrix norm0

is empti
logic error matrix norm0 matrix

dispatch matrix flag
nullptr
cpu matrix matrix norm0
gpu matrix matrix norm0
implement
gpu spars matrix matrix norm0


elem type
matrix elem type matrix elem type assign sign of matrix elem type

is empti
logic error assign sign of matrix

decid and move to right devic
warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign sign of cpu matrix
gpu matrix assign sign of gpu matrix
implement
implement




elem type
matrix elem type matrix elem type add sign of matrix elem type

is empti
logic error add sign of matrix

decid and move to right devic
get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix add sign of cpu matrix
gpu matrix add sign of gpu matrix
implement
implement




decid matrix elem type max indic instead integ vector result use addit calcul
elem type
matrix elem type vector max matrix elem type max indic matrix elem type max valu is col wise

is empti
logic error vector max matrix

decid and move to right devic max indic max valu
max indic switch to matrix type get matrix type get format
max valu switch to matrix type get matrix type get format

dispatch matrix flag max valu
cpu matrix vector max max indic cpu matrix max valu cpu matrix is col wise max indic set data locat dens
gpu matrix vector max max indic gpu matrix max valu gpu matrix is col wise max indic set data locat dens
implement
implement
note must set data locat also max indic sinc max valu max indic written


elem type
matrix elem type vector max matrix elem type max indic matrix elem type max valu is col wise top k

is empti
logic error vector max matrix

decid and move to right devic max indic max valu
max indic switch to matrix type get matrix type get format
max valu switch to matrix type get matrix type get format

dispatch matrix flag max valu
cpu matrix vector max max indic cpu matrix max valu cpu matrix is col wise top k max indic set data locat dens
gpu matrix vector max max indic gpu matrix max valu gpu matrix is col wise top k max indic set data locat dens
implement
implement


elem type
matrix elem type vector min matrix elem type min indic matrix elem type min valu is col wise

is empti
logic error vector min matrix

decid and move to right devic min indic min valu
min indic switch to matrix type get matrix type get format
min valu switch to matrix type get matrix type get format

dispatch matrix flag min valu
cpu matrix vector min min indic cpu matrix min valu cpu matrix is col wise min indic set data locat dens
gpu matrix vector min min indic gpu matrix min valu gpu matrix is col wise min indic set data locat dens
implement
implement


pragma endregion member bla function

pragma region other helper function

elem type
matrix elem type get devic id

current data locat current data locat none
prefer devic id

dispatch matrix flag nullptr
cpudevic
gpu matrix get comput devic id
cpudevic
gpu spars matrix get comput devic id


todo comment need second elem type
todo move share core function front sourc file
bugbug thi perform copi oper even output matrix get overwritten right away
defin output whether complet overwritten actual copi
bring matric onto devic
differ prefer devic move prefer devic
otherwis take preced move devic
input distinguish take preced differ
todo thi call somewhat inconsist sometim sometim
elem type
elem type2
matrix elem type decid and move to right devic matrix elem type matrix elem type2

devic id a get devic id devic id b get devic id
devic id a devic id b


prefer devic id a get prefer devic id prefer devic id b get prefer devic id

prefer devic id a prefer devic id b prefer devic move prefer

transfer to devic prefer devic id a
transfer to devic prefer devic id a

devic id a cpudevic live

transfer to devic devic id a



transfer to devic devic id b



matric
forc otherwis take preced
elem type
matrix elem type decid and move to right devic matrix elem type matrix elem type matrix elem type

devic id a get devic id devic id b get devic id devic id c get devic id
devic id a devic id b devic id a devic id c


prefer devic id a get prefer devic id prefer devic id b get prefer devic id prefer devic id c get prefer devic id

prefer devic id a prefer devic id b prefer devic id a prefer devic id c

transfer to devic prefer devic id a
transfer to devic prefer devic id a
transfer to devic prefer devic id a

devic id b devic id c devic id b cpudevic todo combin

transfer to devic devic id b outvot

devic id a cpudevic live

transfer to devic devic id a
transfer to devic devic id a

devic id b cpudevic

transfer to devic devic id b
transfer to devic devic id b



transfer to devic devic id c
transfer to devic devic id c



matric
elem type
matrix elem type decid and move to right devic matrix elem type matrix elem type matrix elem type matrix elem type

call keep impl
decid and move to right devic
transfer to devic get devic id bugbug correct share prefer devic


elem type
matrix elem type transfer to devic is be move empti transfer

get devic id
noth


own buffer
transfer from devic to devic is be move empti transfer

runtim error cannot move extern own matric prefer devic


perform transfer updat locat devic store
elem type
matrix elem type transfer from devic to devic is be move empti transfer


cpudevic

cpudevic



get devic id
runtim error tri transfer matrix devic devic matrix live devic




warn devic chang
defin devic chang warn
num time devic chang devic chang warn
empti transfer

num time devic chang
devic transfer to cpudevic
devic transfer to
devic transfer to
devic transfer to

num time devic chang devic chang warn devic transfer to cpudevic
fprintf stderr warn matrix transfer differ devic time get num row get num col devic chang warn

transfer
matrix type matrix type spars

cpudevic

cpu spars matrix
logic error move

gpu spars matrix
gpu spars matrix make share gpu spars matrix elem type cpu spars matrix get format

gpu spars matrix chang devic to

cpu spars matrix get num element empti transfer

gpu spars matrix set valu cpu spars matrix


is be move

set data locat spars
cpu spars matrix nullptr



set data locat both spars




gpu spars matrix gpu spars matrix get comput devic id
logic error thi matrix



cpu spars matrix
cpu spars matrix make share cpu spars matrix elem type gpu spars matrix get format

gpu spars matrix get num element empti transfer

gpu spars matrix copi to cpu spars matrix cpu spars matrix


is be move

set data locat spars
gpu spars matrix nullptr



set data locat both spars


anoth

gpu spars matrix chang devic to




pragma critic

cpudevic

cpu matrix
logic error move
cpu matrix get num element empti transfer

gpu matrix make share gpu matrix elem type cpu matrix get num row cpu matrix get num col cpu matrix buffer matrix flag normal



gpu matrix make share gpu matrix elem type

is be move

set data locat dens
cpu matrix nullptr



set data locat both dens




gpu matrix gpu matrix get comput devic id
logic error thi matrix



gpu matrix get num element empti transfer

elem type gpu matrix copi to array todo unnecessari alloc copi make vector move rvalu
cpu matrix make share cpu matrix elem type gpu matrix get num row gpu matrix get num col matrix flag normal




cpu matrix make share cpu matrix elem type


is be move

set data locat dens
gpu matrix nullptr



set data locat both dens


anoth

gpu matrix chang devic to


critic section


elem type
matrix elem type transfer from devic to devic is be move empti transfer updat prefer devic

transfer from devic to devic is be move empti transfer
updat prefer devic
prefer devic id get devic id

elem type
matrix elem type transfer to devic if not there is be move leav both state empti transfer updat prefer devic

get devic id

alreadi right place


get current matrix locat both current both state
is be move leav both state
chang gp us

good


transfer from devic to devic is be move empti transfer updat prefer devic


elem type
matrix elem type print matrix name ptrdiff row start ptrdiff row end ptrdiff col start ptrdiff col end

deviceid type orgdevic get devic id

dispatch matrix flag
nullptr

cpu matrix print matrix name row start row end col start col end


transfer to devic cpudevic
cpu matrix print matrix name row start row end col start col end
transfer to devic orgdevic

spars
cpu spars matrix print matrix name
spars

transfer to devic cpudevic
cpu spars matrix print matrix name
transfer to devic orgdevic



elem type
matrix elem type print matrix name nullptr

print matrix name get num row get num col


helpfer use convolut neural network
elem type
matrix elem type matrix elem type assign pack convolut input matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad

decid and move to right devic input sub batch
switch to matrix type input sub batch get matrix type input sub batch get format

dispatch matrix flag input sub batch

cpu matrix assign pack convolut input input sub batch cpu matrix
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl
zero pad
gpu matrix assign pack convolut input input sub batch gpu matrix
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl
zero pad
implement
implement




helpfer use convolut neural network
elem type
matrix elem type matrix elem type unpack convolut input matrix elem type input sub batch
size input width size input height size input channel
size output width size output height size output channel
size kernel width size kernel height size horizont subsampl size vertic subsampl
zero pad

decid and move to right devic input sub batch
input sub batch switch to matrix type get matrix type input sub batch get format

dispatch matrix flag
input sub batch
cpu matrix unpack convolut input input sub batch cpu matrix
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl
zero pad
gpu matrix unpack convolut input input sub batch gpu matrix
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl
zero pad
implement
implement

input sub batch


elem type
matrix elem type matrix elem type assign max pool result matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

decid and move to right devic input batch
switch to matrix type input batch get matrix type input batch get format

dispatch matrix flag input batch

cpu matrix assign max pool result input batch cpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
gpu matrix assign max pool result input batch gpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
implement
implement




elem type
matrix elem type matrix elem type add max pool gradient matrix elem type output gradient batch matrix elem type input batch matrix elem type output batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

decid and move to right devic output gradient batch input batch
output batch transfer to devic get devic id

get matrix type output gradient batch get matrix type get matrix type input batch get matrix type get matrix type output batch get matrix type
implement

dispatch matrix flag

cpu matrix add max pool gradient output gradient batch cpu matrix input batch cpu matrix output batch cpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
gpu matrix add max pool gradient output gradient batch gpu matrix input batch gpu matrix output batch gpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl

implement
implement




elem type
matrix elem type matrix elem type assign averag pool result matrix elem type input batch size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

decid and move to right devic input batch
switch to matrix type input batch get matrix type input batch get format

dispatch matrix flag input batch

cpu matrix assign averag pool result input batch cpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
gpu matrix assign averag pool result input batch gpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
implement
implement




elem type
matrix elem type matrix elem type assign softmax sum matrix elem type matrix elem type softmax

resiz
get devic id
cpu matrix assign softmax sum softmax cpu matrix cpu matrix

gpu matrix assign softmax sum softmax gpu matrix gpu matrix



elem type
matrix elem type matrix elem type assign nce unnorm eval matrix elem type matrix elem type matrix elem type matrix elem type bia

get matrix type matrix type spars
implement

resiz
get devic id
cpu matrix assign nce unnorm eval cpu matrix cpu matrix bia cpu matrix cpu matrix

gpu matrix assign nce unnorm eval gpu matrix gpu matrix gpu matrix



elem type
matrix elem type matrix elem type assign nois contrast estim matrix elem type matrix elem type matrix elem type matrix elem type bia matrix elem type

is empti is empti is empti
logic error assign nois contrast estim input matric

get devic id get devic id get devic id get devic id get devic id get devic id
implement

resiz

get devic id

size sampl count cpu matrix get num element cpu matrix get num row
resiz get num row sampl count
cpu matrix assign nois contrast estim cpu matrix cpu matrix
bia cpu matrix cpu matrix cpu matrix



size sampl count gpu matrix get num element gpu matrix get num row
resiz get num row sampl count
gpu matrix assign nois contrast estim gpu matrix gpu matrix
bia gpu matrix sampl count gpu matrix gpu matrix




elem type
matrix elem type matrix elem type assign nce deriv matrix elem type matrix elem type matrix elem type matrix elem type size input index

is empti is empti is empti
logic error assign nois contrast estim input matric

get devic id get devic id get devic id get devic id get devic id get devic id
implement

get num row get num row
get devic id

sampl gradient hidden embed embed hidden
cpu matrix assign nce deriv cpu matrix cpu matrix cpu matrix input index cpu matrix



gpu matrix assign nce deriv gpu matrix gpu matrix gpu matrix input index gpu matrix




elem type
matrix elem type matrix elem type add averag pool gradient matrix elem type output gradient batch
size channel
size input width size input height size input size per sampl
size output width size output height size output size per sampl
size window width size window height size horizont subsampl size vertic subsampl

decid and move to right devic output gradient batch
get matrix type output gradient batch get matrix type
implement

dispatch matrix flag

cpu matrix add averag pool gradient output gradient batch cpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
gpu matrix add averag pool gradient output gradient batch gpu matrix channel
input width input height input size per sampl
output width output height output size per sampl
window width window height horizont subsampl vertic subsampl
implement
implement




pragma endregion other helper function

elem type
matrix elem type convolut forward matrix elem type kernel matrix mp row col matrix mp row iwht
matrix mp row run matrix run matrix elem type output

mp row col get num col
mp row iwht get num col
mp row run get num col
run get num col

decid and move to right devic output

review alexeyk spars version
dispatch matrix flag

cpu matrix convolut forward kernel cpu matrix mp row col cpu matrix mp row iwht cpu matrix
mp row run cpu matrix run cpu matrix output cpu matrix
gpu matrix convolut forward kernel gpu matrix mp row col gpu matrix mp row iwht gpu matrix
mp row run gpu matrix run gpu matrix output gpu matrix
implement
implement


elem type
matrix elem type convolut backward data matrix elem type kernel matrix mp row col matrix mp row iwht
matrix mp row run matrix run matrix elem type grad

mp row col get num col
mp row iwht get num col
mp row run get num col
run get num col

decid and move to right devic grad

review alexeyk spars version
dispatch matrix flag

cpu matrix convolut backward data kernel cpu matrix mp row col cpu matrix mp row iwht cpu matrix
mp row run cpu matrix run cpu matrix grad cpu matrix
gpu matrix convolut backward data kernel gpu matrix mp row col gpu matrix mp row iwht gpu matrix
mp row run gpu matrix run gpu matrix grad gpu matrix
implement
implement


elem type
matrix elem type convolut backward kernel matrix elem type matrix mp row col matrix mp row iwht
matrix mp row run matrix run matrix elem type kernel grad

mp row col get num col
mp row iwht get num col
mp row run get num col
run get num col

decid and move to right devic kernel grad

review alexeyk spars version
dispatch matrix flag

cpu matrix convolut backward kernel cpu matrix mp row col cpu matrix mp row iwht cpu matrix
mp row run cpu matrix run cpu matrix kernel grad cpu matrix
gpu matrix convolut backward kernel gpu matrix mp row col gpu matrix mp row iwht gpu matrix
mp row run gpu matrix run gpu matrix kernel grad gpu matrix
implement
implement


elem type
matrix elem type unrol convolut input size unrol col size map out size matrix mp row col
matrix mp row run matrix run matrix elem type output

mp row col get num col
mp row run get num col
run get num col

decid and move to right devic output

dispatch matrix flag

cpu matrix unrol convolut input unrol col map out size mp row col cpu matrix
mp row run cpu matrix run cpu matrix output cpu matrix
implement
implement
implement


elem type
matrix elem type unrol convolut output size unrol col size map in count size map out count matrix mp row col
matrix mp row run matrix run matrix elem type output

mp row col get num col
mp row run get num col
run get num col

decid and move to right devic output

dispatch matrix flag

cpu matrix unrol convolut output unrol col map in count map out count mp row col cpu matrix
mp row run cpu matrix run cpu matrix output cpu matrix
implement
implement
implement


elem type
matrix elem type unrol convolut input for kernel backprop size map out size matrix mp row col
matrix mp row run matrix run matrix elem type output

mp row col get num col
mp row run get num col
run get num col

decid and move to right devic output

dispatch matrix flag

cpu matrix unrol convolut input for kernel backprop map out size mp row col cpu matrix
mp row run cpu matrix run cpu matrix output cpu matrix
implement
implement
implement


elem type
matrix elem type max pool forward matrix mp row col matrix mp row indic matrix indic matrix elem type output

mp row col get num col
mp row indic get num col
indic get num col

decid and move to right devic output

review alexeyk spars version
dispatch matrix flag

cpu matrix max pool forward mp row col cpu matrix mp row indic cpu matrix indic cpu matrix output cpu matrix
gpu matrix max pool forward mp row col gpu matrix mp row indic gpu matrix indic gpu matrix output gpu matrix
implement
implement


elem type
matrix elem type max pool backward matrix elem type matrix elem type
matrix mp row col matrix mp row indic matrix indic
matrix elem type grad

mp row col get num col
mp row indic get num col
indic get num col

decid and move to right devic grad

review alexeyk spars version
dispatch matrix flag

cpu matrix max pool backward cpu matrix cpu matrix
mp row col cpu matrix mp row indic cpu matrix indic cpu matrix
grad cpu matrix
gpu matrix max pool backward gpu matrix gpu matrix
mp row col gpu matrix mp row indic gpu matrix indic gpu matrix
grad gpu matrix
implement
implement


elem type
matrix elem type averag pool forward matrix mp row col matrix mp row indic matrix indic matrix elem type output

mp row col get num col
mp row indic get num col
indic get num col

decid and move to right devic output

review alexeyk spars version
dispatch matrix flag

cpu matrix averag pool forward mp row col cpu matrix mp row indic cpu matrix indic cpu matrix output cpu matrix
gpu matrix averag pool forward mp row col gpu matrix mp row indic gpu matrix indic gpu matrix output gpu matrix
implement
implement


elem type
matrix elem type averag pool backward matrix mp row col matrix mp row indic matrix indic matrix elem type grad

mp row col get num col
mp row indic get num col
indic get num col

decid and move to right devic grad

review alexeyk spars version
dispatch matrix flag

cpu matrix averag pool backward mp row col cpu matrix mp row indic cpu matrix indic cpu matrix grad cpu matrix
gpu matrix averag pool backward mp row col gpu matrix mp row indic gpu matrix indic gpu matrix grad gpu matrix
implement
implement


elem type
matrix elem type batch normal forward matrix elem type scale matrix elem type bia exp avg factor blend factor
matrix elem type run mean matrix elem type run inv std dev matrix elem type epsilon
matrix elem type save mean matrix elem type save inv std dev

decid and move to right devic

review alexeyk spars version
dispatch matrix flag

cpu matrix batch normal forward scale cpu matrix bia cpu matrix exp avg factor blend factor
run mean cpu matrix run inv std dev cpu matrix
cpu matrix epsilon save mean cpu matrix save inv std dev cpu matrix
gpu matrix batch normal forward scale gpu matrix bia gpu matrix exp avg factor blend factor
run mean gpu matrix run inv std dev gpu matrix
gpu matrix epsilon save mean gpu matrix save inv std dev gpu matrix
implement
implement


elem type
matrix elem type batch normal backward matrix elem type matrix elem type grad matrix elem type scale matrix elem type save mean matrix elem type save inv std dev
matrix elem type scale grad matrix elem type bia grad

decid and move to right devic grad

review alexeyk spars version
dispatch matrix flag

cpu matrix batch normal backward cpu matrix grad cpu matrix scale cpu matrix
save mean cpu matrix save inv std dev cpu matrix
scale grad cpu matrix bia grad cpu matrix
gpu matrix batch normal backward gpu matrix grad gpu matrix scale gpu matrix
save mean gpu matrix save inv std dev gpu matrix
scale grad gpu matrix bia grad gpu matrix
implement
implement


pragma region static bla function

elem type
matrix elem type matrix elem type matrix elem type sigma matrix elem type matrix elem type matrix elem type

is empti
logic error input matrix

decid and move to right devic sigma
transfer to devic get devic id
transfer to devic get devic id

sigma switch to matrix type get matrix type get format
switch to matrix type get matrix type get format
switch to matrix type get matrix type get format
switch to matrix type get matrix type get format

dispatch matrix flag nullptr

matrix elem type deep clone
cpu matrix elem type cpu matrix sigma cpu matrix cpu matrix cpu matrix cpu matrix
sigma set data locat
set data locat
set data locat
set data locat
need set data locat matric write

implement
implement
implement


summari matrix matrix multipli major matric transpos alpha beta summari
param name alpha scalar param
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name beta scalar param
param name result matrix user respons alloc param
elem type
matrix elem type multipli and weight add elem type alpha matrix elem type transpos a matrix elem type transpos b
elem type beta matrix elem type

decid and move to right devic

get devic id

get matrix type matrix type spars
implement
get matrix type matrix type spars

get matrix type matrix type dens

cpu spars matrix elem type multipli and weight add alpha cpu matrix transpos a cpu spars matrix transpos b beta cpu matrix
set data locat dens

get matrix type matrix type spars

cpu spars matrix elem type multipli and add alpha cpu matrix transpos a cpu spars matrix transpos b cpu spars matrix
set data locat spars


implement



switch to matrix type matrix type dens matrix format dens
cpu matrix elem type multipli and weight add alpha cpu matrix transpos a cpu matrix transpos b beta cpu matrix
set data locat dens


oper

matrix type matrix type matrix type matrix type matrix type matrix type dens dens

gpu matrix elem type multipli and weight add alpha gpu matrix transpos a gpu matrix transpos b beta gpu matrix
set data locat dens

matrix type matrix type spars matrix type matrix type matrix type matrix type dens spars dens dens

gpu matrix elem type second transpos b gpu matrix transpos gpu matrix
gpu spars matrix elem type multipli and weight add alpha gpu spars matrix transpos a second beta gpu matrix
set data locat dens

matrix type matrix type dens matrix type matrix type spars matrix type matrix type dens dens spars dens

gpu spars matrix get format matrix format matrix format spars csr

gpu spars matrix elem type multipli and weight add alpha gpu matrix transpos a gpu spars matrix transpos b beta gpu matrix



gpu matrix elem type first dummi transpos a gpu matrix transpos alpha gpu matrix alpha
gpu matrix elem type first first dummi support mix ref ref
gpu spars matrix elem type second dummi transpos b gpu spars matrix transpos gpu spars matrix
gpu spars matrix elem type second second dummi
beta

gpu spars matrix elem type multipli first second gpu matrix



matrix elem type get num row get num col deviceid type get devic id
gpu spars matrix elem type multipli first second gpu matrix
beta


set data locat dens

matrix type matrix type dens matrix type matrix type spars matrix type matrix type spars

spars matrix code
gpu spars matrix elem type multipli and add alpha gpu matrix transpos a gpu spars matrix transpos b gpu spars matrix
set data locat spars

matrix type matrix type matrix type matrix type matrix type matrix type spars

gpu spars matrix elem type first dummi alpha gpu spars matrix gpu spars matrix alpha
gpu spars matrix elem type first first dummi malcolm support
beta

gpu spars matrix elem type multipli first transpos a gpu spars matrix transpos b gpu spars matrix
set data locat spars



gpu spars matrix elem type gpu spars matrix get comput devic id
gpu spars matrix elem type multipli first transpos a gpu spars matrix transpos b
gpu spars matrix gpu spars matrix beta
set data locat spars


matrix type matrix type matrix type matrix type dens matrix type matrix type spars

gpu matrix elem type gpu matrix get comput devic id
gpu spars matrix elem type tmp spars gpu matrix get comput devic id
gpu matrix elem type multipli and weight add alpha gpu matrix transpos a gpu matrix transpos b beta
tmp spars set valu
gpu spars matrix tmp spars gpu spars matrix beta
set data locat spars


implement



elem type
matrix elem type multiply1x1 and weight add elem type alpha matrix elem type matrix elem type elem type beta matrix elem type

special matrix
altern get00 element make thing ineffici
get num element
invalid argument multiply1x1 and weight add first must scalar

dispatch matrix flag
nullptr
cpu matrix elem type multiply1x1 and weight add alpha cpu matrix cpu matrix beta cpu matrix
gpu matrix elem type multiply1x1 and weight add alpha gpu matrix gpu matrix beta gpu matrix
implement
implement


summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name result matrix user respons alloc param
elem type
matrix elem type multipli and add matrix elem type transpos a matrix elem type transpos b
matrix elem type

matrix elem type multipli and weight add transpos a transpos b


summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name result matrix user respons alloc param
elem type
matrix elem type multipli matrix elem type transpos a matrix elem type transpos b
matrix elem type

matrix elem type multipli and weight add transpos a transpos b


summari matrix matrix multipli major matric transpos summari
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type multipli matrix elem type matrix elem type matrix elem type

matrix elem type multipli and weight add


summari convolut major matric transpos alpha beta multipli and weight add special summari
param name alpha scalar param
param name input matrix param
param name transpos a whether matrix transpos param
param name input matrix param
param name transpos b whether matrix transpos param
param name beta scalar param
param name result matrix user respons alloc param
elem type
matrix elem type convolv and weight add elem type alpha matrix elem type transpos a matrix elem type transpos b
elem type beta matrix elem type size num channel size horizont subsampl pad channelwis

decid and move to right devic

get devic id get matrix type matrix type dens get matrix type matrix type spars get matrix type matrix type dens

gpu spars matrix elem type convolv and weight add alpha gpu matrix transpos a gpu spars matrix transpos b beta gpu matrix num channel horizont subsampl pad channelwis



implement



summari matrix scalar multipli major matric alpha summari
column vector column
vector row
param name alpha scalar param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type scale and add elem type alpha matrix elem type matrix elem type

is empti is empti
logic error scale and add input matric

decid and move to right devic

get matrix type get matrix type

dispatch matrix flag
cpu matrix elem type scale and add alpha cpu matrix cpu matrix
gpu matrix elem type scale and add alpha gpu matrix gpu matrix
implement
gpu spars matrix elem type move gpu spars matrix gpu spars matrix elem type scale and add alpha gpu spars matrix gpu spars matrix



dispatch matrix flag nullptr

cpu spars matrix elem type scale and add alpha cpu spars matrix cpu matrix
set data locat


gpu spars matrix get format matrix format matrix format spars csc
gpu spars matrix elem type scale and add alpha gpu spars matrix gpu matrix gpu matrix
spars matrix code
gpu spars matrix elem type scale and add alpha gpu spars matrix gpu matrix
set data locat

implement

gpu matrix make share gpu matrix elem type gpu spars matrix copi to dens matrix
gpu spars matrix elem type scale and add alpha gpu matrix gpu spars matrix gpu matrix
set data locat dens
gpu spars matrix nullptr




summari matrix scalar multipli major matric alpha beta summari
column vector column
vector row
param name alpha scalar param
param name input matrix param
param name beta scalar param
param name result matrix caller respons alloc param
elem type
matrix elem type scale and add elem type alpha matrix elem type elem type beta matrix elem type

beta
scale and add alpha
beta
scale alpha


scale and add alpha beta alpha beta
scale beta beta beta



tensor swap addit keep weight scale factor swap dimens

interpret tensor dimens column major usual
tensor dimens note swap
main point reshuffl tensor dimens swap memori
gradient need henc keep weight
note
place oper expressli allow
exampl matrix transpos
keep weight overwritten straight assign uniniti contain na ns
origin matrix dimens ignor size must match row col
diagnost purpos also enforc row col function requir remov help
dens matric
todo handl case
swap happen block copi
swap implement cu dnn
elem type
matrix elem type tensor shuffl scale and add elem type keep weight matrix elem type size size size size size elem type scale factor matrix elem type matrix elem type

get num element get num element get num element get num element alloc must match dimens sinc reinterpret dimens anyway
invalid argument tensor shuffl scale and add must element
is empti oper minibatch slice perfectli cromul


saniti check current case strictli necessari delet
get num row get num row get num row
invalid argument tensor shuffl scale and add meant dimens multipl
get num col get num col get num col
invalid argument tensor shuffl scale and add meant column dimens multipl

decid and move to right devic

dispatch matrix flag
nullptr
cpu matrix elem type tensor shuffl scale and add keep weight cpu matrix scale factor cpu matrix cpu matrix
gpu matrix elem type tensor shuffl scale and add keep weight gpu matrix scale factor gpu matrix gpu matrix
implement
gpu spars matrix elem type tensor shuffl scale and add keep weight gpu spars matrix scale factor gpu spars matrix gpu spars matrix


summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type add scale differ elem type alpha matrix elem type matrix elem type matrix elem type

decid and move to right devic
get matrix type get matrix type get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix elem type add scale differ alpha cpu matrix cpu matrix cpu matrix
gpu matrix elem type add scale differ alpha gpu matrix gpu matrix gpu matrix
implement
implement


summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type assign scale differ elem type alpha matrix elem type matrix elem type matrix elem type

decid and move to right devic

get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix elem type assign scale differ alpha cpu matrix cpu matrix cpu matrix
gpu matrix elem type assign scale differ alpha gpu matrix gpu matrix gpu matrix
implement
implement


summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type add scale differ matrix elem type alpha matrix elem type matrix elem type matrix elem type

decid and move to right devic
alpha transfer to devic get devic id

get matrix type get matrix type get matrix type get matrix type get matrix type alpha get matrix type
implement

dispatch matrix flag

cpu matrix elem type add scale differ alpha cpu matrix cpu matrix cpu matrix cpu matrix
gpu matrix elem type add scale differ alpha gpu matrix gpu matrix gpu matrix gpu matrix
implement
implement


summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type assign scale differ matrix elem type alpha matrix elem type matrix elem type matrix elem type

decid and move to right devic alpha
transfer to devic get devic id

get matrix type get matrix type get matrix type alpha get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag
nullptr
cpu matrix elem type assign scale differ alpha cpu matrix cpu matrix cpu matrix cpu matrix
gpu matrix elem type assign scale differ alpha gpu matrix gpu matrix gpu matrix gpu matrix
implement
implement



elem type
matrix elem type add element to element matrix elem type size size matrix elem type size size

decid and move to right devic

get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix elem type add element to element cpu matrix cpu matrix
gpu matrix elem type add element to element gpu matrix gpu matrix
implement
implement



elem type
matrix elem type assign element to element matrix elem type size size matrix elem type size size

decid and move to right devic

get matrix type get matrix type
implement

dispatch matrix flag

cpu matrix elem type add element to element cpu matrix cpu matrix
gpu matrix elem type add element to element gpu matrix gpu matrix
implement
implement


column slice start start index
elem type
matrix elem type minu one at matrix elem type size posit

dispatch matrix flag

cpu matrix elem type minu one at cpu matrix posit
gpu matrix elem type minu one at gpu matrix posit
implement
implement


summari matrix scalar multipli major matric alpha summari
param name alpha scalar param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type scale elem type alpha matrix elem type matrix elem type

decid and move to right devic

switch to matrix type get matrix type get format

alpha

resiz
set valu littl faster also propag na ns expect beta paramet



dispatch matrix flag

cpu matrix elem type scale alpha cpu matrix cpu matrix
gpu matrix elem type scale alpha gpu matrix gpu matrix
implement gpu spars matrix gpu spars matrix alpha


summari matrix scalar multipli major matric alpha summari
param name alpha scalar param
param name input matrix param
elem type
matrix elem type scale elem type alpha matrix elem type

alpha
set valu littl faster also propag na ns expect beta paramet
is empti


dispatch matrix flag

cpu matrix elem type scale alpha cpu matrix
gpu matrix elem type scale alpha gpu matrix
implement
gpu spars matrix elem type scale alpha gpu spars matrix


summari matrix scalar matrix multipli major matric alpha summari
param name alpha matrix param
param name input matrix param
elem type
matrix elem type scale matrix elem type alpha matrix elem type

is empti


decid and move to right devic alpha

get matrix type alpha get matrix type
implement

dispatch matrix flag
nullptr
cpu matrix elem type scale alpha cpu matrix cpu matrix
gpu matrix elem type scale alpha gpu matrix gpu matrix
implement
implement


elem type
matrix elem type inner product matrix elem type matrix elem type matrix elem type is col wise

is empti is empti
logic error inner product input matrix

decid and move to right devic

get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix elem type inner product cpu matrix cpu matrix cpu matrix is col wise
gpu matrix elem type inner product gpu matrix gpu matrix gpu matrix is col wise
implement
implement


elem type
elem type matrix elem type inner product of matric matrix elem type matrix elem type

is empti is empti
logic error inner product of matric input matric

decid and move to right devic

get matrix type get matrix type

dispatch matrix flag
nullptr
cpu matrix elem type inner product of matric cpu matrix cpu matrix
gpu matrix elem type inner product of matric gpu matrix gpu matrix
implement
implement



dispatch matrix flag
nullptr
implement
gpu spars matrix elem type inner product of matric gpu matrix gpu spars matrix
implement
gpu spars matrix elem type inner product of matric gpu spars matrix gpu matrix



elem type
matrix elem type matrix elem type assign inner product of matric matrix elem type matrix elem type

is empti is empti
logic error inner product of matric input matric

resiz

decid and move to right devic

get matrix type get matrix type

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix set valu cpu matrix elem type inner product of matric cpu matrix cpu matrix
gpu matrix assign inner product of matric gpu matrix gpu matrix
implement
implement



implement





elem type
matrix elem type element wise power elem type alpha matrix elem type matrix elem type

is empti


decid and move to right devic
switch to matrix type get matrix type get format

dispatch matrix flag
nullptr
cpu matrix elem type element wise power alpha cpu matrix cpu matrix
gpu matrix elem type element wise power alpha gpu matrix gpu matrix
implement
gpu spars matrix elem type element wise power alpha gpu spars matrix gpu spars matrix


elem type
matrix elem type are equal matrix elem type matrix elem type elem type threshold

get num row get num row get num col get num col


decid and move to right devic

get matrix type get matrix type

dispatch matrix flag
nullptr
cpu matrix elem type are equal cpu matrix cpu matrix threshold
gpu matrix elem type are equal gpu matrix gpu matrix threshold
cpu spars matrix elem type are equal cpu spars matrix cpu spars matrix threshold
gpu spars matrix elem type are equal gpu spars matrix gpu spars matrix threshold



dispatch matrix flag
nullptr
implement

gpu spars matrix elem type are equal gpu matrix gpu spars matrix threshold
implement

gpu spars matrix elem type are equal gpu spars matrix gpu matrix threshold



elem type
matrix elem type ha element matrix elem type elem type valu

is empti


dispatch matrix flag

cpu matrix elem type ha element cpu matrix valu
gpu matrix elem type ha element gpu matrix valu
implement

implement



diagnost helper check matrix
thi slow
elem type
matrix elem type ha nan name

implement spars matric
return workaround
least evalu dens matric
matrix type matrix type spars


is empti


first detect faster
get devic id cpudevic

matrix elem type get devic id
assign sum of element
get00 element
isnan




matrix elem type

coord
isnan

fprintf stderr ha nan detect matrix name get num row get num col




defin check nan ha nan

anoth diagnost helper check matrix
thi use load save time thi test slow

elem type
size matrix elem type count nan inf


size na ns found
coord


isnan isfinit





todo scalar oper matrix
elem type
elem type matrix elem type exp10 elem type

elem type 302585093


elem type
elem type matrix elem type elem type elem type



logic error smaller zero

floor


todo log add defin tensor op
current use elem type use insid must compar make chang
elem type
elem type matrix elem type log add elem type elem type

elem type temp diff



temp

temp todo swap

diff
diff minlogexp

elem type lsmall lzero



diff
elem type



matrix elem type matrix elem type shift matrix elem type size shift
right shift pad zero
shift left shift need neg valu
shift right shift need posit valu
bugbug leav uniniti valu open column
elem type
matrix elem type matrix elem type shift matrix elem type shift

is empti
logic error shift matrix

logic error shift bugbug thi current leav uniniti valu code contact fseid microsoft




resiz get num row get num col


get num col

shift shift
column slice shift shift set valu column slice shift
shift shift
column slice shift set valu column slice shift shift



elem type
matrix elem type matrix elem type assign element product of with shift neg matrix elem type matrix elem type size shift size negnumb

is empti is empti
logic error assign element product of with shift neg matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument input matrix dimens match

get num row
invalid argument assign element product of with shift neg input matrix must vector

decid and move to right devic
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign element product of with shift neg cpu matrix cpu matrix shift negnumb
gpu matrix assign element product of with shift neg gpu matrix gpu matrix shift negnumb
implement
implement



elem type
matrix elem type matrix elem type assign inner product of with shift neg matrix elem type matrix elem type is col wise size shift size negnumb

inner product with shift neg is col wise shift negnumb



elem type
matrix elem type inner product with shift neg matrix elem type matrix elem type matrix elem type is col wise size shift size negnumb

is empti is empti
logic error inner product input matrix

decid and move to right devic

get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix elem type inner product with shift neg cpu matrix cpu matrix cpu matrix is col wise shift negnumb
gpu matrix elem type inner product with shift neg gpu matrix gpu matrix gpu matrix shift negnumb
implement
implement


elem type
matrix elem type matrix elem type get a row by index matrix elem type size index

is empti
logic error get a row by index matrix

warn must
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix get a row by index cpu matrix index
gpu matrix get a row by index gpu matrix index
implement
implement




elem type
matrix elem type conduct row element multipli with shift matrix elem type matrix elem type matrix elem type size shift b firstmatrixfix

is empti is empti
logic error inner product input matrix

decid and move to right devic

get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix elem type conduct row element multipli with shift cpu matrix cpu matrix cpu matrix shift b firstmatrixfix
gpu matrix elem type conduct row element multipli with shift gpu matrix gpu matrix gpu matrix shift b firstmatrixfix
implement
implement


elem type
matrix elem type matrix elem type assign element product of with shift matrix elem type matrix elem type size shift

is empti is empti
logic error assign element product of with shift matrix

get num row get num row get num col get num col
get num row get num row get num col get num col
invalid argument input matrix dimens match

get num row
invalid argument assign element product of with shift neg input matrix must vector

decid and move to right devic
get matrix type get matrix type
implement

switch to matrix type get matrix type get format

dispatch matrix flag

cpu matrix assign element product of with shift cpu matrix cpu matrix shift
gpu matrix assign element product of with shift gpu matrix gpu matrix shift
implement
implement



elem type
matrix elem type rcrf backward comput matrix elem type alpha matrix elem type beta
matrix elem type function valu matrix elem type lbl
matrix elem type score matrix elem type pair score shift

decid and move to right devic alpha beta
function valu transfer to devic alpha get devic id
beta transfer to devic alpha get devic id

dispatch matrix flag alpha
beta
cpu matrix elem type rcrf backward comput
alpha cpu matrix
beta cpu matrix
lbl cpu matrix
pair score cpu matrix
gpu matrix elem type rcrf backward comput
alpha gpu matrix
beta gpu matrix
lbl gpu matrix
score gpu matrix
pair score gpu matrix shift
implement
implement


elem type
matrix elem type rcrf tran grd comput matrix elem type lbl
matrix elem type alpha
matrix elem type beta
matrix elem type pair score
matrix elem type
start lbl
shift

decid and move to right devic alpha
transfer to devic alpha get devic id

dispatch matrix flag alpha

cpu matrix elem type rcrf tran grd comput
lbl cpu matrix
alpha cpu matrix
beta cpu matrix
pair score cpu matrix
cpu matrix
gpu matrix elem type rcrf tran grd comput
lbl gpu matrix
alpha gpu matrix
beta gpu matrix
pair score gpu matrix
gpu matrix
start lbl
shift
implement
implement


elem type
matrix elem type matrix elem type drop frame matrix elem type label matrix elem type gamma elem type threshhold

decid and move to right devic label gamma

label get num col gamma get num col label get num row gamma get num row
logic error drop frame label matrix size gamm matrix
switch to matrix type label get matrix type label get format

dispatch matrix flag

cpu matrix drop frame label cpu matrix gamma cpu matrix threshhold
gpu matrix drop frame label gpu matrix gamma gpu matrix threshhold
implement
implement




summari alpha summari
must
param name alpha scalar param
param name input matrix param
param name input matrix param
param name result matrix user respons alloc param
elem type
matrix elem type matrix elem type assign sequenc error elem type hsmooth weight matrix elem type label
matrix elem type dnnoutput matrix elem type gamma elem type alpha

decid and move to right devic label dnnoutput gamma

label get matrix type gamma get matrix type
implement

switch to matrix type label get matrix type label get format

dispatch matrix flag

cpu matrix assign sequenc error hsmooth weight label cpu matrix dnnoutput cpu matrix gamma cpu matrix alpha
gpu matrix assign sequenc error hsmooth weight label gpu matrix dnnoutput gpu matrix gamma gpu matrix alpha
implement
implement


pragma endregion static bla function

tensor view current spars matric
elem type
verifi is dens matrix elem type

get matrix type dens
runtim error tensor op tensor oper current support spars matric



elem type
matrix elem type tensor op elem type beta matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

verifi is dens verifi is dens

decid and move to right devic

dispatch matrix flag

cpu matrix tensor op beta cpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
gpu matrix tensor op beta gpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
implement
implement


elem type
matrix elem type tensor op elem type beta matrix elem type matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

verifi is dens verifi is dens verifi is dens

decid and move to right devic

dispatch matrix flag

cpu matrix tensor op beta cpu matrix cpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
gpu matrix tensor op beta gpu matrix gpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
implement
implement


elem type
matrix elem type tensor op elem type beta matrix elem type matrix elem type matrix elem type elem type alpha element wise oper element wise oper reduct op
size offset
small vector size regular op dim small vector ptrdiff regular stride
small vector size reduc op dim small vector ptrdiff reduc stride

verifi is dens verifi is dens verifi is dens verifi is dens

decid and move to right devic

dispatch matrix flag

cpu matrix tensor op beta cpu matrix cpu matrix cpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
gpu matrix tensor op beta gpu matrix gpu matrix gpu matrix alpha reduct op offset regular op dim regular stride reduc op dim reduc stride
implement
implement


matrix
matrix

matrix back store quantiz matrix also flag matrix
explicitli instanti method need purpos
matrix matrix deviceid type
matrix matrix matrix
matrix matrix size num row size num col deviceid type devic id matrix type matrix type matrix format matrix format
matrix matrix size num row size num col p array deviceid type devic id size matrix flag size
matrix matrix
matrix matrix matrix move from
matrix data
matrix get devic id
size matrix get num element
matrix matrix column slice size start column size num col
matrix transfer to devic is be move empti transfer
matrix transfer to devic if not there is be move empti transfer updat prefer devic
size matrix get num row
size matrix get num col
matrix set valu
matrix set valu size num row size num col devic id p array size matrix flag
matrix set valu matrix matrix format
matrix is empti
matrix resiz size num row size num col size num nz elem to reserv grow onli

matrix matrix size size deviceid type size size



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
batch normal engin
cu dnn factori

microsoft cntk

elem type
batch norm engin elem type forward scale bia exp avg factor blend factor run mean run inv std dev
epsilon save mean save inv std dev

get num row in out t get num element
get num row in out t get num element
get num col get num col
isfinit exp avg factor exp avg factor exp avg factor
isfinit blend factor blend factor blend factor
isfinit epsilon epsilon
spatial

in out t get num element scale get num row
in out t get num element bia get num row
in out t get num element run mean get num row
in out t get num element run inv std dev get num row
save mean get num element in out t get num element save mean get num row
save inv std dev get num element in out t get num element save inv std dev get num row



in out t get num element scale get num row
in out t get num element bia get num row
in out t get num element run mean get num row
in out t get num element run inv std dev get num row
save mean get num element in out t get num element save mean get num row
save inv std dev get num element in out t get num element save inv std dev get num row

scale get num col
bia get num col
run mean get num col
run inv std dev get num col
save mean get num element save mean get num col
save inv std dev get num element save inv std dev get num col

ensur compat
forward core scale bia exp avg factor blend factor run mean run inv std dev epsilon save mean save inv std dev


elem type
batch norm engin elem type backward src grad grad scale
save mean save inv std dev scale grad bia grad

ensur compat
backward core src grad grad scale save mean save inv std dev scale grad bia grad


elem type
cntk batch norm engin batch norm engin elem type


base batch norm engin elem type
base


cntk batch norm engin deviceid type devic id tensor shape in out t
spatial imag layout kind imag layout
base devic id in out t spatial imag layout




base devic id
base imag layout
base in out t
base spatial

ensur compat

spatial imag layout imag layout kind
invalid argument cntk batch normal support cudnn layout


forward core scale bia exp avg factor blend factor run mean run inv std dev
epsilon save mean save inv std dev

batch normal forward scale bia exp avg factor blend factor run mean run inv std dev epsilon save mean save inv std dev


backward core src grad grad scale save mean save inv std dev
scale grad bia grad

src grad batch normal backward grad scale save mean save inv std dev scale grad bia grad



cntk batch norm engin
cntk batch norm engin


ha flag test flag

test flag


elem type
uniqu batch norm engin elem type batch norm engin elem type creat deviceid type devic id tensor shape in out t
spatial imag layout kind imag layout
batch norm engin kind enabl engin

cntk batch norm engin
ha flag enabl engin batch norm engin kind cntk

fprintf stderr n use cntk batch normal engin
make uniqu cntk batch norm engin elem type devic id in out t spatial imag layout


ha flag enabl engin batch norm engin kind cu dnn

fprintf stderr n use cu dnn batch normal engin
cu dnn batch norm engin factori elem type creat devic id in out t spatial imag layout


runtim error could find appropri batch normal engin


batch norm engin
batch norm engin


cudalib cuda call cubla encapsul
actual cuda call keep header header

seid hansu

defin secur warn getenv

basic
cuda runtim cuda
cuda devic
cudalib
cudadevic


cubla

nomultidevic defin disabl context driver stuff

ifndef nomultidevic
pragma comment cuda link cuda devic

pragma comment cudart link cuda runtim
pragma comment cubla

msra cuda

devicesalloc mean initi

allow write cuda function error cuda runtim
cuda error

cuda success
runtim error cuda error cuda get error string


cuda stream get current stream

cuda stream default


synchron ongo thread
join

cuda devic synchron cuda devic synchron fail


alloc stack store devic push
stack size
cur stack
size devic stack stack size

memori alloc
mallocbyt size nelem size

size



fprintf stderr mallocbyt alloc element size byte nelem nelem comment hansu annoy output

cuda malloc nelem cuda malloc fail


except

fprintf stderr mallocbyt fail error






freebyt

cuda free cuda free fail


memcpyh2d size byteoffset size nbyte

cuda memcpi byteoffset nbyte cuda memcpi host to devic cuda memcpi fail


memcpyd2h size byteoffset size nbyte

cuda memcpi byteoffset nbyte cuda memcpi devic to host cuda memcpi fail



stdafx
cuda page lock mem alloc
best gpu cpuonli
ifndef cpuonli
cuda runtim


microsoft cntk

ifndef cpuonli
cuda page lock mem alloc cuda page lock mem alloc devic id
devic id devic id



cuda page lock mem alloc malloc size size devic id


cuda set devic devic id

note cuda host alloc default cuda host get flag show alloc cuda host alloc map
cuda host alloc size cuda host alloc default malloc cuda page lock mem alloc fail




cuda page lock mem alloc free devic id

cuda set devic devic id
cuda free host free cuda page lock mem alloc fail


cuda page lock mem alloc malloc size size

malloc size devic id


cuda page lock mem alloc free

free devic id


cuda page lock mem alloc get devic id

devic id


dummi definit compil cpuonli
cuda page lock mem alloc cuda page lock mem alloc



cuda page lock mem alloc get devic id




cuda page lock mem alloc malloc size

nullptr


cuda page lock mem alloc malloc size

nullptr


cuda page lock mem alloc free



cuda page lock mem alloc free





copyright microsoft right reserv
licens licens licens file project root full licens inform

dssm reader defin export function applic


stdafx
defin dataread export creat export
data reader
dssm reader
ifdef leakdetect
leak detect

fileutil fexist

microsoft cntk

dword hidword size size

size

dword lodword size size

size 0x ffffffff


ws2 wstring wstr

size need wide char to multi byte wstr wstr length
str to size need
wide char to multi byte wstr wstr length str to size need
str to


elem type
size dssm reader elem type random sweep size mb start sampl

size random rang per epoch epoch size random rang random rang
epoch random rang per epoch epoch sampl random rang
mb start sampl random rang


read line read line
read sampl sampl read sampl space
return success read record otherwis
elem type
dssm reader elem type read record size read sampl

use


record to read determin record read popul record buffer
mb start sampl start sampl read
tail check possibl remain record read
return read dataset
elem type
size dssm reader elem type record to read size mb start sampl tail

mb start sampl epoch start sampl
determin ahead need read
random random
need read minibatch
size epoch sampl mb start sampl
epoch sampl epoch size

determin left read epoch
size number to epoch epoch size epoch sampl
take either minibatch left epoch
size number to read number to epoch mb size
number to read tail
number to read mb size

random

size random sweep random sweep mb start sampl
first read read take anoth random rang
need read least random rang record
random sweep randomord current seed rang chang sinc last time

number to read round up epoch sampl random rang epoch sampl
number to read tail
number to read random rang


number to read


elem type
dssm reader elem type write label file

write label file
label file to write

map id to label size

file label file label file to write file option write file option text
map id to label size

label file map id to label

fprintf stderr label file written disk label file to write
label file to write clear

cach writer

fprintf stderr warn file written disk written first time entir dataset found label file to write




destroy cleanup remov
note destroy use past point
elem type
dssm reader elem type destroy




init reader initi multipl set
config configur paramet dataread
sampl format
paramet valu reader
reader
reader
reader type dssm reader
mini batch mode partial
random
featur

start
file speech mnist mnist test

label

start
file speech mnist mnist test
label map file speech mnist label
label dim
label type categori


elem type
config record type
dssm reader elem type init from config config record type reader config

vector wstring featur
vector wstring label

determin name featur labl section config file
featur vector featur name string
label vector label name string
dssm dataset need featur label necessari follow label serv place holder
get file config name reader config featur label

dssm dataset must exactli featur
config file must specifi queri featur first document featur sequenc differ attent
featur size label size

featur name queri featur
featur name doc featur
label name label



runtim error dssm requir exactli featur label their name match definit



mb start sampl epoch total sampl epoch start sampl
label id max label dim
partial minibatch end reach
label type label categori
read next sampl
trace level reader config trace level

reader config exist random

bugbug read
wstring random string reader config random
random string

random rang random none

random string auto

random rang random auto



random rang reader config random




random rang random none


minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

config paramet queri featur featur
config paramet config featur queri reader config featur name queri
config paramet config featur doc reader config featur name doc

config featur queri size
runtim error featur file found requir configur featur file myfil start
config featur doc size
runtim error featur file found requir configur featur file myfil start

read featur size inform
thi inform use handl oo vs
featur dim queri config featur queri
featur dim doc config featur doc

wstring file q config featur queri file
wstring file d config featur doc file

dssm queri input init file q featur dim queri
dssm doc input init file d featur dim doc

total sampl dssm queri input num row
read order

read order total sampl
total sampl

read order


mb size

destructor get call properli
elem type
dssm reader elem type dssm reader

releas memori


releas memori releas memori footprint dssm reader
use cach reader take
elem type
dssm reader elem type releas memori

qfeatur buffer
qfeatur buffer
qfeatur buffer
dfeatur buffer
dfeatur buffer
dfeatur buffer
label buffer
label buffer
label buffer
label id buffer
label id buffer
label id buffer
featur data clear
label id data clear
label data clear


setup epoch setup proper posit file variabl set start particular epoch
elem type
dssm reader elem type setup epoch



util round integ multipl size
size round up size valu size size

valu size size size


start minibatch loop startup minibatch
mb size size minibatch sampl
epoch epoch request epoch sampl must specifi epoch zero complet
request epoch sampl sampl random default request data size use sampl dataset
valu must multipl mb size round
elem type
dssm reader elem type start minibatch loop size mb size size epoch size request epoch sampl

size mb start sampl epoch epoch size
total sampl

total sampl dssm queri input num row


size file record total sampl mb start sampl total sampl
fprintf stderr start epoch record count file posit epoch mb start sampl file record

reset read sampl
read next sampl
epoch start sampl mb start sampl mb start sampl
mb size mb size
epoch size request epoch sampl
dssm queri input setup epoch mb size
dssm doc input setup epoch mb size
epoch size size dssm queri input num row

epoch size size dssm queri input num row

random

random shuffl read order read order epoch size

epoch epoch
mb start sampl epoch epoch size


store label type elem type
requir label store elem type array
elem type
dssm reader elem type store label elem type label store label type label valu

label store elem type map label to id label valu


get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
dssm reader elem type tri get minibatch stream minibatch input matric

read next sampl total sampl



unit test exampl input matric contain label
both serv constant valu need chang
node need fill matric label
matrix elem type featur q matric get input matrix elem type featur name queri
matrix elem type featur d matric get input matrix elem type featur name doc
matrix elem type label matric get input matrix elem type label name chang part later todo

size actual mb size read next sampl mb size total sampl total sampl read next sampl mb size

featur q switch to matrix type matrix type spars matrix format matrix format spars csc
featur d switch to matrix type matrix type spars matrix format matrix format spars csc


featur q resiz dssm queri input num row actual mb size
featur d resiz dssm doc input num row actual mb size


fprintf stderr featur q
dssm queri input next batch featur q read next sampl actual mb size read order
fprintf stderr nfeatur d
dssm doc input next batch featur d read next sampl actual mb size read order
fprintf stderr
read next sampl actual mb size

featur q print featur q
fprintf stderr
featur d print featur d
fprintf stderr



gpuspars index type csc col
gpuspars index type
elem type
size
size
size ncol
featur q get matrix from csc format csc col ncol



csc col

fprintf stderr


fprintf stderr





featur q transfer from devic to devic featur q get devic id
featur q switch to matrix type matrix type dens matrix format matrix format dens
featur q print featur q

featur d transfer from devic to devic featur d get devic id
featur d switch to matrix type matrix type dens matrix format matrix format dens
featur d print featur d




actual mb size mb size label buffer

size row label get num row
label buffer elem type row actual mb size
memset label buffer elem type row actual mb size
actual mb size

label buffer row


actual mb size label get num col

size row label get num row
label resiz row actual mb size
label set valu
label set valu row actual mb size label get devic id label buffer


featur q print featur q
featur d print featur d
label label





get label map get label map integ index label
return numer datatyp label
elem type
i data reader label id type i data reader label type dssm reader elem type get label map wstring section name

cach reader

cach reader get label map section name

map id to label


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
dssm reader elem type set label map wstring section name label id type label type label map

cach reader

runtim error cannot map tabl cach reader use

map id to label label map
map label to id clear
pair label type label map

map label to id second first



elem type
dssm reader elem type data end

elem type
dssm binari input elem type dssm binari input


elem type
dssm binari input elem type dssm binari input

dispos

elem type
dssm binari input elem type init wstring file name size



mb size

hndl creat file a file name gener read
file share read open exist file attribut normal

hndl creat file file name gener read
file share read open exist file attribut normal
hndl invalid handl valu

messag
sprintf messag unabl open creat file error file name get last error
runtim error messag


filemap creat file map hndl page readonli

system info sysinfo
get system info sysinfo
dword sy gran sysinfo dw alloc granular

header buffer map view of file filemap handl
file read correct permiss
hidword
lodword
int64 int32

cout after mapviewoffil endl

memcpi num row header buffer int64
memcpi num col header buffer int64 int32
memcpi total n nz header buffer int64 int32 int64

cout after gotvalu endl
int64 offset int64 int32

int64 offset pad offset sy gran
offset offset pad

int64 header size num row int64 offset pad

offset orig map view of file filemap handl
file read correct permiss
hidword offset
lodword offset
header size

offset buffer offset orig offset pad

offset

free offset

offset int64 malloc int64 num row
memcpi offset offset buffer num row int64

int64 header offset offset offset pad num row int64

int64 pad header offset sy gran
header offset pad

orig map view of file filemap handl
file read correct permiss
hidword header offset
lodword header offset

buffer orig pad

elem type
dssm binari input elem type setup epoch size minibatch size

valu mb size minibatch size

valu

free valu
free col indic
free row indic


valu elem type malloc elem type buffer minibatch size
col indic int32 malloc int32 minibatch size
row indic int32 malloc int32 buffer minibatch size
fprintf stderr valu size elem type buffer minibatch size
fprintf stderr colindi size int32 buffer minibatch size
fprintf stderr rowindi size int32 buffer minibatch size

minibatch size mb size

mb size minibatch size




elem type
dssm binari input elem type next batch matrix elem type matric size size num to read order


dev id matric get devic id
matric transfer from devic to devic dev id


int32 index

num to read

int64 offset offset order
int64 offset offset
int64 offset offset order
int32
col indic index
int32 int32 buffer offset
memcpi buffer offset int32
memcpi valu index buffer offset int32 elem type
memcpi row indic index buffer offset int32 elem type int32

fprintf stderr index


fprintf stderr row indic index valu index
matric set valu row indic index valu index

fprintf stderr


index

col indic num to read index


index

col indic

fprintf stderr


fprintf stderr row indic valu



fprintf stderr n xxxx index
fprintf stderr xxxx valu read elem type index elem type buffer num to read
fprintf stderr xxxx indic read int32 index int32 buffer num to read
fprintf stderr xxxx int32 int32


valu elem type malloc elem type buffer minibatch size
col indic int32 malloc int32 buffer minibatch size
row indic int32 malloc int32 buffer minibatch size


matric set matrix from csc format col indic row indic valu index num to read
matric print actual valu


matric switch to matrix type matrix type dens matrix format matrix format dens
matric print featur q

matric transfer from devic to devic dev id




elem type
dssm binari input elem type dispos

offset orig

unmap view of file offset orig

orig

unmap view of file orig


offset

free offset elem type malloc 1024

valu

free valu elem type malloc 1024

row indic

free row indic malloc 1024

col indic

free col indic malloc 1024



elem type
dssm reader elem type get data wstring section name size num record size data buffer size size record start

cach reader

cach reader get data section name num record data buffer size record start

runtim error get data support dssm reader


instanti combin expect use
dssm reader
dssm reader

stdafx sourc file includ standard includ
dssm reader compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file
dllmain defin entri point applic
stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
dssm reader

microsoft cntk

dataread get reader f i data reader preader

preader dssm reader

dataread get reader d i data reader preader

preader dssm reader




copyright microsoft right reserv
licens licens licens file project root full licens inform

lu sequenc reader defin export function applic


stdafx
basic
defin dataread export creat export
data reader
lu sequenc reader
ifdef leakdetect
leak detect

fstream
random random engin
fileutil

microsoft cntk

get id from label label
mb start sampl start sampl ensur good
end of data check check dataset wraparound
return read dataset
elem type
lu sequenc reader elem type get id from label label type label valu label info label info

found label info word4idx find label valu

found second


elem type
batch lu sequenc reader elem type batch lu sequenc reader

index index label info num index

label info index id2class local
label info index class info local



elem type
batch lu sequenc reader elem type read label info wstring vocfil
wstring word4idx
read class
wstring word4cl
wstring idx4word
idx4class
m nbr cl

wifstream
ifdef
open vocfil wifstream

open wtocharpath vocfil wifstream

good
logic error lu sequenc reader cannot open vocfil

wstring wstr

nword
prevcl

m nbr cl
wstring strtmp
good

getlin strtmp
strtmp trim strtmp todo oper place need assign
strtmp length

read class

vector wstring wordandcl split string strtmp wstr
wtoi wordandcl
word4cl wordandcl

idx4class

idx4class prevcl

idx4class prevcl
logic error lu sequenc reader word need group class class indic need ascend
prevcl idx4class


word4idx wordandcl
idx4word wordandcl
m nbr cl
m nbr cl



word4idx strtmp
idx4word strtmp

nword


read class
m nbr cl


elem type
batch lu sequenc reader elem type get class info label info lbl info

lbl info clsinfo read lbl info m nbr class


popul local matrix
lbl info id2class local nullptr
lbl info id2class local matrix elem type cpudevic
lbl info class info local nullptr
lbl info class info local matrix elem type cpudevic

lbl info class info local switch to matrix type matrix type dens matrix format dens
lbl info class info local resiz lbl info m nbr class
lbl info class info local set valu todo need left refactor

move sinc element wise oper expens wrong
todo ever alloc abovew
cur dev id lbl info class info local get devic id
lbl info class info local transfer from devic to devic cur dev id cpudevic

clsidx
prvcl
size nword

clsidx lbl info idx4class
prvcl clsidx

prvcl
lbl info class info local prvcl
prvcl clsidx
lbl info class info local prvcl


lbl info class info local prvcl nword

lbl info class info local transfer from devic to devic cpudevic cur dev id

lbl info clsinfo read


get id from label label
mb start sampl start sampl ensur good
end of data check check dataset wraparound
return read dataset
elem type
lu sequenc reader elem type get id from label vector label id type label valu vector label id type

clear

size label valu size

push back label valu

todo valu



elem type
lu sequenc reader elem type get sentenc end id from output label

label info feat in label info label info out

found feat in word4idx find feat in end sequenc

found feat in word4idx
found second

found



get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
elem type
lu sequenc reader elem type get data wstring size size size




lu sequenc reader elem type check id from label lu sequenc parser elem type label type label valu label info label info lu sequenc parser elem type label id type label id
elem type
lu sequenc reader elem type check id from label label type label valu label info label info label id

found label info map label to id find label valu

found
found label info map label to id



label id found second todo thi call check someth name



elem type
lu sequenc reader elem type write label file

updat label dimens enough need label id max updat process read
index index label info num index

label info label info label info index

write label file
label info file to write

label info map id to label size

file label file label info file to write file option write file option text
label info map id to label size

label file label info map id to label

label info file to write clear

cach writer

fprintf stderr warn file written disk label file written start epoch zero label info file to write





elem type
lu sequenc reader elem type load label file wstring file path vector label type ret label

initi file name
wstring path file path

ret label resiz
wifstream
ifdef
open path ifstream

open wtocharpath path ifstream


wstring
good

wchar stmp string
getlin stmp string
stmp
trim
length


check comment line
bugbug thi check space line need good fail
wstring size find first


trim
ret label push back label type




elem type
lu sequenc reader elem type chang mape label type label type maplist
label type unkstr
label type label id type word4idx

punk word4idx find unkstr
word4idx word4idx

label type first
label id type
maplist find maplist

label type maplist find second
word4idx



punk word4idx

runtim error check miss

punk second


word4idx



elem type
config record type
batch lu sequenc reader elem type init from config config record type reader config

user want cach
cach reader
cach writer

load word map reader config

vector wstring featur
vector wstring label
get file config name reader config featur label
featur size
featur name featur


wstring t input label reader config input label
wstring t output label reader config output label

label size label info num
runtim error batch lu sequenc reader label definit requir

t input label t output label

index index label info num index
label name index label index



index
label info num

label t input label
label name index label

label name index
runtim error cannot find input label

index
label info num

label t output label
label name index label

label name index
runtim error cannot find output label


config record type featur config reader config featur name config record type record

index index label info num index

config record type label config reader config label name index config record type record

label info index begin sequenc wstring label config begin sequenc
label info index end sequenc wstring label config end sequenc
label info index busewordmap label config use word map

label info index ispropos label config is propos

label info index clsinfo read

determin label desir
wstring label type label config label type categori
equal ci label type categori

label info index label categori


logic error lu sequenc reader support categori label

label need label map file file label line
label info index label none

wstring mode label config mode plain plain

label info index class info local nullptr
label info index id2class local nullptr

equal ci mode

label info index reader mode reader mode class

equal ci mode plain

label info index reader mode reader mode plain



logic error unsupport label mode format lu sequenc reader should either plain mode


wstring w class file label config token
w class file

read label info w class file label info index word4idx
label info index reader mode reader mode class
label info index word4cl
label info index idx4word label info index idx4class label info index m nbr class

get class info label info index

label info index busewordmap
chang mape m word map m unk str label info index word4idx
label info index label info index idx4word size




initi variabl
mb start sampl epoch total sampl epoch start sampl seq index
end reach
read next sampl line
read next sampl

word context reader config word context config record type array intargvector vector

input combin label data extra featur dim togeth
featur count featur dim label info label info in
featur count

wstring path name reader config file
trace level
fprintf stderr lu sequenc reader read sequenc file path name

label info label in label info label info in
label info label out label info label info out
fprintf stderr batch lu sequenc reader input file path name
parser pars init path name label in label out label in begin sequenc label in end sequenc label out begin sequenc label out end sequenc m unk str

m request num parallel sequenc reader config nbruttsineachrecurrentit size

m random
reader config exist random

random string reader config random
equal ci random string none



equal ci random string equal ci random string todo inconsist deprec

m random

invalid
todo fail invalid


m equal length output reader config equal length
m allow mult pass data reader config data multi pass

m ignor sentenc begin tag reader config ignoresentencebegintag


elem type
batch lu sequenc reader elem type reset

m process clear
m to process clear
m last process sentenc id
m po in sentenc
m last po in sentenc
m num read

label temp clear
featur temp clear
parser m sentenc index2 sentenc info clear


elem type
batch lu sequenc reader elem type start minibatch loop size mb size size epoch size request epoch sampl

featur buffer

label info label info label info label info label info out label next word label info in label info out
featur buffer elem type mb size label info
memset featur buffer elem type mb size label info


label buffer

label info label info label info label info label info out label next word label info in label info out
label info label categori

label buffer elem type label info mb size
memset label buffer elem type label info mb size
label id buffer mb size
memset label id buffer mb size

label info label none

label buffer elem type mb size
memset label buffer elem type mb size
label id buffer



mb size mb size
epoch size request epoch sampl

epoch size might valu alloc
epoch epoch
mb start sampl epoch epoch size

alloc room
label info label info out label categori
label id data reserv mb size
label info label info out label none
label data reserv mb size
sequenc reserv seq index clear sequenc

clsinfo read
idx2cl read

m total sentenc sofar
total sampl

reset

parser pars reset restart corpu begin


elem type
size batch lu sequenc reader elem type find next sentenc size num read

think test whether sentenc seri minibatch then pick sentenc
m to process size m process size

all done
m to process size

size m to process
m process

all done



all done

m last po in sentenc reset bptt offset
m to process clear mean need sentenc start
reset sentenc
m sentenc end
m sentenc begin



m to process size m process size

think continu stretch sentenc m to process
size nbr to process m to process size
m sentenc begin at resiz nbr to process start fall within current stretch
m sentenc end at resiz nbr to process
m sentenc length clear
m max sentenc length

size nbr to process

size m to process
size parser m sentenc index2 sentenc info s len
m sentenc length push back
m max sentenc length m max sentenc length

m to process size


m max sentenc length

think need start batch sentenc
parser m sentenc index2 sentenc info size corpu


form m to process minibatch
vector size valu m sentenc length first form later move
size i number num read m process size
previou ln
size m last process sentenc id inbr reader m process size inbr reader i number

m process


m equal length output

m process m to process size m request num parallel sequenc

parser m sentenc index2 sentenc info s len
previou ln previou ln

push back
m to process push back
m max sentenc length m max sentenc length
previou ln
m last process sentenc id updat index retriev
previou ln



m to process size m request num parallel sequenc

inbr reader



m process m to process size m request num parallel sequenc

size parser m sentenc index2 sentenc info s len
push back
m to process push back
m max sentenc length m max sentenc length


m to process size m request num parallel sequenc

inbr reader



size nbr to process m to process size
m sentenc begin at resiz nbr to process
m sentenc end at resiz nbr to process

m sentenc length

m to process size


fetch minibatch
return result label id data featur word context
elem type
batch lu sequenc reader elem type ensur data avail size mb start sampl

variabl fill
label id data clear
featur word context clear

label
label info feat in label info label info in
label info label in label info label info out

mani alreadi read
vector sequenc posit seq po

m total sentenc sofar epoch size

p mb layout init




size nbr sentenc read find next sentenc m request num parallel sequenc
m allow mult pass data nbr sentenc read m total sentenc sofar total sampl epoch size

restart
m process assign m process size
m last process sentenc id
nbr sentenc read find next sentenc m request num parallel sequenc


nbr sentenc read

reset

m num read parser pars cach block size label temp featur temp seq po feat in word4idx label in word4idx m allow mult pass data
m num read

fprintf stderr ensur data avail
p mb layout init


m process assign m num read

ifndef debug reader
m random

seed seed
shuffl parser m sentenc index2 sentenc info parser m sentenc index2 sentenc info random engin seed
seed



read next sampl line m num read
nbr sentenc read find next sentenc m request num parallel sequenc
nbr sentenc read

p mb layout init




m total sentenc sofar ulong nbr sentenc read

m last po in sentenc
runtim error lu sequenc reader support begin sentenc zero
m sentenc begin at size m to process size
runtim error lu sequenc reader need prealloc m sentenc begin
m sentenc end at size m to process size
runtim error lu sequenc reader need prealloc m sentenc end
m max sentenc length mb size
runtim error lu sequenc reader minibatch size need larg enough accomod longest sentenc

reset sentenc indic input neg
m sentenc end at assign m sentenc end at size input

minibatch
vector label id type index
vector vector label id type tmp cxt


p mb layout init m to process size m max sentenc length
m last po in sentenc
logic error lu batch sequenc reader current m last po in sentenc support
m last po in sentenc m max sentenc length time step


m to process size parallel sequenc

size m to process utter index
size seq len parser m sentenc index2 sentenc info s len

first token sequenc

m sentenc begin at
m ignor sentenc begin tag ignor sentenc use decod network reader carri activ encod network
logic error batch lu sequenc reader ignoresentencebegintag option disabl support latest architectur chang

creat sequenc entri mb layout
p mb layout add sequenc seq len
behind
seq len m max sentenc length
p mb layout add gap seq len m max sentenc length


seq len last token sequenc

m sentenc end at


seq len valid token

size label parser m sentenc index2 sentenc info s begin
tmp cxt clear

word context index offset context trigram would
word context size

feat in label categori

index clear
ilabel label word context index collat word token offset word context
ilabel parser m sentenc index2 sentenc info s begin access outsid sentenc clamp

get id from label featur temp parser m sentenc index2 sentenc info s begin index

ilabel parser m sentenc index2 sentenc info s end

get id from label featur temp parser m sentenc index2 sentenc info s end index

regular access

get id from label featur temp ilabel index

tmp cxt push back index



runtim error input label expect categori label



featur word context push back tmp cxt

output label
label id type label temp label
label id data push back

total sampl

seq len token sequenc no input

push
index assign label id type nulllabel word consist word nulllabel
tmp cxt assign word context size index context contain word
featur word context push back tmp cxt

label id data push back label id type nulllabel

p mb layout minibatch pack flag no input




m last po in sentenc m max sentenc length





elem type
size batch lu sequenc reader elem type get num parallel sequenc


p mb layout get num parallel sequenc use valid anyway

size m sentenc begin at size m request num parallel sequenc initi m sentenc begin at size
m sentenc begin at size
m sentenc begin at assign
m sentenc end at size
m sentenc end at assign




elem type
batch lu sequenc reader elem type set num parallel sequenc size

m request num parallel sequenc


elem type
batch lu sequenc reader elem type tri get minibatch stream minibatch input matric

call start minibatch loop first
todo allow termin
mb size

fprintf stderr get mini batch mb size



more data ensur data avail mb start sampl
more data


actual size size seqenc
size actualmbs

figur size sequenc
actualmbs label id data size actual column output
actualmbs mb size m to process size todo logic error
runtim error specifi minibatch size smaller actual minibatch size mb size actualmbs

label
label info feat info label info label info in

actualmbs

matric find featur name matric
runtim error batch lu sequenc reader cannot find featur name
matrix elem type featur matric get input matrix elem type featur name

sampl creat represent multi condit todo condit
matrix elem type loc ob cpudevic
featur get matrix type dens
loc ob switch to matrix type dens featur get format

loc ob switch to matrix type spars matrix format spars csc

loc ob resiz feat info word context size actualmbs
loc ob set valu

featur word context size actualmbs
size actualmbs matrix column

size m sentenc end at size parallel sequenc index
size m sentenc end at size time step

vector featur goe matrix column
each column feat info word context size tensor column word context
word context size featur word context size
size featur word context size tupl sampl

support context depend input sinc word vector word place differ slot
size featur word context size

each tupl contain sever word encod multi
thi support word sinc word place slot
size featur word context word index sampl

consist check
m sentenc end at feat info

label id type nulllabel todo condit
p mb layout is gap verifi mark no input
logic error batch lu sequenc reader tri get minibatch observ larger dimens label sign use indic observ label possibl reason ensur data avail



p mb layout is gap verifi mark no input
logic error batch lu sequenc reader tri get minibatch inconsist no input flag

loc ob set valu feat info elem type




loc ob set prefer devic id featur get devic id need otherwis set valu inherit cpudevic target
note thi effici first move loc ob copi what correct
featur set valu loc ob

fill label matrix
get label output matric label info label info out actualmbs

sequenc
seq index



fprintf stderr actual minibatch size zero



read record
actualmbs


elem type
size batch lu sequenc reader elem type get label output stream minibatch input matric label info label info size actualmbs

matric ha input label name label info out


matrix elem type label matric get input matrix elem type label name label info out
label resiz label info actualmbs
label set valu

build side
deviceid type devic id label get devic id
label transfer from devic to devic devic id cpudevic

size nbr labl
size actualmbs column minibatch matrix

size m sentenc begin at size
size m sentenc begin at size

m sentenc end at


label id data

plain label
class label includ index rang word belong word within consecut
label info reader mode reader mode plain
label set valu
label info reader mode reader mode class label info m nbr class

label set valu elem type

clsidx
clsidx label info idx4class

label set valu elem type clsidx
save begin end indx
elem type label info class info local clsidx
elem type label info class info local clsidx

logic error lu sequenc reader right equal smaller left wrong
label set valu begin index
label set valu index


logic error lu sequenc reader reader mode plain set class
nbr labl


move back
label transfer from devic to devic cpudevic devic id

nbr labl


elem type
batch lu sequenc reader elem type copi mb layout to mb layout ptr p mb layout

p mb layout copi from p mb layout


elem type
batch lu sequenc reader elem type set sentenc end actual mb size

label
label info label in label info label info in
label id type index get id from label label in end sequenc label in

actual mb size

index
m sentenc end

m sentenc end



thi seem unus
elem type
batch lu sequenc reader elem type set sentenc begin actual mb size

label
label info label in label info label info in
label id type index get id from label label in begin sequenc label in



index
m sentenc begin

m sentenc begin



elem type
batch lu sequenc reader elem type data end

m sentenc end at size m to process size
logic error data end sentenc end vector size toprocess vector size m sentenc end at size m to process size
size m to process size

m sentenc end at input
logic error batch lu sequenc reader minibatch larg enough accomod longest sentenc
size m to process
m process




elem type
batch lu sequenc reader elem type can read for wstring node name todo wstring

featur name node name

label name label info in node name

label name label info out node name





column slice correspond frame observ
elem type
batch lu sequenc reader elem type get frame stream minibatch input matric size tidx vector size histori


call start minibatch loop first
mb size


label info label in label info label info in

label info label info in ispropos

label info feat info label info label info in

sampl
matrix elem type featur matric get input matrix elem type featur name
matrix elem type loc ob cpudevic
loc ob switch to matrix type spars matrix format spars csc

matric find featur name matric

runtim error lu sequenc reader cannot find featur name

loc ob resiz feat info word context size m request num parallel sequenc
loc ob set valu

m request num parallel sequenc current support utter time

size hlength histori size
next propos
hlength

label id type index

index get id from label label info label info in begin sequenc label in

next propos index
histori push back next propos


size m request num parallel sequenc

size word context size

word context

word context organ descend order
word context size word context

size hidx
size hlength histori size
hlength
hidx histori hlength

hidx histori

matric find featur name matric

loc ob set valu hidx feat info elem type




featur set valu loc ob



m matric m matric

m matric first get num col tidx
matric find first matric
matric get input matrix elem type first set valu m matric first column slice tidx m request num parallel sequenc



read record process



propos label vector size larger reader allow propos
otherwis vector length zero
elem type
batch lu sequenc reader elem type init propos stream minibatch input p mat

label info label info in ispropos

need save info label info in sinc m propos
p mat find label name label info out p mat
m matric label name label info out set valu p mat get input matrix elem type label name label info out



p mat find featur name p mat
m matric featur name set valu p mat get input matrix elem type featur name



elem type
config record type
batch lu sequenc reader elem type load word map config record type reader config

m word map fn wstring reader config wordmap
wstring
wstring
vector wstring
m word map fn

wifstream
ifdef win32
open m word map fn wifstream

open wtocharpath m word map fn wifstream


good

getlin
trim
length

split string


m word map

close

m unk str wstring reader config


batch lu sequenc reader
batch lu sequenc reader

elem type
multi io batch lu sequenc reader elem type tri get minibatch stream minibatch input matric

first iter need check request matric avail
wstring size iter iter
m check dictionari key

iter matric iter matric iter todo rang base

b found
wstring batch lu sequenc reader elem type iter m reader m reader todo rang base

second can read for iter first

name to reader iter first second
b found




b found
runtim error get minibatch cannot find node feed featur iter first

m check dictionari key


random seed
wstring batch lu sequenc reader elem type iter m reader m reader

second set random seed seed

seed

reader
wstring batch lu sequenc reader elem type iter m reader m reader

second get minibatch matric






random seed
elem type
multi io batch lu sequenc reader elem type set random seed

seed
wstring batch lu sequenc reader elem type iter m reader m reader

second set random seed seed



elem type
config record type
multi io batch lu sequenc reader elem type init from config config record type reader config

vector wstring io name reader config io node name config record type array stringargvector
io name size

newer code explicitli place multipl stream input
index io name input name node name

config record type thi io reader config io name

batch lu sequenc reader elem type thi reader batch lu sequenc reader elem type
thi reader init thi io

pair wstring batch lu sequenc reader elem type io name thi reader

m reader insert




older code assum stream featur
batch lu sequenc reader elem type thi reader batch lu sequenc reader elem type

thi reader init reader config

pair wstring batch lu sequenc reader elem type msra strfun wstrprintf stream m reader size thi reader

m reader insert



elem type
multi io batch lu sequenc reader elem type start minibatch loop size mb size size epoch size request epoch sampl

reader
wstring batch lu sequenc reader elem type iter m reader m reader

second start minibatch loop mb size epoch request epoch sampl



elem type
multi io batch lu sequenc reader elem type copi mb layout to mb layout ptr p mb layout

reader
vector size
size row col
m reader

second copi mb layout to p mb layout
row
row p mb layout get num parallel sequenc
row p mb layout get num parallel sequenc
logic error multipl stream sequenc reader must row sentenc begin
size p mb layout get num time step
push back
col



elem type
size multi io batch lu sequenc reader elem type get num parallel sequenc

m reader second get num parallel sequenc



elem type
multi io batch lu sequenc reader elem type get sentenc end id from output label

m reader size
logic error get sentenc end id from output label support reader multi io batch lu sequenc reader
iret

wstring batch lu sequenc reader elem type iter m reader m reader

iret second get sentenc end id from output label

iret



elem type
multi io batch lu sequenc reader elem type data end


iter m reader
iter second data end
break
make sens follow exampl hope correct
break



histori share
elem type
multi io batch lu sequenc reader elem type get propos ob stream minibatch input matric size tidx vector size histori

reader
wstring batch lu sequenc reader elem type iter m reader m reader

second get frame matric tidx histori







need provid initi matric valu
valu get minibatch
elem type
multi io batch lu sequenc reader elem type init propos stream minibatch input matric

reader
iter m reader
iter second init propos matric


multi io batch lu sequenc reader
multi io batch lu sequenc reader

stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
defin datawrit export
lu sequenc reader
lu sequenc writer

ifdef
codecvt


microsoft cntk

enabl utf8 support

todo codecvt support latest
remov ifdef move
ifdef
local local local codecvt utf8 wchar



local local



fprintf stderr warn avail revert user prefer local
local local





dataread get reader f i data reader preader

enabl utf8 support
preader multi io batch lu sequenc reader

dataread get reader d i data reader preader

enabl utf8 support
preader multi io batch lu sequenc reader


datawrit get writer f i data writer pwriter

pwriter lu sequenc writer

datawrit get writer d i data writer pwriter

pwriter lu sequenc writer




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
ifdef win32
objbas

basic
fstream
algorithm

defin datawrit export creat export
data writer
lu sequenc writer
config
ifdef leakdetect
memori leak detect


microsoft cntk

creat data writer

comparison sensit
elem type
lu sequenc writer elem type compar elem type first elem type second

first second


elem type
config record type
lu sequenc writer elem type init from config config record type writer config

udim clear

vector wstring output name writer config output node name config record type array stringargvector
output name size
runtim error writer need least output node name specifi config

index output name input name node name

config record type thi output writer config output name
output file output name wstring thi output file
thi output nbest
n best output name
wstring fname thi output token
read label info fname word4idx output name idx4word output name
size idx4word output name size
udim push back



elem type
lu sequenc writer elem type read label info wstring vocfil
word4idx
idx4word

stmp string


file fopen or die vocfil

nullptr

runtim error cannot open word file vocfil


feof

fscanf stmp countof stmp
word4idx stmp
idx4word stmp

fclose


elem type
lu sequenc writer elem type destroy

output file id output file id

fclose second



elem type
lu sequenc writer elem type save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size


iter matric iter matric iter

wstring output name iter first
matrix elem type output data cast matrix elem type iter second
wstring out file output file output name

save out file output data idx4word output name n best output name





elem type
lu sequenc writer elem type save wstring output file matrix elem type output data idx2wrd nbest

size output data get num col
size idx2wrd size output data get num row
file nullptr
vector pair size elem type

nbest compar pair size elem type pair size elem type

second second


output file id find output file output file id

file
msra file make intermedi dir output file
output file output file
fopen
nullptr
runtim error cannot open write
output file id output file



output file id output file



imax
elem type fmax output data imax
clear
nbest
push back pair size elem type fmax


nbest
push back pair size elem type output data
output data fmax

fmax output data
imax


nbest
sort nbest compar
nbest

nbest

second

first
s re idx2wrd find second
fprintf s re




s re idx2wrd find imax second
fprintf s re
fprintf stderr s re



fprintf
fprintf stderr


lu sequenc writer
lu sequenc writer


copyright microsoft right reserv
licens licens licens file project root full licens inform

lu sequenc parser pars format custom state machin speed


stdafx
lu sequenc parser
stdexcept
fileutil

microsoft cntk

lu sequenc parser
num type label type
lu sequenc parser num type label type lu sequenc parser

init


setup state variabl state tabl state machin
num type label type
lu sequenc parser num type label type init

p file


parser destructor
num type label type
lu sequenc parser num type label type lu sequenc parser

p file
fclose p file


instanti parser support type
lu sequenc parser
lu sequenc parser
lu sequenc parser
lu sequenc parser wstring
lu sequenc parser
lu sequenc parser
lu sequenc parser
lu sequenc parser wstring

num type label type
batch lu sequenc parser num type label type pars size record request vector label vector vector input vector sequenc posit seq po wstring inputlabel2id wstring outputlabel2id can multipl pass data

fprintf stderr batch lu sequenc parser pars input

transfer member variabl
input input
label label

record count
org record count label size
line count
token count
b at eo whether reader sentenc posit
sequenc posit sequenc posit last

wstring
line count record request m file good

getlin m file
trim todo oper place need assign back

m file

can multipl pass data

pars reset restart corpu begin






vector wstring vstr
b blank line length
b blank line b at eo input size label size

add one item label input seq po line count record count org record count sequenc posit last
b at eo



token
token count

vstr split string
vstr size


b at eo
vector vtmp
size vstr size

inputlabel2id find vstr inputlabel2id

inputlabel2id find m unk str inputlabel2id

logic error cannot find item input label vstr m unk str

vtmp push back inputlabel2id find m unk str second


vtmp push back inputlabel2id find vstr second

outputlabel2id find vstr vstr size outputlabel2id

outputlabel2id find m unk str outputlabel2id
logic error cannot find item output label vstr vstr size m unk str
label push back outputlabel2id find m unk str second


label push back outputlabel2id find vstr vstr size second
input push back vtmp
vstr vstr size end sequenc out
backward support
vstr end tag
input size label size

add one item label input seq po line count record count org record count sequenc posit last
b at eo




sequenc posit last input po input size
add one item label input seq po line count record count org record count sequenc posit last

prvat
size
seq po seq po

size label po prvat
sentenc info stinfo
stinfo s len
stinfo s begin prvat
stinfo s end label po
m sentenc index2 sentenc info push back stinfo

prvat label po


fprintf stderr batch lu sequenc parser pars line total token line count token count line count exclud line count
line count


batch lu sequenc parser
batch lu sequenc parser
batch lu sequenc parser wstring
batch lu sequenc parser wstring


copyright microsoft right reserv
licens licens licens file project root full licens inform

data writer defin export function applic

todo unifi share data writer


stdafx
basic

defin datawrit export
data writer
lu sequenc writer

microsoft cntk

config record type
data writer init from config config record type writer config

wstring precis writer config precis
precis
data writer lu sequenc writer
precis
data writer lu sequenc writer

invalid argument data writer lu sequenc writer precis paramet must

data writer init writer config


destroy cleanup remov
note destroy use past point
data writer destroy

data writer
todo need destroy


data writer constructor
config configur writer
config record type
data writer data writer config record type config

init config


destructor cleanup temp file
data writer data writer

destroy


get section section file
section section name section data sepcif config file use determin save
data writer get section wstring section type nocas compar section

data writer get section section


save data save file file
record start start record
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
data writer save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

data writer save data record start matric num record dataset size byte variabl size


save map save file
save id name section save section subsect format
label map save file
data writer save map wstring save id label id type label type label map

data writer save map save id label map




copyright microsoft right reserv
licens licens licens file project root full licens inform

htkmlf reader defin export function applic


stdafx
basic
basetyp

htkfeatio read featur

rollingwindowsourc minibatch sourc
utterancesourcemulti
ifdef win32
readaheadsourc

chunkevalsourc
minibatchiter
defin dataread export creat export
data reader
htkmlf reader
config
ifdef leakdetect
memori leak detect


ifdef unix
limit
dword
word
unint32

pragma warn disabl 4127 condit express constant elem type trigger

iostream

msra numa node numahelp

microsoft cntk

elem type
config record type
htkmlf reader elem type init from config config record type reader config

mbiter
frame sourc
lattic
seq train deriv
utt deriv buffer
minibatch buffer resiz
minibatch buffer index
no data
convert label to target
do seq train
get minibatch copi
do minibatch buffer
do minibatch buffer truncat

reader config exist legaci mode

runtim error legaci mode deprec


framemod away utter longer
specifi max utter length
max utter length reader config max utter length 10000

truncat
truncat utter minibatch size otherwis
actual minibatch size length utter
number ofutt per minibatch
larger minibatch contain multipl
utter
truncat reader config truncat
number ofutt per minibatch reader config nbruttsineachrecurrentit
number ofutt per minibatch

logic error nbr utt in each recurr iter cannot less


initi variabl relat multi utter
actualnumb ofutt per minibatch number ofutt per minibatch
sentenc end assign number ofutt per minibatch
process frame assign number ofutt per minibatch
to process assign number ofutt per minibatch
switch frame assign number ofutt per minibatch
current buffer frame assign number ofutt per minibatch
utt info resiz number ofutt per minibatch

check need sequenc train
reader config exist seq train criterion

do seq train
seq train criterion wstring reader config seq train criterion
seq train criterion mpfe seq train criterion smbr

logic error current support sequenc train criterion mpfe smbr



check framemod sequenc train
framemod reader config frame mode
framemod do seq train

logic error frame mode sequenc train


check partial minibatch allow
minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

figur minibatch buffer
do seq train

do minibatch buffer
truncat

truncat
do minibatch buffer truncat



check write mode train test mode
wstring command reader config action
command write

train or test
prepar for write reader config



train or test
prepar for train or test reader config



elem type
config record type
htkmlf reader elem type prepar for sequenc train config record type reader config

paramet look
wstring denlat rspecifi ali rspecifi tran model filenam silenc phone str
elem type old acoust scale
elem type acoust scale
elem type lm scale
one silenc class

make sure denlat align section exist
reader config exist denlat

logic error sequenc train request denlat section provid

reader config exist align

logic error sequenc train request align section provid


process denlat section
config record type denlat config reader config denlat
denlat config exist

logic error rspecifi provid denomin lattic

denlat config exist kaldi model

logic error rspecifi provid kaldi model

denlat rspecifi wstring denlat config
tran model filenam wstring denlat config kaldi model
silenc phone str wstring denlat config sil phone list
old acoust scale denlat config old acoust scale
acoust scale denlat config acoust scale
lm scale denlat config lm scale
one silenc class denlat config one silenc class

process align section
config record type ali config reader config align
ali config exist

logic error rspecifi provid align

ali rspecifi wstring ali config

scan configur reader deriv input
reader obj input both featur node feed deriv
train criterion node reader deriv feed object
reader obj
ha drive ha obj
iter reader config iter reader config iter
reader config get member id

config record type temp reader config
temp exist current

wstring temp
equal ci reader deriv equal ci seq train deriv back compat

name to type map input output type reader deriv
ha drive

equal ci reader obj equal ci seq train obj back compat

name to type map input output type reader obj
ha obj



ha drive ha obj

logic error miss reader deriv reader obj featur


initi sequenc train
seq train deriv kaldi sequenc train deriv elem type
denlat rspecifi ali rspecifi tran model filenam
silenc phone str seq train criterion old acoust scale
acoust scale lm scale one silenc class

initi deriv buffer
do minibatch buffer
utt deriv buffer

logic error deriv buffer alreadi
sequenc metric deriv
buffer

utt deriv buffer utter deriv buffer elem type
number ofutt per minibatch seq train deriv


load input output train test below
categori differ input output
featur input output type real
label input output type categori
deriv input output type reader deriv
object input output type reader obj

note treat deriv object featur
comput reader rather read disk those
train criterion node train purpos
elem type
config record type
htkmlf reader elem type prepar for train or test config record type reader config

load file sequenc train
do seq train

prepar for sequenc train reader config


variabl relat multi utter
featur buffer multi utt
hold pointer trunk utter
featur buffer alloc multi utt
actual store
featur buffer multi utt assign number ofutt per minibatch
featur buffer alloc multi utt assign number ofutt per minibatch
label buffer multi utt assign number ofutt per minibatch
label buffer alloc multi utt assign number ofutt per minibatch

get featur label note assum featur
section field scp file label section field
mlf file
vector wstring featur name
vector wstring label name
get data name from config reader config featur name label name
featur name size label name size

runtim error network need least input output specifi


load featur file
size i feat
vector size num context left
vector size num context right
vector msra featur section scriptpath train or test featur section
index featur name

config record type thi featur reader config featur name
feat dim push back thi featur
intargvector context window thi featur context window config record type array intargvector vector
context window size symmetr

size window frame context window
window frame
runtim error augmentationext neighbor expans input featur symmetr window frame
size context window frame extend side
num context left push back context
num context right push back context

context window size left context right context

num context left push back context window
num context right push back context window



runtim error context frame must valu specifi found context window size


figur actual featur dimens context
feat dim feat dim num context left num context right

figur categori
wstring thi featur real
equal ci real

name to type map featur name input output type real



invalid argument featur must real

featur name to id map featur name i feat
i feat featur id to name map size
featur id to name map push back featur name
scriptpath push back msra featur section thi featur scp file thi featur thi featur featur transform
featur name to dim map featur name feat dim

featur buffer multi io push back
featur buffer alloc multi io push back

i feat


load label file
size i label
vector wstring statelistpath
vector wstring mlfpath
vector vector wstring mlfpathsmulti
index label name

config record type thi label reader config label name

figur label dimens
thi label exist label dim
label dim push back thi label label dim
thi label exist
label dim push back thi label

invalid argument label must specifi label dim

figur categori
wstring
thi label exist label type
wstring thi label label type deprec eventu

wstring thi label categori output categori
equal ci categori
name to type map label name input output type categori

invalid argument label must categori

load label map
statelistpath push back thi label label map file

label name to id map label name i label
i label label id to name map size
label id to name map push back label name
label name to dim map label name label dim
mlfpath clear
mlfpath push back thi label mlf file
mlfpathsmulti push back mlfpath

label buffer multi io push back
label buffer alloc multi io push back

i label

figur label target map
wstring label to target map file thi label label to target map file
label to target map file

vector vector elem type label to target map
convert label to target multi io push back
thi label exist target dim

label name to dim map label name label dim thi label target dim


runtim error output must specifi target dim label to target map file specifi
size target dim read label to target map file label to target map file statelistpath label to target map
target dim label dim
runtim error mismatch target dim found label to target map file
label to target map multi io push back label to target map



convert label to target multi io push back
label to target map multi io push back vector vector elem type



saniti check
i feat scriptpath size i label mlfpathsmulti size
runtim error msra strfun strprintf input file input output file output inconsist

load random method
size random random auto
reader config exist random

random string reader config random
equal ci random string none

random random none

equal ci random string

random random auto



random reader config random



open script file featur
size num file
size firstfilesonli size lower valu test
vector wstring filelist
vector vector wstring infilesmulti
index scriptpath

filelist clear
wstring scriptpath scriptpath scp file
fprintf stderr read script file scriptpath
size
msra file textread reader scriptpath reader filelist size firstfilesonli optim

filelist push back reader wgetlin



fprintf stderr entri


num file
num file
runtim error msra strfun strprintf file scriptfil inconsist num file

infilesmulti push back filelist


open file label
wstring restrictmlftokey
htktimetofram 100000 10m
vector wstring vector msra htkmlfentri labelsmulti
target delay
reader config exist target delay

target delay reader config target delay

index mlfpathsmulti

msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ
label mlfpathsmulti restrictmlftokey statelistpath htktimetofram target delay label
temp file name page file
labelsmulti push back label


read method valu block random
option roll window support block random
sequenc train
read method reader config read method block random
equal ci read method block random

construct paramet need need pass
pair vector wstring vector wstring latticetoc
unord size modelsymmap

note actual lattic reason
kept requir
minibatchutterancesourcemulti
lattic msra latticesourc latticetoc modelsymmap

frame sourc thi better random creat temp file
frame sourc msra minibatchutterancesourcemulti
scriptpath infilesmulti labelsmulti feat dim label dim
num context left num context right random lattic lattic map framemod

equal ci read method roll window

roll window support sequenc train
do seq train

logic error roll window support sequenc train

wstring page file path
vector wstring page path
reader config exist page file path

page file path wstring reader config page file path

replac compat path
replac page file path page file path
ifdef win32
verifi path exist
dword attrib get file attribut page file path
attrib invalid file attribut attrib file attribut directori
runtim error page file path exist

ifdef unix
stat statbuf
stat wtocharpath page file path statbuf

runtim error page file path exist




temporari path

ifdef win32
page file path reserv path
get temp path path page file path

ifdef unix
page file path reserv path
page file path temp cntk xxxxxx



ifdef win32
page file path size path length input get temp file name path
runtim error msra strfun strprintf page file path must less charact path

ifdef unix
page file path size path length input get temp file name path
runtim error msra strfun strprintf page file path must less charact path

index infilesmulti

ifdef win32
wchar temp file path
get temp file name page file path cntk temp file
page path push back temp file

ifdef unix
temp file
get temp file name page file path cntk temp file
temp file page file path
mkstemp temp file
unlink temp file
close
page path push back get wc temp file



mayhavenofram
add energi

frame sourc multi io msra minibatchframesourcemulti infilesmulti labelsmulti feat dim label dim random pagepath mayhavenofram add energi
frame sourc multi io setverbos verbos
verbos reader config verbos
frame sourc msra minibatchframesourcemulti scriptpath infilesmulti labelsmulti feat dim label dim num context left num context right random page path mayhavenofram add energi
frame sourc setverbos verbos



runtim error read method must roll window block random



load input output train test below
categori differ input output
featur input output type real
label input output type categori
elem type
config record type
htkmlf reader elem type prepar for write config record type reader config

get featur label note assum featur
section name prefix featur label section name
prefix label
vector wstring featur name
vector wstring label name
get data name from config reader config featur name label name

load featur file
size i feat
vector size num context left
vector size num context right
vector size real dim
vector msra featur section scriptpath write featur section
index featur name

config paramet thi featur reader config featur name

figur context
config array context window thi featur context window
context window size symmetr

size window frame context window
window frame
runtim error augmentationext neighbor expans input featur symmetr window frame
size context window frame extend side
num context left push back context
num context right push back context

context window size left context right context

num context left push back context window
num context right push back context window



runtim error context frame must valu specifi found context window size


figur featur dimens context
real dim push back thi featur
real dim real dim num context left num context right

figur categori
thi featur real
real

name to type map featur name input output type real



runtim error featur must real


featur name to id map featur name i feat
i feat featur id to name map size
featur id to name map push back featur name
scriptpath push back msra featur section thi featur scp file thi featur thi featur featur transform
featur name to dim map featur name real dim

featur buffer multi io push back
featur buffer alloc multi io push back
i feat


write label support
label name size
runtim error writer mode support label input featur

open script file correspond featur
size num file
vector wstring filelist
size firstfilesonli size lower valu test
size evalchunks 2048
index scriptpath

filelist clear
wstring scriptpath scriptpath scp file
fprintf stderr read script file scriptpath
size
msra file textread reader scriptpath reader filelist size firstfilesonli optim

filelist push back reader wgetlin



fprintf stderr entri


num file
num file
runtim error msra strfun strprintf htkmlf reader init eval reader file scriptfil inconsist num file

input file multi io push back filelist


file eval sourc msra file eval sourc real dim num context left num context right evalchunks


destructor get call properli
elem type
htkmlf reader elem type htkmlf reader

mbiter
frame sourc
lattic
seq train deriv
utt deriv buffer

index featur buffer multi io
featur buffer multi io

index label buffer multi io
label buffer multi io

size number ofutt per minibatch

featur buffer multi utt
label buffer multi utt


index train or test featur section
train or test featur section

index write featur section
write featur section


start minibatch loop startup minibatch
mb size size minibatch frame
epoch epoch
request epoch sampl sampl random default request data size use sampl dataset
elem type
htkmlf reader elem type start minibatch loop size mb size size epoch size request epoch sampl

mb size mb size
current mb size mb size

train or test

start minibatch loop to train or test mb size epoch request epoch sampl



start minibatch loop to write mb size epoch request epoch sampl

check dictionari key


elem type
htkmlf reader elem type start minibatch loop to train or test size mb size size epoch size request epoch sampl

size datapass
size total frame frame sourc totalfram
size extra frame total frame mb size
size minibatch total frame mb size

partial minibatch allow modifi total frame
request epoch sampl
partial minibatch

total frame mb size

total frame extra frame


request epoch sampl request data size

request epoch sampl total frame

minibatch full minibatch

sinc skip extra frame need total actual frame request
size sweep request epoch sampl total frame want sweep skip extra subtract divid
request epoch sampl extra frame sweep


request epoch sampl request data size

request epoch sampl total frame


get minibatch iter
mbiter

mbiter
mbiter

msra minibatchsourc sourc frame sourc
size current mb size framemod mb size
mbiter msra minibatchiter sourc epoch request epoch sampl current mb size datapass

reset utter deriv buffer
do minibatch buffer

utt deriv buffer
utt deriv buffer reset epoch


clear minibatch buffer
minibatch buffer clear
get minibatch copi
minibatch buffer index
utt info clear
minibatch utt info clear

clear featur label buffer
featur buffer multi io

index featur buffer multi io

featur buffer multi io

featur buffer multi io
featur buffer multi io
featur buffer alloc multi io



label buffer multi io

index label buffer multi io

label buffer multi io

label buffer multi io
label buffer multi io
label buffer alloc multi io



no data
featur start index multi utt assign featur buffer multi io size number ofutt per minibatch
label start index multi utt assign label buffer multi io size number ofutt per minibatch
size number ofutt per minibatch

featur buffer multi utt

featur buffer multi utt
featur buffer multi utt
featur buffer alloc multi utt

label buffer multi utt

label buffer multi utt
label buffer multi utt
label buffer alloc multi utt

re new buffer for multi io



elem type
htkmlf reader elem type start minibatch loop to write size mb size size epoch size request epoch sampl

file eval sourc reset
file eval sourc set minibatch size mb size
chunk eval sourc multi io reset
input file index

index featur buffer multi io

featur buffer multi io

featur buffer multi io
featur buffer multi io
featur buffer alloc multi io




get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
htkmlf reader elem type tri get minibatch stream minibatch input matric

train or test

get minibatch to train or test matric



get minibatch to write matric



notat utter littl tricki
frame mode trunk read
minibatch iter
frame mode real utter read
minibatch iter
note start frame end frame left close right open exampl
start frame end frame copi frame
elem type
htkmlf reader elem type popul utter in minibatch
stream minibatch input matric
size utt index size start frame
size end frame size mb size size mb offset

success

saniti check
start frame end frame



end frame start frame mb size




size num of fea featur buffer multi io size
size num of label label buffer multi io size
iter matric iter matric iter

name to type map iter first input output type real

featur
size featur name to id map iter first
size featur name to dim map iter first

featur buffer multi io

featur buffer multi io elem type mb size number ofutt per minibatch
featur buffer alloc multi io mb size number ofutt per minibatch

featur buffer alloc multi io mb size number ofutt per minibatch

buffer small increas
featur buffer multi io
featur buffer multi io elem type mb size number ofutt per minibatch
featur buffer alloc multi io mb size number ofutt per minibatch


elem type

copi entir column
size start frame end frame

memcpi featur buffer multi io mb offset number ofutt per minibatch utt index
elem type
featur buffer multi utt utt index featur start index multi utt utt index num of fea
elem type




copi element element
size start frame end frame



featur buffer multi io mb offset number ofutt per minibatch utt index
featur buffer multi utt utt index featur start index multi utt utt index num of fea




name to type map iter first input output type categori

label
size label name to id map iter first
size label name to dim map iter first

label buffer multi io

label buffer multi io elem type mb size number ofutt per minibatch
label buffer alloc multi io mb size number ofutt per minibatch

label buffer alloc multi io mb size number ofutt per minibatch

label buffer multi io
label buffer multi io elem type mb size number ofutt per minibatch
label buffer alloc multi io mb size number ofutt per minibatch


size start frame end frame



label buffer multi io mb offset number ofutt per minibatch utt index
label buffer multi utt utt index label start index multi utt utt index num of label




success


elem type
htkmlf reader elem type get one minibatch to train or test data buffer
stream minibatch input matric

skip

first minibatch check input given name
check dictionari key

iter matric iter matric iter

name to type map find iter first name to type map

runtim error msra strfun strprintf
minibatch request input node found
reader cannot gener input
iter first


check dictionari key


utter deriv buffer need keep
utter inform
do minibatch buffer

minibatch utt info assign number ofutt per minibatch
vector pair wstring size

moment support utter
minibatch
ha utt in current minibatch clear
size number ofutt per minibatch

ha utt in current minibatch find utt info first ha utt in current minibatch

fprintf stderr warn utter alreadi exist
minibatch skip
utt info first
re new buffer for multi io

utt info size

ha utt in current minibatch utt info first




current mb size mb size


check finish utter
no data

end epoch
size number ofutt per minibatch

process frame to process

end epoch


end epoch





truncat current mb size mb size
truncat current mb size equal longest
utter minibatch
truncat

current mb size
size number ofutt per minibatch

current buffer frame current mb size

current mb size current buffer frame




initi sentenc boundari inform process
utter
framemod

number ofutt per minibatch
p mb layout init as frame mode current mb size



p mb layout init number ofutt per minibatch current mb size

size number ofutt per minibatch

size current mb size

p mb layout set without or minibatch pack flag



iter utter number ofutt per minibatch
special
size number ofutt per minibatch

size start frame process frame
size end frame
set utter boundari
framemod

to process start frame

p mb layout add sequenc sequenc ptrdiff start frame to process start frame


p mb layout minibatch pack flag sequenc start

start frame current mb size to process

there
framemod truncat
framemod
truncat

end frame start frame current mb size
popul succ popul utter in minibatch matric start frame end frame current mb size
do minibatch buffer popul succ

minibatch utt info push back utt info
ha utt in current minibatch utt info first

process frame current mb size

start frame current mb size to process

there case
framemod truncat
reach utter
framemod truncat
reach utter
framemod
utter boundari

set utter boundari
framemod

start frame

p mb layout minibatch pack flag sequenc start


utter
p mb layout p mb layout get num time step minibatch pack flag sequenc end


put utter minibatch load

end frame start frame current mb size
popul succ popul utter in minibatch matric start frame end frame current mb size
do minibatch buffer popul succ

minibatch utt info push back utt info
ha utt in current minibatch utt info first

process frame current mb size
re new succ re new buffer for multi io



there case
framemod must partial
minibatch
framemod truncat
pull frame utter
framemod truncat
utter
pull utter

check reach minibatch
start frame to process

p mb layout add gap current mb size
size current mb size

p mb layout minibatch pack flag no input

popul input real featur
follow implement effici
popul utter in minibatch matric current mb size




first framemod must
partial minibatch allow
skip minibatch
framemod partial minibatch

skip
re new succ re new buffer for multi io should



second utter boundari partial
minibatch load
framemod

start frame

p mb layout minibatch pack flag sequenc start


utter
to process start frame p mb layout get num time step
p mb layout to process start frame minibatch pack flag sequenc end

end frame to process
size current mb fill end frame start frame
popul succ popul utter in minibatch matric start frame end frame current mb size
do minibatch buffer popul succ

minibatch utt info push back utt info
ha utt in current minibatch utt info first

process frame current mb fill
re new succ re new buffer for multi io

third utter current
minibatch also pack utter
re new succ current mb fill to process current mb size

set utter boundari
current mb fill to process p mb layout get num time step
p mb layout add sequenc sequenc current mb fill current mb fill to process
p mb layout current mb fill minibatch pack flag sequenc start
p mb layout current mb fill to process minibatch pack flag sequenc end
popul succ popul utter in minibatch matric to process current mb size current mb fill
do minibatch buffer popul succ

minibatch utt info push back utt info
ha utt in current minibatch utt info first

process frame
process frame to process
current mb fill to process
re new succ re new buffer for multi io


final pull frame utter current
minibatch full
re new succ framemod truncat

popul succ popul utter in minibatch matric current mb size current mb fill current mb size current mb fill
do minibatch buffer popul succ

minibatch utt info push back utt info
ha utt in current minibatch utt info first

process frame current mb size current mb fill
current mb fill current mb size

p mb layout add sequenc sequenc current mb fill current mb fill to process
p mb layout current mb fill minibatch pack flag sequenc start




p mb layout add gap current mb fill current mb size
size current mb fill current mb size

p mb layout minibatch pack flag no input

popul input real featur
follow implement effici
popul utter in minibatch matric current mb size





skip
skip




elem type
htkmlf reader elem type should copi minibatch from buffer

do minibatch buffer

get minibatch copi copi
buffer back propag
get minibatch copi minibatch buffer size

minibatch buffer index



get minibatch copi first comput
likelihood frame alreadi buffer
get minibatch copi minibatch buffer index minibatch buffer size

minibatch buffer index







elem type
htkmlf reader elem type copi minibatch to buffer

size origin mb size current mb size
size current mb size current mb size
size num minibatch
do minibatch buffer truncat

current mb size mb size
num minibatch elem type origin mb size elem type mb size
num minibatch origin mb size mb size


size num minibatch

minibatch buffer unit current minibatch

size start index current mb size
size num frame
start index current mb size origin mb size current mb size origin mb size start index

set mb layout
current minibatch p mb layout copi from rang p mb layout start index num frame
current minibatch p mb layout init p mb layout get num parallel sequenc num frame
sequenc p mb layout get all sequenc
sequenc

t end start index t begin ptrdiff start index num frame

shift seq
shift seq t begin start index
shift seq t end start index
current minibatch p mb layout add sequenc shift seq


set minibatch size current minibatch
current minibatch current mb size num frame

set utter inform current minibatch
current minibatch minibatch utt info assign
number ofutt per minibatch
vector pair wstring size
size minibatch utt info size

size utt start index
size minibatch utt info size

start index utt start index minibatch utt info second

utt start index minibatch utt info second


start index num frame utt start index



current minibatch minibatch utt info push back minibatch utt info
utt start index minibatch utt info second



size start data copi start index number ofutt per minibatch
size end data copi start index num frame number ofutt per minibatch

copi featur
current minibatch featur resiz
size featur buffer multi io size

vector elem type tmp featur
featur buffer multi io start data copi featur name to dim map featur id to name map
featur buffer multi io end data copi featur name to dim map featur id to name map
current minibatch featur push back tmp featur


copi label
current minibatch label resiz
size label buffer multi io size

vector elem type tmp label
label buffer multi io start data copi label name to dim map label id to name map
label buffer multi io end data copi label name to dim map label id to name map
current minibatch label push back tmp label


minibatch buffer push back current minibatch



elem type
htkmlf reader elem type copi minibatch from buffer to matrix
size index
stream minibatch input matric

minibatch buffer size index

restor variabl relat minibatch
p mb layout copi from minibatch buffer index p mb layout
current mb size minibatch buffer index current mb size
minibatch utt info minibatch buffer index minibatch utt info

copi matrix
iter matric iter matric iter

matrix elem type matric get input matrix elem type iter first
name to type map iter first input output type real

size featur name to id map iter first
size featur name to dim map iter first
minibatch buffer index featur size
set valu
minibatch buffer index featur size
get devic id
minibatch buffer index featur
matrix flag normal

name to type map iter first input output type categori

size label name to id map iter first
size label name to dim map iter first
minibatch buffer index label size
set valu
minibatch buffer index label size
get devic id
minibatch buffer index label
matrix flag normal

do minibatch buffer

name to type map iter first input output type reader deriv

get minibatch copi

current mb size number ofutt per minibatch p mb layout get num col
get num col p mb layout get num col

resiz get num row p mb layout get num col

matric get input matrix elem type iter first set valu



utt deriv buffer get deriv minibatch utt info
p mb layout
matric get input matrix elem type iter first todo refer instead


name to type map iter first input output type reader obj

get minibatch copi

current mb size number ofutt per minibatch p mb layout get num col
get num col p mb layout get num col

resiz p mb layout get num col

set valu



utt deriv buffer get object minibatch utt info
p mb layout
matric get input matrix elem type iter first todo refer instead





get minibatch copi

index
minibatch buffer front



elem type
htkmlf reader elem type copi minibatch to matrix
size size
vector elem type featur buffer
vector elem type label buffer
stream minibatch input matric

iter matric iter matric iter

matrix elem type matric get input matrix elem type iter first
name to type map iter first input output type real

size featur name to id map iter first
size featur name to dim map iter first
featur buffer size
set valu size get devic id featur buffer matrix flag normal

name to type map iter first input output type categori

size label name to id map iter first
size label name to dim map iter first
label buffer size
set valu size get devic id label buffer matrix flag normal

do minibatch buffer

name to type map iter first input output type reader deriv

current mb size number ofutt per minibatch p mb layout get num col
get num col p mb layout get num col

resiz get num row p mb layout get num col

set valu

name to type map iter first input output type reader obj

current mb size number ofutt per minibatch p mb layout get num col
get num col p mb layout get num col

resiz p mb layout get num col

set valu





elem type
htkmlf reader elem type get minibatch to train or test
stream minibatch input matric

either copi minibatch buffer read minibatch
iter
success
should copi minibatch from buffer

copi minibatch from buffer to matrix minibatch buffer index matric




success get one minibatch to train or test data buffer matric
success

get minibatch copi

minibatch buffer size
copi minibatch to buffer
copi minibatch from buffer to matrix matric
minibatch buffer index



copi minibatch to matrix
current mb size number ofutt per minibatch
featur buffer multi io label buffer multi io matric



copi mode cannot full minibatch
comput posterior minibatch
do minibatch buffer success get minibatch copi

utt deriv buffer set epoch end


success





elem type
htkmlf reader elem type get minibatch to write stream minibatch input matric

wstring size iter iter
check dictionari key

iter featur name to id map iter featur name to id map iter

matric find iter first matric

fprintf stderr get minibatch to write featur node specifi reader found network iter first
runtim error get minibatch to write featur node specifi reader found network



iter matric iter matric iter

featur name to id map find iter first featur name to id map
runtim error msra strfun strprintf minibatch request input node found reader cannot gener input iter first


check dictionari key


input file index input file multi io size

file eval sourc reset

load file file
index input file multi io

msra htkfeatread reader

path reader pars input file multi io input file index write featur section
read file
msra matrix feat
featkind
sampperiod
msra util attempt

reader read alloc path featkind sampperiod feat whole file read column featur vector

fprintf stderr evalu read frame feat col wstring path
file eval sourc add file feat featkind sampperiod

input file index

turn frame minibatch augment neighbor
file eval sourc creat eval minibatch

popul input matric
first
iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label

name to type map find iter first name to type map name to type map iter first input output type real

matrix elem type matric get input matrix elem type iter first featur label
size featur name to id map iter first
size featur name to dim map iter first

msra matrix feat file eval sourc chunk of frame
first

p mb layout init feat col
p mb layout add sequenc sequenc feat col
p mb layout set without or feat col minibatch pack flag sequenc end
first


copi featur
feat row
check featur dimens match expect

featur buffer multi io

featur buffer multi io elem type feat row feat col
featur buffer alloc multi io feat row feat col

featur buffer alloc multi io feat row feat col buffer size chang partial minibatch

featur buffer multi io
featur buffer multi io elem type feat row feat col
featur buffer alloc multi io feat row feat col

need sinc fill entir buffer
memset featur buffer multi io elem type feat row feat col

elem type

feat col column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi io feat row elem type feat row feat elem type feat row




feat col column major iter column outsid

feat row

featur buffer multi io feat row feat



set valu feat row feat col get devic id featur buffer multi io matrix flag normal


resiz input affect actual minibatch size
matrix elem type matric get input matrix elem type iter first
resiz get num row










elem type
htkmlf reader elem type re new buffer for multi io size

no data

current buffer frame
process frame
to process
utt info clear



size num of fea featur buffer multi io size
size num of label label buffer multi io size

number frame minibatch iter
current buffer frame mbiter currentmbfram

oper utter level utter inform
framemod

utt info mbiter getutteranceinfo
utt info size
assum utter length
larger minibatch size handl
grace later remov utter reader
utt info size

fprintf stderr warn utter length smaller
minibatch size want remov utter
reduc minibatch size


truncat current buffer frame max utter length

mbiter
mbiter

no data

fprintf stderr warn utter length longer
skip
utt info first max utter length
re new buffer for multi io


do minibatch buffer utt deriv buffer ha resourc for deriv utt info first

mbiter
mbiter

no data

fprintf stderr warn utter
resourc comput deriv skip
utt info first
re new buffer for multi io


support utter buffer
do minibatch buffer ha utt in current minibatch find utt info first ha utt in current minibatch

mbiter
mbiter

no data

fprintf stderr warn utter alreadi exist
minibatch skip
utt info first
re new buffer for multi io



set featur buffer
index featur buffer alloc multi io
size total feat num
featur name to id map featur name to id map

size featur name to id map first
msra matrixstrip feat ori mbiter frame
size fdim feat ori row
size actualmbs ori feat ori col
featur start index multi utt num of fea total feat num
total feat num fdim actualmbs ori featur start index multi utt num of fea

featur buffer multi utt

featur buffer multi utt elem type total feat num
featur buffer alloc multi utt total feat num

featur buffer alloc multi utt total feat num buffer size chang partial minibatch

featur buffer multi utt
featur buffer multi utt elem type total feat num
featur buffer alloc multi utt total feat num


set label buffer
size total label num
label name to id map label name to id map

size label name to id map first
size label name to dim map first

vector size uid mbiter label
size actualmbs ori uid size
label start index multi utt num of label total label num
total label num label start index multi utt num of label actualmbs ori

label buffer multi utt

label buffer multi utt elem type total label num
label buffer alloc multi utt total label num

label buffer alloc multi utt total label num

label buffer multi utt
label buffer multi utt elem type total label num
label buffer alloc multi utt total label num

memset label buffer multi utt elem type total label num

copi featur buffer
index featur buffer multi io
first
featur name to id map featur name to id map

size featur name to id map first
msra matrixstrip feat ori mbiter frame
size actualmbs ori feat ori col
size fdim feat ori row
first

to process actualmbs ori
first



to process actualmbs ori

runtim error multi featur inconsist frame


actualmbs ori mbiter currentmbfram

elem type

actualmbs ori column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi utt fdim featur start index multi utt num of fea elem type fdim feat ori elem type fdim




actualmbs ori column major iter column outsid

feat ori row

featur buffer multi utt fdim featur start index multi utt num of fea feat ori





label name to id map label name to id map

size label name to id map first
size label name to dim map first

vector size uid mbiter label
size actualmbs ori uid size

convert label to target multi io

size label dim label to target map multi io size
actualmbs ori

uid label dim
label dim
size label id uid


label buffer multi utt label start index multi utt num of label label to target map multi io label id





column valu
futur want spars matrix
actualmbs ori

uid
label uid elem type
label buffer multi utt uid label start index multi utt num of label elem type



process frame

mbiter
mbiter
no data




get copi utter correspond current minibatch
use neural network forward comput
elem type
htkmlf reader elem type get minibatch copi
vector vector pair wstring size utt info
stream minibatch input matric
mb layout ptr p mb layout

need copi minibatch forward
comput sequenc train
do minibatch buffer

framemod
utt deriv buffer need likelihood to comput deriv

get minibatch copi
get minibatch to train or test matric

p mb layout copi from p mb layout
utt info minibatch utt info
get minibatch copi


get minibatch copi






elem type
htkmlf reader elem type set net output
vector vector pair wstring size utt info
matrix base outputsb
mb layout ptr p mb layout

output dynam cast matrix elem type outputsb todo check sure
likelihood utter comput
deriv note minibatch contain partial output
utter utt deriv buffer take care glu
togeth
do minibatch buffer

framemod
utt deriv buffer set likelihood utt info output p mb layout




get label map get label map integ file
map tabl numer datatyp label store
elem type
i data reader label id type i data reader label type htkmlf reader elem type get label map wstring section name

id to label map


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
htkmlf reader elem type set label map wstring section name label id type label type label map

id to label map label map


elem type
size htkmlf reader elem type read label to target map file wstring label to target map file wstring label list file vector vector elem type label to target map

label list file
runtim error htkmlf reader read label to target map file cannot read label to target map file without label map file

vector wstring label list
size count num label
count
read statelist first
msra file textread label reader label list file
label reader

label list push back label reader wgetlin
count

num label count
count
msra file textread map reader label to target map file
size target dim
map reader

wstring line map reader wgetlin
find white space demarc
wstring size line find
wstring token line substr
wstring targetstr line substr

label list count token
runtim error htkmlf reader read label to target map file mismatch label map file label to target map file

count
target dim targetstr length
target dim targetstr length
runtim error htkmlf reader read label to target map file inconsist target length among record

vector elem type target vector targetstr length elem type
index targetstr

targetstr compar
target vector elem type
targetstr compar
runtim error htkmlf reader read label to target map file expect label2target map contain

label to target map push back target vector
count


verifi statelist label2target map file order match reader read map
count label list size
runtim error htkmlf reader read label to target map file mismatch length label map file label to target map file

target dim


get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
elem type
htkmlf reader elem type get data wstring section name size num record size data buffer size size record start

runtim error get data support htkmlf reader


elem type
htkmlf reader elem type data end

minibatch consid sentenc
truncat bptt need support check whether
truncat
sentenc end

useless current condit


elem type
htkmlf reader elem type set sentenc end in batch vector size sentenc end

sentenc end resiz switch frame size
size switch frame size

sentenc end switch frame



kaldi2 reader make follow assumpt
featur section alway field scp file
label section alway field mlf file
elem type
config record type
htkmlf reader elem type get data name from config config record type reader config vector wstring featur vector wstring label

reader config get member id

reader config can be config record

config record type temp reader config
config paramet contain file element
temp exist current scp file

featur push back

temp exist current mlf file

label push back




htkmlf reader
htkmlf reader



copyright microsoft right reserv
licens licens licens file project root full licens inform

data reader defin export function applic

todo renam export


stdafx
basetyp

htkfeatio read featur
latticearch read phonem lattic train
simplesenonehmm score
msra mgram unigram score ground truth path sequenc train

rollingwindowsourc minibatch sourc
readaheadsourc
chunkevalsourc
defin dataread export
data reader
htkmlf reader
config

microsoft cntk

dataread get reader f i data reader preader

preader htkmlf reader

dataread get reader d i data reader preader

preader htkmlf reader


util config file htkmlf reader need code

trim trim white space start
trim
note entir
trim

found find first
found npo

eras


eras found
found find last
found npo
eras found


basetyp
htkfeatio util
kaldi sequenc train deriv

microsoft cntk

constructor
elem type
kaldi sequenc train deriv elem type kaldi sequenc train deriv
wstring denlat rspecifi wstring ali rspecifi
wstring tran model filenam wstring silenc phone str
wstring train criterion
elem type old acoust scale elem type acoust scale
elem type lm scale one silenc class

msra
denlat rspecifi
ali rspecifi
denlat reader kaldi random access compact lattic reader
trim file to str to str denlat rspecifi
ali reader kaldi random access int32 vector reader
trim file to str to str ali rspecifi
read kaldi object to str tran model filenam tran model
old acoust scale old acoust scale
acoust scale acoust scale
lm scale lm scale
train criterion train criterion
one silenc class one silenc class
kaldi split string to integ to str silenc phone str
silenc phone

logic error invalid silenc phone sequenc

train criterion mpfe train criterion smbr

logic error support sequenc train criterion mpfe smbr



destructor
elem type
kaldi sequenc train deriv elem type kaldi sequenc train deriv

denlat reader
ali reader


elem type
kaldi sequenc train deriv elem type comput deriv
wstring utt id
matrix elem type log likelihood
matrix elem type deriv
elem type object

utt id str msra to str utt id

saniti check
tran model num pdf log likelihood get num row

runtim error number label log likelihood match
kaldi model utter
utt id log likelihood get num row
tran model num pdf


read align
ali reader ha key utt id str

runtim error align found utter
utt id str

vector int32 ali reader valu utt id str
size log likelihood get num col

runtim error number frame log likelihood match
align utter
utt id log likelihood get num col size


read denomin lattic
denlat reader ha key utt id str

runtim error denomin lattic found utter
utt id

kaldi compact lattic clat denlat reader valu utt id str
creat super final clat state weight
kaldi lattic
convert lattic clat

doe first path acoust scale typic set
acoust scale
old acoust scale

scale lattic acoust lattic scale old acoust scale



topsort lattic
kaldi uint64 prop properti k fst properti
prop k top sort

top sort

runtim error cycl detect lattic utt id



doe lattic acoust rescor posterior
neural network
lattic acoust rescor utt id log likelihood

second acoust languag model scale
acoust scale lm scale

scale lattic lattic scale lm scale acoust scale



forward backward lattic
kaldi posterior post pdf post
train criterion smbr

object kaldi lattic forward backward mpe variant
tran model silenc phone
smbr one silenc class post

train criterion mpfe

object kaldi lattic forward backward mpe variant
tran model silenc phone
mpfe one silenc class post


convert posterior to deriv post deriv
deriv get num col log likelihood get num col

use expect error rate instead expect accuraci
object log likelihood get num col object




elem type
kaldi sequenc train deriv elem type convert posterior to deriv
kaldi posterior post
matrix elem type deriv

kaldi posterior pdf post
kaldi convert posterior to pdf tran model post pdf post

deriv resiz tran model num pdf pdf post size
deriv set valu

size pdf post size

size pdf post size

size pdf post first
tran model num pdf
flip sign
deriv pdf post second




elem type
kaldi sequenc train deriv elem type lattic acoust rescor
wstring utt id
matrix elem type log likelihood
kaldi lattic

get time inform lattic
vector kaldi int32 state time
kaldi int32 max time kaldi lattic state time state time
max time log likelihood get num col

runtim error number frame log likelihood match
denomin lattic utter
utt id log likelihood get num row max time


vector vector kaldi int32 time state map
log likelihood get num col
size state num state
size state

state time state time log likelihood get num col
state time log likelihood get num col

time state map state time push back



size log likelihood get num col

size time state map size

kaldi int32 state time state map
mutabl arc iter kaldi lattic aiter state
aiter done aiter next

kaldi lattic arc aiter valu
kaldi int32 tran ilabel
tran

kaldi int32
tran model transit id to pdf tran
weight set value2 log likelihood weight value2
aiter set valu


check state
kaldi lattic weight final state
kaldi lattic weight zero

set value2
set final state





elem type
kaldi sequenc train deriv elem type ha resourc for deriv
wstring utt id

ali reader denlat reader

fprintf stderr warn lattic alignemnt reader




utt id str msra to str utt id
ali reader ha key utt id str denlat reader ha key utt id str






kaldi sequenc train deriv
kaldi sequenc train deriv


copyright microsoft right reserv
licens licens licens file project root full licens inform


pragma

stdafx
basetyp
fileutil
htkfeatio read numer lattic
latticearch
msra mgram read numer lattic
stdio
stdint
vector


hash
regex

pragma warn disabl 4996
msra lattic

helper write hash file
file section
physicalunitnam line map start
logunitnam physicalunitnam establish map logunitnam numer index physicalunitnam
unitmap
writeunitmap wstring symlistpath unitmap unitmap

vector unit
unit reserv unitmap size
vector map
map reserv unitmap size
iter unitmap cbegin iter unitmap cend iter would iter unitmap work

label iter first
size unitid iter second
unit size unitid
unit resiz unitid grow demand result must compact entri fill check later
unit unitid mani map rememb unit look write
map push back label

unit unitid label


file flist fopen or die symlistpath
write physic unit
index unit

unit
logic error build unitmap gap
fprintf or die flist unit

write phi map
index map

unit map logic name
size unitid unitmap find unit second unit index unit
tounit unit unitid name tehr
fprintf or die flist unit tounit

fflush or die flist


littl helper find valu
maptyp keytyp valtyp
size tryfind maptyp keytyp valtyp deflt

iter find
iter
deflt

iter second


archiv format
output file build
outpath result archiv huge file simpl concaten binari block
outpath contain key offset content archiv found
archiv byteoffset archiv mean previou
outpath symlist unit name encount order numer index use archiv first index
thi file suitabl input hh ed command
actual
file concaten
symlist file must remain pair archiv file
actual train user also need provid typic hh ed
outpath tie triphon unit senon sequenc name full phone symlist
unitnam senon senon senon
archiv build vector wstring infil wstring outpath
unord size modelsymmap
msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ label build numer lattic
msra cm gram lm unigram msra c symbol set unigramsymbol numer lattic

littl unit test helper test read
test
test

archiv
open outpath
lattic
hash size symmap
getlattic sw2001 1263622500 1374610000 symmap
getlattic sw2001 1391162500 1409287500 symmap




numermod label label pass shall convert ml fs lattic infil regular key

wstring tocpath outpath
wstring symlistpath outpath symlist

process file
wstring seenkey keep track seen key error duplic key
msra file make intermedi dir outpath

file fopen or die outpath
file ftoc fopen or die tocpath
size brokeninputfil
index infil

wstring inlatpath infil
fprintf stderr build process lattic inlatpath


wstring regex replac inlatpath wregex wstring map
regex replac wregex wstring path
regex replac wregex wstring extens none
seenkey insert second
runtim error msra strfun strprintf build duplic lattic inlatpath

fail time total broken h decod copi process mani file miss
latticeread


fetch lattic
lattic
numermod
fromhtklattic inlatpath modelsymmap read lattic

frommlf modelsymmap label unigram unigramsymbol read numer lattic
latticeread

write archiv
uint64 offset fgetpo
fwrite
fflush or die

write refer file note file headerless utf8 file fprintf format code page
fprintf or die ftoc msra strfun utf8 brokeninputfil msra strfun utf8 outpath offset
fflush or die ftoc

fprintf stderr written lattic offset offset

except

latticeread
write failur
ignor read failur
fprintf stderr error skip unread lattic inlatpath
brokeninputfil



write unit
todo thi sort redund get symmap alway archiv
writeunitmap symlistpath modelsymmap

fprintf stderr complet lattic read failur infil size infil size brokeninputfil brokeninputfil brokeninputfil infil size


helper context valu left right check uniqu
lattic nodecontext setcontext

unknown


ambigu


helper merg determin uniqu node context
vector lattic nodecontext lattic determinenodecontext msra simplesenonehmm hset

size spunit tryfind hset getsymmap size
size silunit tryfind hset getsymmap size
vector lattic nodecontext nodecontext node size
nodecontext front left nodecontext start
nodecontext front right nodecontext ambigu happen harm either
nodecontext back right nodecontext
nodecontext back left nodecontext ambigu happen sent know
size multispseen entri multi
index edg

edg
size
size
getaligninfo
size edg
logic error determinenodecontext edg allow merg remov
size unit
size size unit
spunit

size
runtim error determinenodecontext context free unit found singl phone word


size unit
spunit bugg lattic h vite track

search warn

size
unit spunit

end posit furthest

runtim error determinenodecontext word consist
fprintf stderr determinenodecontext word found edg size
multispseen
unit



spunit spunit


fprintf stderr totalalign firstalign edg size node size size align size
node node
index
fprintf stderr unit
dump stderr size hset gethmm getnam

runtim error determinenodecontext context free unit found start phone second last phone

ahmm hset gethmm
zhmm hset gethmm
ahmm gettran pindex
zhmm gettran pindex
nodecontext setright
nodecontext setleft

multispseen
fprintf stderr determinenodecontext broken edg multipl seen multispseen edg size
check condit
make hard assumpt phone
silhmm hset gethmm silunit
silid silhmm gettran pindex
index nodecontext

nodecontext
left nodecontext unknown right nodecontext unknown
runtim error determinenodecontext invalid dead node lattic
left nodecontext ambigu right silid right nodecontext
runtim error determinenodecontext invalid ambigu left context right context
right nodecontext ambigu left silid left nodecontext start
runtim error determinenodecontext invalid ambigu right context left context
node

nodecontext move


compar sort merg
lattic nodecontext nodecontext

sort left right sort make appear iother assum merg
diff
diff

diff left left
diff

diff right right
diff
cannot diff pattern sinc size


diff


remov edg
hapi lattic
lattic removefinalnul

lastedg edg back
last edg recogn align record
lastedg firstalign align size align record

lastedg node size lastedg node size
runtim error removefinalnul malform edg
edg resiz edg size remov
node resiz node size start node node
index edg
edg node size
runtim error removefinalnul cannot edg edg connect node time


merg secondari lattic first
with lot caveat
optim lattic unigram lattic uniqu node condit acoust context
edg call removefinalnul
return unsort edg invalid sort uniq represent easier
thi eleg hard labor
lattic merg lattic msra simplesenonehmm hset

edges2 edges2
logic error merg lattic must uniq format
info numfram info numfram
logic error merg lattic must ident frame

establish node context
context determinenodecontext hset
othercontext determinenodecontext hset

creat joint node space node map
thi also collaps uniqu node
note edg lattic ambigu ambigu
ignor keep node unmerg that sinc middl word zero thu keep connect
index context
context
index othercontext
othercontext iother
context insert context othercontext othercontext append othercontext
sort context context
vector size nodemap node size size
vector size othernodemap node size size

index context merg ident node critic step

context context context left context left context right context right
context context enter
node
context size
nodemap context
context iother size
othernodemap context iother

fprintf stderr merg joint node space uniq context size
context resiz

creat node copi context field
node resiz context size
index inew node
node inew context inew
info numnod node size

incorpor align record
size alignoffset align size
align insert align align align

exist edg field also firstalign
index edg

edg nodemap edg
edg nodemap edg

otheredg edg
index otheredg

otheredg othernodemap otheredg
otheredg othernodemap otheredg
otheredg firstalign alignoffset


point node exist edg alreadi node space align space

read merg edg simpli concaten
edg insert edg otheredg otheredg

remov acoust score like ident come differ decod
sort builduniquealign
info hasacscor
index edg
edg

note sort duplic that best done convers uniq format


remov duplic
thi must call uniq format
lattic dedup

edges2
logic error dedup lattic must uniq format

size
index edges2

edges2 edges2 edges2 edges2 edges2 firstalign edges2 firstalign

edges2 implysp edges2 implysp
logic error dedup inconsist implysp flag otherwis ident edg


edges2 edges2

fprintf stderr dedup edg reduc edges2 size
edges2 resiz
info numedg edges2 size
edg clear alreadi make sure longer


load lattic file write archiv

upgrad file format latest format chang
check consist read write
dump stdout
merg lattic merg numer denom lattic
input path actual path output stem ad nice mayb later
exampl command
convertlatticearch latticetoc dummi smbrdebug sw20 small lat smbrdebug sw20 small lat convert cdphoneti smbrdebug combin tie statelist smbrdebug swb300h 9304 align statelist transprob smbrdebug 9304 transprob
regener test lattic
buildlatticearch smbrdebug sw20 small lat regener smbrdebug hvitelat
support special output path syntax
output check format
dash dump lattic stdout instead
archiv convert wstring intocpath wstring intocpath2 wstring outpath
msra simplesenonehmm hset

modelsymmap hset getsymmap

wstring tocpath outpath
wstring symlistpath outpath symlist

open input archiv
todo find h vite emit redund physic triphon even hh ed seem tie file
thu uniq unit sort tie file
modelsymmap
directli hset transpar
vector wstring intocpath intocpath path consist
msra lattic archiv archiv intocpath modelsymmap

secondari archiv option merg oper
mergemod intocpath2 merg lattic
vector wstring intocpaths2
mergemod
intocpaths2 push back intocpath2
msra lattic archiv archive2 intocpaths2 modelsymmap merg archive2

read intocpath file key origin order
vector textbuff
toclin msra file fgetfilelin intocpath textbuff

file
file ftoc

process file
outpath outpath test special syntax bypass actual creat output archiv

msra file make intermedi dir outpath
fopen or die outpath
ftoc fopen or die tocpath

vector invmodelsymmap use dump mode

must pars file key origin order
size skippedmerg
index toclin

line toclin
strchr line

runtim error open invalid line sign line
wstring msra strfun utf16 line line

fprintf stderr convert process lattic

fetch lattic perform necessari format convers alreadi
lattic
archiv getlattic

lattic
mergemod

archive2 haslattic

fprintf stderr convert cannot merg lattic miss secondari archiv skip
skippedmerg


archive2 getlattic

merg
thi connect node match phone context condit aim merg numer lattic
removefinalnul headach
removefinalnul
merg hset
note left dup unigram merg lattic cannot repres unigram lattic sinc node

removefinalnul
determinenodecontext hset

convert todo perman format fread
note merg left unsort format need robust
size spunit tryfind modelsymmap size
builduniquealign spunit

mergemod
dedup

ftoc

write archiv
uint64 offset fgetpo
fwrite
fflush or die

write refer file note file headerless utf8 file fprintf format code page
fprintf or die ftoc msra strfun utf8 msra strfun utf8 outpath offset
fflush or die ftoc

fprintf stderr written convert lattic offset offset

outpath

invmodelsymmap build lazili

invmodelsymmap resiz modelsymmap size
iter modelsymmap iter modelsymmap iter
invmodelsymmap iter second iter first

rebuildedg
dump stdout size

invmodelsymmap


toclin
skippedmerg
fprintf stderr convert merg oper skip secondari lattic miss skippedmerg toclin size

write updat unit
ftoc
writeunitmap symlistpath modelsymmap

fprintf stderr convert lattic toclin size



read lattic extern format


read lattic
lattic expect freshli construct bother check
lattic fromhtklattic wstring path unord size unitmap

vector textbuff
line msra file fgetfilelin path textbuff
line
runtim error lattic form lattic input file zero
iter line
pars
dummychar dummi sscanf check
iter line strncmp iter iter

strncmp iter lmscale note sometim gener extra garbag space line
sscanf iter lmscale wdpenalti info info dummychar dummychar dummychar
runtim error lattic form lmscale wdpenalti line lattic iter


pars
iter line


sscanf iter dummychar dummychar
runtim error lattic form line lattic iter
info numnod
info numedg
iter


runtim error lattic form pars line lattic

info numnod
node reserv info numnod
pars node
size info numnod iter

iter line
runtim error lattic enough line lattic
itest

sscanf iter itest dummychar dummychar
runtim error lattic form node line lattic iter
size itest
runtim error lattic sequenc node line lattic iter
node push back nodeinfo info framedur
info numfram info numfram size node back

pars edg
info numedg
edg reserv info numedg
align reserv info numedg phone word enough
label
size info numedg iter

iter line
runtim error lattic enough line lattic
jtest


1024
exampl

nval sscanf iter jtest
nval info numedg special last edg thu record miss
strcpi
nval
runtim error lattic form edg line lattic iter
size jtest
runtim error lattic sequenc edg line lattic iter
edg push back edgeinfowithscor align size
build align
size edgefram check whether align sum right

info numedg last edg
runtim error lattic align info must start colon must least entri iter



point entri form triphon durat
strchr

runtim error lattic align entri lack comma iter

runtim error lattic align entri label iter
label assign triphon label


durat strtod weird return


runtim error lattic align entri end colon iter

creat align entri
size frame durat info framedur
unitmap find label
unitmap
runtim error lattic unit align model label
size unitid second
size unitid unitmap insert make pair label unitmap size first second creat entri index entri
align push back aligninfo unitid frame
edgefram frame

edgefram node size node


sprintf edgefram node node edgefram node size node edgefram node node
runtim error lattic align info durat mismatch edg durat iter


iter line
runtim error lattic unexpect garbag lattic iter
checklattic

creat effici storag align
size spunit tryfind unitmap size
builduniquealign spunit

showstat


construct numer lattic entri
lattic expect freshli construct bother check
lattic frommlf wstring unord size unitmap
msra htkmlfreader msra htkmlfentri lattic htkmlfwordsequ label
msra cm gram lm unigram msra c symbol set unigramsymbol

transcript label allwordtranscript todo could transcript realli matter

label state word
iter transcript find
iter transcript
runtim error frommlf refer word sequenc lattic strfun utf8
transcript iter second
transcript word size
runtim error frommlf refer word sequenc lattic strfun utf8

determin unigram score word
vector lmscore transcript word size
size silenc unigramsymbol silenc
size lmend unigramsymbol
size sentstart unigramsymbol sent start
size sentend unigramsymbol sent

creat lattic
node resiz transcript word size
edg resiz transcript word size
align reserv transcript align size
size numfram
index transcript word

transcript word
node firstfram
edg
unus



runtim error msra strfun strprintf frommlf mani token repres edgeinfo label
score

score
sent start silenc patch score
size wordindex
sentstart


logic error frommlf found sent start token first posit

sentend

transcript word size
logic error frommlf found sent token posit
lmend score lookup

iwid
sentstart silenc unigram score iwid

align
implysp
firstalign align size
transcript getaligninfo
align insert align
index
numfram frame

node transcript word size numfram
node transcript word size numfram
runtim error msra strfun strprintf frommlf mani frame repres nodeinfo label
info indic
info indic
info numedg edg size
info numnod node size
info numfram numfram
checklattic

creat effici storag align
size spunit tryfind unitmap size
builduniquealign spunit

showstat




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
htkmlf reader compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach




basetyp
htkfeatio util
utter deriv buffer

microsoft cntk

constructor
elem type
utter deriv buffer elem type utter deriv buffer
size number ofutt per minibatch
utter deriv comput interfac elem type deriv interfac

deriv interfac
deriv interfac deriv interfac
num utt per minibatch number ofutt per minibatch
need likelihood
current obj
utt readi assign num utt per minibatch
epoch end
dimens


elem type
utter deriv buffer elem type process utt info
vector vector pair wstring size utt info
mb layout ptr p mb layout
vector vector pair
wstring pair size size utt info in minibatch

utt info in minibatch
utt info size num utt per minibatch
p mb layout get num parallel sequenc num utt per minibatch
utt info in minibatch clear
utt info in minibatch resiz utt info size

size utt info size

size start frame index in minibatch
size num frame

size p mb layout get num time step

p mb layout minibatch pack flag no label



frame rang p mb layout

p mb layout is gap sequenc



num frame
p mb layout is beyond start or end with time offset ptrdiff sequenc p mb layout get num time step

size utt index utt info in minibatch size
wstring utt id utt info utt index first
utt info in minibatch push back
make pair utt id make pair start frame index in minibatch
num frame
start frame index in minibatch
num frame


utt info size utt info in minibatch size



suppos stream log likelihood in
follow format



elem type
utter deriv buffer elem type set likelihood
vector vector pair wstring size utt info
matrix elem type log likelihood in
mb layout ptr p mb layout

need likelihood
epoch end

dimens

dimens log likelihood in get num row

dimens log likelihood in get num row

vector vector
pair wstring pair size size utt info in minibatch
process utt info utt info p mb layout utt info in minibatch

check need move
matrix elem type log likelihood log likelihood in deep clone
log likelihood get devic id

log likelihood transfer from devic to devic
log likelihood get devic id cpudevic


size current mb size p mb layout get num time step
size utt info size

utt info size utt info in minibatch size
size utt info size

wstring utt id utt info first
utt pool find utt id utt pool

utter deriv unit tmp utt unit
tmp utt unit ha deriv
tmp utt unit utt length utt info second
tmp utt unit progress
tmp utt unit stream id
tmp utt unit log likelihood resiz log likelihood get num row
tmp utt unit utt length
utt pool utt id move tmp utt unit


set likelihood comput deriv
utt pool find utt id utt pool
utt pool utt id ha deriv

utt id utt info in minibatch first
size start frame utt info in minibatch second first
size num frame utt info in minibatch second second
utt pool utt id progress num frame utt pool utt id utt length

set likelihood
size num frame

utt pool utt id log likelihood set column
log likelihood column slice
start frame num utt per minibatch
utt pool utt id progress


utt pool utt id progress num frame
utt pool utt id progress utt pool utt id utt length

deriv interfac comput deriv
utt id
utt pool utt id log likelihood
utt pool utt id deriv
utt pool utt id object
utt pool utt id ha deriv
utt pool utt id progress
utt readi utt pool utt id stream id





check readi provid deriv
need likelihood
size utt readi size

utt readi

need likelihood





suppos stream deriv out
follow format



elem type
utter deriv buffer elem type get deriv
vector vector pair wstring size utt info
mb layout ptr p mb layout
matrix elem type deriv out

deriv out
need likelihood
vector vector
pair wstring pair size size utt info in minibatch
process utt info utt info p mb layout utt info in minibatch

current obj
matrix elem type deriv cpudevic
deriv resiz dimens p mb layout get num col
size utt info size

utt info size utt info in minibatch size
size utt info size

wstring utt id utt info first

check deriv
utt pool find utt id utt pool utt pool find utt id utt pool utt pool utt id ha deriv

runtim error deriv readi utter

utt id


assign deriv
utt id utt info in minibatch first
size start frame utt info in minibatch second first
size start frame in utt utt pool utt id progress
size num frame utt info in minibatch second second
size num frame

deriv set column
utt pool utt id deriv column slice
start frame in utt
start frame num utt per minibatch

current obj utt pool utt id object num frame utt pool utt id utt length
utt pool utt id progress num frame
utt pool utt id progress utt pool utt id utt length
utt pool utt id progress utt pool utt id utt length

utt pool eras utt id




check need move
deriv out get devic id

deriv transfer from devic to devic
cpudevic deriv out get devic id

deriv out set valu deriv

keep utter inform check time
give object
current utt info utt info

check need read loglikelihood
need likelihood epoch end utt pool size
need likelihood

utt readi assign num utt per minibatch




elem type
utter deriv buffer elem type get object
vector vector pair wstring size utt info
mb layout ptr p mb layout
matrix elem type object in

object in

check utter inform
match compar utt info utt info current utt info
match

runtim error current object correspond
minibatch utter inform perhap
get object right get deriv


set object
object in resiz p mb layout get num col
object in set valu
current obj cast elem type p mb layout get num col




elem type
utter deriv buffer elem type ha resourc for deriv
wstring utt id

deriv interfac ha resourc for deriv utt id


elem type
utter deriv buffer elem type compar utt info
vector vector pair wstring size utt info1
vector vector pair wstring size utt info2

match
utt info1 size utt info2 size

size utt info1 size

utt info1 size utt info2 size

match


size utt info1 size

utt info1 first utt info2 first
utt info1 second utt info2 second

match







match

match


elem type
utter deriv buffer elem type reset epoch

need likelihood
current obj
epoch end
utt pool clear
current utt info clear
utt readi assign num utt per minibatch


utter deriv buffer
utter deriv buffer


copyright microsoft right reserv
licens licens licens file project root full licens inform

data writer defin export function applic

todo thi similar ident common data writer data writer differ reconcil


stdafx
basic

htkfeatio read featur

defin datawrit export
data writer
htkmlf writer

microsoft cntk

todo move export
datawrit get writer f i data writer pwriter

pwriter htkmlf writer

datawrit get writer d i data writer pwriter

pwriter htkmlf writer


config record type
data writer init from config config record type writer config

wstring precis writer config precis
precis
data writer htkmlf writer
precis
data writer htkmlf writer

invalid argument data writer kaldi htkmlf writer precis paramet must

data writer init writer config


destroy cleanup remov
note destroy use past point
data writer destroy

data writer


data writer constructor
config configur writer
config record type
data writer data writer config record type config

init config


destructor cleanup temp file
data writer data writer

destroy


get section section file
section section name section data sepcif config file use determin save
data writer get section wstring section type nocas compar section

data writer get section section


save data save file file
record start start record
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
data writer save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

data writer save data record start matric num record dataset size byte variabl size


save map save file
save id name section save section subsect format
label map save file
data writer save map wstring save id label id type label type label map

data writer save map save id label map




copyright microsoft right reserv
licens licens licens file project root full licens inform

htkmlf reader defin export function applic


stdafx
basetyp

htkfeatio read featur

ssematrix

defin datawrit export creat export
data writer
config
htkmlf writer
config
ifdef leakdetect
memori leak detect


microsoft cntk

creat data writer
datawrit i data writer data writer factori

elem type
config record type
htkmlf writer elem type init from config config record type writer config

temp array nullptr
temp array size
overflow warn count

vector wstring scriptpath
vector wstring filelist
size num file
size firstfilesonli size lower valu test

verbos writer config verbos
overflow valu writer config overflow valu
max num overflow warn writer config max num overflow warn

vector wstring output name writer config output node name config record type array stringargvector
output name size
runtim error writer need least output node name specifi config
counter
index output name input name node name

config paramet thi output writer config output name

thi output exist
udim push back thi output

runtim error htkmlf writer init writer need specifi output
thi output exist file
scriptpath push back thi output file
thi output exist scp file
scriptpath push back thi output scp file

runtim error htkmlf writer init writer need specifi scp file output

thi output exist kaldicmd

kaldicmd push back thi output kaldicmd
kaldi base float matrix writer wfea
featur writer push back wfea
featur writer open msra strfun utf8 kaldicmd counter


output name to id map output name
output name to dim map output name udim
wstring thi output real
real

output name to type map output name output type output real



runtim error htkmlf writer init output writer output expect real

counter


num file
index scriptpath

filelist clear
wstring script path scriptpath
fprintf stderr htkmlf writer init read output script file script path
size
msra file textread reader script path reader filelist size firstfilesonli optim

wstring line reader wgetlin
wstringstream line
wstring first
first
filelist push back first leotodo



fprintf stderr entri


num file
num file
runtim error msra strfun strprintf htkmlf writer init file scriptfil inconsist num file

output file push back filelist

output file index
samp period 100000


elem type
htkmlf writer elem type destroy

temp array
temp array nullptr
temp array size
size featur writer size

featur writer close
fprintf stderr close kaldi writer



elem type
htkmlf writer elem type get section wstring section type nocas compar section



elem type
htkmlf writer elem type save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size


kaldicmd size

wstring nocas compar iter iter
output file index output file size
runtim error index output file rang

iter matric iter matric iter

wstring output name iter first
matrix elem type output data cast matrix elem type iter second
size output name to id map output name
size output name to dim map output name
wstring out file output file output file index

output data get num row


save to kaldi file out file output data


output file index



output file index output file size
runtim error index output file rang

iter matric iter matric iter

wstring output name iter first
matrix elem type output data cast matrix elem type iter second
size output name to id map output name
size output name to dim map output name
wstring out file output file output file index
wfea msra strfun utf8 out file

wfea msra strfun utf8 kaldicmd
featur writer open wfea
kaldi matrix kaldi base float nnet host

output data get num row

output path msra strfun utf8 out file
file remov extens basenam output path

nnet host resiz output data get num col output data get num row
output data copi to array temp array temp array size
elem type p valu temp array

output data get num col

output data get num row

nnet host p valu
nnet host overflow valu

nnet host output data get num col
verbos overflow warn count max num overflow warn

fprintf stderr overflow frame wfea
overflow warn count





fprintf stderr evalu write frame output data get num col wfea
featur writer write file nnet host



output file index




elem type
htkmlf writer elem type save wstring output file matrix elem type output data

msra matrix output
output resiz output data get num row output data get num col
output data copi to array temp array temp array size
elem type p valu temp array

output data get num col

output data get num row

output p valu



size nansinf output countnaninf
nansinf
fprintf stderr chunkev na ns detect frame nansinf output file output col
save
msra file make intermedi dir output file
msra util attempt

msra htkfeatwrit write output file user samp period output


fprintf stderr evalu write frame output col output file


elem type
htkmlf writer elem type save to kaldi file wstring output file matrix elem type output data

msra matrix output
output resiz output data get num row output data get num col
output data copi to array temp array temp array size
elem type p valu temp array

output data get num col

output data get num row

output p valu



size nansinf output countnaninf
nansinf
fprintf stderr chunkev na ns detect frame nansinf output file output col
save
msra file make intermedi dir output file
msra util attempt

msra htkfeatwrit write kaldi output file user samp period output elem type


fprintf stderr evalu write frame output col output file


elem type
htkmlf writer elem type save map wstring save id label id type label type label map



htkmlf writer
htkmlf writer


copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
text config helper
data reader
string util


wstring
pair
vector


microsoft cntk

text config helper text config helper config paramet config

config exist current input

runtim error cntk text format reader configur contain input section


config paramet input config input

input

runtim error cntk text format reader configur contain input section


precis config find precis
are equal ignor case precis

element type element type tdoubl

are equal ignor case precis

element type element type tfloat



runtim error support precis expect precis


stream id
wstring alia to input map
pair config paramet section input

config paramet input section second
wstring name msra strfun utf16 section first

input exist current input exist current format

runtim error input section input specifi requir paramet
format name


stream descriptor stream
stream
stream name name
stream sampl dimens input
input format

are equal ignor case dens

stream storag type storag type dens

are equal ignor case spars

stream storag type storag type spars



runtim error format paramet must either dens spars


option
input exist current

stream input
stream

runtim error alia valu input name




stream section first


alia to input map find stream alia to input map

runtim error alia alreadi map input
stream alia to input map stream



alia to input map stream stream name


stream element type element type
stream push back stream


filepath msra strfun utf16 config file

config exist random

wstring random string config can be string random config random wstring
wcsicmp random string none

random window random none

wcsicmp random string

random window random auto



random window config random




random window random auto


skip sequenc id config skip sequenc id
max error config max error
trace level config trace level
chunk size byte config chunk size in byte 1024 1024
chunk cach size config num chunk to cach memori total




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul dword reason call lpvoid lp reserv




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
inttyp
index
text reader constant



microsoft cntk

index index file file skip sequenc id size chunk size
file file
file offset start
file offset end
buffer buffer size
buffer start nullptr
buffer end nullptr
nullptr
done
ha sequenc id skip sequenc id
max chunk size chunk size

file nullptr

runtim error input file open read



index refil buffer

done

size byte read fread buffer buffer size file
byte read size
runtim error could read input file
byte read

done



file offset start file offset end
file offset end byte read
buffer start buffer
buffer start
buffer end buffer start byte read




index add sequenc sequenc descriptor

chunk
chunk descriptor chunk chunk back
chunk byte size chunk byte size byte size max chunk size

chunk push back
chunk chunk back
chunk chunk size

chunk byte size byte size
chunk number of sequenc
chunk number of sampl number of sampl
chunk id chunk
chunk sequenc push back


index build from line

buffer start
ha sequenc id
size line
int64 offset get file offset
done

memchr delimit buffer end


sequenc descriptor
line
number of sampl
is valid
file offset byte offset
offset get file offset
byte size offset file offset byte
todo ignor line
add sequenc

line



refil buffer




index build

chunk




max chunk size

file size files file
chunk reserv file size max chunk size max chunk size


chunk push back

refil buffer read first block
done

runtim error input file


buffer end buffer start
buffer start buffer start buffer start

input file contain valu skip

file offset start
buffer start


check first decid
ha sequenc id buffer start name prefix

skip sequenc pars treat line individu sequenc
build from line



size
int64 offset get file offset
read first sequenc
tri get sequenc id

runtim error expect sequenc offset pr ii64 none found offset


sequenc descriptor

file offset byte offset
is valid

done

skip line ignor whatev left line
offset get file offset line start offset
number of sampl

done tri get sequenc id

found sequenc start offset byte file
byte size offset file offset byte
add sequenc


file offset byte offset
is valid



calcul size last sequenc
byte size file offset end file offset byte
add sequenc



index skip line

done

memchr delimit buffer end


found line charact
buffer end

refil buffer



refil buffer



index tri get sequenc id size

found

done

buffer end


well form sequenc must either column delimit
name prefix
column delimit name prefix

found


isdigit

todo ignor malform sequenc
runtim error unexpect charact
read sequenc
offset pr ii64 get file offset


found
size temp

temp

todo ignor malform sequenc
runtim error size overflow read sequenc
offset pr ii64 get file offset



refil buffer


todo ignor malform sequenc
reach without hit pipe charact
runtim error reach file
read sequenc
offset pr ii64 get file offset




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
cntk text format reader
config
text config helper
block random
no random
text parser
sequenc packer

microsoft cntk

cntk text format reader cntk text format reader memori provid ptr provid
config paramet config
provid provid

text config helper config helper config



config helper get element type element type tfloat

deseri share i data deseri text parser config helper



deseri share i data deseri text parser config helper


transform ptr random
size window config helper get random window
window

verbos gener config paramet specif text format reader
verbos config verbos
random make share block random verbos window deseri



random make share no random deseri


random initi nullptr config

transform random

todo frame mode config paramt
packer make share sequenc packer
provid
transform
get stream descript

runtim error

runtim error cntk text format reader while read config helper get file path



vector stream descript ptr cntk text format reader get stream descript

deseri get stream descript


cntk text format reader start epoch epoch configur config

config total epoch size in sampl

runtim error epoch size cannot


transform start epoch config
packer start epoch config


minibatch cntk text format reader read minibatch

packer nullptr
packer read minibatch



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
inttyp
cfloat
limit
index
text parser
text reader constant

defin minwindef
defin is sign
defin

microsoft cntk

state
init
sign
integr part
period
fraction part
the letter e
expon sign
expon


elem type
text parser elem type text data chunk chunk enabl share text data chunk


text data chunk chunk descriptor descriptor

get sequenc
get sequenc size sequenc id vector sequenc data ptr result

size vector sequenc data ptr sequenc ptr map

buffer store actual
vector sequenc buffer sequenc

chunk copi descriptor
size
keep track mani time get sequenc call
when counter valu reach sequenc
chunk safe unload
size sequenc request count



elem type
text parser elem type stream info
storag type
size sampl dimens


elem type
text parser elem type text parser text config helper helper
text parser helper get file path helper get stream

set trace level helper get trace level
set max allow error helper get max allow error
set chunk cach size helper get num chunk to cach
set chunk size helper get chunk size
set skip sequenc id helper should skip sequenc id

initi


elem type
text parser elem type text parser wstring filenam vector stream descriptor stream
filenam filenam
file nullptr
stream info stream size
index nullptr
file offset start
file offset end
buffer buffer size
buffer start nullptr
buffer end nullptr
nullptr
chunk size byte
chunk cach size
trace level trace level error
num allow error
skip sequenc id

stream size

max alia length

size stream size

stream descriptor stream stream
stream
max alia length length

max alia length length

alia to id map
stream info stream storag type
stream info sampl dimens stream sampl dimens

stream descript make share stream descript stream
stream descript sampl layout make share tensor shape stream sampl dimens
stream push back stream descript


max alia length

scratch uniqu max alia length


elem type
text parser elem type text parser

file

fclose file



elem type
text parser elem type initi

index nullptr




attempt

file fopen or die filenam


funicod file

runtim error found begin input file
encod current support filenam


index make uniqu index file skip sequenc id chunk size byte

attempt

index build


still possibl actual input sequenc column
skip sequenc id index ha sequenc id

index nullptr

int64 posit ftelli64 file
posit

runtim error error retriev file posit file filenam


file offset start posit
file offset end posit


elem type
chunk descript text parser elem type get chunk descript

index nullptr

index index get index

chunk descript result
result reserv index size
chunk index

result push back share chunk descript
chunk descript
chunk
chunk number of sampl
chunk number of sequenc



result


elem type
text parser elem type get sequenc for chunk size chunk id vector sequenc descript result

index index get index
chunk index chunk id
result reserv chunk sequenc size

chunk sequenc

result push back


number of sampl
chunk id
is valid





elem type
text parser elem type text data chunk text data chunk chunk descriptor descriptor

descriptor
sequenc request count
sequenc reserv descriptor number of sequenc


elem type
text parser elem type text data chunk get sequenc size sequenc id vector sequenc data ptr result

sequenc ptr map find sequenc id
sequenc ptr map
sequenc request count
result reserv second size
copi second second back insert result


elem type
chunk ptr text parser elem type get chunk size chunk id

chunk ptr chunk
chunk cach find chunk id
chunk cach

chunk second



chunk descriptor index get index chunk id
text chunk make share text data chunk chunk descriptor

attempt text chunk chunk descriptor

load chunk text chunk chunk descriptor


chunk cach size chunk cach size chunk cach size

size candid id size
size min num sequenc left size
chunk cach

chunk second
size num sequenc use
num sequenc use chunk sequenc request count
size num sequenc left chunk sequenc size num sequenc use
num sequenc left min num sequenc left

min num sequenc left num sequenc left
candid id first


candid id size
chunk cach eras candid id


chunk cach size

chunk cach chunk id text chunk


chunk text chunk

chunk


elem type
text parser elem type load chunk text chunk ptr chunk chunk descriptor descriptor

sequenc descriptor descriptor sequenc

chunk sequenc push back load sequenc skip sequenc id sequenc descriptor
sequenc data chunk sequenc back
vector sequenc data ptr sequenc ptr stream info size
size stream info size

stream info stream stream info
stream storag type dens

dens input stream buffer input reinterpret cast dens input stream buffer sequenc data
make share dens sequenc data
input buffer
sampl layout stream sampl layout
number of sampl input number of sampl
chunk chunk
sequenc descriptor
sequenc ptr



spars input stream buffer input reinterpret cast spars input stream buffer sequenc data
make share spars sequenc data
input buffer
indic input indic
nnz count reserv input nnz count size
copi input nnz count input nnz count back insert nnz count
total nnz count input total nnz count
chunk chunk
sequenc descriptor
number of sampl input nnz count size
sequenc ptr


chunk sequenc ptr map sequenc descriptor move sequenc ptr



elem type
text parser elem type increment number of error or die

num allow error

runtim error reach maximum allow reader error

num allow error


elem type
text parser elem type tri refil buffer

size byte read fread buffer buffer size file

byte read size
runtim error could read input file filenam

byte read




file offset start file offset end
file offset end byte read
buffer start buffer
buffer start
buffer end buffer start byte read



elem type
text parser elem type set file offset int64 offset

fseeki64 file offset seek


runtim error error seek posit pr id64 file offset filenam


file offset start offset
file offset end offset

tri refil buffer


elem type
text parser elem type sequenc buffer text parser elem type load sequenc verifi id sequenc descriptor sequenc dsc

file offset sequenc dsc file offset byte

file offset file offset start file offset file offset end

set file offset file offset


size buffer offset file offset file offset start
buffer start buffer offset
size byte to read sequenc dsc byte size

verifi id

size
tri read uint64 byte to read sequenc dsc

runtim error find expect sequenc pr iu64
file offset pr id64 sequenc dsc get file offset



sequenc buffer sequenc

todo reus load sequenc instead creat one
stream stream info

stream storag type dens

sequenc push back make uniqu dens input stream buffer
stream sampl dimens sequenc dsc number of sampl



sequenc push back make uniqu spars input stream buffer



size num row read expect row count sequenc dsc number of sampl
size expect row count

tri read row sequenc byte to read

num row read



increment number of error or die
trace level warn

fprintf stderr
warn could read pr iu64
load sequenc pr iu64
offset pr id64 sequenc dsc get file offset



byte to read num row read expect row count

trace level warn

fprintf stderr
warn exhaust expect input
expect current sequenc pr iu64
offset pr id64 sequenc dsc get file offset





trace level info

fprintf stderr
info finish load sequenc pr iu64
success read pr iu64 expect pr iu64 row
sequenc dsc num row read expect row count


doubl check input stream
todo handl need grace current cntk complain sequenc
ha empti input

size sequenc size

sequenc number of sampl

fprintf stderr
error while read input pr iu64
sequenc pr iu64
file offset pr id64 input sequenc dsc get file offset
ha empti input



ha empti input

runtim error could read input file bail


sequenc


elem type
text parser elem type tri read row sequenc buffer sequenc size byte to read

found
byte to read can read



isdigit column delimit carriag return

skip sequenc column separ

byte to read



delimit

found skip delimit

byte to read
found


size
tri get input id byte to read

increment number of error or die
skip to next input byte to read



stream info stream stream info

stream storag type dens

dens input stream buffer reinterpret cast dens input stream buffer sequenc
vector elem type valu buffer
size size valu size
size stream sampl dimens
tri read dens sampl valu stream sampl dimens byte to read

expect dens sampl abl fulli read ignor
valu size size

clean buffer
valu resiz size

increment number of error or die
skip to next input byte to read


everyth went well increment sampl
number of sampl



spars input stream buffer reinterpret cast spars input stream buffer sequenc
vector elem type valu buffer
vector index type indic indic
valu size indic size
size size valu size
tri read spars sampl valu indic byte to read

expect spars sampl someth went south ignor
valu size size

clean buffer
valu resiz size

indic size size

clean buffer
indic resiz size


increment number of error or die
skip to next input byte to read


valu size indic size
number of sampl
index type count cast index type valu size size
nnz count push back count
total nnz count count


found


trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read input
offset pr id64 get file offset




elem type
text parser elem type tri get input id size size byte to read

scratch index scratch



prefix check
name prefix

trace level warn

fprintf stderr
warn unexpect charact place name prefix
read input name
offset pr id64 name prefix get file offset




skip name prefix

byte to read

byte to read can read



input follow valu marker line also carriag
column separ name prefix follow input
valu delimit name prefix

size size scratch index scratch
size

name scratch size
alia to id map find name
alia to id map

second


trace level warn

fprintf stderr
warn invalid input name
read input name
offset pr id64 name get file offset


trace level warn

fprintf stderr
warn name prefix immedi follow delimit
read input name
offset pr id64 get file offset




scratch index scratch max alia length

scratch index
scratch index



current length alreadi equal maximum expect length
follow delimit
trace level warn

fprintf stderr
warn abl find input name
offset pr id64 get file offset





byte to read


trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read input name
offset pr id64 get file offset




elem type
text parser elem type tri read dens sampl vector elem type valu size sampl size size byte to read

size counter
elem type valu

byte to read can read



soon printabl name prefix
valu delimit name prefix

todo
counter sampl size drop extra element
increment error diff sampl size counter

counter

counter sampl size

runtim error encount sampl size pr id64
exceed expect size pr id64 offset pr id64
counter sampl size get file offset


counter sampl size

dens matric possibl input left part
suffix spars fill rest zero
valu push back
counter





valu delimit

skip valu delimit

byte to read



tri read real number valu byte to read

bail



valu push back valu
counter


increment number of error or die
trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read dens sampl
offset pr id64 get file offset




elem type
text parser elem type tri read spars sampl vector elem type valu vector index type indic size byte to read

size index
elem type valu

byte to read can read



soon printabl name prefix
valu delimit name prefix

spars sampl allow input name input name2



valu delimit

skip valu delimit

byte to read



read spars index
tri read uint64 index byte to read

bail


index numer limit index type

trace level warn

fprintf stderr
warn spars index valu pr iu64 exce maximum allow
valu pr iu64 index size numer limit index type

bail


index numer limit index type

trace level warn

fprintf stderr
warn spars index valu pr iu64 exce maximum allow
valu pr iu64 index size numer limit index type

bail



index must follow delimit

index delimit

consum index delimit

byte to read



trace level warn

fprintf stderr
warn unexpect charact spars valu index
offset pr id64 get file offset




read correspond valu
tri read real number valu byte to read

bail



valu push back valu
indic push back cast index type index


increment number of error or die
trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read spars sampl
offset pr id64 get file offset





elem type
text parser elem type skip to next valu size byte to read

byte to read can read


skip everyth either valu marker input marker
valu delimit delimit name prefix




byte to read



elem type
text parser elem type skip to next input size byte to read

byte to read can read


skip everyth either input marker
name prefix delimit




byte to read



elem type
text parser elem type tri read uint64 size valu size byte to read

valu
found
byte to read can read



isdigit

found


found

size temp valu
valu valu
temp valu

trace level warn

fprintf stderr
warn size overflow read uint64
offset pr id64 get file offset






byte to read


trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read uint64
offset pr id64 get file offset






todo better precis moment pariti uci fast
assum byte to read greater charact
represent float point
follow delimit
post condit point first charact
cannot pars part float point
return pars success
elem type
text parser elem type tri read real number elem type valu size byte to read

state state state init
coeffici divid
neg

byte to read can read



state

state init
must either start sign
isdigit

state integr part


is sign

state sign
neg



trace level warn

fprintf stderr
warn unexpect prefix read float point valu
offset pr id64 get file offset




sign
sign must follow
isdigit

state integr part




trace level warn

fprintf stderr
warn sign follow unexpect charact
read float point valu
offset pr id64 get file offset




integr part
isdigit





state period



state the letter e
coeffici neg




valu cast elem type neg



period
isdigit

state fraction part
coeffici

divid



valu cast elem type neg



fraction part
isdigit

todo ignor precis digit
check overflow
state chang

divid



state the letter e
coeffici divid
neg

coeffici coeffici




coeffici divid
valu cast elem type neg coeffici coeffici



the letter e
follow option minu plu sign nonempti sequenc digit
isdigit

state expon
neg


is sign

state expon sign
neg



trace level warn

fprintf stderr
warn expon follow unexpect charact
read float point valu
offset pr id64 get file offset




expon sign
expon sign must follow
isdigit

state expon




trace level warn

fprintf stderr
warn expon sign follow unexpect charact
read float point valu
offset pr id64 get file offset




expon
isdigit

state chang




expon neg
valu cast elem type coeffici expon




logic error invalid pars state



byte to read


trace level warn

fprintf stderr
warn exhaust input expect current sequenc
read float point valu
offset pr id64 get file offset





elem type
text parser elem type set trace level trace level

trace level trace level


elem type
text parser elem type set max allow error max error

num allow error max error


elem type
text parser elem type set skip sequenc id skip

skip sequenc id skip


elem type
text parser elem type set chunk cach size size

chunk cach size size


elem type
text parser elem type set chunk size size size

chunk size byte size


text parser
text parser


copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
reader shim
cntk text format reader
heap memori provid
cuda memori provid

microsoft cntk

todo memori provid inject

factori config paramet paramet reader ptr

make share cntk text format reader make share heap memori provid paramet


dataread get reader f i data reader preader

preader reader shim factori


dataread get reader d i data reader preader

preader reader shim factori



copyright microsoft right reserv
licens licens licens file project root full licens inform

lib svm binari reader defin export function applic


stdafx
defin dataread export creat export
data reader
lib svm binari reader
fileutil fexist
random

ctime
time
cuda page lock mem alloc
chrono
thread
ifndef win32
type
stat
mman
unistd
fcntl
errno


microsoft cntk

dword hidword size size

size

dword lodword size size

size 0x ffffffff


elem type
dens binari matrix elem type dens binari matrix wstring name devic id size num row size num col
binari matrix elem type name devic id num row num col

valu elem type malloc elem type num row num col
valu elem type cuda page lock mem alloc malloc elem type num row num col devic id


elem type
dens binari matrix elem type clear

num row


elem type
dens binari matrix elem type dispos

valu nullptr

free valu
cuda page lock mem alloc free valu devic id

valu nullptr


elem type
dens binari matrix elem type fill matrix elem type matrix

matrix set valu max num col num row matrix get devic id valu matrix flag normal
debug
matrix print testnam



elem type
dens binari matrix elem type set max row size max row

max row max num row

elem type valu elem type malloc elem type max num col max row
elem type valu elem type cuda page lock mem alloc malloc elem type max num col max row devic id
valu nullptr

num row

memcpi valu valu elem type num row max num col

free valu
cuda page lock mem alloc free valu devic id

valu valu
max num row max row



elem type
dens binari matrix elem type add valu valu size num row

memcpi valu num row max num col valu elem type num row max num col
num row num row


elem type
spars binari matrix elem type spars binari matrix wstring name devic id size num row size num col
binari matrix elem type name devic id num row num col row indic nullptr col indic nullptr max n nz

col indic int32 malloc int32 num row
col indic int32 cuda page lock mem alloc malloc int32 num row devic id
col indic


elem type
spars binari matrix elem type dispos

valu nullptr

free valu
cuda page lock mem alloc free valu devic id

valu nullptr
col indic nullptr

free col indic
cuda page lock mem alloc free col indic devic id

col indic nullptr
row indic nullptr

free row indic
cuda page lock mem alloc free row indic devic id

row indic nullptr


elem type
spars binari matrix elem type set max row size max row

max row max num row

int32 col indic int32 malloc int32 max row
int32 col indic int32 cuda page lock mem alloc malloc int32 max row devic id
col indic nullptr

num row

memcpi col indic col indic int32 num row

free col indic
cuda page lock mem alloc free col indic devic id

col indic col indic
max num row max row



elem type
spars binari matrix elem type resiz array size new n nz


new n nz max n nz



size new max n nz size new n nz
int32 row indic int32 malloc int32 new max n nz
elem type valu elem type malloc elem type new max n nz
int32 row indic int32 cuda page lock mem alloc malloc int32 new max n nz devic id
elem type valu elem type cuda page lock mem alloc malloc elem type new max n nz devic id

copi valu


row indic valu impli pointer alloc
memcpi row indic row indic int32 max n nz
memcpi valu valu elem type max n nz


free storag
row indic nullptr
cuda page lock mem alloc free row indic devic id

valu nullptr
cuda page lock mem alloc free valu devic id

row indic row indic
valu valu
max n nz new max n nz


elem type
spars binari matrix elem type clear

num row



elem type
spars binari matrix elem type add valu valu size

memcpi valu valu elem type


elem type
spars binari matrix elem type add col indic col indic size num col

int32 temp int32 col indic
num col

col indic num row temp int32

num row num col

elem type
spars binari matrix elem type add row indic row indic size

memcpi row indic row indic int32


elem type
spars binari matrix elem type fill matrix elem type matrix

matrix set matrix from csc format col indic row indic valu max num col num row
debug
matrix print testnam



elem type
spars binari input elem type spars binari input wstring file name
file name file name read order nullptr read order length random temp valu nullptr temp valu size offset nullptr offset start start mb end mb

name msra strfun utf8 file name
in file open name ifstream binari ifstream


elem type
spars binari input elem type spars binari input



elem type
spars binari input elem type init wstring wstring renam


size offset
in file seekg ifstream
in file read num row int64
offset int64

in file read num batch int64
offset int64

int32 num featur
int32 num label
in file read num featur int32
offset int32

in file read num label int32
offset int32

int32
int32 num col
int32 max len
temp name malloc max len
int32 num featur

in file read int32
max len

max len
free temp name
temp name malloc max len

offset int32

in file read temp name
temp name
name header buffer offset
wstring wname msra strfun utf16 temp name
renam find wname renam

featur emplac back wname



featur emplac back renam wname

offset int8

in file read num col num col
num col int32 header buffer offset
offset int32

map num col featur back num col

int32 num label

in file read int32
max len

max len
free temp name
temp name malloc max len

offset int32

name header buffer offset
in file read temp name
temp name
wstring wname msra strfun utf16 temp name
renam find wname renam

label emplac back wname



featur emplac back renam wname
label emplac back renam wname

offset int8

num col int32 header buffer offset
in file read num col num col
offset int32
map num col label back num col

free temp name

offset start offset
data start offset start num batch int64

read microbatch size
in file seekg data start
in file read micro batch size int32
mb size size micro batch size

in file seekg
file size size in file tellg


elem type
spars binari input elem type random



random







elem type
spars binari input elem type fill read order size window size

read order nullptr

free read order

read order size malloc size window size
size window size

read order



elem type
spars binari input elem type read offset size start mb size num m bs

start mb start mb end mb start mb num m bs



offset nullptr

free offset

offset int64 malloc int64 num m bs
in file seekg offset start start mb int64
in file read offset int64 num m bs
start mb num m bs num batch

in file read offset num m bs int64



offset num m bs file size

start mb start mb
end mb start mb num m bs


elem type
spars binari input elem type shuffl

random

shuffl read order read order read order length random engin



elem type
spars binari input elem type start distribut minibatch loop size mb size size subset num size num subset


next mb

mb size mb size num subset

subset num subset num
num subset num subset

epoch size num batch num subset

size start mb epoch size subset num
size end mb epoch size subset num

size remaind num batch num subset

size remaind subset num
size remaind subset num

epoch size subset num remaind

start mb
end mb
window size end mb start mb

window size read order length

fill read order window size
read order length window size


shuffl

read offset start mb window size

max mb size
size window size

max mb size max mb size size offset offset
fprintf stderr offset offset

fprintf stderr size max mb size
size max mem 1024 1024 1024
size max pointer max mem max mb size
size max pointer

data buffer malloc max mb size
data to produc push data buffer


thread read data

read minibatch read order read order length

read data detach

elem type
spars binari input elem type get temp data pointer size num byte

temp valu size num byte

temp valu nullptr

free temp valu

temp valu size int32 num byte
temp valu malloc temp valu size

temp valu


elem type
share binari matrix elem type spars binari input elem type creat matrix wstring mat name devic id

share binari matrix elem type ret val nullptr

featur find mat name featur
find featur featur mat name featur

ret val make share spars binari matrix elem type mat name devic id mb size map num col mat name

label find mat name label
find label label mat name label

ret val make share dens binari matrix elem type mat name devic id mb size map num col mat name


ret val


elem type
spars binari input elem type read minibatch size read order size num to read

debug
marker seri seri read minibatch
diagnost span span seri read data
span read span

size num to read

debug
read span span seri get buffer

fprintf stderr start read
size read size offset read order offset read order
buffer get temp data pointer read size
debug
seri write flag get buffer

buffer data to produc
debug
read span
seri write flag buffer
read span span seri read data


in file clear
debug
seri write flag seek

in file seekg data start offset
debug
seri write flag read

in file read buffer read size
data to consum push buffer
fprintf stderr done read
debug
seri write flag done read push buffer
read span


data to consum push nullptr
debug
seri write flag done read



elem type
size spars binari input elem type read minibatch buffer wstring share binari matrix elem type matric


fprintf stderr start read minibatch

size read size offset batch offset batch
buffer get temp data pointer read size

fprintf stderr start read
in file clear
in file seekg data start offset batch
in file read buffer read size
fprintf stderr done read


int32
int32 cur mb size

int64 buffer offset

cur mb size int32 buffer buffer offset
buffer offset int32

int32 featur size

fprintf stderr read featur
int32 buffer buffer offset
buffer offset int32

elem type val elem type buffer buffer offset
buffer offset elem type

int32 row indic int32 buffer buffer offset
buffer offset int32

int32 col indic int32 buffer buffer offset
buffer offset int32 cur mb size

find mat matric find featur
find mat matric

find mat second
resiz array
add valu val
add row indic row indic
add col indic col indic cur mb size
updat n nz
ifdef debug
print featur




int32 label size

fprintf stderr read label
int32 num col map num col label

elem type val elem type buffer buffer offset
buffer offset elem type cur mb size num col

find mat matric find label
find mat matric

find mat second
add valu val cur mb size
ifdef debug
print label



size cur mb size


elem type
size spars binari input elem type fill matric wstring share binari matrix elem type matric


fprintf stderr start fill matric
size cur size
matric

second set max row mb size
second clear

buffer
fprintf stderr start
clock start clock
cur size micro batch size mb size buffer data to consum nullptr
cur size micro batch size mb size next mb epoch size

buffer data to consum
clock clock
start start
fprintf stderr start read took click second start start clock
start
fprintf stderr start read
cur size read minibatch buffer matric
fprintf stderr read
next mb
data to produc push buffer

fprintf stderr fill matric
cur size


elem type
config record type
lib svm binari reader elem type init from config config record type reader config


wstring wstring renam
renam matric reader config renam

reader config exist random

random string reader config random
random string

random

random string auto

time rawtim
timeinfo
time rawtim
timeinfo localtim rawtim
random timeinfo timeinfo timeinfo hour



random reader config random




random


partial minibatch
minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

wstring file reader config file

data input make share spars binari input elem type file
data input init renam

mb size size reader config minibatch
mb size

data input get mb size mb size

runtim error data file config file mismatch minibatch size





mb size data input get mb size


prefetch enabl


elem type
lib svm binari reader elem type destroy



elem type
lib svm binari reader elem type lib svm binari reader

destroy


elem type
lib svm binari reader elem type start minibatch loop size mb size size epoch size request epoch sampl

start distribut minibatch loop mb size epoch request epoch sampl


elem type
lib svm binari reader elem type start distribut minibatch loop size mb size size epoch size subset num size num subset size request epoch sampl

epoch epoch
mb size mb size
debug
reader seri

reader seri

reader seri marker seri base reader
read

data input start distribut minibatch loop mb size subset num num subset


elem type
lib svm binari reader elem type check data matric stream minibatch input matric

data matric

inmat matric

share binari matrix elem type data input creat matrix inmat first inmat second matrix get devic id
nullptr

data matric inmat first




elem type
lib svm binari reader elem type do dssm matrix matrix elem type size actual mb size

size num row get num row
dssm col actual mb size

dssm label nullptr

free dssm label
cuda page lock mem alloc free dssm label get devic id

dssm col actual mb size
dssm label elem type malloc elem type num row actual mb size
dssm label elem type cuda page lock mem alloc malloc elem type num row actual mb size get devic id
memset dssm label elem type num row actual mb size
size num row actual mb size num row

dssm label


get num col actual mb size

set valu num row actual mb size get devic id dssm label matrix flag normal



elem type
lib svm binari reader elem type tri get minibatch stream minibatch input matric

timer clock
debug
span minibatch span reader seri minibatch read

size actual mb size
prefetch enabl

pend async get minibatch valid

fprintf stderr valid
check data matric matric
pend async get minibatch async launch async

data input fill matric data matric


fprintf stderr
timer clock
debug
reader seri write flag

actual mb size pend async get minibatch
debug
reader seri write flag

timer clock timer
fprintf stderr done took click second timer timer clock

actual mb size




p mb layout init as frame mode actual mb size
debug
reader seri write flag start fill

matrix data matric

matric ha input matrix first
matrix second fill matric get input matrix elem type matrix first

debug
reader seri write flag done fill

matric ha input dssm label
do dssm matrix matric get input matrix elem type dssm label actual mb size

pend async get minibatch async launch async

check data matric matric
data input fill matric data matric


debug
read



timer clock timer
fprintf stderr took click second timer timer clock

fprintf stderr done



elem type
config record type
lib svm binari reader elem type renam matric config record type config wstring wstring renam

config get member id

config can be config record

config record type temp config
config paramet contain element
temp exist current renam


wstring temp renam
renam emplac msra strfun utf16 msra strfun utf16




elem type
lib svm binari reader elem type data end

data input data end


elem type
spars binari input elem type data end

instanti combin expect use
lib svm binari reader
lib svm binari reader

stdafx sourc file includ standard includ
dssm reader compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file
dllmain defin entri point applic
stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
lib svm binari reader

microsoft cntk

dataread get reader f i data reader preader

preader lib svm binari reader

dataread get reader d i data reader preader

preader lib svm binari reader




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
opencv2 opencv
byte reader

ifdef

microsoft cntk

get zip error

error error
error init code error
err s error strerror error
error fini error
err s


zip byte reader zip byte reader zip path
zip path zip path

zip path


zip byte reader zip ptr zip byte reader open zip


open zip path

runtim error fail open librari error zip path get zip error

zip ptr

nullptr
close

ifdef ndebug
unus




zip byte reader regist size seq id path

zip file zip creat open zip
stat stat
stat init stat
stat zip file path stat

runtim error fail file info librari error path get zip error
seq id to index seq id make pair stat index stat size
zip push move zip file


zip byte reader read size seq id path grayscal

find index file file
seq id to index find seq id
seq id to index
runtim error could find file file sequenc path seq id

uint64 index second
uint64 size second

content workspac creat size vector size
content size size
content resiz size
zip file zip creat open zip

uniqu file file file
fopen index zip file index
file

nullptr
fclose

ifdef ndebug
unus


nullptr file
nullptr file

runtim error could open file file sequenc librari error
path seq id get zip error error code error zip file

content size size
uint64 byte read fread file content size
byte read size
byte read size

runtim error byte read expect read file
byte read size path


zip push move zip file


grayscal
imdecod size 8 uc1 content imread grayscal

imdecod size 8 uc1 content imread color
nullptr
workspac push move content






copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
imag reader
config
imag config helper
imag transform
block random
no random
imag data deseri
frame packer


microsoft cntk

imag reader imag reader memori provid ptr provid
config paramet config
seed provid provid

futur deseri transform dynam load
extern librari base configur brain script
provid abil implement transform
deseri script languag well

imag config helper config helper config
stream config helper get stream
stream size

thread count config helper get cpu thread count
thread count

thread thread count


deseri make share imag data deseri config

transform ptr random
request multi thread random oper speed intens imag decod transform
multithread get next sequenc
config helper should random

legaci random
use legaci random
random make share block random deseri block random decim mode sequenc use legaci random multithread get next sequenc



random make share no random deseri multithread get next sequenc


random initi nullptr config

cropper make share crop transform
cropper initi random config

scaler make share scale transform
scaler initi cropper config

mean make share mean transform
mean initi scaler config

transform ptr last mean
config helper get data format

last make share transpos transform
last initi mean config


transform last

packer make share frame packer
provid
transform
stream


vector stream descript ptr imag reader get stream descript

stream
stream


imag reader start epoch epoch configur config

config total epoch size in sampl

runtim error epoch size cannot


transform start epoch config
packer start epoch config


minibatch imag reader read minibatch

packer nullptr
packer read minibatch



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul dword reason call lpvoid lp reserv




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
algorithm
unord
random
imag transform
config
conc stack
imag config helper
string util
element type util

microsoft cntk


imag sequenc data dens sequenc data

imag
copi preserv origin sequenc
sequenc data ptr origin


imag transform base initi transform ptr
config paramet reader config

base initi reader config
seed reader config seed

imag config helper config reader config
size featur stream id config get featur stream id
appli stream id push back featur stream id

input stream get input stream
output stream resiz input stream size
copi input stream input stream output stream


sequenc data ptr
imag transform base appli sequenc data ptr sequenc
stream descript input stream
stream descript output stream

input stream storag type storag type dens
input sequenc cast dens sequenc data sequenc
imag dimens dimens input sequenc sampl layout
column cast dimens width
row cast dimens height
channel cast dimens num channel

type id
input stream element type element type tdoubl

type id

input stream element type element type tfloat

type id



runtim error unsupport


result make share imag sequenc data
maketyp type id channel
buffer row column input sequenc
appli sequenc buffer
buffer is continu

buffer buffer



result origin sequenc

buffer is continu
result imag buffer
result buffer
result number of sampl input sequenc number of sampl

imag dimens output dimens buffer col buffer row buffer channel
result sampl layout make share tensor shape output dimens as tensor shape
result




crop transform initi transform ptr
config paramet reader config

imag transform base initi reader config
featur stream id get appli stream id

featur stream id size

runtim error onli singl featur stream support


init from config reader config get input stream featur stream id name


crop transform init from config config paramet config

crop type pars crop type config crop type

floatargvector crop ratio config crop ratio
crop ratio min crop ratio
crop ratio max crop ratio

crop ratio min crop ratio min
crop ratio max crop ratio max
crop ratio min crop ratio max

runtim error invalid crop ratio valu must crop min must
crop max


jitter type pars jitter type config jitter type

config exist current hflip

h flip crop type crop type random



h flip config hflip



crop transform appli size

seed get seed
rng creat
seed

make uniqu mt19937 seed


ratio
jitter type

ratio jitter type
ratio crop ratio min

ratio jitter type uni ratio
crop ratio min crop ratio max

ratio crop ratio min



ratio uni real t crop ratio min crop ratio max
crop ratio min ratio ratio crop ratio max



runtim error jitter current implement


view index crop type crop type multi view10

get crop rect crop type view index row col ratio
h flip bernoulli distribut
view index

flip


rng push move


crop transform crop type
crop transform pars crop type

are equal ignor case center

crop type center


are equal ignor case random

crop type random


are equal ignor case multiview10

crop type multi view10


runtim error invalid crop


crop transform ratio jitter type
crop transform pars jitter type

are equal ignor case none

ratio jitter type


are equal ignor case uniratio

ratio jitter type uni ratio


are equal ignor case unilength

ratio jitter type uni length


are equal ignor case uniarea

ratio jitter type uni area


runtim error invalid jitter


rect crop transform get crop rect crop type view index crow ccol
crop ratio mt19937

crow
ccol
crop ratio crop ratio

crop size cast crow ccol crop ratio
x off
y off


crop type center
view index
x off ccol crop size
y off crow crop size

crop type random
view index
x off uni int t ccol crop size
y off uni int t crow crop size

crop type multi view10

view index view index
corner center crop flip
isub view view index
isub view

left

x off
y off

right

x off ccol crop size
y off

bottom left

x off
y off crow crop size

bottom right

x off ccol crop size
y off crow crop size

center

x off ccol crop size
y off crow crop size








x off x off ccol crop size
y off y off crow crop size
rect x off y off crop size crop size




scale transform initi transform ptr
config paramet reader config

imag transform base initi reader config
interp map emplac nearest inter nearest
interp map emplac linear inter linear
interp map emplac cubic inter cubic
interp map emplac lanczo inter lanczos4

featur stream id get appli stream id

featur stream id size

runtim error onli singl featur stream support


featur get input stream featur stream id
data type featur element type element type tfloat

init from config reader config featur name


scale transform init from config config paramet config

img width config width
img height config height
img channel config channel

size cfeat img width img height img channel
cfeat cfeat numer limit size
runtim error invalid imag dimens

interp clear
stringstream config interpol
token getlin token

explicit cast requir
transform token token token
tolow
str to int map t iter interp map find token
interp map
interp push back second


interp size
interp push back inter linear


scale transform appli size

unus
matrix convert right rescal
requir float point

maketyp data type img channel

convert to data type


seed get seed
rng creat
seed

make uniqu mt19937 seed



index uni int t cast interp size
interp size
resiz

size cast img width cast img height
interp index

rng push move




mean transform initi transform ptr
config paramet reader config

imag transform base initi reader config

featur stream id get appli stream id

featur stream id size

runtim error onli singl featur stream support


init from config reader config get input stream featur stream id name


mean transform init from config config paramet config

wstring mean file config mean file
mean file
mean img releas


file storag
review alexeyk sort defeat purpos wstring
fseid open cv problem
open msra strfun utf8 mean file file storag read
is open
runtim error could open file mean file
mean img mean img
cchan
channel cchan
crow
crow
ccol
ccol
cchan crow ccol
mean img channel mean img row mean img col
runtim error invalid file mean file
releas
mean img mean img reshap cchan crow



mean transform appli size

unus
mean img size size
mean img size size
mean img channel channel

review alexeyk check convers
mean img size size

mean img



transpos transform initi transform ptr
config paramet reader config

transform base initi reader config

current support singl stream
imag config helper config reader config
size featur stream id config get featur stream id
appli stream id push back featur stream id

input stream get input stream
output stream resiz input stream size
copi input stream input stream output stream

appli stream id

stream input stream

imag dimens dimens stream sampl layout

chang nhwc nchw
chang stream make share stream descript stream
chang stream sampl layout make share tensor shape dimens as tensor shape
output stream chang stream



sequenc data ptr
transpos transform appli sequenc data ptr input sequenc
stream descript input stream
stream descript output stream

input stream element type element type tdoubl

type appli input sequenc input stream output stream


input stream element type element type tfloat

type appli input sequenc input stream output stream


runtim error unsupport


repres sequenc own buffer
pass transpos transform
todo trasposit potenti could done place
dens sequenc with buffer dens sequenc data

vector buffer


t elem type
sequenc data ptr
transpos transform type appli sequenc data ptr sequenc
stream descript input stream
stream descript output stream

input stream storag type storag type dens
input sequenc cast dens sequenc data sequenc
input sequenc number of sampl
input stream sampl layout get num element output stream sampl layout get num element

size count input stream sampl layout get num element get size by type input stream element type

result make share dens sequenc with buffer
result buffer resiz count

imag dimens dimens input stream sampl layout imag layout kind
size row count dimens height dimens width
size channel count dimens num channel

reinterpret cast t elem type input sequenc
reinterpret cast t elem type result buffer

size irow irow row count irow

size icol icol channel count icol

icol row count irow irow channel count icol



result sampl layout output stream sampl layout
result result buffer
result number of sampl input sequenc number of sampl
result




copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
reader shim
imag reader
heap memori provid
cuda memori provid

microsoft cntk

todo memori provid inject

factori config paramet paramet reader ptr

make share imag reader make share heap memori provid paramet


dataread get reader f i data reader preader

preader reader shim factori


dataread get reader d i data reader preader

preader reader shim factori




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
imag config helper
string util

microsoft cntk

vector get section with paramet config paramet config paramet name

vector section name
pair config paramet section config

section second exist current paramet name

section name push back section first



section name

runtim error imag reader requir paramet paramet name


section name


imag config helper imag config helper config paramet config
data format

vector featur name get section with paramet config width
vector label name get section with paramet config label dim

review alexeyk current support featur label section
featur name size label name size

runtim error
imag reader current support singl featur label stream featur label found
cast featur name size
cast label name size


config paramet featur section config featur name
size featur section width
size featur section height
size featur section channel

mb fmt featur section mb format nchw
are equal ignor case mb fmt nhwc are equal ignor case mb fmt legaci

data format

are equal ignor case mb fmt nchw are equal ignor case mb fmt cudnn

runtim error imag reader support sampl format nchw nhwc support mb fmt


featur make share stream descript
featur
featur name msra strfun utf16 featur section config name
featur sampl layout make share tensor shape imag dimens as tensor shape data format
featur storag type storag type dens
stream push back featur

config paramet label config label name
size label dimens label label dim

label section make share stream descript
label section
label section name msra strfun utf16 label config name
label section sampl layout make share tensor shape label dimens
label section storag type storag type dens
stream push back label section

map path config file

grayscal config grayscal
rand config random

are equal ignor case rand

random

are equal ignor case rand none

random



runtim error random paramet must none


identifi precis
precis config find precis
are equal ignor case precis

featur element type element type tfloat
label section element type element type tfloat

are equal ignor case precis

featur element type element type tdoubl
label section element type element type tdoubl



runtim error support precis expect precis


cpu thread count config num cpu thread

multi view crop are equal ignor case featur section crop type multiview10


vector stream descript ptr imag config helper get stream

stream


size imag config helper get featur stream id

current support singl featur label stream index hard wire



size imag config helper get label stream id

current support singl featur label stream index hard wire



imag config helper get map path

map path



copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
inttyp
opencv2 opencv
numer
limit
imag data deseri
imag config helper

microsoft cntk

imag data deseri label gener


creat label for size class id spars sequenc data
label gener


helper gener type label spars format
label categori imag belong
repres index categori zero valu categori imag belong
singl categori belong
parameter represent specif
t element
type label gener imag data deseri label gener


type label gener size label dimens valu indic label dimens

label dimens numer limit index type

runtim error label dimens pr iu64 exce maximum allow
valu pr iu64 label dimens size numer limit index type

iota indic indic


creat label for size class id spars sequenc data

nnz count resiz
nnz count
total nnz count
valu
indic indic class id



t element valu
vector index type indic


use keep track imag access dens sequenc data
deseri imag dens sequenc data

imag


imag chunk correspond singl imag
imag data deseri imag chunk chunk enabl share imag chunk

imag sequenc descript descript
imag data deseri parent


imag chunk imag sequenc descript descript imag data deseri parent
descript descript parent parent



get sequenc size sequenc id vector sequenc data ptr result

sequenc id descript
imag sequenc descript

imag make share deseri imag
imag imag move parent read imag descript imag sequenc path parent grayscal
cv imag imag imag

cv imag

runtim error cannot open file imag sequenc path


convert element
data type parent featur element type element type tfloat
cv imag maketyp data type cv imag channel

cv imag convert to cv imag data type


cv imag is continu

cv imag cv imag

cv imag is continu

imag imag imag
imag dimens dimens cv imag col cv imag row cv imag channel
imag sampl layout make share tensor shape dimens as tensor shape
imag sequenc id
imag number of sampl
imag chunk share
result push back imag

spars sequenc data ptr label make share spars sequenc data
label chunk share
parent label gener creat label for imag sequenc class id label
label number of sampl
result push back label



imag data deseri imag data deseri config paramet config

imag config helper config helper config
stream config helper get stream
stream size
grayscal config helper use grayscal
label stream config helper get label stream id
featur stream config helper get featur stream id

expect
imag dimens dimens featur sampl layout config helper get data format
featur sampl layout make share tensor shape dimens as tensor shape

label storag type storag type spars
featur storag type storag type dens

featur element type featur element type
size label dimens label sampl layout get dim

label element type element type tfloat

label gener make share type label gener label dimens

label element type element type tdoubl

label gener make share type label gener label dimens



runtim error unsupport label element label element type


creat sequenc descript config helper get map path label dimens config helper


descript chunk expos imag reader
chunk descript imag data deseri get chunk descript

chunk descript result
result reserv imag sequenc size
imag sequenc

chunk make share chunk descript
chunk chunk id
chunk number of sampl
chunk number of sequenc
result push back chunk


result


imag data deseri get sequenc for chunk size chunk id vector sequenc descript result

current singl sequenc chunk
result push back imag sequenc chunk id


imag data deseri creat sequenc descript map path size label dimens imag config helper config

ifstream map file map path
map file

runtim error could open read map path


size item per line config is multi view crop
size cur id
line
path reader map known reader
imag sequenc descript descript
descript number of sampl
descript is valid

size line index getlin map file line line index

stringstream line
imag path
class id
getlin imag path getlin class id
runtim error invalid file format must contain delimit column line pr iu64 file line index map path

eptr
errno
size strtoull class id eptr
class id eptr errno erang
runtim error cannot pars label valu line pr iu64 second column file line index map path

label dimens

runtim error
imag invalid pr iu64 expect label dimens pr iu64 line pr iu64 file
imag path label dimens line index map path


size start cur id cur id start item per line cur id

descript cur id
descript chunk id cur id
descript path imag path
descript class id
descript major descript
descript minor

imag sequenc push back descript
regist byte reader descript descript path known reader




chunk ptr imag data deseri get chunk size chunk id

sequenc descript imag sequenc chunk id
make share imag chunk sequenc descript


imag data deseri regist byte reader size seq id path path reader map known reader

path

at po path find first
contain plain imag file
at po npo

review alexeyk contain support
ifdef
at po
at po path length
contain path path substr at po
skip path separ
item path path substr at po
zlib support path separ
replac item path item path
share byte reader reader
known reader find contain path
known reader

reader make share zip byte reader contain path
known reader contain path reader



reader second

reader regist seq id item path
reader seq id reader

unus seq id
unus known reader
runtim error code built without contain support onli plain imag file support



imag data deseri read imag size seq id path grayscal

path

imag data deseri seq reader map iter
reader reader find seq id reader
default reader read seq id path grayscal
second read seq id path grayscal


file byte reader read size path grayscal

path

grayscal
imread path imread grayscal

imread path imread color



copyright microsoft right reserv
licens licens licens file project root full licens inform

uci fast reader defin export function applic


stdafx
defin dataread export creat export
data reader
uci fast reader
ifdef leakdetect
leak detect

fileutil fexist

microsoft cntk

elem type
size uci fast reader elem type random sweep size mb start sampl

size random rang per epoch epoch size random rang random rang
epoch random rang per epoch epoch sampl random rang
mb start sampl random rang


read line read line
read sampl sampl read sampl space
return success read record otherwis
elem type
uci fast reader elem type read record size read sampl

use


record to read determin record read popul record buffer
mb start sampl start sampl read
tail check possibl remain record read
return read dataset
elem type
size uci fast reader elem type record to read size mb start sampl tail

mb start sampl epoch start sampl
determin ahead need read
random random
need read minibatch
size epoch sampl mb start sampl
epoch sampl epoch size

determin left read epoch
size number to epoch epoch size epoch sampl
take either minibatch left epoch
size number to read number to epoch mb size
number to read tail
number to read mb size

random

size random sweep random sweep mb start sampl
first read read take anoth random rang
need read least random rang record
random sweep randomord current seed rang chang sinc last time

number to read round up epoch sampl random rang epoch sampl
number to read tail
number to read random rang


number to read


ensur data avail read enough line request minibatch start request
mb start sampl start sampl ensur good
end of data check check dataset wraparound
return read dataset
elem type
uci fast reader elem type ensur data avail size mb start sampl end of data check

mb start sampl epoch start sampl
determin ahead need read
random
need read minibatch
size epoch sampl mb start sampl
epoch sampl epoch size
more to read

size number to read record to read mb start sampl

check proper record read alreadi
read next sampl mb start sampl number to read mb start sampl epoch start sampl


truncat present array locat read parser append array
featur data size epoch sampl featur count size truncat
featur data resiz epoch sampl featur count
label type label categori label data size epoch sampl

label id data resiz epoch sampl
label data resiz epoch sampl

label type label none label data size epoch sampl label dim

label data resiz epoch sampl label dim


record read


num read parser pars number to read record read featur data label data

record read num read
end reach
total sampl num read total record dataset

less record request dataset
record read number to read

updat dataset variabl
size addit to read updat data variabl mb start sampl record read

parser set file posit make anoth dataset

check
partial minibatch found
end of data check record read
partial minibatch record read

more to read



addit read
number to read record read addit to read

record read number to read
read next sampl record read

categori label need build map tabl
label type label categori

newli read record
number read number read record read number read

label type label label data epoch sampl number read
check seen label
valu map label to id find label
label id type label id
valu map label to id

label file to write
runtim error label found specifi label map file label
label map tabl
map label to id label label id max
map id to label label id max label
label id label id max

label dimens lower current label id increas
label dim label id max
label dim label id max



label id valu second


label label
label id data push back label id


read alway want partial minibatch
more to read


updat data variabl updat variabl depend dataset complet read
elem type
size uci fast reader elem type updat data variabl size mb start sampl

file
end reach

size dataset
total sampl featur count featur data size

want determin epoch size base dataset size
epoch size request data size

epoch size multipl mb size random rang
partial minibatch
epoch size total sampl


size round up to mb size
random rang random auto random rang random none
round up to random rang
epoch size round up total sampl round up to



make sure random rang within sampl bound
random rang epoch size

random rang epoch size
randomord resiz random rang random rang


write label file file
write label file

dataset
end reach


updat label dimens enough need label id max updat process read
label type label categori label id max label dim
label dim label id max updat label dimens differ

record to read mb start sampl epoch start sampl epoch size still read potenti epoch size chang
record to read record to read mb start sampl


elem type
uci fast reader elem type write label file

write label file
label file to write

map id to label size

file label file label file to write file option write file option text
map id to label size

label file map id to label

fprintf stderr label file written disk label file to write
label file to write clear

cach writer

fprintf stderr warn file written disk written first time entir dataset found label file to write




destroy cleanup remov
note destroy use past point
elem type
uci fast reader elem type destroy




init reader initi multipl set
config configur paramet dataread
sampl format
paramet valu reader
reader
reader
reader type uci fast reader
mini batch mode partial
random
featur

start
file speech mnist mnist test

label

start
file speech mnist mnist test
label map file speech mnist label
label dim
label type categori


elem type
config record type
uci fast reader elem type init from config config record type reader config

custom delimit point
custom delimit str reader config custom delimit
custom delimit custom delimit str custom delimit str

custom decim point str reader config custom decim point
custom decim point custom decim point str custom decim point str

parser make share uci parser elem type label type custom delimit custom decim point

user want cach
cach reader
cach writer

initi cach
init cach reader config

cach need pars text file
cach reader


vector wstring featur
vector wstring label
get file config name reader config featur label
featur size

featur name featur
reader config exist featur name bugbug ever fire abl name first place
runtim error featur file found requir configur featur file myfil start

label size

label name label

ha label reader config exist label name
ha label
fprintf stderr warn label specifi

config record type config featur reader config featur name config record type record
config record type config label reader config label name config record type record

determin label desir
wstring label type
ha label
label type none

label type wstring config label label type categori

equal ci label type none config featur file config label file
runtim error featur label file must file separ reader defin singl file

size vdim config featur
name config featur name todo aaargh
size udim config label label dim size

initi variabl
mb start sampl epoch total sampl epoch start sampl
label id max label dim
partial minibatch end reach
label type label categori
featur count vdim
read next sampl
trace level reader config trace level
parser set trace level trace level

prefetch enabl reader config prefetch
featur count least better featur
featur count

reader config exist random

random string reader config random
equal ci random string none

random rang random none

equal ci random string

random rang random auto



random rang reader config random




random rang random auto


determin partial minibatch desir
minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

start dimens label featur
size start label config label start size
size dim label config label size

size start featur config featur start size
size dim featur config featur size


convert lower insensit comparison
equal ci label type categori

label type label categori

equal ci label type regress

label type label regress

equal ci label type none

label type label none
dim label label


wstring file config featur file
trace level
fprintf stderr read file file

simpl heurist buffer size avoid break exist experi
size buf size dim featur size 1024
parser pars init file start featur dim featur start label dim label buf size

label label categor valu need label map file file label line
label type label categori

wstring label path config label label map file
fexist label path

todo cntk config reader with brain script would pars file local easi
config array array label
array label load config file label path
array label size

label type label array label
map id to label label
map label to id label

label id max label id type array label size



label creation allow flag done separ command
label file exist verif step train
allow label creation reader config allow map creation
allow label creation
label file to write label path

runtim error label map file found creat creat label map command action label path


valu pass udim enough someth
udim label id max
udim label id max
label dim label id type udim



label dim label id type dim label


know size random resiz otherwis wait know epoch size start minibatch loop
random random rang random auto
randomord resiz random rang random rang

m one line per file reader config one line per file


init cach initi cach reader cach file exist otherwis writer
reader config reader configur
elem type
uci fast reader elem type init cach scriptabl object i config record reader config

check writer first let know cach
reader config exist writer type
invalid argument uci fast reader cach writer type current support brain script
brain script cannot support manipul config record scriptabl object support i conig record immut
todo could implement overlay i config record implement fake valu ad
brain script also cannot support copi reader config kept i config record copyabl
todo could copi i config record ptr that allow trivial magic

elem type
uci fast reader elem type init cach config paramet reader config

first time call cach paramet
note thi littl ugli artifact integr brain script sinc brain script allow copi config move copi code config paramet implement
reader config reader config
reader config copi to reader config

check writer first let know cach
reader config exist writer type


first open binari cach
found


todo need level mayb search section type
config array file list
vector wstring name
reader config exist wfile

file list push back reader config wfile
fexist reader config wfile
found

find config name reader config wfile name
name name

config paramet config reader config name
file list push back config wfile
fexist config wfile
found


file alreadi go read cach file
found

config paramet config
reader config copi to config
mmodifi config reader type look correct
config reader type config writer type
config file file list
cach reader data reader config



cach writer data writer reader config

section name categori type
wstring section type nocas compar section
cach writer get section section
pair section

pair second section type categori label

label categori name pair first

pair second section type label map

label map name pair first




runtim error

cach reader writer cannot creat grace fail disabl cach
fprintf stderr error attemp creat binari found reader writer
cach reader
cach reader
cach writer
cach writer



error
fprintf stderr error attemp creat binari found reader writer
cach reader
cach reader
cach writer
cach writer



destructor get call properli
elem type
uci fast reader elem type uci fast reader

releas memori
cach reader
cach writer


releas memori releas memori footprint uci fast reader
use cach reader take
elem type
uci fast reader elem type releas memori

featur buffer
label buffer
label id buffer
featur data clear
label id data clear
label data clear


setup epoch setup proper posit file variabl set start particular epoch
elem type
uci fast reader elem type setup epoch

start fresh epoch zero read init everyth
howev cach writer need know record count first
epoch total sampl cach writer

read next sampl epoch start sampl mb start sampl
parser set file posit

otherwis posit read start right locat

know total sampl count
total sampl

trace level
fprintf stderr uci fast reader start epoch count line determin record count epoch
parser set pars mode pars line count
total sampl parser pars size
parser set pars mode pars normal
parser set file posit
mb start sampl
updat data variabl updat variabl sinc read
trace level
fprintf stderr record found total sampl


make sure correct locat dataset epoch
size mb start sampl epoch epoch size

size file record total sampl mb start sampl total sampl
fprintf stderr start epoch record count file posit epoch mb start sampl file record
size current file record mb start sampl total sampl

reset read sampl
read next sampl mb start sampl
current file record file record

fprintf stderr alreadi last epoch

slight delima determin file
user told find mani record file distinguish almost done
file charact away middl file read ahead record
end reach end reach
end reach

parser ha more data

end reach
updat data variabl mb start sampl
end reach


move read pointer sinc everyth alreadi memori
end reach epoch start sampl total sampl file record featur data size epoch size featur count

read next sampl mb start sampl epoch size
write label file make sure somewher know entir dataset read point
write label file


right posit need


alreadi past desir record start begin
current file record file record

parser set file posit
current file record

fprintf stderr read record posit properli epoch current file record file record
parser set pars mode pars line count
parser pars file record current file record
parser set pars mode pars normal
label file to write

fprintf stderr warn file written disk label file written start epoch begin dataset label file to write
label file to write clear
runtim error label map file provid config must provid start epoch zero


epoch start sampl mb start sampl mb start sampl



util round integ multipl size
size round up size valu size size

valu size size size


elem type
uci fast reader elem type set num parallel sequenc size

m request num parallel sequenc
m one line per file
mb size m request num parallel sequenc


start minibatch loop startup minibatch
mb size size minibatch sampl
epoch epoch request epoch sampl must specifi epoch zero complet
request epoch sampl sampl random default request data size use sampl dataset
valu must multipl mb size round
elem type
uci fast reader elem type start distribut minibatch loop size mb size size epoch size subset num size num subset size request epoch sampl request data size

subset num subset num
num subset num subset
m one line per file
mb size m request num parallel sequenc file observ therefor read file

current cach cach
cach reader cach writer

init cach reader config
cach reader
releas memori free memori use uci fast reader


read cach
cach reader

cach reader start minibatch loop mb size epoch request epoch sampl



realloc bigger releas origin
mb size mb size

featur buffer
label buffer
label id buffer


mb size mb size
request epoch sampl request data size

end reach

epoch size request data size




epoch size request epoch sampl
partial minibatch
epoch size round up request epoch sampl mb size
epoch size request epoch sampl
fprintf stderr epoch size round integr minibatch epoch size


random rang random auto
invalid less minibatch size need make least minibatch size
random rang random none

epoch size request data size random rang random auto

random rang epoch size

random rang random rang mb size
random rang random auto

epoch size request data size epoch size random rang random rang mb size
runtim error random rang must even multipl mb size integr factor epoch size
randomord resiz random rang random rang



epoch size might valu alloc
size epoch size epoch size request data size 1000 epoch size
epoch epoch
mb start sampl epoch epoch size

alloc room
featur data reserv featur count epoch size
label type label categori

label id data reserv epoch size
label data reserv epoch size

label type label none
label data reserv label dim epoch size

setup epoch


store label type elem type
requir label store elem type array
elem type
uci fast reader elem type store label elem type label store label type label valu

label store elem type map label to id label valu


get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
uci fast reader elem type tri get minibatch stream minibatch input matric

minibatch remain
pend async get minibatch valid

async get minibatch flight wait finish swap
content prefetch matric paramet matric
minibatch remain pend async get minibatch

swap prefetch matric paramet matric
iter matric

prefetch matric find iter first prefetch matric
logic error get minibatch match prefetch matrix found matrix name iter first

swap matric get input matrix elem type iter first prefetch matric get input matrix elem type iter first bugbug thi swap matrix structur directli mess ownership sure deep copi
matrix elem type prefetch matrix prefetch matric iter first
swap iter second prefetch matrix




minibatch remain get minibatch impl matric

alloc prefetch matric fire async minibatch prefetch
minibatch remain prefetch enabl

creat matrix everi output
prefetch matric clear

iter matric
prefetch matric add input iter first make share matrix elem type iter second matrix get devic id iter second p mb layout iter second sampl layout



fire prefetch minibatch remain
minibatch remain prefetch enabl

matrix elem type featur matric get input matrix elem type featur name
devic id featur get devic id
pend async get minibatch async launch async devic id

devic sinc execut thread
matrix elem type set devic devic id

stream minibatch input prefetch matric
iter prefetch matric
prefetch matric add input iter first iter second
todo prefetch matric

get minibatch impl prefetch matric



minibatch remain


get minibatch impl actual implement get minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
uci fast reader elem type get minibatch impl stream minibatch input matric

cach reader

cach reader get minibatch matric

featur
matric find featur name matric
runtim error featur matrix found config file node network featur name

matrix elem type featur matric get input matrix elem type featur name

call start minibatch loop first bugbug
mb size


check chang epoch done
mb start sampl epoch size epoch


random random
more data ensur data avail mb start sampl

figur sweep random
size epoch sampl mb start sampl epoch size minibatch start epoch
size sampl extra total sampl epoch size extra sampl epoch
size epoch ds total sampl epoch size epoch size mani epoch dataset
size random set random random sweep mb start sampl
tmap randomord random set
size epoch end epoch size
size record start total sampl mb start sampl total sampl mb start sampl

actual size either request total sampl read
size actualmbs total sampl mb size still less sweep

check size last minibatch
epoch sampl actualmbs epoch end

actualmbs epoch end epoch sampl


dataset mode
more data

make sure take account hit dataset wrap around
actualmbs total sampl record start actualmbs


featur buffer

featur buffer alloc intermedi buffer featur get devic id mb size featur count
memset featur buffer elem type mb size featur count


label buffer

label type label categori

label buffer alloc intermedi buffer featur get devic id label dim mb size
label id buffer share label id type label id type mb size label id type




label type label none

label buffer alloc intermedi buffer featur get devic id label dim mb size
label id buffer



label type label categori

memset label buffer elem type label dim actualmbs
memset label id buffer label id type actualmbs

label type label none

memset label buffer elem type label dim actualmbs


actualmbs

copi matrix
vector vector featur
determin random index
size rand base keep compil happi
random
rand base epoch sampl epoch sampl random rang

sampl
size j sampl mb start sampl actualmbs j sampl

pick right sampl random desir
size j rand random rand base tmap j sampl random rang j sampl
j rand epoch size bugbug make random insid epoch size enough

vector featur goe matrix column
memcpi featur buffer featur count featur data j rand featur count elem type featur count

label type label categori

label buffer label dim label id data j rand elem type
label id buffer label id data j rand

label type label none

size label dim

elem type elem type atof label data j rand label dim
label buffer label dim





there multipl parallel trainer read time
slice share current trainer subset
size curr subset start col actualmbs subset num num subset
size curr subset end col actualmbs subset num num subset
size curr subset size curr subset end col curr subset start col
creat respect mb layout
everi sampl return sequenc frame
p mb layout init as frame mode curr subset size

write cach writer
cach writer subset num

wstring nocas compar write buffer
write buffer featur name featur buffer
label type label categori

write buffer label name label id buffer
label categori name
write buffer label categori name label buffer

label type label none

write buffer label name label buffer


write second comput statist need
more to write cach writer save data mb start sampl write buffer actualmbs total sampl

done write
more to write

write map tabl necessari
label type label categori label map name

cach writer save map label map name map id to label


write label file

close cach writer
cach writer
cach writer



advanc minibatch
mb start sampl actualmbs

want partial minibatch skip transfer
actualmbs mb size partial minibatch actualmbs curr subset size record found minibatch




transfer need
featur set valu featur count curr subset size featur get devic id featur buffer featur count curr subset start col matrix flag normal
label type label none

matric ha input label name

label matric get input matrix elem type label name
label set valu label dim curr subset size label get devic id label buffer label dim curr subset start col matrix flag normal



read record process



get label map get label map integ index label
return numer datatyp label
elem type
i data reader label id type i data reader label type uci fast reader elem type get label map wstring section name

cach reader

cach reader get label map section name

map id to label


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
uci fast reader elem type set label map wstring section name label id type label type label map

cach reader

runtim error cannot map tabl cach reader use

map id to label label map
map label to id clear
pair label type label map

map label to id second first



get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
elem type
uci fast reader elem type get data wstring section name size num record size data buffer size size record start

cach reader

cach reader get data section name num record data buffer size record start

runtim error get data support uci fast reader


elem type
uci fast reader elem type data end

cach reader
cach reader data end




elem type
uniqu cuda page lock mem alloc uci fast reader elem type get cuda alloc devic id

cuda alloc nullptr

cuda alloc get devic id devic id

cuda alloc reset nullptr



cuda alloc nullptr

cuda alloc reset cuda page lock mem alloc devic id


cuda alloc


elem type
share elem type uci fast reader elem type alloc intermedi buffer devic id size num element

devic id

pin memori devic better copi perform
size total size elem type num element
share elem type elem type get cuda alloc devic id malloc total size devic id elem type

get cuda alloc devic id free




share elem type elem type num element elem type






instanti combin expect use
uci fast reader
uci fast reader

stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
uci fast reader

microsoft cntk

dataread get reader f i data reader preader

preader uci fast reader

dataread get reader d i data reader preader

preader uci fast reader




copyright microsoft right reserv
licens licens licens file project root full licens inform

uci parser pars format custom state machin speed


stdafx
basic
uci parser
stdexcept
stdint

win32
defin ftell64 ftelli64

defin ftell64 ftell


set state particular valu
num type label type
uci parser num type label type set state valu pars state current state pars state state

dword dword state
rang shift current state
state tabl rang shift valu


set state rang state transit rang valu
num type label type
uci parser num type label type set state rang value1 value2 pars state current state pars state state

dword dword state
rang shift current state
valu value1 valu value2 valu

state tabl rang shift valu



setup state tabl setup state transit tabl state
state block state index incom charact
num type label type
uci parser num type label type setup state tabl custom delimit custom decim point

custom delimit custom decim point custom delimit
invalid argument delimit point cannot


state whitespac


set state rang whitespac label
set state rang whitespac whole number
set state whitespac sign
set state whitespac sign

whitespac
set state whitespac whitespac
set state whitespac whitespac
set state whitespac whitespac
set state whitespac end of line
custom delimit
set state custom delimit whitespac whitespac


state neg sign


set state rang sign label
set state rang sign whole number
whitespac
set state sign whitespac
set state sign whitespac
set state sign whitespac
set state sign end of line
custom delimit
set state custom delimit sign whitespac


state number


set state rang whole number label
set state rang whole number whole number
custom decim point
set state custom decim point whole number period

set state whole number period

set state whole number the letter e
set state whole number the letter e
whitespac
set state whole number whitespac
set state whole number whitespac
set state whole number whitespac
set state whole number end of line
custom delimit
set state custom delimit whole number whitespac


state period


set state rang period label
set state rang period remaind
whitespac
set state period whitespac
set state period whitespac
set state period whitespac
set state period end of line
custom delimit
set state custom delimit period whitespac


state remaind


set state rang remaind label
set state rang remaind remaind
set state remaind the letter e
set state remaind the letter e
whitespac
set state remaind whitespac
set state remaind whitespac
set state remaind whitespac
set state remaind end of line
custom delimit
set state custom delimit remaind whitespac


state letter


set state rang the letter e label
set state rang the letter e expon
set state the letter e expon sign
set state the letter e expon sign
whitespac
set state the letter e whitespac
set state the letter e whitespac
set state the letter e whitespac
set state the letter e end of line
custom delimit
set state custom delimit the letter e whitespac


state expon neg sign


set state rang expon sign label
set state rang expon sign expon
whitespac
set state expon sign whitespac
set state expon sign whitespac
set state expon sign whitespac
set state expon sign end of line
custom delimit
set state custom delimit expon sign whitespac


state expon


set state rang expon label
set state rang expon expon
whitespac
set state expon whitespac
set state expon whitespac
set state expon whitespac
set state expon end of line
custom delimit
set state custom delimit expon whitespac


state line

set state rang end of line label
set state rang end of line whole number
set state end of line sign
set state end of line end of line
whitespac
set state end of line whitespac
set state end of line whitespac
set state end of line whitespac
custom delimit
set state custom delimit end of line whitespac


state label

set state rang label label
set state label end of line
whitespac
set state label whitespac
set state label whitespac
set state label whitespac
custom delimit
set state custom delimit label whitespac


state line count

set state rang line count eol line count other
set state line count eol line count eol


state line count other

set state rang line count other line count other
set state line count other line count eol


reset line state variabl
num type label type
uci parser num type label type prepar start line

number convert thi line
label convert thi line
element convert thi line
space delimit start byte counter
space delimit max byte counter
last label is string


reset accumul variabl
num type label type
uci parser num type label type prepar start number

partial result
built up number
divid
whole number multipli
expon multipli


reset state variabl start read posit
num type label type
uci parser num type label type prepar start posit size posit

current state whitespac
byte counter posit must come prepar start line
buffer start posit

prepar state machin line
prepar start number
prepar start line
total number convert
total label convert


uci parser
num type label type
uci parser num type label type uci parser custom delimit custom decim point

init custom delimit custom decim point


setup state variabl state tabl state machin
num type label type
uci parser num type label type init custom delimit custom decim point

prepar start posit
file buffer
p file
state tabl dword all state max
setup state tabl custom delimit custom decim point


parser destructor
num type label type
uci parser num type label type uci parser

state tabl
file buffer
p file
fclose p file


done with label call label found
num type label type
uci parser num type label type done with label

current counter
space delimit max space delimit start
space delimit max byte counter

label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
fprintf stderr string found numer file label
label convert thi line
element convert thi line
last label is string

prepar start number


call complet
num type label type
uci parser num type label type done with valu

store
number

num type final result
current state expon

final result num type partial result expon multipli built up number

divid

final result num type partial result built up number divid



final result num type built up number


final result num type final result whole number multipli

label store label locat instead locat
index element convert thi line
store
start label index index start label dim label

store label final result
store

start featur index index start featur dim featur

number push back final result
total number convert
number convert thi line
element convert thi line
last label is string
store

store anyth need skip current increment
store

element convert thi line



prepar start number


store label special label type
num type label type
uci parser num type label type store label num type valu

label push back label type valu
total number convert
number convert thi line
element convert thi line
last label is string


store last label store last label numer type tranfer label vector
label type handl special
num type label type
uci parser num type label type store last label

last label is string file format error last label
num type valu number back
number back
label push back label type valu


pars init initi pars file
file name path file open
start featur column zero base featur start
dim featur featur
start label column zero base label start
dim label label
buffer size size temporari buffer store read
start posit file posit start
num type label type
uci parser num type label type pars init lpcwstr todo chang file name size start featur size dim featur size start label size dim label size buffer size size start posit

file name
start label start label
dim label dim label
start featur start featur
dim featur dim featur
pars mode pars normal
trace level
buffer size buffer size
buffer start start posit

file alreadi open cleanup
p file
uci parser num type label type uci parser

errno wfopen p file file name

runtim error uci parser pars init error open file file name
fseeki64 p file seek

runtim error uci parser pars init error seek file file name

file size get file posit
file buffer byte buffer size
set file posit start posit


get file posit current file posit text file
return current posit file
num type label type
int64 uci parser num type label type get file posit

int64 posit ftell64 p file
posit
runtim error uci parser get file posit error retriev file posit file
posit


set file posit current file posit begin file read first block
state machin mode initi similar begin file
recommned valu get file posit known start line
zero pass
num type label type
uci parser num type label type set file posit int64 posit

fseeki64 p file posit seek

runtim error uci parser set file posit error seek file

setup state machin start posit
prepar start posit posit

read first buffer posit first buffer expect read reposit
updat buffer

futur debug could valid valu either previou charact


ha more data test current dataset whitespac
return
num type label type
uci parser num type label type ha more data

byte counter byte counter
size buffer index byte counter buffer start

test without move parser state
byte counter file size byte counter buffer index

reach buffer assum
right time close enough
buffer index buffer size


file buffer buffer index
pars state next state pars state state tabl whitespac
next state whitespac next state end of line





updat buffer load buffer full
return record read
num type label type
size uci parser num type label type updat buffer

state machin might want look back copi begin
size save byte byte counter space delimit start
save byte buffer size
save byte

memcpi file buffer buffer size file buffer byte counter buffer start save byte save byte
buffer start byte counter save byte


read block
size byte to read buffer size file size buffer start save byte
size byte read fread file buffer save byte byte to read p file
byte read ferror p file
runtim error uci parser updat buffer error read file
byte read


num type label type
uci parser num type label type set pars mode pars mode mode

alreadi mode noth
pars mode mode


switch mode
mode pars line count
current state line count other


current state whitespac
prepar start line
prepar start number

pars mode mode


set trace level level screen output
trace level trace level zero mean output epoch relat output output
num type label type
uci parser num type label type set trace level trace level

trace level trace level


pars pars
record request record request
number pointer vector number must alloc
label pointer vector label default
return record actual read file reach valu request record
num type label type
uci parser num type label type pars size record request vector num type number vector label type label

number dim featur pars mode pars line count
label dim label pars mode pars line count

transfer member variabl
number number
label label

tick start get tick count
record count
size buffer index byte counter buffer start
byte counter file size record count record request

check need updat buffer
buffer index buffer size

updat buffer
buffer index byte counter buffer start


file buffer buffer index

pars state next state pars state state tabl current state

next state expon

built up number built up number
portion increas divid
next state remaind
divid


test state transit
current state next state

system diagnost debug write line current state current state state next state

next state label want process prefix
next state label

numer process
current state

the letter e
divid
partial result built up number divid
integ
partial result built up number
built up number

whole number
could follow remaind expon
next state the letter e
next state period
done with valu
next state period

partial result built up number
divid
built up number


remaind
follow expon
next state the letter e
done with valu

expon
done with valu




label handl
current state

label
done with label

end of line
prepar start line

whitespac
start space delimit entiti
next state end of line
space delimit start byte counter



label handl state
next state

sign process next state sinc still charact handi
sign

whole number multipli

expon sign

expon multipli

go whitespac end of line space delimit entiti
whitespac
space delimit max byte counter
whitespac nobodi process anyth label
element convert thi line element process
done with label

end of line
current state whitespac

space delimit max byte counter
whitespac nobodi process anyth label
element convert thi line element process
done with label

process label line
label mode label last label

store last label

intent fall
line count eol
record count done anoth record
trace level

progress dot
record count

record count 1000

record count 10000

fprintf stderr



fprintf stderr




fprintf stderr




line count other
space delimit start byte counter




current state next state

move charact
byte counter
buffer index


tick stop get tick count

tick delta tick stop tick start

trace level
fprintf stderr number pars tick delta total number convert
record count


store label version get last space delimit store label vector

uci parser store label final result

label first current counter
space delimit max space delimit start
space delimit max byte counter
label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
label push back move label
label convert thi line
element convert thi line
last label is string


done with label version store label

uci parser done with label

label
store label store label
prepar start number


store last label version

uci parser store last label

alreadi store label
last label is string

store label

alreadi store numer version label number
user want
number back
prepar start number


note current code ident know special paramet cover paramet

store label version get last space delimit store label vector

uci parser store label final result

label first current counter
space delimit max space delimit start
space delimit max byte counter
label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
label push back move label
label convert thi line
element convert thi line
last label is string


done with label version store label

uci parser done with label

label
store label store label
prepar start number


store last label version

uci parser store last label

alreadi store label
last label is string

store label

alreadi store numer version label number
user want
number back
prepar start number


ifdef standalon
wmain argc wchar argv

uci parser parser
vector valu
valu reserv 784000
vector label
label reserv 60000
parser pars init speech mnist mnist train label first
parser pars init speech pars test label none
record


record read parser pars 10000 valu label
record read 10000
parser set file posit around
record record read
valu clear
label clear
record 150000
record



instanti parser support type
uci parser
uci parser
uci parser
uci parser
uci parser
uci parser

copyright microsoft right reserv
licens licens licens file project root full licens inform

spars pc reader defin spars parallel corpu reader


stdafx
defin dataread export creat export
data reader
spars pc reader
ifdef leakdetect
leak detect

ifndef spars pcreader window
mman
stat
stdio
fcntl


microsoft cntk

dword hidword size size

size

dword lodword size size

size 0x ffffffff


elem type
spars pc reader elem type spars pc reader

ifdef spars pcreader window
filemap

unmap view of file filemap


data buffer

unmap view of file data buffer


close handl hndl

munmap data buffer file posit max
close hndl

featur count

valu

free valu


row indic

free row indic


col indic

free col indic



label buffer

free label buffer



elem type
spars pc reader elem type destroy




init reader initi multipl set
config configur paramet dataread
elem type
config record type
spars pc reader elem type init from config config record type reader config

spars reader consid everi consecut row part singl block
thi use later comput corss entropi softmax block
default valu indic row independ
micro batch size reader config microbatch size size

mini batch size
trace level reader config trace level
max read data reader config max read data size
do gradient check reader config gradient check
return dens reader config return dens
spars factor reader config spars factor size expect input posit zero valu
verif code int32 reader config verif code size

vector wstring featur name
vector wstring label name

file wstring reader config file

determin name featur labl section config file
featur vector featur name string
label vector label name string
get file config name reader config featur name label name

label name size

runtim error spars pc requir exactli label their name match definit



featur count featur name size
label name label name

featur name vector wstring featur count
dim vector size featur count
valu vector elem type featur count
row indic vector int32 featur count
col indic vector int32 featur count

featur count

config file must specifi queri featur first document featur sequenc differ attent
featur name featur name featur count

config paramet featur config reader config featur name

featur config size
runtim error featur config found requir configur featur 506530

dim featur config


ifdef spars pcreader window
hndl creat file file gener read
file share read open exist file attribut normal
hndl invalid handl valu

runtim error unabl open creat file error file get last error


get file size ex hndl plarg integ file posit max
filemap creat file map hndl page readonli

data buffer map view of file filemap
file read
hidword
lodword


hndl open msra strfun utf8 file rdonli
hndl
runtim error unabl open creat file file
stat
fstat hndl
runtim error unabl retriev file size file file
file posit max size
data buffer mmap nullptr file posit max prot read privat hndl
data buffer fail

data buffer nullptr
runtim error could memori file file





start minibatch loop startup minibatch
mb size size minibatch sampl
epoch epoch ignor
request epoch sampl sampl random ignor
elem type
spars pc reader elem type start minibatch loop size mb size size epoch size request epoch sampl

valu mini batch size mb size

mini batch size mb size

featur count

valu

free valu
free col indic
free row indic
free label buffer


valu elem type malloc elem type dim mini batch size spars factor
row indic int32 malloc int32 dim mini batch size spars factor
col indic int32 malloc int32 mini batch size
label buffer elem type malloc elem type mini batch size



reset read sampl
curr offset


get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
spars pc reader elem type tri get minibatch stream minibatch input matric

call start minibatch loop first
mini batch size


return earli debug purpos
max read data curr offset max read data


curr offset file posit max


matrix elem type label nullptr label label matrix
matric ha input label name

label matric get input matrix elem type label name
label get num row
runtim error spars pc reader support singl label valu column network expect label get num row


vector int32 curr index vector int32 featur count
featur count

curr index


size

mini batch size curr offset file posit max

featur count

col indic curr index

int32 int32 data buffer curr offset
curr offset int32

dim spars factor

runtim error input dens enough memori alloc


memcpi valu curr index data buffer curr offset elem type
curr offset elem type

memcpi row indic curr index data buffer curr offset int32
curr offset int32

curr index


elem type label elem type data buffer curr offset
label buffer label
curr offset elem type

verif code

int32 verif code int32 data buffer curr offset

verif code verif code

runtim error verif code match expect error read verif code



curr offset int32



featur count

col indic curr index
matrix elem type featur matric get input matrix elem type featur name

featur get format matrix format matrix format spars csc
featur switch to matrix type matrix type spars matrix format matrix format spars csc

featur set matrix from csc format col indic row indic valu curr index dim


return dens do gradient check

featur count
matric get input matrix elem type featur name switch to matrix type matrix type dens matrix format matrix format dens


label

label resiz
label set valu elem type
label set valu label get devic id label buffer


creat mb layout
each sampl consist sequenc micro batch size sampl
todo they realli tempor order better would tensor readi
p mb layout init micro batch size micro batch size
size micro batch size
p mb layout add sequenc sequenc micro batch size




elem type
spars pc reader elem type data end

get label map get label map integ index label
return numer datatyp label
elem type
i data reader label id type i data reader label type spars pc reader elem type get label map wstring section name

map id to label


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
spars pc reader elem type set label map wstring section name i data reader label id type label type label map

map id to label label map
map label to id clear
pair label type label map

map label to id second first



instanti combin expect use
spars pc reader
spars pc reader

stdafx sourc file includ standard includ
spars pc reader compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file
dllmain defin entri point applic
stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
spars pc reader

microsoft cntk

dataread get reader f i data reader preader

preader spars pc reader

dataread get reader d i data reader preader

preader spars pc reader




copyright microsoft right reserv
licens licens licens file project root full licens inform

htkmlf reader defin export function applic


stdafx
ifdef win32
objbas

basic

htkfeatio read featur
latticearch read phonem lattic train
simplesenonehmm score
msra mgram unigram score ground truth path sequenc train

rollingwindowsourc minibatch sourc
utterancesourcemulti
chunkevalsourc
minibatchiter
defin dataread export creat export
data reader
config
scriptabl object
htkmlf reader
timer util
ifdef leakdetect
memori leak detect


ifdef unix
limit
dword
word
unint32

pragma warn disabl 4127 condit express constant elem type trigger

ifdef win32
msra numa node numahelp


msra

mgram index mgram nindex mgram index invalid index



msra
unord wstring htkfeatread parsedpath archiv path string map
vector wstring htkfeatread parsedpath archiv path string vector


microsoft cntk

creat data reader
dataread i data reader data reader factori

elem type
config record type
htkmlf reader elem type init from config config record type reader config

truncat reader config truncat
convert label to target

intargvector number ofutt per minibatch for all epoch reader config nbruttsineachrecurrentit config record type array intargvector vector
num seq per mb for all epoch number ofutt per minibatch for all epoch

num seq per mb for all epoch size

num seq per mb for all epoch

logic error nbr utt in each recurr iter cannot less



num seq per mb num seq per mb for all epoch
p mb layout init num seq per mb enter actual read todo thi hacki

no data

wstring command reader config action look config master command determin whether write output input train evalu input output

reader config exist legaci mode
runtim error legaci mode deprec

command write

train or test
prepar for write reader config



train or test
prepar for train or test reader config



load input output
note term featur impli real valu quantiti
label impli categor quantiti irrespect whether
input target network
elem type
config record type
htkmlf reader elem type prepar for train or test config record type reader config

vector wstring scriptpath
vector wstring root path in script
wstring root path in lattic toc
vector wstring mlfpath
vector vector wstring mlfpathsmulti
size firstfilesonli size lower valu test
vector vector wstring infilesmulti
size num file
wstring unigrampath

size random random auto
size i feat i label
i feat i label
vector wstring statelistpath
vector size num context left
vector size num context right
size num expand to utt

vector wstring featur name
vector wstring label name

lattic
vector wstring hmm name
vector wstring lattic name
get data name from config reader config featur name label name hmm name lattic name
featur name size label name size

invalid argument network need least input output specifi


load real valu input featur
index featur name

config record type thi featur reader config featur name
feat dim push back thi featur

expand to utt thi featur expand to utter featur process ivector
expand to utt push back expand to utt
expand to utt
num expand to utt

intargvector context window thi featur context window config record type array intargvector vector
context window size symmetr

size window frame context window
window frame
invalid argument augmentationext neighbor expans input featur symmetr window frame

size context window frame extend side
num context left push back context
num context right push back context

context window size left context right context

num context left push back context window
num context right push back context window



invalid argument context frame must valu specifi found context window size


expand to utt num context left num context right
runtim error context window expans permit expand to utter

updat feat dim reflect total input dimens feat dim context window featur dimens
lower level featur reader expect
feat dim feat dim num context left num context right

wstring thi featur real
equal ci real

name to type map featur name input output type real



invalid argument featur must real


featur name to id map featur name i feat
scriptpath push back thi featur scp file
root path in script push back thi featur prefix path in scp
featur name to dim map featur name feat dim

featur buffer multi io push back nullptr
featur buffer alloc multi io push back

i feat


index label name

config record type thi label reader config label name
thi label exist label dim
label dim push back thi label label dim
thi label exist
label dim push back thi label

invalid argument label must specifi label dim

wstring
thi label exist label type
wstring thi label label type deprec eventu

wstring thi label categori output categori

equal ci categori
name to type map label name input output type categori

invalid argument label must categori

statelistpath push back thi label label map file

label name to id map label name i label
label name to dim map label name label dim
mlfpath clear
thi label exist current mlf file

mlfpath push back thi label mlf file



thi label exist current mlf file list

invalid argument either mlf file mlf file list must exist htkmlf reder


wstring thi label mlf file list
msra file textread

mlfpath push back wgetlin


mlfpathsmulti push back mlfpath

label buffer multi io push back nullptr
label buffer alloc multi io push back

i label

wstring label to target map file thi label label to target map file
label to target map file

vector vector elem type label to target map
convert label to target multi io push back
thi label exist target dim

label name to dim map label name label dim thi label target dim



runtim error output must specifi target dim label to target map file specifi


size target dim read label to target map file label to target map file statelistpath label to target map
target dim label dim
runtim error mismatch target dim found label to target map file
label to target map multi io push back label to target map



convert label to target multi io push back
label to target map multi io push back vector vector elem type



lattic file name
pair vector wstring vector wstring latticetoc
index lattic name support lattic

config record type thi lattic reader config lattic name

vector wstring path
expand wildcard thi lattic den lat toc file path
latticetoc second insert latticetoc second path path

thi lattic exist num lat toc file

path clear
expand wildcard thi lattic num lat toc file path
latticetoc first insert latticetoc first path path

root path in lattic toc wstring thi lattic prefix path in toc


relat file name
vector wstring cdphonetyingpath tran pspath
index hmm name

config record type thi hmm reader config hmm name

cdphonetyingpath push back thi hmm phone file
tran pspath push back thi hmm tran p file


file
support
cdphonetyingpath size statelistpath size tran pspath size
hset loadfromfil cdphonetyingpath statelistpath tran pspath

i feat scriptpath size i label mlfpathsmulti size
runtim error input file input output file output inconsist

i feat num expand to utt
runtim error least featur stream must frame base utter base

expand to utt first featur stream ivector mess lower level featur reader
runtim error first featur stream file must frame base utter base pleas reorder featur block config appropri

reader config exist random

wstring random string reader config can be string random reader config random wstring
equal ci random string none random random none
equal ci random string random random auto
random reader config random todo could random string


frame mode reader config frame mode
verbos reader config verbos

frame mode truncat

invalid argument truncat cannot frame mode frame mode


determin partial minibatch desir
wstring minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

read method default block random option roll window
wstring read method reader config read method block random

read method block random random random none
invalid argument random cannot none read method block random

read method roll window num expand to utt
runtim error roll window reader support expand to utt chang block random

read input file multipl input
check consist file script file
num file
index scriptpath

vector wstring filelist
wstring scriptpath scriptpath
fprintf stderr read script file scriptpath
size
msra file textread reader scriptpath reader filelist size firstfilesonli optim

filelist push back reader wgetlin



fprintf stderr entri


num file
num file
runtim error file scriptfil inconsist num file

post process file
user specifi prefix path prefix path filelist
dotdotdot expans necessari
wstring rootpath root path in script
rootpath specifi path prefix featur

first make slash consist sorri linux user necessari
replac rootpath rootpath

second remov trail slash
todo greater regex replac rootpath wstring
size string po
string po rootpath length string po string po

rootpath string po




rootpath rootpath substr string po

third join rootpath entri filelist
rootpath

wstring path filelist

path find first wstring npo

vector wstring strarr msra strfun split path
ifdef win32
replac strarr strarr


path strarr rootpath strarr



ifdef win32
replac path path

path rootpath path







expans use rel path name
mean full path file
exampl file
contain entri like
file1 feat
file2 feat

featur read
file1 feat
file2 feat

thi work well store file featur
want differ file everytim move creat featur

wstring scpdircach
entri filelist
expand dot dot dot entri scriptpath scpdircach


infilesmulti push back move filelist


reader config exist unigram
unigrampath wstring reader config unigram

load unigram need use train
msra c symbol set unigramsymbol
uniqu msra cm gram lm unigram
size silencewordid size
size startwordid size
size endwordid size
unigrampath

unigram reset msra cm gram lm
unigram read unigrampath unigramsymbol filter vocabulari build max m unigram
silencewordid unigramsymbol silenc give even vocabulari
startwordid unigramsymbol
endwordid unigramsymbol


unigram latticetoc second size
fprintf stderr trainlay exclus code enabl unigram specifi deriv word exclus

current assum mlf root name
wstring restrictmlftokey restrict reader file make stuff much faster without shorten input file
infilesmulti size

index infilesmulti

msra htkfeatread parsedpath ppath infilesmulti
wstring ppath str wstring ppath

extens none
todo greater regex replac wstring ppath wregex wstring
string po
string po ppath str length string po string po

ppath str string po ppath str string po ppath str string po ppath str string po





ppath str string po
restrictmlftokey insert ppath str substr string po



restrictmlftokey insert ppath str



label

reader config exist statelist
statelistpath reader config statelist

htktimetofram 100000 10m
vector msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ labelsmulti
vector wstring vector msra htkmlfentri labelsmulti
vector wstring pagepath
index mlfpathsmulti

msra c symbol set wordmap unigram unigramsymbol
msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ
label mlfpathsmulti restrictmlftokey statelistpath wordmap size htktimetofram label
temp file name page file

make sure msra htkmlfreader move
move construct msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ valu
type msra htkmlfreader move construct

labelsmulti push back move label


equal ci read method block random

construct paramet need need pass

lattic reset msra latticesourc latticetoc hset getsymmap root path in lattic toc
lattic setverbos verbos

frame sourc thi better random creat temp file
minim reader memori footprint reader config minim reader memori footprint
frame sourc reset msra minibatchutterancesourcemulti infilesmulti labelsmulti feat dim label dim
num context left num context right random
lattic lattic map frame mode
minim reader memori footprint expand to utt
frame sourc setverbos verbos

equal ci read method roll window

wstring page file path
vector wstring page path
reader config exist page file path

page file path wstring reader config page file path

ifdef win32
replac compat path
replac page file path page file path

verifi path exist
dword attrib get file attribut page file path
attrib invalid file attribut attrib file attribut directori
runtim error page file path exist

ifdef unix
stat statbuf
stat wtocharpath page file path statbuf

runtim error page file path exist



temporari path

ifdef win32
page file path reserv path
get temp path path page file path

ifdef unix
page file path temp cntk xxxxxx



ifdef win32
page file path size path length input get temp file name path
runtim error page file path must less charact path

page file path size path length input get temp file name path
runtim error page file path must less charact path

index infilesmulti

ifdef win32
wchar temp file path
get temp file name page file path cntk temp file
page path push back temp file

ifdef unix
temp file path
strcpi temp file msra strfun utf8 page file path
mkstemp temp file
unlink temp file
close
page path push back get wc temp file



mayhavenofram
add energi

frame sourc reset msra minibatchframesourcemulti infilesmulti labelsmulti feat dim label dim
num context left num context right random
page path mayhavenofram add energi
frame sourc setverbos verbos



runtim error read method must roll window block random



load input output
note term featur impli real valu quaniti
label impli categor quantiti irrespect whether
input target network
todo lot code prepar
elem type
config record type
htkmlf reader elem type prepar for write config record type reader config

vector wstring scriptpath
size num file
size firstfilesonli size lower valu test
size evalchunks 2048
vector size real dim
size i feat
vector size num context left
vector size num context right

vector wstring featur name
vector wstring label name
lattic
vector wstring hmm name
vector wstring lattic name

get data name from config reader config featur name label name hmm name lattic name

index featur name

config record type thi featur reader config featur name
real dim push back thi featur

intargvector context window thi featur context window config record type array intargvector vector
context window size symmetr

size window frame context window
window frame

runtim error augmentationext neighbor expans input featur symmetr window frame


size context window frame extend side
num context left push back context
num context right push back context

context window size left context right context

num context left push back context window
num context right push back context window



runtim error context frame must valu specifi found context window size


updat feat dim reflect total input dimens feat dim context window featur dimens
lower level featur reader expect
real dim real dim num context left num context right

wstring thi featur real
equal ci real

name to type map featur name input output type real



runtim error featur must real


featur name to id map featur name i feat
scriptpath push back thi featur scp file
featur name to dim map featur name real dim

featur buffer multi io push back nullptr
featur buffer alloc multi io push back
i feat


label name size
runtim error writer mode support label input featur

num file
index scriptpath

vector wstring filelist
wstring scriptpath scriptpath
fprintf stderr read script file scriptpath
size
msra file textread reader scriptpath reader filelist size firstfilesonli optim

filelist push back reader wgetlin



fprintf stderr entri


num file
num file
runtim error htkmlf reader init eval reader file scriptfil inconsist num file

input file multi io push back move filelist


file eval sourc reset msra file eval sourc real dim num context left num context right evalchunks


start minibatch loop startup minibatch
request mb size size minibatch frame
epoch epoch
request epoch sampl sampl random default request data size use sampl dataset
elem type
htkmlf reader elem type start distribut minibatch loop size request mb size size epoch size subset num size num subset size request epoch sampl request data size

subset num num subset
subset num num subset support distribut mb read

mb num time step request mb size note ignor frame mode full sequenc mode

num seq per mb num seq per mb for all epoch epoch

distribut read utter mode distribut utter minibatch among subset
train or test frame mode

num subset num seq per mb num subset

logic error insuffici valu nbruttsineachrecurrentit distribut read subset num seq per mb num subset


num seq per mb num seq per mb num subset subset num num seq per mb num subset


p mb layout init num seq per mb enter actual read todo thi hacki

resiz array
these size request fill still mani gap
frame mode num seq per mb must howev return layout frame sequenc frame
sentenc end assign num seq per mb
process frame assign num seq per mb
num frame to process assign num seq per mb
switch frame assign num seq per mb
num valid frame assign num seq per mb

train or test

multi utter process
featur buffer multi utt assign num seq per mb nullptr
featur buffer alloc multi utt assign num seq per mb
label buffer multi utt assign num seq per mb nullptr
label buffer alloc multi utt assign num seq per mb

multi utter process lattic phone boundari
lattic buffer multi utt assign num seq per mb nullptr
label id buffer multi utt resiz num seq per mb
phoneboundari id buffer multi utt resiz num seq per mb

frame mode num seq per mb

logic error nbr utt in each recurr iter cannot frame mode read


bugbug bptt sequenc mode instead request mb size utter back time
start minibatch loop to train or test request mb size epoch subset num num subset request epoch sampl



distribut read mini batch write
subset num num subset

logic error distribut read mini batch support train test


p mb layout init request mb size enter actual read todo thi hacki

start minibatch loop to write request mb size epoch request epoch sampl

check dictionari key


elem type
htkmlf reader elem type start minibatch loop to train or test size mb size size epoch size subset num size num subset size request epoch sampl

size datapass
size total frame frame sourc totalfram

size extra frame total frame mb size
size minibatch total frame mb size

allow partial minibatch noth
partial minibatch

want partial frame round total frame even multipl mb size
total frame mb size
total frame extra frame

request epoch sampl request data size

request epoch sampl total frame

minibatch full minibatch

sinc skip extra frame need total actual frame request
size sweep request epoch sampl total frame want sweep skip extra subtract divid
request epoch sampl extra frame sweep


request epoch sampl request data size

request epoch sampl total frame


mbiter reset msra minibatchiter frame sourc epoch request epoch sampl mb size subset num num subset datapass
advanc iter find reach epoch
mbiter currentmbfram mbiter

mbiter


no data
mbiter
no data

featur buffer multi io

featur buffer multi io nullptr check first featur assum

index featur buffer multi io

featur buffer multi io nullptr
featur buffer alloc multi io



featur start index multi utt assign featur buffer multi io size num seq per mb


label buffer multi io

label buffer multi io nullptr

index label buffer multi io

label buffer multi io nullptr
label buffer alloc multi io



label start index multi utt assign label buffer multi io size num seq per mb


size num seq per mb

featur buffer multi utt

featur buffer multi utt
featur buffer alloc multi utt


label buffer multi utt

label buffer multi utt
label buffer alloc multi utt


lattic buffer multi utt

lattic buffer multi utt reset


re new buffer for multi io



elem type
htkmlf reader elem type start minibatch loop to write size mb size size epoch size request epoch sampl

file eval sourc reset
file eval sourc set minibatch size mb size
input file index

featur buffer multi io nullptr check first featur assum

index featur buffer multi io

featur buffer multi io nullptr
featur buffer alloc multi io




elem type
htkmlf reader elem type get minibatch4 se vector share msra latticepair latticeinput
vector size uid vector size boundari vector size extrauttmap

train or test

get minibatch4 se to train or test latticeinput uid boundari extrauttmap






elem type
htkmlf reader elem type get minibatch4 se to train or test vector share msra latticepair latticeinput
vector size uid vector size boundari vector size extrauttmap

latticeinput clear
uid clear
boundari clear
extrauttmap clear
size extra seq per mb size

latticeinput push back extra lattic buffer multi utt
uid insert uid extra label id buffer multi utt extra label id buffer multi utt
boundari insert boundari extra phoneboundari id buffer multi utt extra phoneboundari id buffer multi utt


extrauttmap insert extrauttmap extra seq per mb extra seq per mb



elem type
htkmlf reader elem type get hmm data msra simplesenonehmm

hset


get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
todo read function superset
elem type
htkmlf reader elem type tri get minibatch stream minibatch input matric

train or test

get minibatch to train or test matric



get minibatch to write matric



elem type
htkmlf reader elem type get minibatch to train or test stream minibatch input matric

size
size
skip

first minibatch make sure suppli request node
wstring size iter iter
check dictionari key

iter matric iter matric iter

name to type map find iter first name to type map

runtim error minibatch request input node found reader cannot gener input iter first


check dictionari key


timer aggreg timer
verbos
aggreg timer start



truncat


frame mode whole utter


extra lattic buffer multi utt clear
extra label id buffer multi utt clear
extra phoneboundari id buffer multi utt clear
extra seq per mb clear
no data num frame to process left first channel minibatch




bugbug decid mani utter go take desir frame fill
current seem fill utter regardless length

decid mb num time step
column determin longest utter amongst desir
whatev user specifi size ignor valu howev pass underli reader bugbug that even wrong
bugbug honor mb size paramet fill request sampl request parallel sequenc
mb num time step num frame to process
mb num time step num frame to process
size num seq per mb

mb num time step num frame to process
mb num time step num frame to process


frame mode

num seq per mb user must request parallel sequenc
p mb layout init as frame mode mb num time step



p mb layout init num seq per mb mb num time step


creat desir utter
first fill parallel sequenc utter pack
note code littl mislead frame mode
frame mode reader think parallel sequenc num seq per mb
report outsid parallel sequenc frame
skip frame mode partial minibatch mbiter requestedfram mb num time step frame sourc totalfram mb num time step
size num seq per mb

skip

stopgap
num frame to process lattic buffer multi utt lattic buffer multi utt getnumfram num frame to process

bugbug found bug track
fill frame inconsist frame lattic though rare occur
thi stopgap remov bug found
need renew
need renew

size framenum num frame to process
fprintf stderr warn mismatch frame fill reader lattic ignor utter
framenum lattic buffer multi utt getnumfram lattic buffer multi utt getkey
re new buffer for multi io
need renew num frame to process lattic buffer multi utt lattic buffer multi utt getnumfram num frame to process


num valid frame num frame to process
num valid frame

frame mode

layout alreadi initi entir frame mode
reader think parallel sequenc
size p mb layout get num parallel sequenc

num valid frame alreadi valid frame need gap




p mb layout add sequenc sequenc num valid frame


extra seq per mb push back
fill one utt datafor parallelmod matric num valid frame

lattic buffer multi utt nullptr

extra lattic buffer multi utt push back lattic buffer multi utt
extra label id buffer multi utt push back label id buffer multi utt
extra phoneboundari id buffer multi utt push back phoneboundari id buffer multi utt



re new buffer for multi io


skip

extra num seq
frame mode

size num seq per mb

size framenum num frame to process
framenum




lattic buffer multi utt nullptr lattic buffer multi utt getnumfram framenum

bugbug found bug track
fill frame inconsist frame lattic though rare occur
thi stopgap remov bug found
fprintf stderr warn mismatch frame fill reader lattic ignor utter
framenum lattic buffer multi utt getnumfram lattic buffer multi utt getkey




slot found
size num seq per mb found slot

framenum num valid frame mb num time step

found
extra seq per mb push back
lattic buffer multi utt nullptr

extra lattic buffer multi utt push back lattic buffer multi utt
extra label id buffer multi utt push back label id buffer multi utt
extra phoneboundari id buffer multi utt push back phoneboundari id buffer multi utt


fill one utt datafor parallelmod matric num valid frame framenum
p mb layout add sequenc sequenc num valid frame num valid frame framenum

re new buffer for multi io
num valid frame framenum
extra num seq
slot found




slot found

done sourc sourc



remain gap
size num seq per mb
p mb layout add gap num valid frame mb num time step
frame mode

iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric get input matrix elem type iter first featur label
name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first
set valu mb num time step num seq per mb get devic id featur buffer multi io matrix flag normal

name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
set valu mb num time step num seq per mb get devic id label buffer multi io matrix flag normal




truncat


truncat bptt


truncat bptt mode minibatch consist truncat length frame
reader maintain current utter minibatch contain frame
when utter reach avail utter slot
no data return last utter epoch

cursor parallel sequenc reach
end epoch
size num seq per mb

process frame num frame to process
end epoch


end epoch



size num of fea featur buffer multi io size
size num of label label buffer multi io size

creat featur matrix
p mb layout init num seq per mb mb num time step

vector size actualmbs num seq per mb
size num seq per mb

fill parallel sequenc slot
size start fr process frame start frame cursor insid utter correspond time step

utter mb layout
num frame to process start fr no data num frame to process start fr
num frame to process start fr
edg no data start fr
p mb layout add sequenc sequenc ptrdiff start fr num frame to process start fr


start fr mb num time step num frame to process minibatch reach utter

mb num time step frame fill time step
start fr begin utter

sentenc end
switch frame mb num time step

begin utter

sentenc end
switch frame

actualmbs mb num time step
size end fr start fr actualmbs actual frame index segment
iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric get input matrix elem type iter first featur label

name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first

featur buffer multi io nullptr
featur buffer alloc multi io mb num time step num seq per mb buffer size chang partial minibatch

featur buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
featur buffer alloc multi io mb num time step num seq per mb


elem type

size start fr end fr column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi io num seq per mb
elem type
featur buffer multi utt featur start index multi utt num of fea
elem type


must cast cannot memcpi

size start fr end fr column major iter column outsid



featur buffer multi io num seq per mb
featur buffer multi utt featur start index multi utt num of fea




name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
label buffer multi io nullptr
label buffer alloc multi io mb num time step num seq per mb

label buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
label buffer alloc multi io mb num time step num seq per mb


size start fr end fr



label buffer multi io num seq per mb
label buffer multi utt label start index multi utt num of label




process frame mb num time step

start fr mb num time step num frame to process branch utter end insid minibatch

utter end first copi segment later pack utter
start fr process frame
actualmbs num frame to process start fr parallel sequenc use point
size end fr start fr actualmbs frame sequenc
end fr num frame to process

fill frame tail utter
iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric get input matrix elem type iter first featur label

name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first

featur buffer multi io nullptr
featur buffer alloc multi io mb num time step num seq per mb buffer size chang partial minibatch

featur buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
featur buffer alloc multi io mb num time step num seq per mb


elem type

size start fr end fr column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi io num seq per mb
elem type
featur buffer multi utt featur start index multi utt num of fea
elem type




size start fr end fr column major iter column outsid



featur buffer multi io num seq per mb
featur buffer multi utt featur start index multi utt num of fea




name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
label buffer multi io nullptr
label buffer alloc multi io mb num time step num seq per mb

label buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
label buffer alloc multi io mb num time step num seq per mb


size start fr end fr



label buffer multi io num seq per mb
label buffer multi utt label start index multi utt num of label




process frame end fr start fr advanc cursor
process frame num frame to process must
switch frame actualmbs
actualmbs
p mb layout actualmbs minibatch pack flag sequenc end note origin code overwrot matrix o red vector
point complet utter fill rest utter

bugbug fill fill minibatch re new suffici
fill remain slot minibatch
re new succ re new buffer for multi io
actualmbs mb num time step actual space

re new succ actual anoth utter start

size start t switch frame
have take sequenc short truncat length
size end t mb num time step start t num frame to process
note confus start t end t start fr end fr

sequenc mb layout
p mb layout add sequenc sequenc start t start t num frame to process

copi
iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric iter first featur label

name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first
elem type

size start t end t column major iter column

copi entir column need sse matrix gap column align
memcpi featur buffer multi io num seq per mb
elem type
featur buffer multi utt featur start index multi utt num of fea
elem type




size start t end t column major iter column outsid



featur buffer multi io num seq per mb
featur buffer multi utt featur start index multi utt num of fea




name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
size start t end t



label buffer multi io num seq per mb
label buffer multi utt label start index multi utt num of label





process frame end t start t

bugbug sinc current cannot fill utter least check
size actualmbs end t start t

actualmbs end t start t bugbug need someth like
mb num time step

fprintf stderr get minibatch to train or test warn pack second utter still fill time slot fill slot gap
rest
p mb layout add gap mb num time step

have renew read
re new buffer for multi io


space avail bugbug updat actualmbs test

rest
p mb layout add gap actualmbs mb num time step

actualmbs mb num time step actual space

size num seq per mb
done fill parallel sequenc

iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric get input matrix elem type iter first featur label
name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first
set valu mb num time step num seq per mb get devic id featur buffer multi io matrix flag normal

name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
set valu mb num time step num seq per mb get devic id label buffer multi io matrix flag normal


skip
truncat
skip keep go right size minibatch

verbos

aggreg timer stop
total mb read time aggreg timer elaps second
fprintf stderr total minibatch read time total mb read time





copi utter minibatch given locat parallel sequenc index start frame
todo thi data for data for move comput node
elem type
htkmlf reader elem type fill one utt datafor parallelmod stream minibatch input matric size start fr
size framenum size channel index size sourc channel index

size
size
size num of fea featur buffer multi io size
size num of label label buffer multi io size

iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label
matrix elem type matric get input matrix elem type iter first featur label

name to type map iter first input output type real

featur name to id map iter first
featur name to dim map iter first

featur buffer multi io nullptr featur buffer alloc multi io mb num time step num seq per mb

featur buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
memset featur buffer multi io elem type mb num time step num seq per mb
featur buffer alloc multi io mb num time step num seq per mb


elem type

size start fr framenum column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi io num seq per mb channel index elem type featur buffer multi utt sourc channel index featur start index multi utt sourc channel index num of fea elem type




size start fr framenum column major iter column outsid



featur buffer multi io num seq per mb channel index featur buffer multi utt sourc channel index featur start index multi utt sourc channel index num of fea




name to type map iter first input output type categori

label name to id map iter first
label name to dim map iter first
label buffer multi io nullptr label buffer alloc multi io mb num time step num seq per mb

label buffer multi io alloc intermedi buffer get devic id mb num time step num seq per mb
memset label buffer multi io elem type mb num time step num seq per mb
label buffer alloc multi io mb num time step num seq per mb


size start fr framenum



label buffer multi io num seq per mb channel index
label buffer multi utt sourc channel index label start index multi utt sourc channel index num of label






elem type
htkmlf reader elem type get minibatch to write stream minibatch input matric

wstring size iter iter
check dictionari key

iter featur name to id map iter featur name to id map iter

matric find iter first matric

fprintf stderr get minibatch to write featur node specifi reader found network iter first
runtim error get minibatch to write featur node specifi reader found network




iter matric iter matric iter

featur name to id map find iter first featur name to id map
runtim error msra strfun strprintf minibatch request input node found reader cannot gener input iter first


check dictionari key


input file index input file multi io size

file eval sourc reset

load file file
size
index input file multi io

msra htkfeatread reader

path reader pars input file multi io input file index
read file
msra matrix feat
featkind
sampperiod
msra util attempt

reader read path featkind sampperiod feat whole file read column featur vector




feat col

feat col

thi broadcast vector multipl column need vector support
msra matrix feat feat
feat resiz feat row
size feat row
size feat col
feat feat


fprintf stderr evalu read frame feat col wstring path
file eval sourc add file feat featkind sampperiod

input file index

turn frame minibatch augment neighbor
file eval sourc creat eval minibatch

popul input matric
first
iter matric iter matric iter

derefer matrix correspond input output name
popul base whether featur label

name to type map find iter first name to type map name to type map iter first input output type real

matrix elem type matric get input matrix elem type iter first featur label todo realli didn check real
size featur name to id map iter first
size featur name to dim map iter first

msra matrix feat file eval sourc chunk of frame

updat mb layout
first

p mb layout init feat col
p mb layout add sequenc sequenc feat col feat col time step sinc parallel sequenc
p mb layout minibatch pack flag sequenc start
p mb layout set without or feat col minibatch pack flag sequenc end bugbug set without or origin code seem inconsist
first


copi featur
feat row
check featur dimens match expect

featur buffer multi io nullptr
featur buffer alloc multi io feat row feat col buffer size chang partial minibatch

featur buffer multi io alloc intermedi buffer get devic id feat row feat col
featur buffer alloc multi io feat row feat col


elem type

feat col column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi io feat row elem type feat row feat elem type feat row




feat col column major iter column outsid

feat row

featur buffer multi io feat row feat



set valu feat row feat col get devic id featur buffer multi io matrix flag normal










elem type
htkmlf reader elem type re new buffer for multi io size

no data

truncat
num frame to process




size num of fea featur buffer multi io size
size num of label label buffer multi io size

size total feat num
index featur buffer alloc multi io

msra matrixstrip feat ori mbiter frame
size fdim feat ori row
size actualmbs ori feat ori col
featur start index multi utt num of fea total feat num
total feat num fdim actualmbs ori featur start index multi utt num of fea


featur buffer multi utt featur buffer alloc multi utt total feat num

featur buffer multi utt alloc intermedi buffer total feat num
featur buffer alloc multi utt total feat num


size total label num
label name to id map label name to id map

size label name to id map first
size label name to dim map first

vector size uid mbiter label
size actualmbs ori uid size
label start index multi utt num of label total label num
total label num label start index multi utt num of label actualmbs ori


label buffer multi utt label buffer alloc multi utt total label num

label buffer multi utt alloc intermedi buffer total label num
label buffer alloc multi utt total label num


memset label buffer multi utt elem type total label num

first
index featur buffer multi io

msra matrixstrip feat ori mbiter frame
size actualmbs ori feat ori col
size fdim feat ori row
first

num frame to process actualmbs ori
first



num frame to process actualmbs ori

runtim error multi featur inconsist frame


actualmbs ori mbiter currentmbfram

elem type

actualmbs ori column major iter column

copi entir column need sse matrix gap column
memcpi featur buffer multi utt fdim featur start index multi utt num of fea elem type fdim feat ori elem type fdim




actualmbs ori column major iter column outsid

feat ori row

featur buffer multi utt feat ori row featur start index multi utt num of fea feat ori





label name to id map label name to id map

size label name to id map first
size label name to dim map first

vector size uid mbiter label
size actualmbs ori uid size

convert label to target multi io

size label dim label to target map multi io size
actualmbs ori

uid label dim
label dim
size label id uid


label buffer multi utt label start index multi utt num of label label to target map multi io label id





column valu
futur want spars matrix
actualmbs ori

uid
label buffer multi utt uid label start index multi utt num of label elem type




lattic
lattic buffer multi utt

lattic buffer multi utt reset


mbiter haslattic

lattic buffer multi utt move mbiter lattic
phoneboundari id buffer multi utt clear
phoneboundari id buffer multi utt mbiter bound
label id buffer multi utt clear
label id buffer multi utt mbiter label


process frame

timer mb iter advanc timer
verbos
mb iter advanc timer start

advanc iter find reach epoch


mbiter
mbiter currentmbfram mbiter

verbos

mb iter advanc timer stop
advanc time mb iter advanc timer elaps second
fprintf stderr time advanc mbiter advanc time


mbiter
no data




get label map get label map integ file
map tabl numer datatyp label store
elem type
i data reader label id type i data reader label type htkmlf reader elem type get label map wstring section name

id to label map


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
htkmlf reader elem type set label map wstring section name i data reader label id type i data reader label type label map

id to label map label map


elem type
size htkmlf reader elem type read label to target map file wstring label to target map file wstring label list file vector vector elem type label to target map

label list file
runtim error htkmlf reader read label to target map file cannot read label to target map file without label map file

vector wstring label list
size count num label
count
read statelist first
msra file textread label reader label list file
label reader

label list push back label reader wgetlin
count

num label count
count
msra file textread map reader label to target map file
size target dim
map reader

wstring line map reader wgetlin
find white space demarc
wstring size line find
wstring token line substr
wstring targetstr line substr

label list count token
runtim error htkmlf reader read label to target map file mismatch label map file label to target map file

count
target dim targetstr length
target dim targetstr length
runtim error htkmlf reader read label to target map file inconsist target length among record

vector elem type target vector targetstr length elem type
index targetstr

targetstr compar
target vector elem type
targetstr compar
runtim error htkmlf reader read label to target map file expect label2target map contain

label to target map push back target vector
count


verifi statelist label2target map file order match reader read map
count label list size
runtim error htkmlf reader read label to target map file mismatch length label map file label to target map file

target dim


get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
elem type
htkmlf reader elem type get data wstring section name size num record size data buffer size size record start

runtim error get data support htkmlf reader


elem type
htkmlf reader elem type data end

minibatch consid sentenc
truncat bptt need support check wether
truncat
sentenc end

useless current condit


elem type
htkmlf reader elem type set sentenc end in batch vector size sentenc end

sentenc end resiz switch frame size
size switch frame size
sentenc end switch frame


elem type
htkmlf reader elem type copi mb layout to mb layout ptr p mb layout

p mb layout copi from p mb layout


elem type
size htkmlf reader elem type get num parallel sequenc

frame mode
num seq per mb p mb layout get num parallel sequenc
logic error htkmlf reader number parallel sequenc p mb layout num seq per mb
p mb layout get num parallel sequenc use valid anyway


get file config name determin name featur label section config file
featur vector featur name string
label vector label name string
elem type
config record type
htkmlf reader elem type get data name from config config record type reader config vector wstring featur vector wstring label
vector wstring hmm vector wstring lattic

reader config get member id

reader config can be config record


config record type temp reader config
config paramet contain file element
temp exist current scp file

featur push back

temp exist current mlf file temp exist current mlf file list

label push back

temp exist current phone file

hmm push back

temp exist current denlat toc file

lattic push back




elem type
htkmlf reader elem type expand dot dot dot wstring feat path wstring scp path wstring scp dir cach

wstring delim

scp dir cach

scp dir cach scp path
wstring tail
scp dir cach find last delim
wstring npo

tail scp dir cach substr
scp dir cach resiz


tail noth split given contain filenam
scp dir cach swap tail


size feat path find
feat path npo
feat path feat path substr scp dir cach feat path substr


elem type
uniqu cuda page lock mem alloc htkmlf reader elem type get cuda alloc devic id

cuda alloc nullptr

cuda alloc get devic id devic id

cuda alloc reset nullptr



cuda alloc nullptr

cuda alloc reset cuda page lock mem alloc devic id


cuda alloc


elem type
share elem type htkmlf reader elem type alloc intermedi buffer devic id size num element

devic id

pin memori devic better copi perform
size total size elem type num element
share elem type elem type get cuda alloc devic id malloc total size
devic id elem type

get cuda alloc devic id free




share elem type elem type num element
elem type






htkmlf reader
htkmlf reader


copyright microsoft right reserv
licens licens licens file project root full licens inform


pragma

stdafx
basic
fileutil
htkfeatio read numer lattic
latticearch
msra mgram read numer lattic
stdio
stdint
vector


unord
regex

pragma warn disabl 4996
msra lattic

helper write hash file
file section
physicalunitnam line map start
logunitnam physicalunitnam establish map logunitnam numer index physicalunitnam
unitmap
writeunitmap wstring symlistpath unitmap unitmap

vector unit
unit reserv unitmap size
vector map
map reserv unitmap size
iter unitmap cbegin iter unitmap cend iter would iter unitmap work

label iter first
size unitid iter second
unit size unitid
unit resiz unitid grow demand result must compact entri fill check later
unit unitid mani map rememb unit look write
map push back label

unit unitid label


file flist fopen or die symlistpath
write physic unit
index unit

unit
logic error build unitmap gap
fprintf or die flist unit

write phi map
index map

unit map logic name
size unitid unitmap find unit second unit index unit
tounit unit unitid name tehr
fprintf or die flist unit tounit

fflush or die flist


littl helper find valu
maptyp keytyp valtyp
size tryfind maptyp keytyp valtyp deflt

iter find
iter
deflt

iter second


archiv format
output file build
outpath result archiv huge file simpl concaten binari block
outpath contain key offset content archiv found
archiv byteoffset archiv mean previou
outpath symlist unit name encount order numer index use archiv first index
thi file suitabl input hh ed command
actual
file concaten
symlist file must remain pair archiv file
actual train user also need provid typic hh ed
outpath tie triphon unit senon sequenc name full phone symlist
unitnam senon senon senon
archiv build vector wstring infil wstring outpath
unord size modelsymmap
msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ label build numer lattic
msra cm gram lm unigram msra c symbol set unigramsymbol numer lattic

numermod label label pass shall convert ml fs lattic infil regular key

wstring tocpath outpath
wstring symlistpath outpath symlist

process file
wstring seenkey keep track seen key error duplic key
msra file make intermedi dir outpath

file fopen or die outpath
file ftoc fopen or die tocpath
size brokeninputfil
index infil

wstring inlatpath infil
fprintf stderr build process lattic inlatpath


wstring regex replac inlatpath wregex wstring map
regex replac wregex wstring path
regex replac wregex wstring extens none
seenkey insert second
runtim error build duplic lattic inlatpath

fail time total broken h decod copi process mani file miss
latticeread


fetch lattic
lattic
numermod
fromhtklattic inlatpath modelsymmap read lattic

frommlf modelsymmap label unigram unigramsymbol read numer lattic
latticeread

write archiv
uint64 offset fgetpo
fwrite
fflush or die

write refer file note file headerless utf8 file fprintf format code page
fprintf or die ftoc msra strfun utf8 brokeninputfil msra strfun utf8 outpath offset
fflush or die ftoc

fprintf stderr written lattic offset offset

except

latticeread
write failur
ignor read failur
fprintf stderr error skip unread lattic inlatpath
brokeninputfil



write unit
todo thi sort redund get symmap alway archiv
writeunitmap symlistpath modelsymmap

fprintf stderr complet lattic read failur infil size infil size brokeninputfil brokeninputfil brokeninputfil infil size


helper context valu left right check uniqu
lattic nodecontext setcontext

unknown


ambigu


helper merg determin uniqu node context
vector lattic nodecontext lattic determinenodecontext msra simplesenonehmm hset

size spunit tryfind hset getsymmap size
size silunit tryfind hset getsymmap size
vector lattic nodecontext nodecontext node size
nodecontext front left nodecontext start
nodecontext front right nodecontext ambigu happen harm either
nodecontext back right nodecontext
nodecontext back left nodecontext ambigu happen sent know
size multispseen entri multi
index edg

edg
size
size
getaligninfo
size edg
logic error determinenodecontext edg allow merg remov
size unit
size size unit
spunit

size
runtim error determinenodecontext context free unit found singl phone word


size unit
spunit bugg lattic h vite track

search warn

size
unit spunit

end posit furthest

runtim error determinenodecontext word consist
fprintf stderr determinenodecontext word found edg size
multispseen
unit



spunit spunit


fprintf stderr totalalign firstalign edg size node size size align size
node node
index
fprintf stderr unit
dump stderr size hset gethmm getnam

runtim error determinenodecontext context free unit found start phone second last phone

ahmm hset gethmm
zhmm hset gethmm
ahmm gettran pindex
zhmm gettran pindex
nodecontext setright
nodecontext setleft

multispseen
fprintf stderr determinenodecontext broken edg multipl seen multispseen edg size
check condit
make hard assumpt phone
silhmm hset gethmm silunit
silid silhmm gettran pindex
index nodecontext

nodecontext
left nodecontext unknown right nodecontext unknown
runtim error determinenodecontext invalid dead node lattic
left nodecontext ambigu right silid right nodecontext
runtim error determinenodecontext invalid ambigu left context right context
right nodecontext ambigu left silid left nodecontext start
runtim error determinenodecontext invalid ambigu right context left context
node

nodecontext move


compar sort merg
lattic nodecontext nodecontext

sort left right sort make appear iother assum merg
diff
diff

diff left left
diff

diff right right
diff
cannot diff pattern sinc size


diff


remov edg
hapi lattic
lattic removefinalnul

lastedg edg back
last edg recogn align record
lastedg firstalign align size align record

lastedg node size lastedg node size
runtim error removefinalnul malform edg
edg resiz edg size remov
node resiz node size start node node
index edg
edg node size
runtim error removefinalnul cannot edg edg connect node time


merg secondari lattic first
with lot caveat
optim lattic unigram lattic uniqu node condit acoust context
edg call removefinalnul
return unsort edg invalid sort uniq represent easier
thi eleg hard labor
lattic merg lattic msra simplesenonehmm hset

edges2 edges2
logic error merg lattic must uniq format
info numfram info numfram
logic error merg lattic must ident frame

establish node context
context determinenodecontext hset
othercontext determinenodecontext hset

creat joint node space node map
thi also collaps uniqu node
note edg lattic ambigu ambigu
ignor keep node unmerg that sinc middl word zero thu keep connect
index context
context
index othercontext
othercontext iother
context insert context othercontext othercontext append othercontext
sort context context
vector size nodemap node size size
vector size othernodemap node size size

index context merg ident node critic step

context context context left context left context right context right
context context enter
node
context size
nodemap context
context iother size
othernodemap context iother

fprintf stderr merg joint node space uniq context size
context resiz

creat node copi context field
node resiz context size
index inew node
node inew context inew
info numnod node size

incorpor align record
size alignoffset align size
align insert align align align

exist edg field also firstalign
index edg

edg nodemap edg
edg nodemap edg

otheredg edg
index otheredg

otheredg othernodemap otheredg
otheredg othernodemap otheredg
otheredg firstalign alignoffset


point node exist edg alreadi node space align space

read merg edg simpli concaten
edg insert edg otheredg otheredg

remov acoust score like ident come differ decod
sort builduniquealign
info hasacscor
index edg
edg

note sort duplic that best done convers uniq format


remov duplic
thi must call uniq format
lattic dedup

edges2
logic error dedup lattic must uniq format

size
index edges2

edges2 edges2 edges2 edges2 edges2 firstalign edges2 firstalign

edges2 implysp edges2 implysp
logic error dedup inconsist implysp flag otherwis ident edg


edges2 edges2

fprintf stderr dedup edg reduc edges2 size
edges2 resiz
info numedg edges2 size
edg clear alreadi make sure longer


load lattic file write archiv

upgrad file format latest format chang
check consist read write
dump stdout
merg lattic merg numer denom lattic
input path actual path output stem ad nice mayb later
exampl command
convertlatticearch latticetoc dummi smbrdebug sw20 small lat smbrdebug sw20 small lat convert cdphoneti smbrdebug combin tie statelist smbrdebug swb300h 9304 align statelist transprob smbrdebug 9304 transprob
regener test lattic
buildlatticearch smbrdebug sw20 small lat regener smbrdebug hvitelat
support special output path syntax
output check format
dash dump lattic stdout instead
archiv convert wstring intocpath wstring intocpath2 wstring outpath
msra simplesenonehmm hset

modelsymmap hset getsymmap

wstring tocpath outpath
wstring symlistpath outpath symlist

open input archiv
todo find h vite emit redund physic triphon even hh ed seem tie file
thu uniq unit sort tie file
modelsymmap
directli hset transpar
vector wstring intocpath intocpath path consist
msra lattic archiv archiv intocpath modelsymmap

secondari archiv option merg oper
mergemod intocpath2 merg lattic
vector wstring intocpaths2
mergemod
intocpaths2 push back intocpath2
msra lattic archiv archive2 intocpaths2 modelsymmap merg archive2

read intocpath file key origin order
vector textbuff
toclin msra file fgetfilelin intocpath textbuff

file
file ftoc

process file
outpath outpath test special syntax bypass actual creat output archiv

msra file make intermedi dir outpath
fopen or die outpath
ftoc fopen or die tocpath

vector invmodelsymmap use dump mode

must pars file key origin order
size skippedmerg
index toclin

line toclin
strchr line

runtim error open invalid line sign line
wstring msra strfun utf16 line line

fprintf stderr convert process lattic

fetch lattic perform necessari format convers alreadi
lattic
archiv getlattic

lattic
mergemod

archive2 haslattic

fprintf stderr convert cannot merg lattic miss secondari archiv skip
skippedmerg


archive2 getlattic

merg
thi connect node match phone context condit aim merg numer lattic
removefinalnul headach
removefinalnul
merg hset
note left dup unigram merg lattic cannot repres unigram lattic sinc node

removefinalnul
determinenodecontext hset

convert todo perman format fread
note merg left unsort format need robust
size spunit tryfind modelsymmap size
builduniquealign spunit

mergemod
dedup

ftoc

write archiv
uint64 offset fgetpo
fwrite
fflush or die

write refer file note file headerless utf8 file fprintf format code page
fprintf or die ftoc msra strfun utf8 msra strfun utf8 outpath offset
fflush or die ftoc

fprintf stderr written convert lattic offset offset

outpath

invmodelsymmap build lazili

invmodelsymmap resiz modelsymmap size
iter modelsymmap iter modelsymmap iter
invmodelsymmap iter second iter first

rebuildedg
dump stdout size

invmodelsymmap


toclin
skippedmerg
fprintf stderr convert merg oper skip secondari lattic miss skippedmerg toclin size

write updat unit
ftoc
writeunitmap symlistpath modelsymmap

fprintf stderr convert lattic toclin size



read lattic extern format


read lattic
lattic expect freshli construct bother check
lattic fromhtklattic wstring path unord size unitmap

vector textbuff
line msra file fgetfilelin path textbuff
line
runtim error lattic form lattic input file zero
iter line
pars
dummychar dummi sscanf check
iter line strncmp iter iter

strncmp iter lmscale note sometim gener extra garbag space line
sscanf iter lmscale wdpenalti info info dummychar dummychar dummychar
runtim error lattic form lmscale wdpenalti line lattic iter


pars
iter line


sscanf iter dummychar dummychar
runtim error lattic form line lattic iter
info numnod
info numedg
iter


runtim error lattic form pars line lattic

info numnod
node reserv info numnod
pars node
size info numnod iter

iter line
runtim error lattic enough line lattic
itest

sscanf iter itest dummychar dummychar
runtim error lattic form node line lattic iter
size itest
runtim error lattic sequenc node line lattic iter
node push back nodeinfo info framedur
info numfram info numfram size node back

pars edg
info numedg
edg reserv info numedg
align reserv info numedg phone word enough
label
size info numedg iter

iter line
runtim error lattic enough line lattic
jtest


1024
exampl

nval sscanf iter jtest
nval info numedg special last edg thu record miss
strcpi
nval
runtim error lattic form edg line lattic iter
size jtest
runtim error lattic sequenc edg line lattic iter
edg push back edgeinfowithscor align size
build align
size edgefram check whether align sum right

info numedg last edg
runtim error lattic align info must start colon must least entri iter



point entri form triphon durat
strchr

runtim error lattic align entri lack comma iter

runtim error lattic align entri label iter
label assign triphon label


durat strtod weird return


runtim error lattic align entri end colon iter

creat align entri
size frame durat info framedur
unitmap find label
unitmap
runtim error lattic unit align model label
size unitid second
size unitid unitmap insert make pair label unitmap size first second creat entri index entri
align push back aligninfo unitid frame
edgefram frame

edgefram node size node


sprintf edgefram node node edgefram node size node edgefram node node
runtim error lattic align info durat mismatch edg durat iter


iter line
runtim error lattic unexpect garbag lattic iter
checklattic

creat effici storag align
size spunit tryfind unitmap size
builduniquealign spunit

showstat


construct numer lattic entri
lattic expect freshli construct bother check
lattic frommlf wstring unord size unitmap
msra htkmlfreader msra htkmlfentri lattic htkmlfwordsequ label
msra cm gram lm unigram msra c symbol set unigramsymbol

transcript label allwordtranscript todo could transcript realli matter

label state word
iter transcript find
iter transcript
runtim error frommlf refer word sequenc lattic
transcript iter second
transcript word size
runtim error frommlf refer word sequenc lattic

determin unigram score word
vector lmscore transcript word size
size silenc unigramsymbol silenc
size lmend unigramsymbol
size sentstart unigramsymbol sent start
size sentend unigramsymbol sent

creat lattic
node resiz transcript word size
edg resiz transcript word size
align reserv transcript align size
size numfram
index transcript word

transcript word
node firstfram
edg
unus



runtim error frommlf mani token repres edgeinfo label
score

score
sent start silenc patch score
size wordindex
sentstart


logic error frommlf found sent start token first posit

sentend

transcript word size
logic error frommlf found sent token posit
lmend score lookup

iwid
sentstart silenc unigram score iwid

align
implysp
firstalign align size
transcript getaligninfo
align insert align
index
numfram frame

node transcript word size numfram
node transcript word size numfram
runtim error frommlf mani frame repres nodeinfo label
info indic
info indic
info numedg edg size
info numnod node size
info numfram numfram
checklattic

creat effici storag align
size spunit tryfind unitmap size
builduniquealign spunit

showstat




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
htkmlf reader compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

data reader defin export function applic


stdafx
basic

defin dataread export
defin datawrit export
htkmlf reader
htkmlf writer

microsoft cntk

dataread get reader f i data reader preader

preader htkmlf reader

dataread get reader d i data reader preader

preader htkmlf reader


datawrit get writer f i data writer pwriter

pwriter htkmlf writer

datawrit get writer d i data writer pwriter

pwriter htkmlf writer


ifdef win32
util config file htkmlf reader need code

trim trim white space start
trim
note entir
trim

found find first
found npo

eras


eras found
found find last
found npo
eras found





copyright microsoft right reserv
licens licens licens file project root full licens inform

htkmlf reader defin export function applic


stdafx
ifdef win32
objbas

basic

htkfeatio read featur
ssematrix

defin datawrit export creat export
data writer
config
htkmlf writer
ifdef leakdetect
memori leak detect


microsoft cntk

creat data writer
datawrit i data writer data writer factori

elem type
config record type
htkmlf writer elem type init from config config record type writer config

temp array nullptr
temp array size

vector wstring scriptpath
vector wstring filelist
size num file
size firstfilesonli size lower valu test

vector wstring output name writer config output node name config record type array stringargvector
output name size
runtim error writer need least output node name specifi config

index output name input name node name

config paramet thi output writer config output name
thi output exist
udim push back thi output

runtim error htkmlf writer init writer need specifi output

thi output exist file
scriptpath push back thi output file
thi output exist scp file
scriptpath push back thi output scp file

runtim error htkmlf writer init writer need specifi scp file output

output name to id map output name
output name to dim map output name udim
wstring thi output real
real

output name to type map output name output type output real



runtim error htkmlf writer init output writer output expect real



num file
index scriptpath

filelist clear
wstring script path scriptpath
fprintf stderr htkmlf writer init read output script file script path
size
msra file textread reader script path reader filelist size firstfilesonli optim

filelist push back reader wgetlin



fprintf stderr entri


num file
num file
runtim error htkmlf writer init file scriptfil inconsist num file

output file push back filelist

output file index
samp period 100000


elem type
htkmlf writer elem type destroy

temp array
temp array nullptr
temp array size


elem type
htkmlf writer elem type get section wstring section type nocas compar section



elem type
htkmlf writer elem type save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size


wstring nocas compar iter iter
output file index output file size
runtim error index output file rang

iter matric iter matric iter

wstring output name iter first
matrix elem type output data cast matrix elem type iter second
size output name to id map output name
size output name to dim map output name
wstring out file output file output file index

output data get num row


save out file output data


output file index




elem type
htkmlf writer elem type save wstring output file matrix elem type output data

msra matrix output
output resiz output data get num row output data get num col
output data copi to array temp array temp array size
elem type p valu temp array

output data get num col

output data get num row

output p valu



size nansinf output countnaninf
nansinf
fprintf stderr chunkev na ns detect frame nansinf output file output col
save
msra file make intermedi dir output file
msra util attempt

msra htkfeatwrit write output file user samp period output


fprintf stderr evalu write frame output col output file


elem type
htkmlf writer elem type save map wstring save id label id type label type label map



htkmlf writer
htkmlf writer


copyright microsoft right reserv
licens licens licens file project root full licens inform

data writer defin export function applic

todo thi similar ident common data writer data writer differ reconcil


stdafx
basic

htkfeatio read featur

defin datawrit export
data writer
htkmlf writer

microsoft cntk

config record type
data writer init from config config record type writer config

wstring precis writer config precis
precis
data writer htkmlf writer
precis
data writer htkmlf writer

invalid argument data writer htkmlf writer precis paramet must

data writer init writer config


destroy cleanup remov
note destroy use past point
data writer destroy

data writer
todo need destroy well


data writer constructor
config configur writer
config record type
data writer data writer config record type config

init config


destructor cleanup temp file
data writer data writer

destroy


get section section file
section section name section data sepcif config file use determin save
data writer get section wstring section type nocas compar section

data writer get section section


save data save file file
record start start record
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
data writer save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

data writer save data record start matric num record dataset size byte variabl size


save map save file
save id name section save section subsect format
label map save file
data writer save map wstring save id label id type label type label map

data writer save map save id label map




copyright microsoft right reserv
licens licens licens file project root full licens inform

binari writer defin export function applic


stdafx
basic
defin datawrit export creat export
data writer
binari reader

microsoft cntk

destroy cleanup remov
note destroy use past point
elem type
binari writer elem type destroy




destructor get call properli
elem type
binari writer elem type binari writer

clear section refer delt section file destructor
section clear

sectionfil
pair sec file

pair second

sec file clear


init writer initi multipl set section
config configur paramet datawrit
sampl format binari writer
writer
writer implement reader writer
writer type binari writer
mini batch mode partial
random
wfile speech mnist mnist test
wsize init size file
larg enough dataset file shrink actual size close
wsize
wrecord record alloc space file
file cannot expand larg enough known modifi element config creat file
wrecord 50000
featur

start
section type
stat
section type stat
element size
comput count mean varianc stddev rang


label

label index
element size
wref featur
section type label
map
redefin record section sinc need save record
wrecord
variabl size averag size
element size
section type label map

categori

element size elem type
section type categori label

label type categori




elem type
section binari writer elem type creat section scriptabl object i config record section size size

invalid argument binari writer current implement brain script
reason binari writer need config path also avail brain script


elem type
section binari writer elem type creat section config paramet config section parent section size record size window size

first check need open section file
vector wstring section

determin element size elem type size
size element size elem type
config exist current element size

element size config element size


record expect
defin previou level use
size record record
config exist current wrecord

record config wrecord

record

invalid argument requir config variabl wrecord miss binari writer configur


size dimens singl item
config exist current

config


section use cach
section type section type section type null
config exist current section type

section type found type section type null
wstring config section type
section type max

equal ci section type string

found type section type




check make sure match someth
found type section type null

invalid argument invalid valu section type binari writer configur

section type found type


calcul byte element size record
size data onli size record element size
size data size data onli size section header min

filenam defin level none parent file
section file file
config exist current wfile

wstring wfile config wfile
sec file sec file find wfile
sec file sec file

file sec file second



todo saniti check record clue make
size initi size config wsize size 256 mb provid
initi size 1024 1024 convert byte
initi size data size
initi size data size make init size slightli larger need
file section file wfile file option read write initi size
sec file wfile file
parent section file file section
parent section set element count record
parent section set file uniqu id uniqu id



file defin config level parent file
parent section parent section get section file

file parent section get section file

section type section type null

invalid argument filenam wfile defin binari writer configur



determin file posit need
size file posit last
size file posit next

file

avail posit file alway
file posit last file get file posit max
file posit next file round up file posit last

zero keep file clean
file posit last file posit next

size size file posit next file posit last
size round down file round up file posit last file get view align
need veiw zero use byte
view file get view round down file get view align
view file posit last file get view align
memset size
file releas view view



section name
section name config config name

window size want separ element map
size window size window size
config exist current window size

window size config window size

map type map main window size map element window map parent
map type map aux window size map section map parent

creat section
section section
section type

section type null
happen origin file header noth
also use multipl file defin none level

section type file file header
occur

section type data section
section section file parent section file posit next map main data size
section init header section type data section name data section section data float elem type

section type label label

size element size label id type
data size record element size section header min
section label section label file parent section file posit next map main data size
section data data type section data int
label kind label kind label categori
config match label type regress

label kind label regress
data type section data float
element size elem type

config match label type categori

everyth alreadi valu



runtim error invalid label type miss binari writer configur


initi section header
section label init header section type label section name label data type word element size

initi special label header item
section label set label kind label kind
section label set label dim config label dim
section section label


section type label map label map tabl string
section section string file parent section file posit next map aux data size
section init header section type label map section name label section data string variabl length string
section set flag flag auxilari section
section set flag flag variabl size

section type stat statist

config array calc stat config comput
record calc stat size
element size numer statist
data onli size record element size
data size data onli size section header min
section stat section stat file parent section file posit next map aux data size
section stat init header section type stat section name data statist section data struct numer statist variabl length string
section stat set flag flag auxilari section
section section stat


section type categori label
section section file parent section file posit next map main data size
section init header section type categori label section name categori label section data float elem type variabl length string



rest header variabl necessari
section

file section alreadi creat
section parent section



section set element size element size
section set element per record
section set element count record
section set size data size
section set size all data size

window size record convert byte
size data window size window size window size element size data onli size
clamp actual size
data window size data onli size data window size

pointer setup alloc view necessari
aux section section get flag flag auxilari section
section ensur element aux section data onli size data window size

updat file posit section
file set file posit max section get file posit data size

section parent
parent section add section section


from fulli usabl section

find subsect
vector wstring subsect
find config name config section type subsect

look children creat well
wstring subsect subsect

creat section config subsect section record window size


wait everyth map valid
section type section type stat

config array calc stat config comput
section stat section init comput calc stat


section
section type section type file section type section type null

wstring wsection name msra strfun utf16 section name
ident name write configur
section find wsection name section

runtim error ident section name appear twice section name

section wsection name section


valid header make sure sane
section file section valid header file write

runtim error invalid header file header file get name section get name


complet section
section


init initi binari writer
config configur binari writer
elem type
config record type
binari writer elem type init from config config record type config

initi variabl
record current
record max config wrecord size
trace level config trace level
uniqu id word get tick count

configur recurs creat subfil section well
creat section config record max


get section section file
section section name section data sepcif config file use determin save
elem type
binari writer elem type get section wstring section type nocas compar section

pair section

section pair first pair second get section type



save data save file file
record start start record dataset size multipl pass
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
return desir requir signal file close
elem type
binari writer elem type save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

allow restart write session thi use primarili write entir section
record start

record current record start


make sure gap write
record current record start

runtim error cach binari writer record skip record current record start

written
pair section

section section pair second
written section save data record start matric num record dataset size byte variabl size written

current record expect write
record current record start num record

written


save map save file
save id name section save
label map save file
elem type
binari writer elem type save map wstring save id binari writer elem type label id type binari writer elem type label type label map

section section section save id
section get section type section type label map

section string section string section
section string set label map label map



instanti combin expect use
binari writer
binari writer

stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
data reader
defin datawrit export
data writer
binari reader

microsoft cntk

dataread get reader f i data reader preader

preader binari reader

dataread get reader d i data reader preader

preader binari reader


datawrit get writer f i data writer pwriter

pwriter binari writer

datawrit get writer d i data writer pwriter

pwriter binari writer




copyright microsoft right reserv
licens licens licens file project root full licens inform

binari file defin binari file


stdafx
data reader
binari reader
limit
stdint

microsoft cntk

high dword function
dword hidword size size

size

dword lodword size size

size 0x ffffffff


binari file constructor
file name file read creat exist
option file option file option read write file option read accept
size size file expand contract exist file given size zero mean keep current size
binari file binari file wstring file name file option option size size


system info sy info
get system info sy info
view align sy info dw alloc granular
file creat file

write file option file option read write
name file name
max view size 0x10000000 256 mb initi size
hnd file creat file file name write file gener write gener read gener read
file share read open alway file attribut normal
hnd file invalid handl valu

messag
sprintf messag unabl open creat file error file name get last error
runtim error messag


code detect file network local
wstring path
found file name find last
found npo
path file name

path file name substr found
drive type get drive type path

actual size file
size

get file size ex hnd file plarg integ size

file posit max size

hnd map
creat file map hnd file
write file page readwrit page readonli
hidword size lodword size

hnd map

messag
sprintf messag unabl file error file name get last error
runtim error messag

map size size

write file init size file zero
write file

file posit max



destructor destroy binari file
binari file binari file

iter view iter view

view
iter releas view iter

todo check error code uncaught except
close handl hnd map

write file truncat actual size
write file

set file pointer ex hnd file larg integ file posit max file
set end of file hnd file

close handl hnd file


binari file set file posit max size file posit max

file posit max file posit max
file posit max map size

messag
sprintf messag set posit larger map file size file posit max map size
runtim error messag



map check current address map
file posit file posit search
size size map region
size region actual map start file posit
return address alreadi map complet
vector view posit iter binari file map size file posit size size

iter view
iter view iter

file posit iter file posit
file posit size iter file posit iter size

size
know answer posit
size iter file posit iter size file posit



iter


find data view find view contain pointer valu
pointer search
return iter found view found
vector view posit iter binari file find data view

search view want
iter view
iter view iter

view begin iter view
view begin view begin iter size


iter


find view find view map pointer pointer begin
view pointer view search
return iter found view found
vector view posit iter binari file find view view

iter view
iter view iter

iter view view


iter


find view find view file posit
file posit file posit search
return iter found view found
vector view posit iter binari file find view size file posit

iter view
iter view iter

iter file posit file posit


iter


releas view releas view iter
iter iter view
return element view vector valid
vector view posit iter binari file releas view vector view posit iter iter forc

forc iter ref count

iter ref count
iter



write file
flush view of file iter view iter size
unmap view of file iter view

iter view eras iter

iter


get view view file
file posit file posit view start
size size view byte
return pointer view
binari file get view size file posit size size

p buf map view of file hnd map handl
write file file write file read correct permiss
hidword file posit
lodword file posit
size
p buf

messag
sprintf messag unabl file error name file posit get last error
runtim error messag

view push back view posit p buf file posit size

updat file posit neccesari
size file posit end file posit size
file posit max file posit end
file posit max file posit end
p buf


releas view releas view file
view view releas must return get view previous
binari file releas view view

found
iter view iter view iter

iter view view

releas view iter
found



view releas could found
found


realloc view realloc view
view pointer view
size size view
return pointer realloc view
note realloc view address chang
binari file realloc view view size size

view po find view view
view po view

size file posit view po file posit
releas view view po
view get view file posit size



find view realloc

view

view


ensur view size ensur view least particular size
view pointer view
size minimum size view
return pointer view least size byte larg
note realloc view address chang
binari file ensur view size view size size

view po find view view
view po view

view po size size

size file posit view po file posit
releas view view po
view get view file posit size




find view realloc

view

view


ensur map ensur view least particular size
data pointer pointer
size alloc size
return pointer locat least size byte larg
note realloc view address chang
binari file ensur map size size

view po find data view
view po view

int64 offset view po view
int64 data end offset size

beyond size view need realloc
data end int64 view po size

todo view chang accomid request
size file posit view po file posit
releas view view po
view get view file posit data end
view offset




find view realloc






round up round file posit mappabl locat intend map locat separ
file posit posit file want round
size binari file round up size file posit

size round to view align
file posit round to round to round to


section file constructor
file name file read creat exist
option file option file option read write file option read accept
size size file expand contract exist file given size zero mean keep current size
section file section file wstring file name file option option size size
binari file file name option size

file section section map file section header min
write file

file section init header section type file binari data file section data none


check file header
file section valid header write file

messag
sprintf messag invalid file format binari file file name
runtim error messag



section file destructor
section file section file

remov section
section header header file section get header

finish file magic
write file

header w magic magic file


file section
file section
file section
binari file destructor take care clean section map memori map file


section init header section type descript section data data type word element size


memset section header section header min
section header w magic section type file magic incomplet magic section magic ace9 4 ace
section header version 0x0100 version
section header size header section header min size header round nearest boundari
section header data section section nest
section header section type word section
section header section data word data type section section data
section header byte per element element size byte element mean variabl
section header custom structur id custom structur none custom structur
section header element per record element record
section header flag flag none flag depend section type
section header element count total element store
memset section header name descript descript size clear buffer zero first
strcpi section header name descript descript name descript section content format name descript extra byte zero least termin requir
section header size section header min size section includ header
section header size all section header min size section includ header section
section header section file posit section file offset need assum file posit order



valid header make sure everyth header valid
section valid header write

valid
valid section header w magic magic file section header w magic magic section write section header w magic magic incomplet magic ace9 4 ace
valid section header version 0x0100 version
valid section header size header section header min section header size header section header min size header round nearest boundari
valid section header data section section header size header offset section header section file posit size section nest
valid section header section type section type max section
valid section header section data section data max section section data
section header byte per element element size byte element mean variabl
valid section header custom structur id custom structur max custom structur
section header element per record element record
valid section header flag flag max flag depend section type
section header element count total element store
strcpi section header name descript descript name descript section content format name descript extra byte zero least termin requir

size section must least accomid header element
valid section header size section header size header section header element count section header byte per element size section includ header section
valid section header size all section header size header section header element count section header byte per element size section includ header section
there integr record file element count element per record
valid section header element per record section header element count section header element per record

file posit must order
size file posit last
section header data section

valid section header section file posit file posit last section file offset need assum file posit order

valid
valid


get name name section valu overridden user
wstring section get name

name
name

name descript header
wstring name descript msra strfun utf16 section header name descript
first colon name descript find first
first colon npo name descript size first colon

name name descript substr first colon


name descript colon
name


get section section section
index index section
map map desir section
size element size map window record map element window
section section read section size index map type map size size element

check valid index
section size index

runtim error read section invalid index


alreadi load
section index
section index

load load map
size file posit section header section file posit index

section section
size load size
section header header get section header file posit map load size

make sure request record
size element header element count header element per record size element
convert record byte
size element header element per record header byte per element

header section type


section section file header file posit map load size

section type label map
section section string file header file posit map load size
variabl size section size size section byte
support separ window variabl size
size element section get size section get header size

section type label
section section label file header file posit map load size

section type stat
section section stat file header file posit map load size



make sure header valid
section valid header

messag
sprintf messag invalid header file header file get name section get name
runtim error messag


setup element map pointer need
section ensur element size element

section parent section
section index section
section


destructor destroy section
section section

section section
iter section iter section iter

section section iter
section map skip
section

section

section clear


ensur element make sure element rang avail read write
element begin element access
byte request byte request
return pointer element request
section ensur element size element size byte request

everyth alreadi setup pointer
get flag flag variabl size support variabl size entri handl section subclass
size element request byte request get element size
element element request get element count

messag
sprintf messag element rang error acces element size element byte request
runtim error messag


make sure buffer rang handl request
element elem min element element request elem max element buffer

get element buffer element byte request


element buffer element elem min get element size


get element buffer element buffer pass element size
element element want element buffer start
window size minimum size window byte element window resiz smaller
return pointer element buffer
section get element buffer size element size window size

check element rang
file write element get element count

messag
sprintf messag element rang error acces element element element get element count
runtim error messag


section map whole separ map element buffer
map type map element window

map togeth header offset
element buffer section header section header size header
elem min
file write

elem max window size
variabl size section element size byte
get element size
elem max get element size



elem max get element count

map element size use element window map

save header size reestablish pointer necessari
size header size section header size header
element buffer section header
element buffer
ensur map element buffer window size

check map chang updat pointer
element buffer element buffer

element buffer element buffer
section header header size


element buffer


window size larger increas map size
map element size window size
map element size window size

element size specifi size
map element size
map element size 1024 1024 size 16 meg

element map
size element map count map element size get element size
element map count element map count get element count
map element size element map count get element size

file posit element
element element map count get element count

elem min get element count element map count
elem max get element count



elem min element
elem max elem min element map count

size section posit get header size elem min get element size

align view locat
size align boundari file get view align
size view posit section posit file posit align boundari align boundari
size offset section posit file posit align boundari

releas view current view
element view

file releas view element view

element view file get view view posit map element size offset
element buffer element view offset
element buffer


remap header updat view pointer view chang section view
view view pointer pass file posit
file posit file posit view refer
section remap header view size file posit

iter section iter section iter

section section iter
section map skip
section

section map type map parent

int64 offset section file posit file posit
offset
runtim error remap header invalid map children must follow parent map space

updat header locat
section header header section section header section header view offset
section element buffer header header size header
updat children
section remap header view file posit




ensur map size make sure map section least size
size size
section ensur map size size size

call map owner map least section
map type map element window
section map owner
view file ensur view size section header size

check remap
view section header

section header section header view
element buffer section header section header size header
remap header view file posit



ensur map make sure pointer pass map appropri
data start start pointer locat want map
size size start pointer
return map applic
section ensur map data start size size

call map owner
view file ensur map data start size

check remap section map need
check map owner differ
view data start

element window map separ need remap
map type map element window

int64 offset view data start
section header section header section header offset
element buffer section header section header size header
remap header section header file posit


view


get section header retriev section header possibl entir section
file posit posit file section start
map type map header chang depend header
size size read read entir section size header
size actual map section
return pointer section header
section header section get section header size file posit map type map type size size

section header section header
map type

map parent

section owner section map owner
file posit section owner get file posit
runtim error invalid fileposit cannot earlier file map parent
size offset file posit section owner get file posit
size total size offset size size section header min

make sure least header
section owner get map size total size

section owner ensur map size total size

section header section header section owner get header offset

read actual real header size realloc need well
file write

size section header size
total size offset size
section owner get map size total size

section owner ensur map size total size




map file
file posit
runtim error invalid fileposit file map section must start file postion zero
intent fall begin file
map section all
section header file get section file posit size
file write

size new size section header size all
new size size
section header section header file realloc view section header new size
size new size


map section

section header file get section file posit size


map element window
size size header section header min
section header file get section file posit size header
size size header
alloc element view time later
thi allow area file care

read actual real header size realloc need well
file write

howev alway auxiliari section know map section
section header flag flag auxilari section flag variabl size

size section header size
file releas section section header
section header file get section file posit size
map type map section





header
section header


get section retriev section header possibl entir section
file posit posit file section start
size size read read entir section size header
size actual map section
return pointer section header
section header section file get section size file posit size size

determin size size
determin size
size section header min
section header bin header section header get view file posit size

write file figur size need
write file

map size larg enough section want alloc entir thing
bin header size size determin size

size bin header size
bin header section header realloc view bin header size

size enough header need least much
bin header size header size

size bin header size header
bin header section header realloc view bin header size

size bigger entir section reduc actual size map
bin header size all size

size bin header size
bin header section header realloc view bin header size




memset bin header section header min
bin header section type section type data
bin header w magic magic section
bin header version 0x0100
bin header size header section header min
bin header size size current map size header
bin header size all size size element size

bin header


releas section releas section file
section section releas must return get section previous
section file releas section section header section

releas view section


section map owner find section own map view section
return section own map
section section section map owner

section section
current section parent map map owner
section map type map parent

section map type map section all section map type map file



search backward look map owner
section parent

section section parent
section map type map section all section map type map file

section



oop noth found map error
map error map parent found



section constructor
initi section variabl
write initi header must done caller
section section section file section file section parent section size file posit map type map type size size

init section file parent section file posit map type size


section constructor
initi section variabl
write initi header must done caller
section section section file section file section parent section section header section header size file posit map type map type size size

init section file parent section section header file posit map type size


init section
file section file belong
parent section parent section
section header section header pointer map section map
file posit posit file header start
map type map section
size size section read zero actual size section use
note write initi header call init header header init
section init section file file section parent section section header section header size file posit map type map type size size

file file
file posit file round up file posit
parent parent section
map type map type

size section header min file write
runtim error insuffici size request section write mode

clear element window map variabl
element view pointer begin valid view
element buffer buffer pointer
map element size size map element view use map element window map type
elem min current map minimum valu first valid
elem max current map maximum valu past last valid

section header

section header get section header file posit map type size
map type map type modifi get section header

section header section header

resiz section correct initi zero show actual map area
section header data section
section resiz section header data section

map size size


add section subsect section
thi handl alloc necessari well updat header valid file posit
current limit ad section parent section
section to add subsect ad section
section section add section section section to add

file posit
section section

size file posit section to add get file posit file posit
size size round file round up section get size

parent
section to add set parent

parent header section file
section to add get section file section get section file

section header header section get header
header section file posit header data section file posit
header data section header section file posit header data section file posit
runtim error invalid fileposit section subsect cannot start earlier file parent section

updat size perviou ancestor section

size section parent setion alway assum
size round file round up header size all
size round section to add get size section
header size all size round

section file level need updat past
section get map type map file

section section get parent
header section get header
section section to add get section file section get section file


section memori
section push back section to add

section to add


save data save file file
record start start record dataset size multipl pass
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
return desir requir signal file close
section save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

section section
section stream save anyth
implement stat process
iter matric find get name
iter matric



data sourc iter second

want save first iter
record start dataset size




size index record start section get element per record
size size
byte variabl size get flag flag variabl size
size byte variabl size
section get element size
size section get element size section get element per record num record


allow
runtim error invalid size binari writer variabl size length


section ensur element index size
section get element index
memcpi size data sourc size
record start num record get record count


section string section string section file file section parent section section header section header size file posit map type map type size size
section file parent section section header file posit map type size


section string section string section file file section parent section size file posit map type map type size size
section file parent section file posit map type size



get label map label map current file
translat represent file
return label id label
section string label id type section string label type section string get label map

map id to label size

get element
section string label id type element section string label id type get element count
section string label id type element element element element

string label
map id to label element string label
map label to id string label element

advanc stop




map id to label


set label map map
section string set label map section string label id type section string label type label map

section section
label map size get element count
runtim error set label map call map tabl match file defin element count
get section type section type label map
runtim error label invalid

free map tabl
map label to id clear
map id to label clear

write pass map tabl
cur str section get element
size size section get size section get header size
size origin size size
section get element count

iter label map find
iter label map

messag
sprintf messag map tabl contain entri label
runtim error messag


revers map tabl
map label to id iter second

iter second
errno strcpi cur str size


messag
sprintf messag enough room map buffer byte insuffici origin size
runtim error messag

size length forget
size
cur str


zero rest free space
memset cur str size

store result
map id to label label map


get element element given index
section string get element size index

element buffer
index get element count

messag
sprintf messag get element invalid index request element index get element count
runtim error messag


skip string want
section string label id type element element index element

advanc stop






ensur element make sure element rang avail read write
element begin element access
byte request byte request
return pointer element request
section string ensur element size element size byte request

everyth alreadi setup pointer
get flag flag variabl size support variabl size entri
get map type map element window support tabl current
element get element count

messag
sprintf messag element rang error acces element size element byte request
runtim error messag


make sure buffer rang handl request
element buffer

get element buffer element byte request


get element element


section label section label section file file section parent section section header section header size file posit map type map type size size
section file parent section section header file posit map type size


section label section label section file file section parent section size file posit map type map type size size
section file parent section file posit map type size



store store stat file
section stat store

get element count

stat get element numer statist
equal ci stat statist

stat valu

equal ci stat statist count

stat valu count

equal ci stat statist mean

stat valu mean

equal ci stat statist

stat valu

equal ci stat statist

stat valu

equal ci stat statist rang

stat valu

equal ci stat statist rootmeansquar

stat valu

equal ci stat statist varianc

stat valu varianc

equal ci stat statist stddev

stat valu stddev



fprintf stderr unknown statist request file stat statist




section stat section stat section file file section parent section size file posit map type map type size size
section file parent section file posit map type size



section stat section stat section file file section parent section section header section header size file posit map type map type size size
section file parent section section header file posit map type size



set comput initi statist gather locat
comput config name stat want record
section stat init comput config array comput

set element count comput size
comput size

name comput
stat get element numer statist
strcpi stat statist name
stat valu


initi variabl
count element
maximum valu seen
minimum valu seen
number seen
sum2 squar number seen

comput singl
mean mean valu
root mean squar

second measur
var sum accumul differ mean valu squar

comput second
varianc
stddev

progress variabl
pmean
pvarianc


set comput comput variabl valu
name name comput variabl
valu valu
section stat set comput name valu

get element count

stat get element numer statist
equal ci stat statist name

stat valu valu





get comput comput variabl base name
name name comput variabl
return valu variabl
section stat get comput name

get element count

stat get element numer statist
equal ci stat statist name

stat valu





save data save file file
record start start record dataset size multipl pass
matrici section name section subsect pointer data sepcif config file use determin save
num record record save zero applic
dataset size size dataset
byte variabl size variabl size size current block written zero use ignor variabl size
return desir requir signal file close
section stat save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size

section stream child ignor
iter matric find parent get name
iter matric



data sourc iter second

size element size parent get element size
ret val
element size
ret val accumul data data sourc num record record start dataset size
element size
ret val accumul data data sourc num record record start dataset size
ret val


defin pass
accumul data accumul dataset
templat handl valu
data sourc pointer
num record record data sourc
record start record start
dataset size size dataset
elem type
section stat accumul data elem type data sourc size num record size record start size dataset size

first want calcul sum squar sum
record start dataset size


elem type elem p elem type data sourc
elem type elem p max elem p parent get element per record num record

valu
elem p elem p max

elem type elem elem p
keep current count easier math
size cur count count
count

calcul progress mean varianc
http mathworld wolfram sampl varianc comput html
prev mean pmean
pmean pmean elem pmean count
cur count

mean differ pmean prev mean
pvarianc cur count pvarianc count mean differ mean differ


accumul sum
elem
sum2 elem elem
elem
elem
elem
elem
elem p


check last chunk first
record start num record dataset size

mean count
sum2 count
sqrt
varianc pvarianc
stddev sqrt varianc

error mean pmean
error 00001
printf substanti differ progress mean
defin pass
sinc done store valu
store





defin pass
record start dataset size

elem type elem p elem type data sourc
elem type elem p max elem p parent get element per record num record

valu
elem p elem p max

elem type elem elem p
diff elem mean
var sum diff diff


check last chunk first
record start num record dataset size

varianc var sum count
stddev sqrt varianc
error pvarianc varianc
error 00001
printf substanti differ progress varianc

sinc done store valu
store





done




copyright microsoft right reserv
licens licens licens file project root full licens inform

binari reader defin export function applic


stdafx
defin dataread export creat export
data reader
binari reader
ifdef leakdetect
leak detect


microsoft cntk

destroy cleanup remov
note destroy use past point
elem type
binari reader elem type destroy




load section load section file
section root section whose children enumr
note call recurs obtain full section heirarchi
elem type
binari reader elem type load section section section root map type map size window size

section count section root get section count
section count

section new section section root read section map window size
found section find new section get name
found section

runtim error load section duplic section name alreadi defin previous new section get name

section new section get name new section
load subsect
load section new section map window size



init reader initi multipl set
config configur paramet dataread
sampl format
paramet valu reader
reader
reader
reader type binari reader
mini batch mode partial
file
speech mnist mnist featur
speech mnist mnist label



vector wstring get comma separ item config paramet config wstring

config array file config
stringargvector file

vector wstring get comma separ item scriptabl object i config record config wstring

config vector wstring


elem type
config record type
binari reader elem type init from config config record type reader config

load file config info root level
vector wstring file config
vector wstring file get comma separ item reader config file
m one line per file
m one line per file reader config onelineperfil
reader config size
total sampl
size window size reader config window size size
map type map window size map element window map section

m one line per file

file size

file sec file wfopen file
sec file nullptr
f stream push back sec file

logic error binari reader init cannot find read file




file size

section file sec file section file file file option read
size record sec file file section get record count

total record
section flag flag sec file file section get flag
total sampl flag flag auxilari section

total sampl record

otherwis want check make sure

record total sampl flag flag auxilari section
runtim error multipl file differ record count cannot use togeth


sec file push back sec file

section file
section section sec file file section
load section section map window size


initi variabl
mb start sampl epoch epoch start sampl
partial minibatch
trace level reader config trace level

determin partial minibatch desir
minibatch mode reader config minibatch mode partial
partial minibatch equal ci minibatch mode partial

initi load complet
display properti


elem type
binari reader elem type display properti

trace level


fprintf stderr binari reader
enumer file
section file file sec file

section section file file section
fprintf stderr file record file get name section get element count


pair section

section section pair second
fprintf stderr section element element per record element size pair first section get element count section get element per record section get element size
section get section type section type stat

vector numer statist stat
stat resiz section get element count
size size numer statist stat size
get data pair first stat size stat size
fprintf stderr stat
numer statist stat stat

fprintf stderr stat statist stat valu

fprintf stderr




destructor get call properli
elem type
binari reader elem type binari reader

clear section refer delet section file destructor
section clear

section file sec file sec file

sec file

sec file clear

size f stream size

todo check error code uncaught except
fclose f stream



start minibatch loop startup minibatch
mb size size minibatch sampl
epoch epoch request epoch sampl must specifi epoch zero complet
request epoch sampl sampl random default request data size use sampl dataset
valu must multipl mb size round
elem type
binari reader elem type start minibatch loop size mb size size epoch size request epoch sampl

mb size mb size
request epoch sampl request data size

want dataset size first file dataset size
total sampl
runtim error section file contain total sampl determin dataset size
request epoch sampl total sampl

epoch size request epoch sampl
epoch epoch

setup epoch


check end dataset check arriv dataset
actualmbs actual size dataset request
return dataset otherwis
elem type
binari reader elem type check end dataset size actualmbs

size epoch end epoch size
size epoch sampl mb start sampl epoch size

check size last minibatch
epoch sampl actualmbs epoch end

actualmbs epoch end epoch sampl


make sure take account hit dataset wrap around
actualmbs total sampl mb start sampl total sampl actualmbs

actualmbs




want partial minibatch skip
actualmbs mb size partial minibatch

mb start sampl actualmbs





get minibatch minibatch featur label
matric name matrix type featur label map correspond matrix
matrix resiz necessari contain
return minibatch minibatch remain
elem type
binari reader elem type tri get minibatch stream minibatch input matric

call start minibatch loop first
mb size


check chang epoch done
mb start sampl epoch size epoch




actual size either request total sampl read
size actualmbs total sampl mb size still less sweep
size epoch start sampl mb start sampl total sampl

end of dataset check end dataset actualmbs
end of dataset


valu matric

matrix name valu first
gpu data matric get input matrix elem type matrix name
section section section matrix name
size row section get element per record
section data data type
size data size
section get data type size data type data size

type expect
data type section data float data size elem type

label need subsect
section get section type section type label

categori label found
section label section label section label section
categori check save
section label get label kind label categori

section section categori
section get section count

section categori section read section

found categori label
section categori get section type section type categori label

section section categori
row section get element per record
section get data type size data type data size
categori label found



categori label found

runtim error categori label save file either save support creation binari reader




make sure good
data type section data float data size elem type

runtim error categori label save file either save support creation binari reader


size size row data size actualmbs
size index epoch start sampl section get element per record
elem type elem type section ensur element index size
elem type section get element elem type epoch start sampl section get element per record
elem type section ensur map size

make sure expect
section get flag flag auxilari section section get element size elem type

runtim error get minibatch section auxilari section specifi element size mismatch section get name section get element size

gpu data set valu row actualmbs gpu data get devic id


advanc minibatch
mb start sampl actualmbs

read record process



setup epoch setup proper posit file variabl set start particular epoch
elem type
binari reader elem type setup epoch

start fresh epoch zero read init everyth
total sampl

make sure correct locat dataset epoch
size mb start sampl epoch epoch size

size file record mb start sampl total sampl
fprintf stderr start epoch record count file posit epoch mb start sampl file record

reset origin read sampl
epoch start sampl mb start sampl mb start sampl


get label map get label map integ index label
return numer datatyp label
elem type
binari reader elem type label id type binari reader elem type label type binari reader elem type get label map wstring section name

iter section find section name
iter section

runtim error get label map request section name found

section section iter second
section get section type section type label map

runtim error section specifi label map section


correct section
section string section label map section string section
section label map get label map


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
binari reader elem type set label map wstring section name binari reader elem type label id type binari reader elem type label type label map

runtim error binari reader support set map tabl


get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach buffer insuffic
elem type
binari reader elem type get data wstring section name size num record size data buffer size size record start

iter section find section name
iter section

runtim error get data request section name found

section section iter second
size size data section get element per record section get element size
num record record start section get element per record section get element count

runtim error get data request invalid record

size data num record
buffer larg enough
size data data buffer size

data buffer size size data


copi from section ensur element section get element per record record start size data
memcpi data buffer size copi from size data



elem type
binari reader elem type data end

instanti combin expect use
binari reader
binari reader


stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

sequenc reader defin export function applic


stdafx
defin dataread export creat export
data reader
sequenc reader
ifdef leakdetect
leak detect

data writer
fileutil fexist
iostream
vector


microsoft cntk


fail becaus deprec fn name

version neither use maintain delet
is in use
is in use
logic error thi deprec expect call fn name


read line read line
read sampl sampl read sampl space
return success read record otherwis
elem type
sequenc reader elem type read record size read sampl

fail becaus deprec function deprec class should use anymor

use


record to read determin record read popul record buffer
mb start sampl start sampl read
tail check possibl remain record read
return read dataset bugbug return
elem type
size sequenc reader elem type record to read size mb start sampl tail

fail becaus deprec function deprec class should use anymor

mb start sampl epoch start sampl
determin ahead need read
need read minibatch
size epoch sampl mb start sampl epoch size

determin left read epoch
size number to epoch epoch size epoch sampl
take either minibatch left epoch
size number to read number to epoch mb size
number to read tail
number to read mb size

number to read


get id from label label
mb start sampl start sampl ensur good
end of data check check dataset wraparound
return read dataset
elem type
i data reader label id type sequenc reader elem type get id from label label valu label info label info

found label info map label to id find label valu
found
found label info map label to id

found label info map label to id find m unk
found label info map label to id
runtim error vocabulari label valu

found second


elem type
sequenc reader elem type check id from label label valu label info label info todo label id type label id

fail becaus deprec function deprec class should use anymor

found label info map label to id find label valu

found
found label info map label to id

label id found second



ensur data avail read enough line request minibatch start request
mb start sampl start sampl start
end of data check check dataset wraparound
return read dataset
elem type
sequenc reader elem type ensur data avail size mb start sampl end of data check

fail becaus deprec function deprec class should use anymor

mb start sampl epoch start sampl
determin ahead need read
need read minibatch
size epoch sampl mb start sampl
more to read

size number to read record to read mb start sampl

check proper record read alreadi
read next sampl mb start sampl number to read mb start sampl epoch start sampl


anoth sequenc alreadi read wait
seq index sequenc size


seq index
mb start sampl
sequenc clear
featur data clear
label id data clear

read next sampl
epoch sampl

label
label info label in label info label info in

next word
label info label info out label next word

next word

label info label info label info next word label info in label info out

label id data size epoch sampl

label id data resiz epoch sampl
label data resiz epoch sampl label info


mani alreadi read
sequenc read
vector elem type featur temp
vector label type label temp
vector sequenc posit seq po


num read parser pars cach block size label temp featur temp seq po
more to read num read

translat spars pars format train format
label
b sentenc start
sequenc posit spo last sequenc posit seq flag null
num read

check
sequenc posit spo seq po
spo label po spo last label po spo number po spo last number po

spo last spo

b sentenc start

label entri
label spo label po need minu sinc

label in categori label
label type label valu label temp label

trim label valu size
input

check sequenc marker
b sentenc start equal ci label valu label info label info in end sequenc label mb size

ignor case begin use initi purpos
spo flag seq flag stop label
sequenc read

creat seqenc tabl
sequenc push back epoch sampl
sequenc size epoch sampl epoch sampl sequenc sequenc size mb size

fprintf stderr read sentenc length longer minibatch size smaller increas minibatch size least epoch sampl

wcerr read sentenc length longer minibatch size smaller increas minibatch size least epoch sampl endl
runtim error read sentenc length longer minibatch size smaller increas minibatch size least epoch sampl


equal ci label valu label info label info in end sequenc
ignor sentenc end


todo ignor check sentenc end
need remov train
alloc initi chunck featur data
label in label categori

label id type index get id from label label valu label in

found valu appropri locat
label in index goe label out dimens small
featur data push back index



runtim error input label expect categori label todo config time mayb keep remind reader


potenti featur
featur dim

runtim error assum spars input featur need chang code dens matrix
move posit start addit featur section
label in
featur dim featur data size
even pair index valu
spo number po
runtim error featur must specifi pair index valu invalid featur label label valu

featur spo number po

index featur temp featur
index index featur dim
runtim error invalid featur index label featur dimens index label valu featur dim

elem type valu featur temp featur
featur data index valu




output label
label info label info out label categori

label valu label temp label

next word

word label increment
todo produc reader realiz delay node network
label valu label temp label
equal ci label valu label info label info in end sequenc

label valu label info end sequenc




runtim error invalid output label expect categori next word


label
label id type get id from label label valu label info
label id data push back

read next sampl
epoch sampl
end reach
total sampl total record dataset

b sentenc start



check read right
j end label id data size
label id type index
check id from label label info end sequenc label info index
runtim error cannot find sentenc begin label

label id data j end index
languag model first word letter
runtim error lm sequenc reader last letter word batch sentenc end



read next sampl line num read
sequenc read more to read need read least sequenc

read updat appropri variabl
more to read

updat data variabl


read
more to read


updat data variabl updat variabl depend dataset complet read
elem type
sequenc reader elem type updat data variabl

fail becaus deprec function deprec class should use anymor

file
end reach

size dataset
total sampl featur count featur data size

want determin epoch size base dataset size
epoch size request data size

epoch size total sampl


todo comment call updat data variabl
write label file

dataset
end reach


updat label dimens enough need label id max updat process read
index index label info num index

label info index label categori label info index num id label info index
label info index label info index num id updat label dimens differ



todo move file well
elem type
sequenc reader elem type write label file

fail becaus deprec function deprec class should use anymor

updat label dimens enough need label id max updat process read
index index label info num index

label info label info label info index

write label file
label info file to write

label info map id to label size

file label file label info file to write file option write file option text
label info map id to label size

label file label info map id to label

label info file to write clear

cach writer

fprintf stderr warn file written disk label file written start epoch zero label info file to write
wcerr warn file label info file to write written disk label file written start epoch zero endl





destroy cleanup remov
note destroy use past point
elem type
sequenc reader elem type destroy




init reader initi multipl set
config configur paramet dataread
sampl format
paramet valu reader
reader
reader
reader type sequenc reader
random
addit featur dimens
featur dim
file sequenc sequenc
label in

label map file sequenc alphabet
label type categori
begin sequenc
end sequenc

label out

label map file sequenc phonem
label type categori
begin sequenc
end sequenc


note thi great deal duplic batch sequenc reader init from config gotten clean love appli well
todo thi seem never call remov
elem type
config record type
sequenc reader elem type init from config config record type reader config

fail becaus deprec function deprec class should use anymor

user want cach
cach reader
cach writer

note probabl want enabl point

initi cach
init cach reader config
reader config reader config

cach need pars test file
cach reader


vector wstring featur
vector wstring label
get file config name reader config featur label
featur size

featur name featur


label size label info num
runtim error lm sequenc reader label definit requir

index index label info num index
label name index label index

config record type featur config reader config featur name config record type record

class size
featur dim featur config
index index label info num index

config record type label config reader config label name index config record type record

todo refer label info index
label info index num id
label info index begin sequenc msra strfun utf8 label config begin sequenc
label info index end sequenc msra strfun utf8 label config end sequenc

determin label desir
wstring label type label config label type categori
label type categori

label info index label categori

label type next word

ident input label
label info index label next word
label info index label info label info in

label type

label info index label none
label info index label


label need label map file file label line
label info index label none

wstring w class file reader config wordclass
nword label config label dim
w class file

read class info w class file class size
word4idx
idx4word
idx4class
idx4cnt
nword
m unk nois sampler



vector array label
wstring label path label config label map file
fexist label path

file load label file label path array label
array label size

label type label array label
label info index map id to label label
label info index map label to id label

label info index num id label id type array label size
label info index map name label path



w class file

read class info w class file class size
word4idx
idx4word
idx4class
idx4cnt
nword m unk nois sampler

i max
word4idx word4idx

label type label first
second
i max i max
label info index map id to label label
label info index map label to id label

label info index num id label id type i max

label info index map name label path

label info index file to write label path



label info index label id type size label config label dim

updat dimens file say bigger
label info index label info index num id

label info index label info index num id



initi variabl
mb start sampl epoch total sampl epoch start sampl seq index
end reach
read next sampl line
read next sampl
trace level reader config trace level
parser set trace level trace level

input combin label data extra featur dim togeth
featur count featur dim label info label info in
featur count

wstring path name reader config file
trace level
fprintf stderr lm sequenc reader read input file path name

todo mani label info in must exactli
label info label in label info label info in
label info label out label info label info out
parser pars init path name featur dim label in label out label in begin sequenc label in end sequenc label out begin sequenc label out end sequenc


m unk reader config



elem type
sequenc reader elem type read word word file

fail becaus deprec function deprec class should use anymor



feof

fgetc









ungetc





strcpi word strlen






word


string

printf word found truncat word



word



elem type
sequenc reader elem type read class info wstring vocfil class size
word4idx
idx4word
idx4class
size idx4cnt
nword use consist check
m unk
nois sampler nois sampler
flatten

vocfil vocfil vocfil convert wstring
strtmp
size
clsidx
class size

line
vector token
ifstream
open vocfil


runtim error cannot open word file


getlin line

line trim line
token msra strfun split line
token size

stoi token
size stof token
strtmp token
clsidx stoi token

idx4cnt
word4idx strtmp
idx4word strtmp

idx4class clsidx
class size class size clsidx

close
class size

note user specifi label dim nword fail later interpret infer
idx4class size nword
runtim error read class info actual word smaller specifi vocabulari size check label dim larg idx4class size nword

vector count idx4cnt size
idx4cnt
count first second
nois sampler nois sampler count

check use vocabulari file
word4idx find m unk word4idx
fprintf stderr read class info unknown vocabulari file unknown word error encount m unk


init cach initi cach reader cach file exist otherwis writer
reader config reader configur
elem type
sequenc reader elem type init cach config paramet reader config

check writer first let know cach
reader config exist writer type


first open binari cach
found


todo need level mayb search section type
config array file list
vector wstring name
reader config exist wfile

file list push back reader config wfile
fexist reader config wfile
found

find config name reader config wfile name
name name

config paramet config reader config name
file list push back config wfile
fexist config wfile
found


file alreadi go read cach file
found

config paramet config
reader config copi to config
mmodifi config reader type look correct
config reader type config writer type
config file file list
cach reader data reader config



cach writer data writer reader config

section name categori type
wstring section type nocas compar section
cach writer get section section
pair section

todo would need sequenc map well
mayb chang heirarch name root label in
pair second section type categori label

label categori name label info out pair first

pair second section type label map

label map name label info out pair first




runtim error

fprintf stderr error attemp creat binari found reader writer
cach reader
cach reader
cach writer
cach writer



error
fprintf stderr error attemp creat binari found reader writer
cach reader
cach reader
cach writer
cach writer



destructor get call properli
elem type
sequenc reader elem type sequenc reader

releas memori
cach reader
cach writer


releas memori releas memori footprint sequenc reader
use cach reader take
elem type
sequenc reader elem type releas memori

featur buffer
featur buffer
featur buffer
label buffer
label buffer
label buffer
label id buffer
label id buffer
label id buffer
featur data clear
label id data clear
label data clear
sequenc clear


setup epoch setup proper posit file variabl set start particular epoch
elem type
sequenc reader elem type setup epoch

fail becaus deprec function deprec class should use anymor

start fresh epoch zero read init everyth
howev cach writer need know record count first
epoch total sampl cach writer

read next sampl line read next sampl epoch start sampl mb start sampl seq index
parser set file posit todo ever

otherwis posit read start right locat

seq index
know total sampl count
total sampl

trace level
fprintf stderr start epoch pars determin record count epoch
choos larg read
parser set file posit
mb start sampl
ensur data avail mb start sampl

mb start sampl total sampl
seq index sequenc size

trace level
fprintf stderr record found total sampl

seq index

slight dilemma determin file
user told find mani record file distinguish almost done
file charact away middl file read ahead record
end reach end reach
end reach

parser ha more data

end reach
updat data variabl
end reach



alway start first sampl
epoch start sampl mb start sampl



elem type
sequenc reader elem type lm setup epoch

read next sampl line read next sampl epoch start sampl mb start sampl seq index


util round integ multipl size
size round up size valu size size

valu size size size


start minibatch loop startup minibatch
mb size size minibatch sampl
note sequenc size sequenc everi sequenc could differ length
epoch epoch request epoch sampl must specifi epoch zero complet
request epoch sampl sampl random default request data size use sampl dataset
elem type
sequenc reader elem type start minibatch loop size mb size size epoch size request epoch sampl

fail becaus deprec function deprec class should use anymor

current cach cach
cach reader cach writer

init cach reader config
cach reader
releas memori free memori use sequenc reader


read cach
cach reader

cach reader start minibatch loop mb size epoch request epoch sampl



featur buffer

label info label info label info label info label info out label next word label info in label info out
featur buffer elem type mb size label info
memset featur buffer elem type mb size label info


label buffer

label info label info label info label info label info out label next word label info in label info out
label info label categori

label buffer elem type mb size label info
memset label buffer elem type mb size label info
label id buffer label id type mb size
memset label id buffer label id type mb size

label info label none

label buffer elem type mb size
memset label buffer elem type mb size
label id buffer



mb size mb size
request epoch sampl request data size

end reach

epoch size request data size




epoch size request epoch sampl


epoch size might valu alloc
size epoch size epoch size request data size 1000 epoch size
epoch epoch
mb start sampl epoch epoch size

alloc room
featur data reserv featur count epoch size
label info label info out label categori
label id data reserv epoch size
label info label info out label none
label data reserv epoch size
sequenc reserv seq index clear sequenc
complic
setup epoch
lm setup epoch instead
lm setup epoch

clsinfo read
idx2cl read

parser pars reset


elem type
sequenc reader elem type data end

fail becaus deprec function deprec class should use anymor

sentenc end


elem type
sequenc reader elem type sentenc end

fail becaus deprec function deprec class should use anymor

get minibatch size increas seq index
real index seq index
seq index seq index

label
label info label info label info label info label info out label next word label info in label info out

size actualmbs

figur size sequenc
seq index

actualmbs sequenc seq index sequenc seq index



actualmbs sequenc


actualmbs mb size


size j end sequenc seq index

label info label categori

label id type index
check id from label label info end sequenc label info index
runtim error cannot find sentenc begin label

label id data j end index







output label matrix word observ
first word index
second word
third begin index word
fourth end index word
elem type
sequenc reader elem type get label output stream minibatch input matric
size mb start sampl size actualmbs

fail becaus deprec function deprec class should use anymor

size
matric ha input label name label info out


matrix elem type label matric get input matrix elem type label name label info out

reader mode reader mode
label resiz nois sampl size actualmbs
reader mode reader mode class
label resiz actualmbs
reader mode reader mode softmax
label resiz actualmbs

size j sampl mb start sampl actualmbs j sampl

pick right sampl random desir
size j rand j sampl
label id data j rand
label set valu elem type

reader mode reader mode

label set valu elem type nois sampler logprob
size noiseid noiseid nois sampl size noiseid

nois sampler sampl
label set valu noiseid elem type
label set valu noiseid elem type nois sampler logprob


reader mode reader mode class

clsidx idx4class
class size

label set valu elem type clsidx
save begin end indx
label set valu class info local clsidx begin index
label set valu class info local clsidx index




elem type
sequenc reader elem type get input prob stream minibatch input matric

fail becaus deprec function deprec class should use anymor

matric ha input stridx2 prob


idx2prob read


matrix elem type idx2prob matric get input matrix elem type stridx2 prob

popul local matrix
id2 prob switch to matrix type matrix type dens matrix format dens
id2 prob resiz nword

move sinc element wise oper expens wrong
cur dev id id2 prob get devic id
id2 prob transfer from devic to devic cur dev id cpudevic
size nword
id2 prob nois sampler prob
id2 prob transfer from devic to devic cpudevic cur dev id

old devic id idx2prob get devic id
caution set valu chang idx2cl chang behavior later
idx2prob set valu id2 prob
idx2prob transfer from devic to devic idx2prob get devic id old devic id

idx2prob read


todo document seem fill specif hard code input someth interest
elem type
sequenc reader elem type get input to class stream minibatch input matric

matric ha input stridx2 cl


idx2cl read


matrix elem type idx2cl matric get input matrix elem type stridx2 cl

popul local matrix
id2class local switch to matrix type matrix type dens matrix format dens
id2class local resiz nword

move sinc element wise oper expens wrong
cur dev id id2class local get devic id
id2class local transfer from devic to devic cur dev id cpudevic
size nword

clsidx idx4class
id2class local clsidx

id2class local transfer from devic to devic cpudevic cur dev id

old devic id idx2cl get devic id
caution set valu chang idx2cl chang behavior later
idx2cl set valu id2class local
idx2cl transfer from devic to devic idx2cl get devic id old devic id

idx2cl read


elem type
sequenc reader elem type get class info

clsinfo read


popul local matrix
class info local switch to matrix type matrix type dens matrix format dens
class info local resiz class size

move sinc element wise oper expens wrong
cur dev id class info local get devic id
class info local transfer from devic to devic cur dev id cpudevic

clsidx
prvcl
size nword

clsidx idx4class
prvcl clsidx clsidx prvcl

prvcl
class info local prvcl
prvcl clsidx
class info local prvcl

prvcl clsidx

nword larger actual word
logic error lm sequenc reader get class info probabl word specifi larger actual word check network builder reader


class info local prvcl nword

class info local print

class info local transfer from devic to devic cpudevic cur dev id

clsinfo read


elem type
sequenc reader elem type tri get minibatch stream minibatch input matric

fail becaus deprec function deprec class should use anymor

call start minibatch loop first
mb size


check chang epoch done
sequenc size mb start sampl sequenc sequenc size


more data ensur data avail mb start sampl
more data


figur sweep random
size record start total sampl mb start sampl total sampl mb start sampl

actual size size seqenc
size actualmbs

figur size sequenc
sequenc concaten vector length comput differ consecut start indic
seq index seq index sequenc size sequenc size

actualmbs sequenc seq index sequenc seq index



actualmbs sequenc


actualmbs mb size

runtim error specifi minibatch size smaller actual minibatch size mb size actualmbs


dataset
more data

make sure take account hit dataset wrap around
actualmbs total sampl record start actualmbs


label
label info label info label info label info label info out label next word label info in label info out

label info label categori

memset label buffer elem type label info actualmbs
memset label id buffer label id type actualmbs

label info label none

memset label buffer elem type actualmbs


actualmbs

memset featur buffer elem type actualmbs label info

sampl

matrix elem type featur matric get input matrix elem type featur name
matric find featur name matric

featur get matrix type matrix type dens

featur resiz label info actualmbs
featur set valu



featur resiz label info actualmbs
featur reset



size j sampl mb start sampl actualmbs j sampl

pick right sampl random desir
size j rand j sampl todo thi seem unfinish

vector featur goe matrix column
size size featur data j rand
featur buffer label info elem type

matric find featur name matric
featur set valu elem type


get label output matric mb start sampl actualmbs
get input to class matric
get class info

make sure sequenc index match index
sequenc seq index mb start sampl actualmbs
sequenc
seq index


advanc minibatch
mb start sampl actualmbs

want partial minibatch skip transfer
actualmbs record found minibatch




transfer need


featur
matric find featur name matric

matrix elem type matric get input matrix elem type numberob
cur dev id get devic id
transfer from devic to devic cur dev id cpudevic
actualmbs
transfer from devic to devic cpudevic cur dev id
size actualmbs

wstring msra strfun wstrprintf featur
matrix elem type featur matric get input matrix elem type
featur set valu label info featur get devic id featur buffer label info matrix flag normal





runtim error featur size suffici larg ask minibatch size check minibatch size featur definit actualmbs




label info label categori

matric find label name label info out matric

todo what debug code
size actualmbs

wstring msra strfun wstrprintf label
thi write node name label n crash exist seem dead code
matrix elem type label matric get input matrix elem type
label set valu label info label get devic id label buffer label info matrix flag normal


bugbug categori label output anyth node given

label info label none

matrix elem type label matric get input matrix elem type label name label info out
label set valu actualmbs label get devic id label buffer matrix flag normal




runtim error cannot find matric label name label info out


read record process



get label map get label map integ index label
return numer datatyp label
elem type
i data reader label id type i data reader label type sequenc reader elem type get label map wstring section name

fail becaus deprec function deprec class should use anymor

cach reader

cach reader get label map section name

label info label info label info label info label info out label next word label info in label info out

label info map id to label


set label map set label map integ index label
label map map tabl label valu must
note task label map tabl must train test
elem type
sequenc reader elem type set label map wstring section name i data reader label id type label type label map

fail becaus deprec function deprec class should use anymor

cach reader

runtim error cannot map tabl cach reader use

label info label info label info label info label info out label next word label info in label info out

label info map id to label label map
label info map label to id clear
pair label type label map

label info map label to id second first



get data get metadata specifi section memori
section name section name retriev
num record record read
pointer buffer data buffer size size requir buffer accomid request
data buffer size size databuff byte
size buffer fill
record start record start read default zero start
return remain read reach
elem type
sequenc reader elem type get data wstring section name size num record size data buffer size size record start

cach reader
runtim error get data support sequenc reader
cach reader get data section name num record data buffer size record start


instanti combin expect use
sequenc reader
sequenc reader

elem type
config record type
batch sequenc reader elem type init from config config record type reader config

user want cach
cach reader
cach writer

cach block size reader config cach block size cach block size token

initi cach
init cach reader config
reader config reader config

cach need pars test file
cach reader


vector wstring featur
vector wstring label
get file config name reader config featur label

actual fail exampl still clear sequenc section
break
ad addit constraint sinc cannot ever entri miss someth
featur size todo ever fail pleas remov check sampl section could use check verifi
invalid argument batch sequenc reader onli featur section allow
break

featur size
featur name featur
todo meaning allow featur section

label size label info num
runtim error batch sequenc reader label definit requir even label type none

bugbug name come dictionari alphabet order definit order
label in label pars label in output label
index index label info num index
label name index label index
expect label section
alphabet first goe featur
alphabet second goe label
these label interleav input output label type next word
word succeed input copi output train
possibl specifi label type none either todo test first

config record type featur config featur name reader config reader config featur name config record type record
wstring mode featur config mode softmax

equal ci mode

reader mode reader mode
nois sampl size featur config nois

equal ci mode softmax
reader mode reader mode softmax
equal ci mode
reader mode reader mode class

logic error unsupport format mode

sybol
m unk msra strfun utf8 reader config

class size
featur dim featur name featur config
index index label info num index

code build label info record label input
label info label info index

config record type label config reader config label name index config record type record

label info num id map word file read build map
label info begin sequenc msra strfun utf8 label config begin sequenc
label info end sequenc msra strfun utf8 label config end sequenc

determin label desir
label type label config label type categori
equal ci label type categori

label info label categori
label info label id type size label config label dim mean infer input

equal ci label type next word

index
invalid argument batch sequenc reader input label must kind next word
ident input label
label info label next word
label info label info label info in
break
version overwrot look label dim paramet
break

equal ci label type none

label info label none
label info label


invalid argument batch sequenc reader invalid label type label type

label need label map file file label line
label info label none bugbug thi seem wrong next word read info twice

nword label info bugbug nword member get twice next word

read word definit file specifi
wstring w class file reader config wordclass
w class file

read class info w class file class size
word4idx
idx4word
idx4class
idx4cnt
nword use consist check
m unk nois sampler



read word map file present
vector array label
note label map file creat exist
wstring label path label config label map file
file exist label path

file load label file label path array label
build map tabl
array label size

label type label array label
label info map id to label label
label info map label to id label

label info num id label id type array label size
label info map name label path
label info file to write clear output noth write



fprintf stderr lm sequenc reader label map creat intern label map file found label path
w class file


break
remov seemingli redund read
break
bugbug thing done redund
read class info w class file class size
word4idx
idx4word
idx4class
idx4cnt
nword
m unk nois sampler


word4idx size nword todo infer point time label info word4idx size
logic error batch sequenc reader init vocabulari size setup file word file consist nword word4idx size w class file
i max

word4idx word4idx

label type label first
second
i max i max
label info map id to label label
label info map label to id label

label info num id label id type i max

label info map name label path
label info file to write label path map path denot output write map
bugbug thi facil function file creat



updat dimens map file say bigger specifi mean infer input
todo clean num id map read otherwis ident
label info label info num id
label info label info num id


initi variabl
mb start sampl epoch total sampl epoch start sampl seq index
end reach
read next sampl line
read next sampl
trace level reader config trace level
parser set trace level trace level

bugbug random option ignor

input combin label data extra featur dim togeth
featur count featur dim label info label info in
featur count

wstring path name reader config file
trace level
fwprintf stderr lm sequenc reader input file path name

label info label in label info label info in
label info label out label info label info out
parser pars init path name featur dim label in label out label in begin sequenc label in end sequenc label out begin sequenc label out end sequenc

m request num parallel sequenc reader config nbruttsineachrecurrentit size indic fill mb size
todo thi depend sequenc


elem type
batch sequenc reader elem type reset

m process clear
m to process clear
m last process sentenc id
m po in sentenc
m last po in sentenc
m num read

label temp size
label temp clear
featur temp size
featur temp clear
parser m sentenc index2 sentenc info clear


elem type
batch sequenc reader elem type start minibatch loop size mb size size epoch size request epoch sampl

current cach cach
cach reader cach writer

init cach reader config
cach reader
releas memori free memori use sequenc reader


read cach
cach reader

cach reader start minibatch loop mb size epoch request epoch sampl



alloc buffer build featur label
alloc mb size entri total token cound across multipl parallel sequenc
label info label info label info label info label info out label next word label info in label info out

featur buffer featur
featur buffer elem type mb size label info

label buffer label

label info label categori

label buffer elem type mb size label info
label id buffer i data reader elem type label id type mb size todo pleas vector

label info label none

label buffer elem type mb size
label id buffer



featur buffer row size mb size
featur buffer row idx size mb size

id2class local matrix elem type cpudevic
class info local matrix elem type cpudevic

mb size mb size
request epoch sampl request data size

end reach

epoch size request data size




epoch size request epoch sampl


epoch size might valu alloc
size epoch size epoch size request data size 1000 epoch size
epoch epoch
random seed epoch
mb start sampl epoch epoch size
epoch sampl return counter know return epoch

alloc room
featur data reserv featur count epoch size
label info label info out label categori
label id data reserv epoch size
label info label info out label none
label data reserv epoch size
sequenc reserv seq index clear sequenc
complic
setup epoch
lm setup epoch instead
lm setup epoch

clsinfo read
idx2cl read

parser pars reset

reset


fill m to process sequenc length
thi updat m to process also lazili initi m process
m to process check whether sequenc done m to process unchang
return sequenc process epoch
elem type
size batch sequenc reader elem type determin sequenc to process

m num read load either first call input file


lazili creat m process
m process size
m process resiz m num read

lazili check done
done m to process contain sequenc m process like appli
m to process size

all done
all done get least entri m to process complet
guess sinc length complet
m to process size

m to process
m process

m last process sentenc id
m last po in sentenc
all done



all done done
m to process clear


still unfinish sequenc length
m to process size

they length valu first entri
parser m sentenc index2 sentenc info m to process s len


m to process fill m request num parallel sequenc entri length
size
size max to process m request num parallel sequenc m request num parallel sequenc size m request num parallel sequenc size
size max token m request num parallel sequenc size mb size
size num token token counter
size m last process sentenc id
m num read buffer
m to process size max to process parallel sequenc limit


skip entri done
m process


first unprocess sequenc determin length minibatch

parser m sentenc index2 sentenc info s len
parser m sentenc index2 sentenc info s len


check token
num token num token max token
total token limit

length first
m to process push back

count token
num token parser m sentenc index2 sentenc info s len

alreadi done

fprintf stderr determin sequenc to process sequenc token m to process size num token




fill buffer sequenc process
advanc m last po in sentenc cursor sentenc
return previou valu m last po in sentenc need creat layout
thi subroutin get minibatch call elsewher
elem type
batch sequenc reader elem type get minibatch data size first po in sentenc

return enough sampl make epoch
thi stopgap flaw
epoch reload random epoch random seed guarante sampl
parser start cach block size must corpu size get load epoch
altern cach block size epoch size good sinc utter length batch
much sinc soon come reader solv issu
epoch sampl return epoch size


featur data clear
label id data clear

step determin sequenc process m to process

size determin sequenc to process
none left epoch boundari shuffl epoch

reset

vector sequenc posit seq po
fprintf stderr lm sequenc reader read epoch fflush stderr
m num read parser pars cach block size label temp featur temp seq po
fprintf stderr sequenc read m num read
first po in sentenc m last po in sentenc
m num read


ifdef make configur reproduc cach block size use constant todo remov month
cach block size 50000

srand random seed todo older code idea random seed use
random shuffl parser m sentenc index2 sentenc info parser m sentenc index2 sentenc info
note random shuffl deprec sinc

config wider random


mt19937 random seed random seed initi epoch get increment intermedi reshuffl
shuffl parser m sentenc index2 sentenc info parser m sentenc index2 sentenc info


read next sampl line m num read
determin sequenc to process


step copi sentenc m to process featur data label id data

next word label info label info out label next word
label info label in label info label info in
label info label out label info label info out

first po in sentenc m last po in sentenc

size m last po in sentenc
size iend label out label none exclud last token sinc last label predict
break chang
label out label node assum output label label input
break chang
size jend m request num parallel sequenc mb size size mb size truncat length
size jend iend

m to process size

size m to process
size parser m sentenc index2 sentenc info s begin

label in categori label
label valu label temp
consum

gener featur token
label in label categori

label id type label id get id from label label valu label in

found valu appropri locat
label in label id goe label out dimens small
featur data push back label id


runtim error input label expect categori label

gener output label token
label out label none

label valu label temp
label id type label id
label out label categori

consum todo valu use
label id get id from label label valu label out

next word

word alreadi increment read label valu
equal ci label valu label in end sequenc differ input output
label id get id from label label in end sequenc label in

label id get id from label label valu label in


logic error unexpect output label never

label id data push back label id


total sampl
epoch sampl return


m last po in sentenc could also iter m last po in sentenc directli

rememb
note thi flag propag set m process data end seem fragil
m sentenc end iend




return
input sequenc chunk epoch defin
epoch sequenc randomli sort
sequenc length return
minibatch consist sequenc length gap
elem type
batch sequenc reader elem type tri get minibatch stream minibatch input matric

call start minibatch loop first
todo fail
mb size


todo valid whether pass matric match reader section definit

step minibatch

size first po in sentenc
more data get minibatch data first po in sentenc
more data

p mb layout init m to process size



least sequenc
m to process list sequenc
m process say whether sequenc complet
featur data contain input label indic
label id data contain output label indic

step transfer matric

size actualmbs featur data size total token across sequenc
actualmbs
label id data label id data size actualmbs

creat mb layout
thi handl variabl length sequenc
size actualmbs m to process size
m to process size actualmbs
p mb layout init m to process size
size m to process size

size m to process
label info label out label info label info out
size parser m sentenc index2 sentenc info s len label out label none last label
break chang
s len s len label out label node assum output label label input
break chang
ptrdiff ptrdiff first po in sentenc
ptrdiff ptrdiff ptrdiff first po in sentenc
ptrdiff
logic error batch sequenc reader sentenc outsid minibatch

logic error batch sequenc reader sentenc outsid minibatch
p mb layout add sequenc sequenc size

p mb layout add gap size
ptrdiff
p mb layout add gap


copi featur data matrix
featur data spars alreadi interleav parallel sequenc copi dens matrix
alway copi first convert desir
size featur dim label info label info in
iter matric find featur name
iter matric found featur matrix request time

matrix elem type featur matric get input matrix elem type iter first

move matrix featur get matrix type matrix type spars
bugbug matrix support modifi dens matrix temporarili instead local matrix assign
deviceid type featur devic id featur get devic id
featur transfer from devic to devic featur devic id cpudevic move matrix

featur get matrix type matrix type spars

featur resiz featur dim actualmbs actualmbs
featur reset



featur resiz featur dim actualmbs
featur set valu


size actualmbs note matrix column time step

vector featur goe matrix column
size size featur data index word index column alreadi interleav m to process size m to process size

featur set valu elem type


featur transfer from devic to devic cpudevic featur devic id move matrix


info
reader mode reader mode class

get input to class matric
get class info


label
get label output matric actualmbs

sequenc
seq index


transfer need
featur
matric find featur name matric

matrix elem type matric numberob todo fall back differ node
cur dev id get devic id
transfer from devic to devic cur dev id cpudevic
actualmbs
transfer from devic to devic cpudevic cur dev id
size actualmbs

wstring msra strfun wstrprintf featur
matrix elem type featur matric
featur set valu featur dim featur get devic id featur buffer featur dim matrix flag normal




read record process





time po time posit exampl actual minibatch stream
time posit actual tiem

thi call batch sequenc reader tri get minibatch longer
elem type
batch sequenc reader elem type set sentenc begin utt po time po

label
label info label in label info label info in
label id type index get id from label label in begin sequenc label in

time po

index

m sentenc begin
bugbug thi current function noth mark gap set flag
utt po
logic error batch sequenc reader set sentenc begin disabl implement seem date set flag
p mb layout set without or utt po time po minibatch pack flag sequenc start todo






todo renam copi mb layout to wrong signatur
elem type
batch sequenc reader elem type set sentenc seg batch vector size sentenc end

sentenc end resiz m to process size
m sentenc begin

sentenc end assign m to process size



sentenc end assign m to process size mb size




note data end must call minibatch order propag m sentenc end m process
elem type
batch sequenc reader elem type data end

m sentenc end
m to process
m process
m sentenc end


fill label label id data
when class label matrix
depend reader mode
class
nois train prob nois nois prob

follow comment obsolet
word
word
row begin end indic
notic indic defin follow begin end indx
end index plu end index
thi subroutin get minibatch call
elem type
batch sequenc reader elem type get label output stream minibatch input matric
size mb start sampl size actualmbs

matric ha input label name label info out


size
matrix elem type label matric get input matrix elem type label name label info out
reader mode reader mode
label resiz nois sampl size actualmbs
reader mode reader mode class
label resiz actualmbs

label resiz actualmbs

move sinc element wise oper expens
cur dev id label get devic id
label transfer from devic to devic cur dev id cpudevic
label get current matrix locat

elem type epsilon elem type avoid zero although almost imposs

size j sampl mb start sampl actualmbs j sampl

token
label id type label id data j sampl

write sampl valu output
thi write index vector which wrong want spars vector
label set valu elem type

reader mode reader mode

label set valu elem type nois sampler logprob
size noiseid noiseid nois sampl size noiseid

nois sampler sampl
label set valu noiseid elem type
label set valu noiseid elem type nois sampler logprob


reader mode reader mode class

clsidx idx4class
class size

label set valu elem type clsidx

save begin end indx
size size class info local clsidx
size size class info local clsidx


logic error lm sequenc reader get label output word least equal larger left index right index larger equal left index word index smaller right index


label set valu class info local clsidx begin index
label set valu class info local clsidx index


reader mode reader mode softmax


label set valu epsilon elem type

reader mode reader mode unnorm

label set valu elem type

label set valu epsilon elem type


thi fragil line never instead get minibatch data
keep track sentenc end m sentenc end read data end reset m process
actualmbs last entri m sentenc end whether word sentenc

find numer index sentenc token
label info label in label info label info label info out label next word label info in label info out label info label info in thi trigger think wrong come label id data output
label id type end sequenc index get id from label label in end sequenc label in

m sentenc end end sequenc index



send back came
note thi leav both locat desir
base model access inform
label transfer from devic to devic cpudevic cur dev id



elem type
batch sequenc reader elem type get sentenc end id from output label


label
label info label in label info label info in
found word4idx find label in end sequenc

found
found word4idx

found second






batch sequenc reader
batch sequenc reader


copyright microsoft right reserv
licens licens licens file project root full licens inform

export defin export function applic


stdafx
defin dataread export
defin datawrit export
sequenc reader
sequenc writer

microsoft cntk

dataread get reader f i data reader preader

preader batch sequenc reader

dataread get reader d i data reader preader

preader batch sequenc reader


datawrit get writer f i data writer pwriter

pwriter lm sequenc writer

datawrit get writer d i data writer pwriter

pwriter lm sequenc writer




copyright microsoft right reserv
licens licens licens file project root full licens inform

sequenc parser pars format custom state machin speed


stdafx
stdexcept
stdint
basic
sequenc parser
fileutil

microsoft cntk

set state particular valu
num type label type
sequenc parser num type label type set state valu pars state current state pars state state

dword dword state
rang shift current state
state tabl rang shift valu


set state rang state transit rang valu
num type label type
sequenc parser num type label type set state rang value1 value2 pars state current state pars state state

dword dword state
rang shift current state
valu value1 valu value2 valu

state tabl rang shift valu



setup state tabl setup state transit tabl state
state block state index incom charact
num type label type
sequenc parser num type label type setup state tabl


state whitespac


set state rang whitespac label
set state rang whitespac whole number
set state whitespac sign
set state whitespac sign
whitespac
set state whitespac whitespac
set state whitespac whitespac
set state whitespac whitespac
set state whitespac whitespac intepret white space divid
set state whitespac end of line


state neg sign


set state rang sign label
set state rang sign whole number
whitespac
set state sign whitespac
set state sign whitespac
set state sign whitespac
set state sign end of line


state number


set state rang whole number label
set state rang whole number whole number
set state whole number period
set state whole number the letter e
set state whole number the letter e
whitespac
set state whole number whitespac
set state whole number whitespac
set state whole number whitespac
set state whole number whitespac 1234 usag sequenc
set state whole number end of line


state period


set state rang period label
set state rang period remaind
whitespac
set state period whitespac
set state period whitespac
set state period whitespac
set state period end of line


state remaind


set state rang remaind label
set state rang remaind remaind
set state remaind the letter e
set state remaind the letter e
whitespac
set state remaind whitespac
set state remaind whitespac
set state remaind whitespac
set state remaind whitespac 1234 usag sequenc
set state remaind end of line


state letter


set state rang the letter e label
set state rang the letter e expon
set state the letter e expon sign
set state the letter e expon sign
whitespac
set state the letter e whitespac
set state the letter e whitespac
set state the letter e whitespac
set state the letter e end of line


state expon neg sign


set state rang expon sign label
set state rang expon sign expon
whitespac
set state expon sign whitespac
set state expon sign whitespac
set state expon sign whitespac
set state expon sign end of line


state expon


set state rang expon label
set state rang expon expon
whitespac
set state expon whitespac
set state expon whitespac
set state expon whitespac
set state expon whitespac
set state expon end of line


state line

set state rang end of line label
set state rang end of line whole number
set state end of line sign
set state end of line end of line
whitespac
set state end of line whitespac
set state end of line whitespac
set state end of line whitespac


state label

set state rang label label
set state label end of line
whitespac
set state label whitespac
set state label whitespac
set state label whitespac
set state label whitespac


state line count

set state rang line count eol line count other
set state line count eol line count eol


state line count other

set state rang line count other line count other
set state line count other line count eol


reset line state variabl
num type label type
sequenc parser num type label type prepar start line

number convert thi line
label convert thi line
element convert thi line
space delimit start byte counter
space delimit max byte counter
last label is string
begin sequenc end sequenc


reset accumul variabl
num type label type
sequenc parser num type label type prepar start number

partial result
built up number
divid
whole number multipli
expon multipli


reset state variabl start read posit
num type label type
sequenc parser num type label type prepar start posit size posit

current state whitespac
byte counter posit must come prepar start line
buffer start posit

prepar state machin line
prepar start number
prepar start line
total number convert
total label convert


sequenc parser
num type label type
sequenc parser num type label type sequenc parser

init


setup state variabl state tabl state machin
num type label type
sequenc parser num type label type init

prepar start posit
file buffer
p file
state tabl dword all state max
setup state tabl


parser destructor
num type label type
sequenc parser num type label type sequenc parser

state tabl
file buffer
p file
fclose p file


done with label call label found
num type label type
sequenc parser num type label type done with label

current counter
space delimit max space delimit start
space delimit max byte counter

label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
label convert thi line
element convert thi line
last label is string

prepar start number


call complet
num type label type
sequenc parser num type label type done with valu

store
number

num type final result
current state expon

final result num type partial result expon multipli built up number

divid

final result num type partial result built up number divid



final result num type built up number


final result num type final result whole number multipli

todo sequenc reader probabl need store number label
label store label locat instead locat
index element convert thi line
start label index index start label dim label

store label final result

start featur index index start featur dim featur

number push back final result
total number convert
number convert thi line
element convert thi line
last label is string



prepar start number


store label special label type
num type label type
sequenc parser num type label type store label num type valu

label push back label type valu
total number convert
number convert thi line
element convert thi line
last label is string


store last label store last label numer type tranfer label vector
label type handl special
num type label type
sequenc parser num type label type store last label

last label is string file format error last label
num type valu number back
number back
label push back label type valu


get file posit current file posit text file
return current posit file
num type label type
int64 sequenc parser num type label type get file posit

int64 posit ftelli64 p file
posit
runtim error sequenc parser get file posit error retriev file posit file
posit


set file posit current file posit begin file read first block
state machin mode initi similar begin file
recommend valu get file posit known start line
zero pass
todo ever call anyth
num type label type
sequenc parser num type label type set file posit int64 posit

fseeki64 p file posit seek

runtim error sequenc parser set file posit error seek file

setup state machin start posit
prepar start posit posit

read first buffer posit first buffer expect read reposit
updat buffer

futur debug could valid valu either previou charact


ha more data test current dataset whitespac
return
num type label type
sequenc parser num type label type ha more data

byte counter byte counter
size buffer index byte counter buffer start

test without move parser state
byte counter file size byte counter buffer index

reach buffer assum
right time close enough
buffer index buffer size


file buffer buffer index
pars state next state pars state state tabl whitespac
next state whitespac next state end of line





updat buffer load buffer full
return record read
num type label type
size sequenc parser num type label type updat buffer

state machin might want look back copi begin
size save byte byte counter space delimit start
save byte buffer size
save byte

memcpi file buffer buffer size file buffer byte counter buffer start save byte save byte
buffer start byte counter save byte


read block
size byte to read buffer size file size buffer start save byte
size byte read fread file buffer save byte byte to read p file
byte read ferror p file
runtim error sequenc parser updat buffer error read file
byte read


num type label type
sequenc parser num type label type set pars mode pars mode mode

alreadi mode noth
pars mode mode


switch mode
mode pars line count
current state line count other


current state whitespac
prepar start line
prepar start number

pars mode mode


set trace level level screen output
trace level trace level zero mean output epoch relat output output
num type label type
sequenc parser num type label type set trace level trace level

trace level trace level


store label version get last space delimit store label vector

sequenc parser store label final result

label first current counter
space delimit max space delimit start
space delimit max byte counter
label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
begin sequenc equal ci label begin tag
begin sequenc
end sequenc equal ci label end tag
end sequenc
label push back move label
label convert thi line
element convert thi line
last label is string


done with label version store label

sequenc parser done with label

label
store label store label
prepar start number


store last label version

sequenc parser store last label

alreadi store label
last label is string

store label

alreadi store numer version label number
user want
number back
prepar start number


note current code ident know special paramet cover paramet

store label version get last space delimit store label vector

sequenc parser store label final result

label first current counter
space delimit max space delimit start
space delimit max byte counter
label lpcstr file buffer space delimit start buffer start space delimit max space delimit start
begin sequenc equal ci label begin tag
begin sequenc
end sequenc equal ci label end tag
end sequenc
label push back move label
label convert thi line
element convert thi line
last label is string


done with label version store label

sequenc parser done with label

label
store label store label
prepar start number


store last label version

sequenc parser store last label

alreadi store label
last label is string

store label

alreadi store numer version label number
user want
number back
prepar start number


ifdef standalon
wmain argc wchar argv

sequenc parser parser
vector valu
valu reserv 784000
vector label
label reserv 60000
parser pars init speech mnist mnist train label first
parser pars init speech pars test label none
record


record read parser pars 10000 valu label
record read 10000
parser set file posit around
record record read
valu clear
label clear
record 150000
record



instanti parser support type
sequenc parser
sequenc parser
sequenc parser
sequenc parser
sequenc parser
sequenc parser

num type label type
lm batch sequenc parser num type label type pars init lpcwstr file name size dim featur size dim label in size dim label out begin sequenc in end sequenc in begin sequenc out end sequenc out

lm sequenc parser num type label type pars init file name dim featur dim label in dim label out begin sequenc in end sequenc in begin sequenc out end sequenc out


num type label type
lm batch sequenc parser num type label type pars size record request vector label type label vector num type number vector sequenc posit seq po

size linecnt size lm sequenc parser num type label type pars record request label number seq po

creat sentenc info structur read input line
size prvat
size
seq po seq po

sentenc info stinfo
stinfo s begin prvat
size s end label po
stinfo s len s end stinfo s begin
m sentenc index2 sentenc info push back stinfo

prvat label po


m sentenc index2 sentenc info size linecnt
linecnt todo chang size


lm batch sequenc parser
lm batch sequenc parser

copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
ifdef win32
objbas

basic
fstream
algorithm

defin datawrit export creat export
data writer
sequenc reader
sequenc writer
config
ifdef leakdetect
memori leak detect


microsoft cntk

creat data writer

comparison sensit
elem type
lm sequenc writer elem type compar elem type first elem type second

first second


elem type
config record type
lm sequenc writer elem type init from config config record type writer config

udim clear

vector wstring output name writer config output node name config record type array stringargvector
output name size
runtim error writer need least output node name specifi config

index output name input name node name

config record type thi output writer config output name
output file output name wstring thi output file
thi output nbest
n best output name
wstring fname thi output token
read sybol
m unk output name writer config

sequenc reader elem type read class info fname class size
word4idx output name
idx4word output name
idx4class output name
idx4cnt output name

m unk output name
nois sampler

size idx4word output name size
udim push back



elem type
lm sequenc writer elem type read label info wstring vocfil
word4idx
idx4word

str file name string
stmp string
strtmp
size


wcstomb str file name 2048 vocfil vocfil length

file
fopen str file name

nullptr

runtim error cannot open word file


feof

fscanf stmp countof stmp
word4idx stmp
idx4word stmp

fclose


elem type
lm sequenc writer elem type destroy

output file id output file id

fclose second



elem type
lm sequenc writer elem type save data size record start wstring nocas compar matric size num record size dataset size size byte variabl size


iter matric iter matric iter

wstring output name iter first
matrix elem type output data cast matrix elem type iter second
wstring out file output file output name

save out file output data idx4word iter first n best output name





elem type
lm sequenc writer elem type save wstring output file matrix elem type output data idx2wrd nbest

size output data get num col
size idx2wrd size output data get num row
file nullptr
vector pair size elem type

nbest compar pair size elem type pair size elem type

second second


output file id find output file output file id

file
msra file make intermedi dir output file
output file output file
fopen
nullptr
runtim error cannot open write
output file id output file



output file id output file



imax
elem type fmax output data imax
clear
nbest
push back pair size elem type fmax


nbest
push back pair size elem type output data
output data fmax

fmax output data
imax


nbest
sort nbest compar
nbest

nbest

second

first
s re idx2wrd find second
fprintf s re




s re idx2wrd find imax second
fprintf s re
fprintf stderr s re



fprintf
fprintf stderr


lm sequenc writer
lm sequenc writer


copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
htkmlf reader
config
htk data deseri
mlf data deseri
config helper
bundler
string util
frame packer
sequenc packer
truncat bptt packer
block random
no random

microsoft cntk

vector i data deseri ptr creat deseri config paramet reader config

vector wstring featur name
vector wstring label name
vector wstring notus
config helper config reader config

config get data name from config featur name label name notus notus
featur name size label name size

invalid argument network need least featur label specifi


corpu descriptor ptr corpu make share corpu descriptor

vector i data deseri ptr featur deseri
vector i data deseri ptr label deseri

primari
first deseri drive defin chunk
todo make configur paramet
featur name featur name

deseri make share htk data deseri corpu reader config featur name featur name primari
primari
featur deseri push back deseri


label name label name

deseri make share mlf data deseri corpu reader config label name label name

label deseri push back deseri


vector i data deseri ptr deseri
deseri insert deseri featur deseri featur deseri
deseri insert deseri label deseri label deseri

deseri


htkmlf reader htkmlf reader memori provid ptr provid
config paramet reader config
seed provid provid

todo deseri transform dynam load
extern librari base configur brain script

frame mode reader config frame mode
truncat reader config truncat
frame mode truncat

logic error frame mode truncat bptt mutual exclus


frame mode

pack mode pack mode sampl

truncat

pack mode pack mode truncat



pack mode pack mode sequenc


nbruttsineachrecurrentit reader configur truncat length
truncat length specifi estim
parallel sequenc pack mbsize truncat length
nbruttsineachrecurrentit specifi assum truncat size mb size
real minibatch size mb size nbruttsineachrecurrentit epoch index
truncat length reader config truncat length
num parallel sequenc for all epoch
reader config nbruttsineachrecurrentit config paramet array intargvector vector

config helper config reader config
size window config get random window
deseri creat deseri reader config
deseri

logic error pleas specifi least singl input stream


bundler make share bundler reader config deseri deseri
verbos reader config verbos
wstring read method config get random

todo chang config deseri allow
are equal ignor case read method wstring block random

random make share block random verbos window bundler block random decim mode chunk use legaci random

are equal ignor case read method wstring none

random make share no random bundler



runtim error read method must block random none


random initi nullptr reader config

creat output stream descript dens
deseri

get stream descript

stream descript ptr stream make share stream descript
stream storag type storag type dens
stream stream size
stream push back stream



todo unifi sampl sequenc mode packer singl
todo function differ handl
todo m blayout perf iter copi sequenc
todo should perf test unifi

todo step packer move reader
todo core cntk they format agnost use
todo deseri
pack mode

pack mode sampl
packer make share frame packer provid random stream

pack mode sequenc
packer make share sequenc packer provid random stream

pack mode truncat
packer make share truncat bptt packer provid random stream


logic error unsupport packer pack mode



vector stream descript ptr htkmlf reader get stream descript

stream
stream


htkmlf reader start epoch epoch configur config

config total epoch size in sampl

runtim error epoch size cannot




pack mode pack mode truncat

size minibatch size config minibatch size in sampl
size truncat length truncat length
truncat length

config truncat length specifi minibatch size
truncat size mb size
real minibatch size truncat size nbruttsineachrecurrentit
fprintf stderr legaci configur use truncat bptt mode pleas adapt config explicitli specifi truncat length
truncat length minibatch size
size num parallel sequenc num parallel sequenc for all epoch config epoch index
minibatch size num parallel sequenc truncat length


epoch configur bptt config
bptt config number of worker config number of worker
bptt config worker rank config worker rank
bptt config total epoch size in sampl config total epoch size in sampl
bptt config epoch index config epoch index
bptt config minibatch size in sampl minibatch size
bptt config truncat size truncat length

random start epoch bptt config
packer start epoch bptt config



random start epoch config
packer start epoch config



minibatch htkmlf reader read minibatch

packer nullptr
packer read minibatch




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
regex
config helper
data reader
string util

microsoft cntk



pair size size config helper get context window

size left right
intargvector context window config context window config paramet array intargvector vector

context window size symmetr

size window frame context window
window frame

invalid argument neighbor expans input featur symmetr window frame


extend side
size context window frame
left context
right context

context window size

left context right context
left context window
right context window



invalid argument context window must valu specifi found context window size


make pair left right


config helper check featur type

wstring config real
wcsicmp real

invalid argument featur must real



config helper check label type

wstring
config exist label type

todo deprec eventu
cast wstring config label type



output categori
cast wstring config categori


wcsicmp categori

invalid argument label must categori



get file config name determin name featur label section config file
featur vector featur name string
label vector label name string
config helper get data name from config
vector wstring featur
vector wstring label
vector wstring hmm
vector wstring lattic

config get member id

config can be config record

config paramet temp config
config paramet contain file element
temp exist current scp file

featur push back

temp exist current mlf file temp exist current mlf file list

label push back

temp exist current phone file

hmm push back

temp exist current denlat toc file

lattic push back




element type config helper get element type

precis config find precis
are equal ignor case precis

element type tfloat


are equal ignor case precis

element type tdoubl


runtim error support precis expect precis


size config helper get featur dimens

config exist

config


invalid argument featur must specifi dimens properti miss


size config helper get label dimens

config exist label dim

config label dim


config exist

config


invalid argument label must specifi dimens label dim properti miss


vector wstring config helper get mlf path

vector wstring result
config exist current mlf file

result push back config mlf file



config exist current mlf file list

invalid argument either mlf file mlf file list must exist reader configur


wstring config mlf file list
msra file textread

result push back wgetlin



result


size config helper get random window

size result random auto

config exist random

wstring random string config can be string random config random wstring
wcsicmp random string none

result random none

wcsicmp random string

result random auto



result config random



result


wstring config helper get random

read method default block random
wstring random config read method block random

random block random get random window random none

invalid argument random cannot none read method block random


random


vector wstring config helper get sequenc path

wstring script path config scp file
wstring root path config prefix path in scp

vector wstring filelist
fprintf stderr read script file script path

todo possibl chang file abl read pipelin
script path gzip file popen stream gener open return ifstream
ifstream msra strfun utf8 script path
line
getlin line

filelist push back msra strfun utf16 line


fprintf stderr entri cast filelist size

post process file
user specifi prefix path prefix path filelist
dotdotdot expans necessari
root path specifi path prefix featur

first make slash consist sorri linux user necessari
replac root path root path

second remov trail slash
wregex trailer
root path regex replac root path trailer wstring

third join root path entri filelist
root path

wstring path filelist

path find first wstring npo

vector wstring strarr msra strfun split path
ifdef win32
replac strarr strarr

path strarr root path strarr



ifdef win32
replac path path

path root path path







expans use rel path name
mean full path file
exampl file
contain entri like
file1 feat
file2 feat

featur read
file1 feat
file2 feat

thi work well store file featur
want differ file everytim move creat featur

wstring scp dir cach
entri filelist

expand dot dot dot entri script path scp dir cach



filelist


intargvector config helper get number of utter per minibatch for all eppoch

intargvector number of utter config nbruttsineachrecurrentit config paramet array intargvector vector
number of utter size

number of utter

logic error nbr utt in each recurr iter cannot less



number of utter


config helper expand dot dot dot wstring feat path wstring scp path wstring scp dir cach

wstring delim

scp dir cach

scp dir cach scp path
wstring tail
scp dir cach find last delim
wstring npo

tail scp dir cach substr
scp dir cach resiz

tail noth split given contain filenam
scp dir cach swap tail

size feat path find
feat path npo
feat path feat path substr scp dir cach feat path substr




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
experiment htkmlf reader compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx

bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv





copyright microsoft right reserv
licens licens licens file project root full licens inform

data reader defin export function applic


stdafx
basic

defin dataread export
data reader
config
reader shim
htkmlf reader
heap memori provid

microsoft cntk

factori method reader
todo must remov move untyp matrix
factori config paramet paramet reader ptr

make share htkmlf reader make share heap memori provid paramet


dataread get reader f i data reader preader

preader reader shim factori


dataread get reader d i data reader preader

preader reader shim factori




copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
inttyp
limit
mlf data deseri
config helper
htkmlf reader htkfeatio
htkmlf reader msra mgram
latticearch

defin minwindef

microsoft cntk

one float
one doubl

current singl chunk contain vector label
todo thi chang futur work subset chunk
point time
mlf data deseri mlf chunk chunk

mlf data deseri parent

mlf chunk mlf data deseri parent parent parent


get sequenc size sequenc id vector sequenc data ptr result

parent get sequenc by id sequenc id result



inner utter
mlf utter sequenc descript

size sequenc start


mlf data deseri mlf data deseri corpu descriptor ptr corpu config paramet label config wstring name

frame mode current specifi configur
configur particular deseri higher level configur
becaus find method
frame mode label config find frame mode

config helper config label config

config check label type
size dimens config get label dimens

dimens numer limit index type

runtim error label dimens pr iu64 exce maximum allow
valu pr iu64 dimens size numer limit index type


todo similarli reader current assum mlf root name
restrict reader file make stuff much faster without shorten input file

todo current word tabl
msra c symbol set word tabl nullptr
unord symbol tabl nullptr
vector wstring mlf path config get mlf path
wstring state list path cast wstring label config label map file

todo current still thi refactor later
htk time to frame 100000 10m
msra htkmlfreader msra htkmlfentri msra lattic lattic htkmlfwordsequ label mlf path wstring state list path word tabl symbol tabl htk time to frame

make sure msra htkmlfreader move

move construct
msra htkmlfreader msra htkmlfentri
msra lattic lattic htkmlfwordsequ valu
type msra htkmlfreader move construct

element type config get element type

mlf utter descript
descript is valid
size total frame

string registri corpu get string registri
label

current registri contain utter describ
skip other
size
string registri tri get first


descript major

utter second
descript sequenc start class id size
descript is valid
size number of frame

index utter

timespan utter
timespan firstfram
utter firstfram utter numfram timespan firstfram

runtim error label consecut order label first


timespan classid dimens

runtim error class exce model output dimens timespan classid dimens


timespan classid cast msra classidtyp timespan classid

runtim error classidtyp bit


size timespan firstfram timespan firstfram timespan numfram

class id push back timespan classid
number of frame



descript number of sampl number of frame
total frame number of frame
utter index push back frame size
key to sequenc descript major utter index size

todo should creat chunk
mlf frame
chunk id
number of sampl
major descript major
is valid descript is valid
size descript number of sampl

frame size
minor
index descript sequenc start
frame push back


utter index push back frame size

total number of frame total frame

fprintf stderr mlf data deseri mlf data deseri read sequenc frame size
fprintf stderr mlf data deseri mlf data deseri read utter key to sequenc size

initi stream descript singl stream
stream descript ptr stream make share stream descript
stream
stream name name
stream sampl layout make share tensor shape dimens
stream storag type storag type spars
stream element type element type
stream push back stream

initi label
categori reserv dimens
categori indic reserv dimens
size dimens

spars sequenc data ptr categori make share spars sequenc data
categori indic push back cast index type
categori indic categori indic
categori nnz count resiz
categori nnz count
categori total nnz count
categori number of sampl
element type element type tfloat

categori one float



element type element type tdoubl
categori one doubl

categori push back categori



current singl chunk
todo thi chang deseri properli support chunk
chunk descript mlf data deseri get chunk descript

make share chunk descript

number of sequenc frame mode frame size key to sequenc size
number of sampl frame size
chunk descript


get sequenc particular chunk
mlf data deseri get sequenc for chunk size vector sequenc descript result

result reserv frame size
frame mode

becaus frame mode creat sequenc frame
size frame size

sequenc descript
major frame major
minor frame minor
frame
chunk id frame chunk id
number of sampl
is valid
result push back




creat sequenc descript utter
size utter index size

sequenc descript
major frame utter index major
minor

chunk id frame utter index chunk id
number of sampl utter index utter index
is valid
result push back




chunk ptr mlf data deseri get chunk size chunk id

unus chunk id
chunk id
make share mlf chunk


spars label utter
elem type
mlf sequenc data spars sequenc data

vector elem type valu
uniqu index type indic ptr

mlf sequenc data size number of sampl
valu number of sampl
indic ptr index type number of sampl

number of sampl numer limit index type

runtim error number sampl mlf sequenc pr iu64
exce maximum allow valu pr iu64
number of sampl size numer limit index type


nnz count resiz number of sampl cast index type
number of sampl number of sampl
total nnz count cast index type number of sampl
indic indic ptr
valu



mlf data deseri get sequenc by id size sequenc id vector sequenc data ptr result

frame mode

size label class id frame sequenc id index
label categori size
result push back categori label



pack label utter spars sequenc
size start frame index utter index sequenc id
size number of sampl utter index sequenc id start frame index
spars sequenc data ptr
element type element type tfloat

make share mlf sequenc data number of sampl



element type element type tdoubl
make share mlf sequenc data number of sampl


size number of sampl

size frame index start frame index
size label class id frame frame index index
indic cast index type label

result push back



sequenc descript invalid sequenc

mlf data deseri get sequenc descript by key key type sequenc descript result

sequenc id key to sequenc find major
sequenc id key to sequenc

result invalid sequenc



frame mode

size index utter index sequenc id second minor
result frame index



result major major
result minor
result sequenc id second
result chunk id frame utter index sequenc id second chunk id
result number of sampl utter index sequenc id second utter index sequenc id second
result is valid





copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx
htk data deseri
config helper
basic
numer

todo thi remov depend code elimin
current fix link
msra

unord wstring htkfeatread parsedpath archiv path string map
vector wstring htkfeatread parsedpath archiv path string vector



microsoft cntk



htk data deseri htk data deseri
corpu descriptor ptr corpu
config paramet featur
wstring featur name
primari
io featur dimens
sampl period
verbos
corpu corpu
total number of frame
primari primari

frame mode current specifi configur
configur particular deseri higher level configur
becaus find method
frame mode featur find frame mode

config helper config featur
config check featur type

context config get context window
element type config get element type

dimens config get featur dimens
dimens dimens context first context second

initi chunk descript config
initi stream featur name
initi featur inform

augment window config get context window

given explicitli need identifi requir augment rang expect dimens
dimens file
augment window first augment window second

augment window first augment window second msra augmentationext io featur dimens dimens



initi chunk base configur utter descript
htk data deseri initi chunk descript config helper config

read utter descript
vector wstring path config get sequenc path
vector utter descript utter
utter reserv path size
string registri corpu get string registri
path

utter descript descript move msra htkfeatread parsedpath
size number of frame descript get number of frame

todo need least frame boundari marker work
todo remov deseri rewritten
number of frame

fprintf stderr htk data deseri htk data deseri skip utter frame less frame
number of frame descript get key



wstring descript get key
size
primari

todo definit corpu move corpu descriptor
todo key ad current drive deseri
string registri add valu



string registri tri get

utter unknown skip




descript set id
utter push back descript
total number of frame number of frame


size max utter per chunk 65535
distribut chunk
simpli count frame reach chunk size
note first random chunk use chunk consecut thu caus disk head seek chunk

frame second
size frame per sec

chunk consitut minut
size chunk frame frame per sec frame target chunk

load initi hour rang involv disk seek accept
when page chunk chunk chunk size

chunk resiz
chunk reserv total number of frame chunk frame

chunk id
size start frame insid chunk
index utter

exceed current entri creat
chunk littl larger want half utter length
chunk chunk back get total frame chunk frame chunk back get number of utter max utter per chunk

chunk push back htk chunk descript
chunk id
start frame insid chunk


append utter last chunk
htk chunk descript current chunk chunk back
utter assign to chunk chunk id current chunk get number of utter start frame insid chunk
primari

have store utter map primari deseri
key to chunk locat utter get id make pair utter get chunk id utter get index insid chunk

start frame insid chunk utter get number of frame
current chunk move utter


fprintf stderr
htk data deseri htk data deseri utter group chunk chunk size utter frame
utter size
chunk size
utter size chunk size
total number of frame chunk size


describ expos stream singl stream featur
htk data deseri initi stream wstring featur name

stream descript ptr stream make share stream descript
stream
stream name featur name
stream sampl layout make share tensor shape dimens
stream element type element type
stream storag type storag type dens
stream push back stream


read inform featur first file
thi inform use later check featur among file properti
htk data deseri initi featur inform

msra util attempt

msra htkfeatread reader
reader getinfo chunk front get utter get path featur kind io featur dimens sampl period
fprintf stderr htk data deseri htk data deseri determin featur kind dimension frame shift
dimens featur kind sampl period



get inform avail chunk
chunk descript htk data deseri get chunk descript

chunk descript chunk
chunk reserv chunk size

size chunk size

make share chunk descript

number of sampl chunk get total frame
frame mode frame repres sequenc
augment still done frame sequenc pleas get sequenc by id method
number of sequenc frame mode chunk get total frame chunk get number of utter
chunk push back

chunk


get sequenc particular chunk
thi inform use random fill current window sequenc
htk data deseri get sequenc for chunk size chunk id vector sequenc descript result

htk chunk descript chunk chunk chunk id
result reserv chunk get total frame
size offset in chunk
size chunk get number of utter

utter chunk get utter
size major utter get id

frame mode

becaus frame mode creat sequenc frame
size utter get number of frame

sequenc descript
chunk id chunk id
major major
minor
offset in chunk
is valid
number of sampl
result push back




creat sequenc descript utter
sequenc descript
chunk id chunk id
major major
minor
offset in chunk
is valid
number of sampl utter get number of frame
result push back




wrapper around matrix view vector column vector
doe memori associ
matrix as vector of vector


matrix as vector of vector msra matrixbas
matrix



size size

matrix col


size

matrix matrix row



disabl copi move matrix as vector of vector
msra matrixbas matrix



represet chunk memori given random
random decid releas particular chunk
htk data deseri htk chunk chunk


htk chunk htk data deseri parent size chunk id parent parent chunk id chunk id

chunk descript parent chunk chunk id

possibl distribut read
make sever attempt
msra util attempt

chunk descript requir data parent featur kind parent io featur dimens parent sampl period parent verbos



get sequenc
get sequenc size sequenc id vector sequenc data ptr result

parent get sequenc by id chunk id sequenc id result


unload memori
htk chunk

chunk descript parent chunk chunk id
chunk descript releas data



disabl copi move htk chunk
htk data deseri parent
size chunk id


get chunk specifi chunk
chunk ptr htk data deseri get chunk size chunk id

make share htk chunk chunk id


matrix store sampl sequenc without pad differ ssematrix
column equal sampl sequenc
row equal size featur vector sampl dimens
featur matrix


featur matrix size num row size num column num row num row num column num column

resiz num row num column


return refer column
size column

num row column num row


get pointer
get data




get column equal sampl sequenc utter
size get number of column

num column


get total size element store featur
size get total size

size



featur
vector
number row dimens featur
size num row
number column sampl utter
size num column


thi store sequenc float
htk float sequenc data dens sequenc data

htk float sequenc data featur matrix buffer

number of sampl get number of column
buffer get data



featur matrix buffer


thi store sequenc doubl
htk doubl sequenc data dens sequenc data

htk doubl sequenc data featur matrix buffer get data get data get total size

number of sampl get number of column
buffer



vector buffer


sequenc chunk sequenc
sequenc guarante uniqu insid chunk
htk data deseri get sequenc by id size chunk id size vector sequenc data ptr

chunk descript chunk chunk id
size utter index frame mode chunk descript get utter for chunk frame index
utter descript utter chunk descript get utter utter index
utter frame chunk descript get utter frame utter index

wrapper allow size requir augmentneighbor
matrix as vector of vector utter frame wrapper utter frame
featur matrix featur dimens frame mode utter get number of frame

frame mode

frame mode augment singl frame
size frame index utter get start frame index insid chunk
msra augmentneighbor utter frame wrapper vector frame index augment window first augment window second featur



augment complet utter
size frame index frame index utter get number of frame frame index

msra augmentneighbor utter frame wrapper vector frame index augment window first augment window second featur frame index



copi featur sequenc depend
dens sequenc data ptr result
element type element type tdoubl

result make share htk doubl sequenc data featur

element type element type tfloat

result make share htk float sequenc data move featur



logic error current deseri support type


push back result


sequenc descript invalid sequenc

get sequenc descript
htk data deseri get sequenc descript by key key type sequenc descript

primari
iter key to chunk locat find major
iter key to chunk locat

unknown sequenc return invalid
invalid sequenc



chunk chunk iter second first
sequenc chunk get utter iter second second
chunk id sequenc get chunk id
frame mode sequenc get start frame index insid chunk minor sequenc get index insid chunk
is valid
number of sampl frame mode sequenc get number of frame





copyright microsoft right reserv
licens licens licens file project root full licens inform

defin secur warn

chunk random
random

microsoft cntk

note thi code use legaci random make sure preserv behavior test
todo deprec random place
size rand size size

still cover rang
size random number rand rand rand
random number


note thi code use legaci random make sure preserv behavior test
todo deprec random place
t vector
random shuffl t vector size random seed

size rand cast size rand

runtim error random shuffl larg need chang differ random gener


srand cast random seed
index current locat

pick random locat locat swap current
size random locat rand size
swap current locat random locat



chunk random chunk random i data deseri ptr deseri size random rang in sampl legaci
deseri deseri legaci legaci random rang in sampl random rang in sampl

origin chunk deseri get chunk descript


get random chunk
vector random chunk chunk random get random chunk

random chunk


random chunk depend mode legaci calcul random window
chunk random random seed

vector size random chunk indic
random chunk indic reserv origin chunk size
size origin chunk size

random chunk indic push back


legaci

random shuffl random chunk indic seed



mt19937 cast seed
shuffl random chunk indic random chunk indic


place random chunk timelin
random chunk clear
random chunk reserv origin chunk size
size sampl posit
size sequenc posit
size chunk index chunk index origin chunk size chunk index

size origin chunk index random chunk indic chunk index
size number of sampl origin chunk origin chunk index number of sampl
size number of sequenc origin chunk origin chunk index number of sequenc

random chunk random chunk
random chunk chunk id chunk index
random chunk origin origin chunk origin chunk index
random chunk sampl posit start sampl posit
random chunk sequenc posit start sequenc posit
random chunk push back random chunk
sampl posit number of sampl
sequenc posit number of sequenc


chunk comput random rang random chunk sequenc
size half window rang random rang in sampl
size chunk id chunk id origin chunk size chunk id

chunk random chunk chunk id

start rang left neighbor
chunk id

chunk random window
chunk random window



chunk random window random chunk chunk id random window might earli
chunk random window random chunk chunk id random window might space


need adapt
chunk sampl posit start random chunk chunk random window sampl posit start half window rang

earli need increas
chunk random window


chunk alway insid window
adjust window chunk id
chunk random window chunk random window chunk id
chunk random window chunk random window chunk id

chunk random window origin chunk size
random chunk chunk random window sampl end posit chunk sampl posit start half window rang

space move window right
chunk random window





copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn
algorithm

no random
data reader

microsoft cntk

no random no random i data deseri ptr deseri multithread get next sequenc
deseri deseri
sampl posit in epoch
current chunk posit size
global sampl posit
total number of sampl
current sequenc posit in chunk
multithread get next sequenc multithread get next sequenc

deseri nullptr
stream deseri get stream descript
chunk descript deseri get chunk descript

size sampl count
chunk chunk descript

check posit correspond chunk
chunk sampl offset size chunk

chunk sampl offset push back sampl count
sampl count chunk number of sampl


sampl count

runtim error no random expect input contain sampl success read sampl


total number of sampl sampl count


no random initi transform ptr config paramet



size no random get chunk index of size sampl posit

result upper bound chunk sampl offset chunk sampl offset sampl posit
result chunk sampl offset


no random start epoch epoch configur config

config config

config total epoch size in sampl request data size

config total epoch size in sampl total number of sampl


sampl posit in epoch
global sampl posit config total epoch size in sampl config epoch index
size sweep sampl posit global sampl posit total number of sampl

size chunk index get chunk index of sweep sampl posit
chunk index current chunk posit

unload everyth
current chunk id size
current chunk nullptr

need load descript current chunk
current chunk posit chunk index
current sequenc posit in chunk
sequenc window clear
deseri get sequenc for chunk current chunk posit sequenc window


move current sequenc insid chunk match sampl offset
size sampl offset insid chunk sweep sampl posit chunk sampl offset current chunk posit
size number of sampl
size sequenc id

current linear happen border epoch
size sequenc window size

size sequenc size sequenc window number of sampl
sequenc size number of sampl sampl offset insid chunk

found sequenc



number of sampl sequenc size
sequenc id


current sequenc posit in chunk sequenc id
chunk descript current chunk posit number of sequenc current sequenc posit in chunk


move cursor sequenc possibl updat chunk inform need
no random move to next sequenc

sequenc descript sequenc sequenc window current sequenc posit in chunk
sampl posit in epoch sequenc number of sampl
global sampl posit sequenc number of sampl

current sequenc posit in chunk chunk descript current chunk posit number of sequenc

move chunk
current chunk posit current chunk posit chunk descript size
current sequenc posit in chunk
sequenc window clear
deseri get sequenc for chunk current chunk posit sequenc window



current sequenc posit in chunk



get sequenc descript total size less sampl count
vector sequenc descript no random get next sequenc descript size sampl count

sequenc window size
chunk descript current chunk posit number of sequenc current sequenc posit in chunk

sampl sampl count

vector sequenc descript result



sequenc descript sequenc sequenc window current sequenc posit in chunk
result push back sequenc
sampl sequenc number of sampl

move to next sequenc

check whether sequenc fit sampl count
sampl sequenc window current sequenc posit in chunk number of sampl
result


sequenc no random get next sequenc size sampl count

sequenc result
config total epoch size in sampl sampl posit in epoch

result end of epoch
result


check sweep
todo thi preserv behavior could done differ futur
size sweep posit global sampl posit total number of sampl
sampl count sampl count total number of sampl sweep posit
sampl count

vector sequenc descript descript get next sequenc descript sampl count

retriev sequenc requir worker
size start descript size config worker rank config number of worker
size descript size config worker rank config number of worker
size subset size start
subset size

result


result resiz stream size vector sequenc data ptr subset size

collect chunk need
size chunk ptr chunk

current chunk nullptr

chunk current chunk id current chunk


subset size

sequenc descript descript start
chunk find sequenc descript chunk id
chunk

chunk sequenc descript chunk id deseri get chunk sequenc descript chunk id



process
vector sequenc data ptr sequenc
sequenc descript descript start

chunk find sequenc descript chunk id
chunk

logic error invalid chunk request


second get sequenc sequenc descript sequenc
stream size

result sequenc



todo thi chang move transform random deal multithread
multithread get next sequenc

pragma parallel schedul dynam
subset size
process



subset size
process


keep last chunk time
current chunk id descript start subset size chunk id
chunk find current chunk id
chunk
current chunk second

result




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn

sequenc random
algorithm
util
dequ

microsoft cntk

note thi code use legaci random make sure preserv behavior test
todo deprec random place
size rand size size

still cover rang
size random number rand rand rand
random number


sequenc random sequenc random
i data deseri ptr deseri
chunk random ptr chunk random
random chunk chunk random get random chunk
chunk window begin
random window end
random cursor
chunk window end
current sequenc cursor
current chunk cursor
current sampl cursor
deseri deseri

size
random chunk

origin number of sequenc

origin number of sequenc



buffer origin sequenc reserv


reset current sweep accord random seed provid
sequenc random reset size rand seed

srand rand seed

sequenc window clear
chunk window clear
random chunk info clear

chunk window begin
random window end
random cursor
chunk window end

current chunk cursor
current sequenc cursor
current sampl cursor

prepar chunk read
random next chunk if need


get random sequenc descript exceed sampl count
vector random sequenc descript sequenc random get next sequenc descript size sampl count

sampl sampl count

vector random sequenc descript result
result reserv sampl count

size sequenc offset insid chunk current sequenc cursor random chunk current chunk cursor sequenc posit start
random sequenc descript sequenc sequenc window current chunk cursor chunk window begin sequenc offset insid chunk

result push back sequenc
sampl sequenc number of sampl
current sequenc cursor
current sampl cursor sequenc number of sampl

sequenc offset insid chunk random chunk current chunk cursor origin number of sequenc

move chunk
move chunk cursor


sampl current chunk cursor random chunk size

sequenc offset insid chunk current sequenc cursor random chunk current chunk cursor sequenc posit start
sequenc sequenc window current chunk cursor chunk window begin sequenc offset insid chunk
sampl sequenc number of sampl

result push back sequenc
current sequenc cursor
sampl sequenc number of sampl
current sampl cursor sequenc number of sampl

sequenc offset insid chunk random chunk current chunk cursor origin number of sequenc

move chunk
move chunk cursor




result


move chunk cursor chunk random sequenc necessari
sequenc random move chunk cursor

current chunk cursor
random next chunk if need


releas chunk chunk window need anymor
sequenc random releas chunk

drop chunk firstli make sure use
that mean sequenc descript previou call still block random
size current chunk current chunk cursor random chunk size
size candid to unload chunk window begin
candid to unload random chunk size
candid to unload random chunk current chunk random window
random chunk candid to unload random window current chunk cursor

sequenc window front
chunk window front
random chunk info front
chunk window begin
candid to unload



random chunk need chunk cursor increment
sequenc random random next chunk if need

current chunk cursor random window end

current chunk cursor chunk window begin


random window end current chunk cursor

random window end random chunk size




chunk random
sampl posit random current sampl count
random chunk posit window guarante determin
sequenc chunk random
size next random cursor random chunk random window end random window
next random cursor random chunk size
random chunk next random cursor random window random window end

next random cursor


determin chunk need load memori
size next chunk window end random chunk next random cursor random window

let page everyth current rang end chunk index end chunk idx
size chunk window end next chunk window end

add random sequenc for chunk


size first sequenc posit to random
random cursor random chunk random cursor sequenc end posit

size end sequenc po to random random chunk next random cursor sequenc end posit
size first sequenc posit to random end sequenc po to random

valid random rang express chunk
todo thi done effici know rang chunk alreadi
size current chunk idx get chunk index for sequenc posit

size chunk window begin random chunk current chunk idx random window
size chunk window end random chunk current chunk idx random window

valid random rang express sequenc posit
size po begin random chunk chunk window begin sequenc posit start
size po end random chunk chunk window end sequenc end posit



pick sequenc posit po begin po end
size rand po begin po end

sequenc current cannot place posit
is valid for posit get random sequenc descript by sequenc id


sequenc current cannot place posit
is valid for posit get random sequenc descript by sequenc id


swap
swap get random sequenc descript by sequenc id get random sequenc descript by sequenc id todo swap perhap effici




verifi right
size first sequenc posit to random end sequenc po to random

todo
is valid for posit get random sequenc descript by sequenc id

logic error sequenc random random next sequenc descript random logic mangl



recalcul sampl random chunk effici index seek
size sampl count
size random chunk random window end chunk window begin
size index index sequenc window random chunk size index

sampl count sequenc window random chunk index number of sampl


save sampl inform
chunk info info
info number of sampl sampl count
info start random chunk info random chunk info back start random chunk info back number of sampl
random chunk info push back info

updat cursor
random window end
random cursor next random cursor
chunk window end next chunk window end


set current cursor given sampl offset
offset middl sequenc sequenc pick
sequenc offset outsid sweep return
size sequenc random seek size sweep sampl offset size sweep

determin sampl rang random within chunk window
size random window begin in sampl
size random window end in sampl
random chunk info

random window begin in sampl random chunk info front start
random window end in sampl random chunk info back start random chunk info back number of sampl


sweep sampl offset random window begin in sampl

request offset earliest random sequenc still
need start
reset sweep

sweep sampl offset random window end in sampl

request offset within random window
chang current chunk cursor contain request offset
size index
index index random chunk info size index

random chunk info index start sweep sampl offset
sweep sampl offset random chunk info index start random chunk info index number of sampl




index random chunk info size

current chunk cursor chunk window begin index
current sequenc cursor random chunk current chunk cursor sequenc posit start
current sampl cursor random chunk info index start

todo time advanc right sequenc
need past random chunk window


advanc sequenc sequenc desir offset reach
todo perhap optim
current sampl cursor sweep sampl offset

get next sequenc descript


current sampl cursor


check random sequenc valid target posit chunk random window
sequenc random is valid for posit size target posit random sequenc descript seq desc

chunk random chunk get chunk index for sequenc posit target posit
chunk random window seq desc chunk chunk id seq desc chunk chunk id chunk random window


get random chunk index sequenc posit sweep
size sequenc random get chunk index for sequenc posit size sequenc posit

result upper bound
random chunk
random chunk
sequenc posit
size random chunk sequenc posit start
result random chunk


random sequenc chunk given index
sequenc random add random sequenc for chunk size chunk idx

chunk idx chunk window end

random chunk chunk random chunk chunk idx
vector random sequenc descript chunk sequenc

buffer origin sequenc clear
deseri get sequenc for chunk chunk origin buffer origin sequenc
chunk sequenc reserv buffer origin sequenc size
size buffer origin sequenc size

random sequenc descript
buffer origin sequenc
number of sampl buffer origin sequenc number of sampl
chunk chunk
chunk sequenc push back


sequenc window push back move chunk sequenc
chunk window push back chunk
chunk window end


get random sequenc sequenc
random sequenc descript sequenc random get random sequenc descript by sequenc id size sequenc id

size global chunk idx get chunk index for sequenc posit sequenc id
size sequenc offset insid chunk sequenc id random chunk global chunk idx sequenc posit start
sequenc window global chunk idx chunk window begin sequenc offset insid chunk



copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn

block random
algorithm
util
dequ

data reader
random


microsoft cntk

block random block random
verbos
size random rang in sampl
i data deseri ptr deseri
decim mode decim mode
use legaci random
multithread get next sequenc
verbos verbos
deseri deseri
decim mode decim mode
sweep size
epoch size size
global sampl posit size
epoch start posit
sweep total number of sampl
last seen chunk id size
chunk random make share chunk random deseri random rang in sampl use legaci random
multithread get next sequenc multithread get next sequenc

deseri nullptr

stream deseri get stream descript
sequenc random make share sequenc random deseri chunk random

calcul total sampl
sweep total number of sampl
chunk deseri get chunk descript

sweep total number of sampl chunk number of sampl



start epoch
block random start epoch epoch configur config

last seen chunk id size

config config
config total epoch size in sampl request data size

epoch size sweep total number of sampl



epoch size config total epoch size in sampl


calcul start epoch prepar sweep need
epoch start posit epoch size config epoch index
prepar new sweep if need epoch start posit

set sequenc cursor sequenc correspond epoch start posit
last epoch end middl sequenc cursor move sequenc sweep
size offset in sweep epoch start posit sweep total number of sampl
size new offset sequenc random seek offset in sweep sweep
global sampl posit sweep sweep total number of sampl new offset


prepar sweep need
block random prepar new sweep if need size sampl posit

size sweep sampl posit sweep total number of sampl
sweep sweep

sweep sweep
sweep start in sampl sweep sweep total number of sampl

rerandom chunk
chunk random random sweep

reset seqeunc random
sequenc random reset sweep

unload chunk memori
chunk clear
last seen chunk id size



get sequenc exceed sampl count
sequenc block random get next sequenc size sampl count

sequenc descript
sequenc result
vector random sequenc descript sequenc
result end of epoch get next sequenc descript sampl count sequenc
sequenc size

result


decim
vector random sequenc descript decim
decim reserv sequenc size
decim sequenc decim
decim size

result


result resiz stream size vector sequenc data ptr decim size

process
descript decim
vector sequenc data ptr sequenc
chunk find descript chunk chunk id
chunk

logic error invalid chunk request


second get sequenc descript sequenc
stream size

result sequenc



todo thi chang move transform random deal multithread
multithread get next sequenc

pragma parallel schedul dynam
decim size
process



decim size
process


sequenc random releas chunk
result


sequenc descript exceed sampl count
return epoch reach
block random get next sequenc descript size sampl count vector random sequenc descript result

sampl count

prepar new sweep if need global sampl posit

check epoch
global sampl posit epoch size epoch start posit




sampl count sampl count epoch size epoch start posit global sampl posit
sampl count

check sweep
sampl count sampl count sweep total number of sampl global sampl posit sweep total number of sampl
sampl count

random sequenc
result sequenc random get next sequenc descript sampl count



decim sequenc load unload chunk infrom sequenc random
block random decim vector random sequenc descript vector random sequenc descript decim

swap remov chunk one
requir chunk
retriev data chunk

move cursor read sequenc
sequenc

global sampl posit sequenc number of sampl


decim reserv size
decim mode decim mode chunk

sequenc

sequenc chunk chunk id config number of worker config worker rank

decim push back sequenc



decim mode decim mode sequenc

size stride begin size config worker rank config number of worker
size stride end size config worker rank config number of worker
decim assign stride begin stride end



logic error support mode



retriev chunk base window inform provid sequenc random
block random retriev data chunk

window sequenc random get chunk window
window back chunk id last seen chunk id

noth retriev


last seen chunk id window back chunk id

build current load chunk
iter thru chunk window chunk
request deseri
there could chunk chunk requir anymor swap chunk chunk remov
size chunk ptr chunk
chunk window

decim mode decim mode chunk chunk chunk id config number of worker config worker rank




chunk find chunk chunk id
chunk

chunk chunk chunk id second



chunk chunk chunk id deseri get chunk chunk origin



swap current chunk chunk remov stale rememb newli load
chunk swap chunk




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn
defin secur warn

numer
inttyp
sequenc packer
element type util

microsoft cntk

mb layout ptr sequenc packer creat mb layout stream batch batch

vector mb layout sequenc info info
size index index batch size index

mb layout sequenc info info

info seq id index
info t begin
info t end batch index number of sampl
info push back info


vector pair size size placement
vector size row alloc

creat minibatch layout
mb layout ptr p mb layout make share mb layout
p mb layout init as pack sequenc info placement row alloc
p mb layout


minibatch sequenc packer read minibatch

sequenc transform get next sequenc minibatch size
batch sequenc

minibatch minibatch sequenc end of epoch
batch

minibatch


output stream descript size batch size

stream index stream index batch size stream index

stream batch batch stream index
output stream descript stream index storag type
p mb layout storag type dens
pack dens stream stream batch stream index pack spars stream stream batch stream index

buffer stream buffer stream index

stream minibatch make share stream minibatch
stream minibatch buffer
stream minibatch layout p mb layout
minibatch push back stream minibatch


minibatch


mb layout ptr sequenc packer pack dens stream stream batch batch size stream index

output stream descript stream index storag type storag type dens
stream input stream descript stream index
buffer stream buffer stream index
size sampl size get sampl size stream
p mb layout creat mb layout batch
size requir size p mb layout get num col sampl size
buffer size requir size

buffer resiz requir size


element size get size by type stream element type

sequenc info p mb layout get all sequenc

iter sequenc layout copi sampl
sourc sequenc buffer appropri offset
sequenc info sequenc info

skip gap
sequenc info seq id sequenc




sequenc batch sequenc info seq id
size num sampl sequenc number of sampl
num sampl sequenc info get num time step

buffer ptr buffer
iter sampl sequenc keep track sampl offset especi
import spars input offset preced element
size sampl index sampl offset sampl index num sampl sampl index

comput offset destin buffer layout inform
column index correspond given sampl
destin offset p mb layout get column index sequenc info sampl index sampl size
verifi enough space left buffer full sampl
destin offset buffer size sampl size
destin buffer ptr destin offset
stream storag type storag type dens

verifi offset invari dens
sampl offset sampl index sampl size
pack dens sampl destin sequenc sampl offset sampl size
sampl offset sampl size

stream storag type storag type spars

todo make cast member spars sequenc data
spars sequenc data ptr spars sequenc pointer cast spars sequenc data sequenc
make sure sequenc meta correct
num sampl spars sequenc nnz count size
pack spars sampl as dens destin spars sequenc sampl index sampl offset sampl size element size
move offset count sampl
sampl offset spars sequenc nnz count sampl index
verifi offset within bound less equal
total count sequenc
sampl offset spars sequenc total nnz count



runtim error storag support stream storag type




p mb layout


mb layout ptr sequenc packer pack spars stream stream batch batch size stream index

output stream descript stream index storag type storag type spars

comput aggreg count sequenc batch
size nnz count
sequenc batch

spars sequenc data ptr spars sequenc pointer cast spars sequenc data sequenc
nnz count spars sequenc total nnz count


nnz count numer limit index type

runtim error minibatch count pr iu64 exce maximum allow
valu pr iu64 nnz count size numer limit index type


stream input stream descript stream index
stream storag type storag type spars
element size get size by type stream element type
index size index type
p mb layout creat mb layout batch

comput requir buffer size
size size element size index
column size column index
size requir size
nnz count
nnz count element size index size
index size p mb layout get num col

buffer stream buffer stream index
buffer size requir size

buffer resiz requir size


destin buffer
insert nnz count first element buffer
memcpi destin nnz count nnz count

creat pointer memori block insid buffer
portion anther indic
data dst destin nnz count
indic dst data dst element size nnz count
column index current sampl valu pack
index type column offset
vector store column index sampl result pack matrix
vector index type spars column indic
vector keep track offset input sequenc
offset valu pack current sampl
valu indic start offset posit sequenc index
vector index type sequenc offset batch size

vector mb layout sequenc info sequenc info p mb layout get all sequenc

sort vector ascend order parallel sequenc index
sort sequenc info sequenc info
mb layout sequenc info mb layout sequenc info

iter time step layout total sampl column
parallel sequenc travers layout horizont direct
time step time step p mb layout get num time step time step

time step iter sequenc minibatch
travers layout vertic direct
sequenc info sequenc info

skip sequenc intersect time step
time step sequenc info t begin time step sequenc info t end




store offset current column
spars column indic push back column offset

seq id sequenc info seq id
seq id sequenc




comput index sampl insid sequenc
size sampl index time step sequenc info t begin
sequenc batch seq id

make sure index less sequenc length sampl
sampl index sequenc number of sampl

sequenc offset sequenc offset seq id
spars sequenc data ptr spars sequenc pointer cast spars sequenc data sequenc
index type spars sequenc nnz count sampl index

comput sampl offset byte
size sampl offset sequenc offset element size
copi valu sourc sequenc buffer
data src reinterpret cast sequenc sampl offset
memcpi data dst data src element size
data dst element size advanc destin pointer

copi valu indic sourc sequenc buffer
indic src spars sequenc indic sequenc offset
memcpi indic dst indic src index size
indic dst index size advanc destin pointer

sequenc offset
column offset



point element sequenc offset equal total
count respect sequenc element
overal count
accumul sequenc offset sequenc offset nnz count

check distanc index destin pointer
indic dst data dst nnz count index size
pack sampl column offset must equal total count
column offset nnz count
spars column indic push back column offset
check column indic
column pack matrix
p mb layout get num col spars column indic size

verifi enough space buffer column indic
indic dst spars column indic size index size destin requir size
copi column indic buffer
memcpi indic dst spars column indic spars column indic size index size

p mb layout




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn
defin secur warn

dequ
truncat bptt packer
element type util

microsoft cntk



repres slot accumul sequenc minibatch creat
slot equal parallel sequenc want pack
slot


slot length sampl cursor sampl offset


check slot
is empti

sequenc


get avail sampl slot
size avail number of sampl

length sampl cursor
sequenc sampl cursor front sequenc number of sampl sampl cursor
length sampl cursor


add sequenc slot
push sequenc sequenc data ptr

sequenc push back
length number of sampl


sequenc data ptr front sequenc

sequenc
sequenc front


pop front sequenc begin slot
pop sequenc

sequenc
sampl cursor
sampl offset
length sequenc front number of sampl
sequenc front


contain current sampl cursor first sequenc sequenc front slot
size sampl cursor

offset current sampl region first sequenc
dens input sampl cursor sampl size byte
spars input element size byte count
preced sampl
size sampl offset


prepar sequenc
dequ sequenc data ptr sequenc

contain size slot sampl accumul sequenc
size length


repres buffer slot minibatch creat
sequenc buffer

sequenc buffer size num parallel sequenc

alloc requir slot
slot resiz num parallel sequenc


check whether avail slot
noth to pack

find slot slot slot is empti
slot


matrix prepar sequenc row num parallel sequenc slot
least hold sequenc fill truncat length
onli epoch could less truncat length sampl matrix

look someth like
slot1

slot m

slot n s rn1 s rn2 s rn2
vector slot slot


truncat bptt packer truncat bptt packer
memori provid ptr memori provid
transform ptr transform
vector stream descript ptr stream
packer base memori provid transform stream
truncat size

spars output find output stream descript output stream descript stream descript ptr storag type storag type spars
spars output output stream descript

todo support spars
runtim error spars output support bptt mode


prepar layout
output stream descript size

p mb layout make share mb layout
p mb layout set uniqu axi name truncat bptt packer
current layout push back p mb layout



truncat bptt packer start epoch epoch configur config

minibatch size config minibatch size in sampl
truncat size config truncat size

minibatch size config minibatch size in sampl
truncat size config truncat size

minibatch size

logic error minibatch size cannot zero

truncat size

logic error truncat size cannot zero


estim parallel sequenc pack slot minibatch size truncat size
num parallel sequenc floor minibatch size truncat size

sequenc buffer per stream clear

prepar buffer
output stream descript size

stream output stream descript
buffer stream buffer
buffer resiz num parallel sequenc truncat size get sampl size stream
sequenc buffer per stream push back make share sequenc buffer num parallel sequenc



fill initi sequenc
size slot index slot index num parallel sequenc slot index

read sequenc to slot slot index



minibatch truncat bptt packer read minibatch

minibatch result

current expect sequenc ident length differ stream
suffici check singl stream
sequenc buffer per stream front noth to pack

result end of epoch
result


iter stream slot pack minibatch
size stream index stream index output stream descript size stream index

current layout stream index init num parallel sequenc truncat size
size sequenc id
size slot index slot index num parallel sequenc slot index

pack slot stream index slot index sequenc id


stream minibatch ptr make share stream minibatch
stream buffer stream index
layout current layout stream index
result push back


result


pack slot sequenc minibatch
truncat bptt packer pack slot size stream index size slot index size sequenc id

slot sequenc buffer per stream stream index slot slot index

slot avail number of sampl truncat size

there free space slot fill possibl
read sequenc to slot slot index


much sampl need read
size number of sampl truncat size slot avail number of sampl
number of sampl

reach correspond minibatch layout
current layout stream index add sequenc sequenc slot index truncat size

check noth slot
slot is empti



size sampl size get sampl size input stream descript stream index
storag type storag type input stream descript stream index storag type
size element size get size by type input stream descript stream index element type

distanc sampl sequenc byte
size stride size num parallel sequenc sampl size

current sequenc minibatch layout
current layout stream index add sequenc
sequenc id
slot index
slot sampl cursor
slot front sequenc number of sampl slot sampl cursor

fill buffer
size current timestep current timestep number of sampl current timestep

check reach front sequenc
slot sampl cursor slot front sequenc number of sampl

start sequenc have reset current pointer minibatch layout
slot pop sequenc

ad sequenc minibatch
current layout stream index add sequenc
sequenc id
slot index
current timestep
current timestep slot front sequenc number of sampl


fill first sequenc slot
slot front sequenc
buffer destin current sampl
buffer stream buffer stream index
offset stride size current timestep slot index sampl size
offset offset buffer size
destin buffer offset

pack sampl
storag type storag type dens

slot sampl offset slot sampl cursor sampl size
pack dens sampl destin slot sampl offset sampl size
slot sampl offset sampl size



storag type storag type spars
todo make cast member spars sequenc data
spars sequenc data ptr spars sequenc pointer cast spars sequenc data
slot sampl cursor spars sequenc nnz count size
pack spars sampl as dens destin spars sequenc slot sampl cursor
slot sampl offset sampl size element size
slot sampl offset spars sequenc nnz count slot sampl cursor
slot sampl offset spars sequenc total nnz count


slot sampl cursor


clean last sequenc read need
slot sampl cursor slot front sequenc number of sampl

slot pop sequenc


ad last
number of sampl truncat size

current layout stream index add sequenc
sequenc
slot index
number of sampl
truncat size



truncat bptt packer read sequenc to slot size slot index

slot sequenc buffer per stream front slot slot index
truncat size slot avail number of sampl

need singl sequenc potenti request truncat size slot avail number of sampl
effici realiti truncat size usual less sequenc size
transform get next sequenc
end of epoch




ad sequenc slot stream
size size

size

check sequenc length
front front number of sampl front number of sampl

runtim error bptt sequenc differ input stream length


sequenc buffer per stream slot slot index push sequenc front






copyright microsoft right reserv
licens licens licens file project root full licens inform

reader shim implement shim wrap reader


defin secur warn

ifdef win32
objbas


sstream
basic

defin dataread export creat export
data reader
reader shim

microsoft cntk

elem type
reader shim elem type reader shim reader factori factori
factori factori



elem type
reader shim elem type init config paramet config

intargvector number ofutt per minibatch for all epoch
config nbruttsineachrecurrentit config paramet array intargvector vector

prefetch config prefetch
prefetch launch asynchron
otherwis defer synchron execut call
launch type prefetch launch async launch defer

num parallel sequenc number ofutt per minibatch for all epoch

reader factori config
stream reader get stream descript
stream

name to stream id insert make pair name



elem type
reader shim elem type start minibatch loop size mb size size epoch size request epoch sampl

start distribut minibatch loop mb size epoch request epoch sampl


elem type
reader shim elem type start distribut minibatch loop
size request mb size
size epoch
size subset num
size num subset
size request epoch sampl request data size

epoch configur config
config worker rank subset num
config number of worker num subset
config minibatch size in sampl request mb size
config total epoch size in sampl request epoch sampl
config epoch index epoch

reader start epoch config
end of epoch

adapt minibatch make sure outstand read
prefetch task valid

prefetch task wait


prefetch task async launch type

reader read minibatch



enumer input wstring size name to stream id

todo boost algorithm join boost adapt transform make gener
stringstream
first

name to stream id

first
name msra strfun utf8 first
name
first





elem type
reader shim elem type get minibatch stream minibatch input matric

todo verifi matrix name ident
reader input name warn subset
superset

end of epoch




check matric devic
inject i memori provid stream
devic id matric second matrix get devic id
matric
second matrix get devic id devic id unus devic id

prefetch task valid

minibatch minibatch prefetch task
minibatch end of epoch

end of epoch
minibatch





reset stale layout
bugbug thi seem incorrect layout updat layout reset twice
iter matric

iter second p mb layout init


gener error messag check layout constraint
wstring wstring layout to input map
minibatch

todo altern pin buffer packer copi anyth pack pin memori
copi return minibatch matric
matric

name to stream id find first name to stream id

input name enumer input name to stream id
runtim error could input reader reader output
first input name


size stream id name to stream id first

stream minibatch stream id

num parallel sequenc stream layout get num parallel sequenc

thi longer hold differ input differ sequenc length result differ
parallel sampl
num parallel sequenc minibatch front layout get num parallel sequenc

layout second p mb layout

layout get num col

layout copi layout info reader
layout copi from stream layout keep name
layout to input map layout get axi name first

layout stream layout deep valu level comparison

runtim error dynam axi layout share input layout gener
input incompat axi differ sequenc length
consid ad dynam axi input node
layout get axi name layout to input map layout get axi name first


size sampl size stream stream id sampl layout get num element
matrix matric get input matrix elem type first
fill matrix from stream stream stream id storag type matrix sampl size stream



end of epoch

prefetch task async launch type

reader read minibatch



minibatch


elem type
reader shim elem type fill matrix from stream storag type matrix elem type matrix size num row stream minibatch ptr stream

size num col stream layout get num col

storag type dens

reinterpret cast elem type stream
matrix set valu num row num col matrix get devic id cast elem type matrix flag normal

storag type spars

spars layout ident cuda layout
http doc nvidia cuda cuspars compress spars column format
size reinterpret cast size stream
size nnz count
elem type valu reinterpret cast elem type
index type row reinterpret cast index type valu nnz count
index type column reinterpret cast index type row nnz count
matrix set matrix from csc format column row valu nnz count num row num col



runtim error storag support



elem type
reader shim elem type data end note return valu never use

elem type
reader shim elem type copi mb layout to mb layout ptr layout

thi method inherit i data reader remov near futur
implement


elem type
size reader shim elem type get num parallel sequenc

bugbug thi properti stream reader might produc sever differ
parallel sequenc thu properti make sens anymor
thi method call
data reader helper get num subminibatch need estim size
comput network set batch normal time constant comput learn rate sampl
comput network set batch normal time constant comput actual size momentum sampl
adapt minibatch size comput learn rate sampl
num parallel sequenc


reader shim
reader shim


copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn
defin secur warn

algorithm
frame packer

microsoft cntk


mb layout ptr frame packer creat mb layout stream batch batch

violat find batch batch sequenc data ptr number of sampl
violat batch

runtim error detect frame sequenc size frame mode
violat number of sampl

creat minibatch layout
mb layout ptr p mb layout make share mb layout
p mb layout init as frame mode batch size
p mb layout




copyright microsoft right reserv
licens licens licens file project root full licens inform


defin secur warn
defin secur warn

packer base
element type util

microsoft cntk



todo handl memori provid
packer base stream buffer resiz size new size

size new size
reset reinterpret cast memori provid alloc new size


memori provid free



packer base start epoch epoch configur config

minibatch size config minibatch size in sampl
minibatch size

logic error minibatch size cannot zero



packer base packer base memori provid ptr memori provid
transform ptr transform
vector stream descript ptr stream
transform transform
minibatch size
output stream descript stream

input stream descript transform get stream descript
input stream descript size
input stream descript size output stream descript size

stream buffer reserv output stream descript size

saniti check
size output stream descript size

stream output stream descript
unus stream

input output match everyth spars dens storag
stream element type element type tfloat stream element type element type tdoubl
stream name input stream descript name
stream input stream descript
get sampl size input stream descript get sampl size stream

input stream descript storag type storag type dens
stream storag type storag type spars

runtim error dens spars pack request stream support
stream name


stream buffer push back stream buffer memori provid



get sampl size byte
size packer base get sampl size stream descript ptr stream

stream nullptr
size element size get size by type stream element type
stream sampl layout get num element element size




copyright microsoft right reserv
licens licens licens file project root full licens inform

defin secur warn

bundler


microsoft cntk

repres bundl chunk descript possibl cleans
bundler bundler chunk descript chunk descript

chunk descript ptr origin

sequenc invalid least deseri
size invalid


bundler bundler
config paramet reader config
i data deseri ptr driver
vector i data deseri ptr deseri
cleans
deseri deseri driver driver

unus reader config

combin stream underli deseri
deseri

get stream descript

stream descript ptr stream make share stream descript
stream stream size
stream push back stream



cleans cleans
creat chunk descript


creat chunk descript base chunk underli deseri
bundler creat chunk descript

chunk driver get chunk descript
chunk size

runtim error drive deseri least provid chunk


chunk reserv chunk size

clean requir simpli build chunk base chunk descript primari deseri
cleans

chunk

make share bundler chunk descript
number of sampl number of sampl
number of sequenc number of sequenc
chunk size
origin
chunk push back




otherwis build bundl chunk underli deseri
vector sequenc descript sequenc descript
sequenc descript reserv chunk front number of sequenc
sequenc descript
size chunk index chunk index chunk size chunk index

size number of sampl
size number of sequenc
sequenc descript clear

iter thru sequenc identifi whether valid among deseri
driver get sequenc for chunk chunk chunk index sequenc descript
size invalid
size sequenc index sequenc index sequenc descript size sequenc index

sequenc sequenc descript sequenc index
is valid
size deseri index deseri index deseri size deseri index

deseri deseri index get sequenc descript by key sequenc descript sequenc index
is valid

is valid
invalid insert sequenc index




is valid

number of sampl sequenc number of sampl
number of sequenc



build chunk valid sequenc
number of sampl

make share bundler chunk descript
number of sampl number of sampl
number of sequenc number of sequenc
chunk size
origin chunk chunk index
chunk push back
invalid move invalid




get chunk descript
chunk descript bundler get chunk descript

chunk descript chunk chunk


get sequenc descript chunk
bundler get sequenc for chunk size chunk id vector sequenc descript sequenc

bundler chunk descript ptr chunk chunk chunk id
chunk descript ptr origin chunk origin
driver get sequenc for chunk origin sequenc

sequenc clean
chunk invalid




cleans
vector sequenc descript result
result reserv sequenc size
size sequenc index sequenc index sequenc size sequenc index

chunk invalid find sequenc index chunk invalid




result push back sequenc sequenc index

swap sequenc result


repres chunk pointer underli deseri chunk
bundler bundl chunk chunk

size number of input
bundler parent
size chunk id

map expos sequenc inner chunk deseri
index vector map chunk inner sequenc number of input
deseri number of input
vector chunk ptr inner chunk
map expos sequenc inner sequenc deseri
indic
vector size sequenc to sequenc

disabl copi move bundl chunk


bundl chunk size number of input bundler parent size chunk id
number of input number of input parent parent chunk id chunk id

bundler chunk descript ptr chunk parent chunk chunk id
chunk descript ptr origin chunk origin

deseri parent deseri
number of input deseri size
vector sequenc descript sequenc
sequenc reserv origin number of sequenc

creat chunk map
parent driver get sequenc for chunk origin sequenc
chunk ptr drive chunk parent driver get chunk origin
sequenc to sequenc resiz number of input sequenc size
inner chunk resiz number of input sequenc size
size sequenc index sequenc index sequenc size sequenc index

chunk invalid find sequenc index chunk invalid




size current index sequenc index number of input
sequenc to sequenc current index sequenc sequenc index
inner chunk current index drive chunk


creat sequenc map requir underli chunk
sequenc descript
size deseri index deseri index parent deseri size deseri index

size chunk ptr secondari chunk

size sequenc index sequenc index sequenc size sequenc index

chunk invalid find sequenc index chunk invalid




size current index sequenc index number of input deseri index
deseri deseri index get sequenc descript by key sequenc sequenc index
sequenc to sequenc current index

chunk ptr secondari chunk
secondari chunk find chunk id
secondari chunk

secondari chunk deseri deseri index get chunk chunk id
secondari chunk insert make pair chunk id secondari chunk



secondari chunk second


inner chunk current index secondari chunk




get sequenc
get sequenc size sequenc id vector sequenc data ptr result

result reserv number of input
size current index sequenc id number of input
parent deseri size

size origin sequenc id sequenc to sequenc current index
inner chunk current index get sequenc origin sequenc id result




chunk
chunk ptr bundler get chunk size chunk id

make share bundl chunk stream size chunk id



stdafx sourc file includ standard includ
pars number compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

dllmain defin entri point applic

stdafx
ifdef win32
defin win32 lean mean
defin nominmax
window


bool apientri dll main hmodul h modul
dword reason call
lpvoid lp reserv


reason call

process attach
thread attach
thread detach
process detach





copyright microsoft right reserv
licens licens licens file project root full licens inform

cntk eval defin export function cntk


stdafx
defin eval export creat export
eval
action
cntk eval
cpu matrix set num thread
simpl output writer
ndl network builder
ifdef leakdetect
leak detect

best gpu
mpi wrapper

todo temporari mechan enabl memori share
node output valu matric thi away
share readi enabl
share node valu matric

microsoft cntk

elem type
eval get eval i evalu model elem type peval

peval cntk eval elem type


eval get eval f i evalu model peval

get eval peval

eval get eval d i evalu model peval

get eval peval


elem type
cntk eval elem type init config

start
config pars config
size n thread config num cpu thread
cpu matrix elem type set num thread n thread

share node valu matric config share node valu matric


destroy cleanup remov
note destroy use past point
elem type
cntk eval elem type destroy

cleanup everyth
reset
reader
writer



creat network creat network base network descript
network descript network descript
elem type
cntk eval elem type creat network network descript

config paramet config
config pars network descript

vector wstring output node name
get model from config config paramet elem type config output node name

nullptr

logic error unabl construct network descript



get node dimens node dimens specifi node
dimens name node dimens node append input output scenario
node group node request input output specifi
note node group specifi dimens expect popul name node request dimens modifi current valu
elem type
cntk eval elem type get node dimens wstring size dimens node group node group



iter dimens iter dimens iter
iter second



output node output node
node group

node input

output node size

logic error output node found cannot determin input node dimens lack output node output node name output node properli defin configur file


node input node output node
node node

wstring name node node name
size size node get sampl matrix num row
dimens name size



node output

node output node
node node

wstring name node node name
size size node get sampl matrix num row
dimens name size



node specifi
iter dimens iter dimens iter

node get node from name iter first
iter second node get sampl matrix num row





start evalu minibatch loop prepar network evalu call
ouput node name name node evalu
elem type
cntk eval elem type start evalu minibatch loop wstring output node name

start evalu minibatch loop get node from name output node name


evalu evalut model given input output
input node name input vector
output node name output vector output vector need prealloc caller size happen evalu
elem type
cntk eval elem type evalu wstring vector elem type input wstring vector elem type output

size minibatch size config minibatch size size 10240
evalu name output
vector wstring out node name

config paramet config
config devic id get devic id

creat reader necessari
reader nullptr

reader eval reader elem type config


reader
get node dimens dimens node input
reader set data input dimens
reader set boundari start

creat writer necessari
writer nullptr

writer eval writer elem type config

writer
get node dimens dimens node output
writer set data output dimens

call evalu
simpl output writer elem type
write output reader minibatch size writer out node name


evalu evalut model given input output
output node name output vector output vector need prealloc caller size happen evalu
elem type
cntk eval elem type evalu wstring vector elem type output

evalu name output
vector wstring out node name

config paramet config

creat writer necessari
writer nullptr

writer eval writer elem type config


writer
get node dimens dimens node output
writer set data output dimens

call evalu
simpl output writer elem type
write output writer out node name


reset state reset cell state start utter
elem type
cntk eval elem type reset state

start start


instanti combin expect use
cntk eval
cntk eval


copyright microsoft right reserv
licens licens licens file project root full licens inform

cassert
stdio
profil
best gpu cpuonli flag

ifndef cpuonli
cuda profil

compil without cuda defin profil control function stub
cuda profil start


cuda profil stop




profil profil num sampl
num sampl num sampl
is profil activ



profil profil

is profil activ
stop


profil start

is profil activ
is profil activ
fprintf stderr start profil
cuda profil start


profil next sampl

is profil activ

num sampl
stop



num sampl
start



profil stop

is profil activ
cuda profil stop
fprintf stderr stop profil
is profil activ


copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file
bell whistl parallel random

defin secur warn secur avail platform file give variabl warn

basic

nonlinear node dropout node
special purpos node sequenc with softmax node
data reader helper
matrix quantiz impl
ifdef quantiz gradient aggreg
pair size first
workaround line aggreg gradient impl get updat header cpu eval error
all reduc dist grad aggreg

simpl dist grad aggreg
progress trace




microsoft cntk







config paramet
config paramet
scriptabl object i config record
scriptabl object i config record


train perform multi epoch train checkpoint


elem type
elem type train comput network ptr deviceid type creat network fn deviceid type devic id
i data reader train set data reader
i data reader valid set data reader
make mode

determin epoch start includ recov checkpoint make mode enabl
start epoch determin start epoch make mode
start epoch max epoch

logprintf stderr train necessari



wstring model file name get model name for epoch start epoch
load network from checkpoint start epoch
fprintf stderr
load network from checkpoint
logprintf stderr start checkpoint load network model file name

logprintf stderr creat virgin network

creat load checkpoint
share comput network load network from checkpoint creat network fn devic id comput network creat from file elem type devic id model file name

devic comput
logprintf stderr model node load network from checkpoint load creat get total number of node
get devic id
fprintf stderr

fprintf stderr get devic id

todo bugbug start checkpoint need synchron initi model
strategi initi mpi rank broadcast paramet

start epoch start epoch
need adapt regular

trace flag
enabl node trace trace node name real trace node name categori trace node name spars

train or adapt model start epoch load network from checkpoint nullptr train set data reader valid set data reader



adapt similar train purpos adapt


elem type
elem type adapt wstring orig model file name wstring ref node name
i data reader train set data reader
i data reader valid set data reader
deviceid type devic id make mode

start epoch determin start epoch make mode
start epoch max epoch

logprintf stderr train necessari



comput network ptr
network load from checkpoint
start epoch

wstring model file name get model name for epoch start epoch
logprintf stderr start checkpoint load network model file name
comput network creat from file elem type devic id model file name
network load from checkpoint



logprintf stderr load network from origin model file orig model file name
comput network creat from file elem type devic id orig model file name


start epoch start epoch

comput network ptr ref net
need adapt regular adapt reg type adapt reg type adapt reg weight
need adapt regular

logprintf stderr load refer network from origin model file orig model file name
ref net comput network creat from file elem type devic id orig model file name


comput node base ptr ref node
need adapt regular adapt reg type adapt reg type

logprintf stderr check ref node name orig model file name
ref node name
invalid argument ref node name exist need adapt reg type
ref node ref net get node from name ref node name


train or adapt model start epoch network load from checkpoint ref net ref node train set data reader valid set data reader



train or adapt model main train given start model


momentum per mb momentum per sampl size minibatch size

elem type
elem type train or adapt model start epoch comput network ptr
network load from checkpoint
comput network ptr ref net
comput node base ptr ref node
i data reader train set data reader
i data reader valid set data reader

featur node featur node
label node label node
criterion node get train criterion node

fprintf stderr
logprintf stderr train criterion node
node criterion node

logprintf stderr node node name node oper name

criterion node

logprintf stderr none
invalid argument train or adapt model criterion node specifi


determin evalu node get eval criterion node ensur criterion log
vector comput node base ptr evalu node

origin evalu node get eval criterion node
comput node base ptr criteria log make sure criteria
node criterion node
criteria log insert node

node origin evalu node
criteria log insert node second
evalu node push back node

evalu node

fprintf stderr
logprintf stderr evalu criterion node
fprintf stderr
node evalu node

logprintf stderr node node name node oper name




vector comput node base ptr addit node to evalu
output node output node
addit node to evalu insert addit node to evalu output node cbegin output node cend

pre comput node list get node requir pre comput
addit node to evalu insert addit node to evalu pre comput node list cbegin pre comput node list cend

alloc memori forward backward comput
alloc all matric evalu node addit node to evalu criterion node

featur label node matric pass get minibatch
todo instead rememb node directli abl handl node current version crash mix network
stream minibatch input input matric stream minibatch input
todo chang share uniqu
size

node featur node label node
node node
input matric add input node node name node valu ptr node get mb layout node get sampl layout


file sequenc train
is sequenc train criterion criterion node oper name sequenc with softmax
is sequenc train criterion

sequenc with softmax node elem type node cast sequenc with softmax node elem type criterion node
node dynam pointer cast sequenc with softmax node elem type criterion node
node gethmm
train set data reader get hmm data


use regular adapt adapt techniqu
edit model normal train algorithm
todo should done adapt
todo redo leverag share ptr probabl even network share featur node
todo then also share mb layout current copi valu
vector comput node base ptr ref featur node keep origin network featur
need adapt regular adapt reg type adapt reg type ref node nullptr

ref net invalid compil network prepar compil
replac input node network input node main network
ref featur node resiz featur node size
size featur node size

need keep info undo later
todo after chang share ptr longer necessari
ref featur node ref net get node from name featur node node name rememb restor later
ref net chang node featur node node name featur node

cast mb layout ptr ref net get mb layout ptr of network get mb layout ptr of network workaround
ref net compil network

alloc memori forward comput
ref net alloc all matric ref node nullptr


initi weight gradient holder
criterion todo support multipl one
learnabl node learnabl paramet node criterion node
matrix elem type smooth gradient

node iter learnabl node node iter learnabl node node iter

comput node ptr node dynam pointer cast comput node elem type node iter
smooth gradient push back matrix elem type node valu get num row
node valu get num col
get devic id


avg criterion lr control criterion
lr control criterion avg criterion numer limit infin
size epoch not count in avg criterion start epoch learn rate adjust interv

vector wstring eval node name
size evalu node size
eval node name push back evalu node node name

learn rate per sampl mb size start epoch

learn rate adjust factor
vector prev learn rate
prev learn rate resiz num prev learn rate
num prev learn rate

prev learn rate


get parallel method parallel method data parallel sgd

init dist grad agg evalu node size trace level

get parallel method parallel method model averag sgd

init model aggreg handler sync stat trace


precomput mean inv std dev node save initi model
when precomput save load model
checkpoint instead built network descript
pre comput train set data reader featur node label node input matric network load from checkpoint

synchron rank write model
everyon done load model
nullptr

wait all


parallel train main node save model prevent
parallel train node collid write file
nullptr is main node
save get model name for epoch start epoch


size total train sampl seen aggreg epoch log purpos

learn rate initi
prev criterion numer limit infin
start epoch

learn rate initi tri load check point info start epoch
total train sampl seen
learn rate per sampl
smooth gradient
prev criterion
prev chosen minibatch size
learn rate initi
prev learn rate start epoch num prev learn rate learn rate per sampl


auto learn rate search type learn rate search algorithm adjust after epoch
learn rate initi learn rate param size start epoch

invalid argument
when adjust after epoch must either exist checkpoint file
learn rate must specifi config start epoch


drop out seed
prev dropout rate
prev normal time constant
prev normal blend time constant

learn rate reduc

user config memori alloc convolut oper network
comput network set max temp mem size for cnn criterion node max temp mem size in sampl for cnn
need adapt regular adapt reg type adapt reg type ref node

comput network set max temp mem size for cnn ref net ref node max temp mem size in sampl for cnn


likewis sequenc train paramet
is sequenc train criterion

comput network set seq param elem type criterion node h smooth weight frame drop thresh do refer align
seq gammar calc amf seq gammar calc lmf seq gammar calc wp seq gammar calcb mmi factor seq gammar calc use mbr


main epoch loop
start epoch max epoch todo size

synchron rank proceed
rank finish write previou model file
nullptr

wait all


timer timer
timer start

dropout rate epoch
comput network set dropout rate elem type criterion node dropout rate prev dropout rate drop out seed
comput network set batch normal time constant elem type criterion node
batch normal time constant prev normal time constant
batch normal blend time constant prev normal blend time constant

learn rate adjust
auto learn rate search type learn rate search algorithm learn rate param size

bugbug get num parallel sequenc return certain situat seem restart checkpoint
learn rate per sampl get learn rate per sampl bugbug workaround train set data reader get num parallel sequenc

auto learn rate search type learn rate search algorithm search befor epoch

largest prev learn rate per sampl prev learn rate
num prev learn rate

largest prev learn rate per sampl largest prev learn rate per sampl prev learn rate


reason learn rate base initi minibatch size
new learn rate per sampl search for best learn rate ref net ref node learn rate per sampl
train set data reader featur node label node
criterion node evalu node input matric
learnabl node smooth gradient
learn rate initi largest prev learn rate per sampl
learn rate adjust factor new learn rate per sampl learn rate per sampl
learn rate per sampl new learn rate per sampl

save sampl learn rate support changeabl minibatch size
prev learn rate num prev learn rate learn rate per sampl


learn rate initi

learn rate per sampl min learn rate

logprintf stderr learn rate sampl epoch less min learn rate train complet
learn rate per sampl min learn rate
auto learn rate search type learn rate search algorithm

parallel train main node save model prevent
parallel train node collid write file
nullptr is main node
save model path




size chosen minibatch size
size actual minibatch size

through command line config file user minibatch size epoch
basi epoch epoch point mb size size either
keep
last minibatch size tune find better
auto adjust minibatch mb size size

size num frame to use in search num mini batch4 lr search mb size
epoch size request data size

num frame to use in search exceed total frame epoch
num frame to use in search num frame to use in search epoch size


tune find better minibatch size
chosen minibatch size adapt minibatch size ref net ref node
num frame to use in search
train set data reader learn rate per sampl
mb size featur node label node
criterion node evalu node
input matric learnabl node
smooth gradient learn rate adjust factor
prev chosen minibatch size chosen minibatch size



explicitli minibatch size
chosen minibatch size mb size


actual minibatch size fix up effect mb size chosen minibatch size bugbug workaround train set data reader get num parallel sequenc

momentum per sampl get momentum per sampl bugbug workaround train set data reader get num parallel sequenc
time constant sampl contribut reduc
momentum as time constant momentum per sampl
momentum per sampl
momentum per sampl
fprintf stderr
logprintf stderr start epoch learn rate sampl effect momentum momentum time constant sampl
learn rate per sampl momentum per mb momentum per sampl actual minibatch size momentum as time constant

epoch criterion epoch criterion criterion valu return
vector epoch criterion epoch eval error evalu node size
train one epoch
ref net
ref node

epoch size
train set data reader
learn rate per sampl
chosen minibatch size
featur node
label node
criterion node
evalu node
input matric
learnabl node smooth gradient
epoch criterion epoch eval error
total train sampl seen epoch criterion second aggreg train sampl log purpos

timer stop
epoch time timer elaps second

use eval criterion control lr epoch eval error size
lr control criterion epoch eval error averag

lr control criterion epoch criterion averag

note train loss per sampl epoch total sampl seen total epoch
logprintf stderr
finish epoch train train loss per sampl total sampl seen
max epoch epoch criterion averag total train sampl seen
last finish epoch train loss epoch criterion averag
epoch eval error size criterion train criterion

fprintf stderr
avg learn rate per sampl epoch time
learn rate per sampl epoch time

epoch eval error size

fprintf stderr
eval err per sampl avg learn rate per sampl epoch time
epoch eval error averag learn rate per sampl epoch time



fprintf stderr eval err per sampl
size epoch eval error size
fprintf stderr epoch eval error averag

fprintf stderr avg learn rate per sampl epoch time
learn rate per sampl epoch time

todo extra messag criterion
logprintf stderr finish epoch criterion node sampl
max epoch criterion node node name epoch criterion averag

size epoch eval error size

logprintf stderr finish epoch evalu node sampl
max epoch eval node name epoch eval error averag



valid set data reader train set data reader valid set data reader nullptr

simpl evalu elem type evalforvalid
vector wstring cv set train and eval node
criterion node size

cv set train and eval node push back criterion node node name

evalu node size

cv set train and eval node push back evalu node node name


bugbug train size train size constrain converg memori eval constrain memori
v score evalforvalid evalu valid set data reader cv set train and eval node mb size
logprintf stderr finish epoch valid train loss per sampl max epoch v score averag
v score size
fprintf stderr eval err per sampl v score averag
fprintf stderr

use cv set control lr if cv exist

use eval criterion control lr v score size
lr control criterion v score averag

lr control criterion v score averag first train criterion



broadcast epoch criterion make sure processor learn rate schedul
get parallel method parallel method model averag sgd num node in use

bcast epoch criterion first main node rank
bcast epoch criterion second main node rank
bcast lr control criterion main node rank


load prev model
size epoch sinc last learn rate adjust learn rate adjust interv
avg criterion numer limit infin

avg criterion lr control criterion



avg criterion epoch sinc last learn rate adjust epoch not count in avg criterion
avg criterion
lr control criterion
epoch sinc last learn rate adjust epoch not count in avg criterion


auto learn rate search type learn rate search algorithm adjust after epoch
learn rate param size epoch sinc last learn rate adjust learn rate adjust interv

isnan avg criterion prev criterion avg criterion prev criterion numer limit infin

load best model

roll back
best model path get model name for epoch learn rate adjust interv
logprintf stderr load roll back previou model best train criterion valu best model path
reread persist paramet elem type best model path
load check point info learn rate adjust interv
total train sampl seen
learn rate per sampl
smooth gradient
prev criterion
prev chosen minibatch size
load prev model



continu reduc

isnan avg criterion
prev criterion avg criterion reduc learn rate if improv less than prev criterion
prev criterion numer limit infin

learn rate reduc

learn rate reduc



parallel train main node save model prevent
parallel train node collid write file
nullptr is main node
save get model name for epoch

logprintf stderr finish train save model




learn rate reduc

learn rate per sampl learn rate decreas factor
logprintf stderr learn rate per sampl reduc learn rate per sampl




isnan avg criterion
prev criterion avg criterion reduc learn rate if improv less than prev criterion
prev criterion numer limit infin


learn rate per sampl learn rate decreas factor
logprintf stderr learn rate per sampl reduc learn rate per sampl

prev criterion avg criterion increas learn rate if improv more than prev criterion
prev criterion numer limit infin

learn rate per sampl learn rate increas factor
logprintf stderr learn rate per sampl increas learn rate per sampl





isnan avg criterion
runtim error train criterion


load previou valu
load prev model epoch sinc last learn rate adjust learn rate adjust interv

prev criterion avg criterion
epoch not count in avg criterion


synchron rank proceed
nobodi tri read checkpoint file time
rank delet
nullptr

wait all


persist model check point info
nullptr is main node

save check point info total train sampl seen learn rate per sampl smooth gradient prev criterion chosen minibatch size
model name get model name for epoch
logprintf stderr save checkpoint model model name
save model name
keep check point file

previou checkpoint file save space
auto learn rate search type learn rate search algorithm adjust after epoch load best model

epoch sinc last learn rate adjust

wunlink get check point file name for epoch

epoch sinc last learn rate adjust learn rate adjust interv

wunlink get check point file name for epoch learn rate adjust interv




wunlink get check point file name for epoch




learn rate per sampl

logprintf stderr learn rate sampl reduc stop train
learn rate per sampl


main epoch loop

synchron rank proceed
rank finish write model file
nullptr

wait all


progress trace comput cluster manag
progress trace trace progress percentag max epoch
progress trace trace train loss last finish epoch train loss

sinc link featur node need remov delet
need adapt regular adapt reg type adapt reg type ref node nullptr

size ref featur node size

note need handl delet care
ref net chang node ref featur node node name ref featur node



input matric



train one epoch train epoch


gener pad float or exp format pad size precis valu

elem type
size elem type train one epoch comput network ptr
comput network ptr ref net
comput node base ptr ref node
epoch number
size epoch size
i data reader train set data reader
learn rate per sampl
size tune mb size
vector comput node base ptr featur node
vector comput node base ptr label node
vector comput node base ptr criterion node
vector comput node base ptr evalu node
stream minibatch input input matric todo pointer
comput node base ptr learnabl node
matrix elem type smooth gradient
epoch criterion epoch criterion
vector epoch criterion epoch eval error
prefix msg

scope network oper mode mode guard network oper mode train

bring valu consist state
epoch criterion epoch criterion
epoch eval error assign epoch eval error size epoch criterion

total time in m bs sinc timer microsecond time resolut

initi statist
size total epoch sampl

num m bs run

use gradient aggreg get parallel method parallel method data parallel sgd
epoch number parallel start epoch num
use model averag get parallel method parallel method model averag sgd
epoch number parallel start epoch num
use parallel train use gradient aggreg use model averag

relat variabl
size n sampl sinc last model sync
use parallel train p masgd helper

p masgd helper on epoch start learnabl node


vector matrix elem type learn param gradient
profil profil num m bs to cuda profil

reset profil perform epoch
num m bs to cuda profil

use distribut mb read use parallel train
enabl distribut mb read
train set data reader support distribut mb read
use distribut mb read

train set data reader start distribut minibatch loop tune mb size epoch number current node rank
num node in use epoch size



train set data reader start minibatch loop tune mb size epoch number epoch size


start evalu minibatch loop evalu node
start evalu minibatch loop criterion node
need adapt regular adapt reg type adapt reg type ref node

ref net start evalu minibatch loop ref node


prepar minibatch
minibatch use singl minibatch larg
data reader helper subminibatch dispatch elem type smb dispatch
size num subminibatch need data reader helper get num subminibatch need elem type train set data reader max sampl in ram num submini batch tune mb size

trivial need manag handl
num subminibatch need
smb dispatch init learnabl node criterion node evalu node

follow special featur support kaldi2 reader effici sequenc train
thi attemp comput error signal whole utter
neural network featur current workaround
forward sequenc train allow
process utter time
todo move forward support reader make first citizen
attempt utter deriv featur train set data reader featur node input matric

fprintf stderr
logprintf stderr start minibatch
use gradient aggreg

fprintf stderr data parallel sgd train my rank num node num gradient bit
current node rank num node in use num gradient bit

buffer async gradient aggreg

fprintf stderr buffer async gradient aggreg enabl



use distribut mb read

fprintf stderr distribut read enabl


num subminibatch need

max sampl in ram size
fprintf stderr maximum sampl max sampl in ram

fprintf stderr subminibatch num subminibatch need

fprintf stderr

timer timer
timer start

note follow local matric use dist grad agg path
assum train criterion node epoch
criterion valu accumul minibatch without pull
criterion accumul elem type local epoch criterion get devic id
criterion accumul elem type local epoch eval error epoch eval error size get devic id

main minibatch loop

differenti log keep previou criterion valu around
epoch criterion epoch criterion last log epoch criterion
vector epoch criterion epoch eval error last log epoch eval error

no more sampl to process


minibatch
todo guarante alreadi complet point overwrit buffer
size actual mb size
wa data read data reader helper get minibatch into network elem type train set data reader criterion node
use distribut mb read use parallel train input matric actual mb size
wa data read use distribut mb read no more sampl to process distribut read loop rank complet
epoch

note wa data read get minibatch into network suppos full
must touch

wa data read
actual mb size wa data read

n sampl sinc last model sync actual mb size

node chang
todo move well tire everyth
todo right get minibatch call sinc chang
need check whether would caus unintend side effect
todo origin code call actual mb size
comput network bump eval time stamp featur node
comput network bump eval time stamp label node

actual mb size

wa data read
ifndef evaldl
do gradient check gradient check criterion node learnabl node
logic error cannot gradient checker

todo current support node regular
need adapt regular adapt reg type adapt reg type ref node

size actual mb size2 ref net determin actual mb size from featur
ref net get mb layout ptr of network copi from get mb layout ptr of network todo thi untest miss seemingli inconsist

actual mb size2 actual mb size
logic error train one epoch ref net differ size main

ref net forward prop ref node
matrix elem type scale and add elem type adapt reg weight
dynam pointer cast comput node elem type ref node valu
elem type adapt reg weight
dynam pointer cast comput node elem type label node valu


forward back propag

option minibatch minibatch
thi enabl use full minibatch
size actual num subminibatch num subminibatch need smb dispatch get minibatch into cach train set data reader input matric num subminibatch need
size ismb ismb actual num subminibatch ismb

actual num subminibatch

smb dispatch get sub minibatch to net ismb minibatch full size
comput network bump eval time stamp featur node
comput network bump eval time stamp label node



forward prop evalu node


comput node first sinc gradient comput forward valu
chang need recomput gradient valu share matrix
forward prop evalu node bulk evalu reus comput gradient


forward prop train criterion


forward prop criterion node


backprop


learn rate per sampl min learn rate comput gradient learn rate larg enough
backprop criterion node

hous keep minibatch
actual num subminibatch
smb dispatch done with current sub minibatch ismb page state
minibatch
actual num subminibatch
smb dispatch done with current minibatch
actual mb size

progress statist count frame gap
bugbug onc multipl layout must done criterion basi
size num sampl with label wa data read get num sampl with label of network actual mb size

actual mb size across node parallel train
size aggreg num sampl actual mb size
size aggreg num sampl with label num sampl with label

use gradient aggreg

accumul criterion valu object
actual mb size

wa data read
criteria valu accumul anoth matrix avoid pull valu
local epoch criterion criterion node num sampl with label
size evalu node size
local epoch eval error evalu node num sampl with label




distribut gradient aggreg
learn param gradient size

learn param gradient reserv learnabl node size
node iter learnabl node node iter learnabl node node iter

comput node ptr node dynam pointer cast comput node elem type node iter
node is paramet updat requir

matrix elem type curr param gradient node gradient todo share ptr

sometim parallel train current node sampl process
gradient matrix size let size
curr param gradient get num col

matrix elem type curr param valu node valu
curr param gradient resiz curr param valu get num row curr param valu get num col


learn param gradient push back curr param gradient




prepar header
grad header num eval node evalu node size
grad header num sampl actual mb size
hoist criterion space reduc
local epoch criterion assign criterion node num sampl with label
size evalu node size
local epoch eval error assign evalu node num sampl with label
grad header num sampl with label local epoch criterion get criterion second
grad header criterion local epoch criterion get criterion first
size evalu node size
grad header eval error local epoch eval error get criterion

sampl process dist grad agg aggreg gradient learn param gradient grad header epoch number
no more sampl to process sampl process

aggreg num sampl grad header num sampl
aggreg num sampl with label grad header num sampl with label
epoch criterion epoch criterion grad header criterion grad header num sampl with label
size epoch eval error size
epoch eval error grad header eval error


updat model paramet
aggreg num sampl learn rate per sampl min learn rate

smooth gradient iter smooth gradient
node iter learnabl node node iter learnabl node node iter smooth gradient iter

comput node base ptr node node iter
node is paramet updat requir

matrix elem type smooth gradient smooth gradient iter
ifdef debug
smooth gradient ha nan train one epoch updat weight
logic error oper na ns smooth gradient node node name node oper name

bugbug issu access mb layout longer done multipl input layout
updat weight node smooth gradient learn rate per sampl
get momentum per sampl epoch number bugbug workaround get mb layout ptr of network get num parallel sequenc aggreg num sampl
l2 reg weight l1 reg weight
need ave multipli use nesterov momentum
ifdef debug
dynam pointer cast comput node elem type node valu ha nan train one epoch updat weight
logic error oper na ns function valu paramet updat node node name node oper name





aggreg model averag
use model averag

n sampl sinc last model sync n frame between ma sync

sync p masgd helper on arriv at sync point learnabl node smooth gradient n sampl sinc last model sync
sync

n sampl sinc last model sync


prepar condit
use distribut mb read

no more sampl to process wa data read



timer stop
num m bs run

total time in m bs timer elaps second
train sampl sinc last log aggreg num sampl with label insid epoch criterion last log


thi show criterion sinc last log
num m bs run first m bs to show result num m bs to show result num m bs run num m bs to show result

epoch valu updat
use gradient aggreg

aggreg directli valu minibatch accumul
timer restart
epoch criterion local epoch criterion get criterion
size epoch eval error size
epoch eval error local epoch eval error get criterion
timer stop

last trail comput
total time in m bs timer elaps second


epoch criterion aggreg entir epoch show differ last time log
bugbug work use gradient aggreg epoch criterion
train loss sinc last log train sampl sinc last log epoch criterion epoch criterion last log train sampl sinc last log
epoch criterion epoch criterion sinc last log epoch criterion epoch criterion last log
train loss sinc last log epoch criterion sinc last log averag todo check whether train sampl sinc last log match differ
train sampl sinc last log epoch criterion sinc last log second

wa progress print

train criterion
epoch number epoch size

progress trace comput cluster manag
mb prog
mb prog num precis
max comput epoch size

num mb per epoch max comput epoch size tune mb size
mb prog num m bs run num mb per epoch
mb prog num precis ceil log10 num mb per epoch num m bs to show result
mb prog num precis mb prog num precis

wa progress print progress trace trace progress percentag epoch number mb prog

progress trace regular
format string epoch minibatch mb prog num precis sampl seen train loss per sampl
gener pad float or exp format train loss sinc last log
sgd trace stderr format string
prefix msg epoch number max epoch num m bs run num m bs to show result
num m bs run mb prog train sampl sinc last log train loss sinc last log

configur abl percentag instead

wa progress print progress trace trace progress percentag epoch number

format string epoch minibatch sampl seen train loss per sampl
gener pad float or exp format train loss sinc last log
sgd trace stderr format string
prefix msg epoch number max epoch num m bs run num m bs to show result
num m bs run train sampl sinc last log train loss sinc last log
max comput epoch size num m bs run train sampl sinc last log num m bs to show result


size epoch eval error size

eval error epoch eval error epoch eval error last log averag train sampl sinc last log
format string eval err per sampl gener pad float or exp format eval error
sgd trace stderr format string eval error


format string total time gener pad float or exp format total time in m bs sampl per second
sgd trace stderr format string total time in m bs train sampl sinc last log total time in m bs

progress trace comput cluster manag
wa progress print
progress trace trace train loss train loss sinc last log

trace level
fflush stderr

epoch criterion is nan
runtim error train criterion

reset statist differenti log
epoch criterion last log epoch criterion
epoch eval error last log epoch eval error

total time in m bs


timer restart
total epoch sampl aggreg num sampl with label
use model averag
total sampl seen aggreg num sampl with label

call data end
thi signal someth reader
data end reader specif process sentenc end reach
train set data reader data end

attempt comput error signal whole utter
neural network featur current workaround
forward sequenc train allow
process utter time onli use kaldi2 reader
todo move forward support reader
attempt utter deriv featur train set data reader featur node input matric

profil next sampl


main minibatch loop

use model averag

p masgd helper on epoch end learnabl node smooth gradient n sampl sinc last model sync
n sampl sinc last model sync


hoist accumul criterion valu side variabl
use gradient aggreg accumul variabl directli
use gradient aggreg

epoch criterion local epoch criterion get criterion
size epoch eval error size
epoch eval error local epoch eval error get criterion


model averag aggreg criteria
use model averag num node in use

total epoch sampl process worker
size total epoch sampl of all worker total epoch sampl
all reduc total epoch sampl of all worker
total sampl seen total epoch sampl of all worker

criteria worker
use gradient aggreg otherwis would local epoch criterion
epoch criterion local epoch criterion get criterion
size epoch eval error size
epoch eval error local epoch eval error get criterion

reduc epoch criterion epoch eval error node
all reduc epoch criterion first
all reduc epoch criterion second
transfer vector must pull apart object exchang separ
todo merg train criteria
vector numer epoch eval error size
vector size denom epoch eval error size
size epoch eval error size

numer epoch eval error first
denom epoch eval error second

all reduc numer
all reduc denom
size epoch eval error size
epoch eval error epoch criterion numer denom

modifi valu
total epoch sampl total epoch sampl of all worker

total epoch sampl



subroutin helper follow


momentum per mb momentum per sampl size minibatch size

momentum per sampl minibatch size


train eval criterion node refer unfortun depend network
hold insid nice also thread thi away sequenc sequenc model properli
todo merg
comput network ptr vector comput node base ptr tmp criterion node set
todo test remov comment

elem type
vector comput node base ptr elem type get train criterion node comput network ptr

train criterion node name

tmp criterion node set criterion node from train criterion node name
tmp criterion node set


final criterion node


elem type
vector comput node base ptr elem type get eval criterion node comput network ptr

eval criterion node name

tmp criterion node set criterion node from eval criterion node name
tmp criterion node set


evalu node


execut pre comput node
return precomput execut
elem type
elem type pre comput comput network ptr
i data reader train set data reader
vector comput node base ptr featur node
vector comput node base ptr label node
stream minibatch input input matric

comput node base ptr node get node requir pre comput test ha comput flag

node size

logprintf stderr pre comput node found skip pre comput step



fprintf stderr
logprintf stderr precomput pre comput node found node size
node node

logprintf stderr node node name node oper name


comput
scope network oper mode mode guard network oper mode pre comput

train set data reader start minibatch loop mb size request data size
train set data reader start minibatch loop mb size epoch size base epoch
2015 support larg dataset usual partit whole dataset sever epoch
need precomput
use all data for pre comput node
train set data reader start minibatch loop mb size
epoch note epoch often enough featur mean stddev estim prior
train set data reader start minibatch loop mb size epoch size
start evalu minibatch loop node

initi
node node
dynam pointer cast i pre comput node node mark comput accumul

size num iter befor print progress
size num iter sinc last print of progress
size actual mb size dummi
data reader helper get minibatch into network elem type train set data reader nullptr input matric actual mb size dummi

todo move get minibatch into network pass around necessari
comput network bump eval time stamp featur node
comput network bump eval time stamp label node

forward prop node

num iter sinc last print of progress progress trace trace fake progress num iter befor print progress num iter sinc last print of progress


final
node node
dynam pointer cast i pre comput node node mark comput done accumul

fprintf stderr
logprintf stderr precomput complet




reason initi learn rate base initi mbsize
elem type
elem type search for best learn rate comput network ptr
comput network ptr ref net
comput node base ptr ref node epoch number
cur learn rate
i data reader train set data reader
vector comput node base ptr featur node
vector comput node base ptr label node
vector comput node base ptr criterion node
vector comput node base ptr evalu node
stream minibatch input input matric
comput node base ptr learnabl node
matrix elem type smooth gradient
learn rate initi
largest prev learn rate per sampl

best learn rate per sampl cur learn rate

size num frame to use in search num mini batch4 lr search epoch number mb size epoch number
epoch size request data size

num frame to use in search exceed total frame epoch
num frame to use in search num frame to use in search epoch size


min learn rate min learn rate
learn rate per sampl 618f sqrt mb size epoch number todo comment magic constant

learn rate initi largest prev learn rate per sampl

largest prev learn rate per sampl sampl first 618f compens second safeti
learn rate per sampl largest prev learn rate per sampl 618f 618f


base model epoch epoch number
reread persist paramet elem type get model name for epoch base model epoch

learn rate learn rate per sampl
size dummi minibatch size use
size dummi total train sampl seen use
prev criterion numer limit infin
load check point info base model epoch
dummi total train sampl seen
learn rate
smooth gradient
prev criterion
dummi minibatch size

model chang
epoch criterion base criterion
vector epoch criterion epoch eval error evalu node size epoch criterion infin ignor entir method
train one mini epoch and reload model ref net ref node epoch number
num frame to use in search train set data reader mb size epoch number
featur node label node
criterion node evalu node
input matric learnabl node
smooth gradient
base criterion epoch eval error
base adapt learn rate search

auto learn rate search type learn rate search algorithm search befor epoch

prev criterion numer limit infin
prev criterion base criterion averag

ratio

epoch size request data size
ratio num frame to use in search epoch size

interpol prev criterion base criterion
base criterion first base criterion second ratio prev criterion ratio base criterion averag base criterion averag


epoch criterion epoch criterion epoch criterion infin


learn rate per sampl
train one mini epoch and reload model ref net ref node epoch number
num frame to use in search train set data reader
learn rate per sampl mb size epoch number featur node
label node criterion node
evalu node input matric
learnabl node smooth gradient
epoch criterion epoch eval error
adapt learn rate search
epoch criterion is nan epoch criterion averag base criterion averag learn rate per sampl min learn rate

best learn rate per sampl learn rate per sampl

grid search first num best search epoch epoch
epoch number num best search epoch

left learn rate per sampl mb size epoch number
right learn rate per sampl learn rate per sampl
epoch criterion right criterion epoch criterion
epoch criterion left criterion comput mini epoch

train one mini epoch and reload model ref net ref node epoch number
num frame to use in search train set data reader
left learn rate per sampl mb size epoch number
featur node label node
criterion node evalu node
input matric learnabl node
smooth gradient
left criterion epoch eval error
detail base adapt learn rate search

right learn rate per sampl left learn rate per sampl

right criterion averag left criterion averag

right learn rate per sampl

train one mini epoch and reload model ref net ref node
epoch number num frame to use in search
train set data reader
right learn rate per sampl mb size epoch number
featur node label node
criterion node
evalu node
input matric
learnabl node
smooth gradient
right criterion
epoch eval error
detail right adapt learn rate search



left learn rate per sampl

train one mini epoch and reload model ref net ref node
epoch number num frame to use in search
train set data reader
left learn rate per sampl mb size epoch number
featur node label node
criterion node
evalu node
input matric
learnabl node
smooth gradient
left criterion
epoch eval error
detail left adapt learn rate search



best learn rate per sampl left criterion averag right criterion averag left learn rate per sampl right learn rate per sampl


logprintf stderr best learn rate sampl epoch base criterion
epoch number best learn rate per sampl base criterion averag

best learn rate per sampl


adapt minibatch size choos largest feasibl minibatch size
thi necessari parallel oper minim model updat henc bandwidth
thi
seid droppo
paralleliz stochast gradient descent speech dn ns
proc icassp 2014
elem type
size elem type adapt minibatch size comput network ptr
comput network ptr ref net
comput node base ptr ref node
epoch number
size num frame to use in search
i data reader train set data reader
learn rate per sampl
size initi minibatch size
vector comput node base ptr featur node
vector comput node base ptr label node
vector comput node base ptr criterion node
vector comput node base ptr evalu node
stream minibatch input input matric
comput node base ptr learnabl node
matrix elem type smooth gradient
learn rate adjust factor

size min minibatch size initi minibatch size
size chosen minibatch size initi minibatch size

adjust base
basic assum epoch mbsize
control smaller safe increas lower bound size
learn rate chang so far get learn rate per sampl epoch number bugbug workaround train set data reader get num parallel sequenc get learn rate per sampl bugbug workaround train set data reader get num parallel sequenc
learn rate chang so far learn rate adjust factor

increas full factor found aggress sqrt seem robust
learn rate chang so far sqrt learn rate chang so far

inde reduc
learn rate chang so far

safe increas size note bigger
min minibatch size size min minibatch size learn rate chang so far


epoch number prev chosen minibatch size

newli start train previou size store model ignor
bugbug support 2013
logprintf stderr epoch previou minibatch size consid invalid reset
prev chosen minibatch size
prev chosen minibatch size


check need skip
prev chosen minibatch size
epoch number minibatch size tune frequenc
epoch number minibatch size tune frequenc

logprintf stderr adapt minibatch search search better minibatch size epoch skip keep minibatch size
epoch number prev chosen minibatch size
chosen minibatch size prev chosen minibatch size



prev chosen minibatch size

prev chosen minibatch size chosen minibatch size previou epoch
higher initi minibatch size minibatch size start epoch
start search prev chosen minibatch size instead initi minibatch size
logprintf stderr adapt minibatch search limit min minibatch size largest previou minibatch size
prev chosen minibatch size min minibatch size
min minibatch size min minibatch size prev chosen minibatch size


size max minibatch size minibatch size tune max

grow compar previou step
prev chosen minibatch size

prev chosen minibatch size chosen minibatch size

logprintf stderr adapt minibatch search limit max minibatch size previou minibatch size
prev chosen minibatch size
max minibatch size max minibatch size prev chosen minibatch size


chosen minibatch size search for best minibatch size ref net ref node epoch number
num frame to use in search train set data reader
learn rate per sampl featur node
label node criterion node
evalu node input matric
learnabl node smooth gradient
min minibatch size max minibatch size


chosen minibatch size


size round to multipl of64

size


size round to multipl of64 size




use small percentag train minibatch
specul train variou size pick best
elem type
size elem type search for best minibatch size comput network ptr
comput network ptr ref net
comput node base ptr ref node
epoch number
size num frame to use in search
i data reader train set data reader
learn rate per sampl
vector comput node base ptr featur node
vector comput node base ptr label node
vector comput node base ptr criterion node
vector comput node base ptr evalu node
stream minibatch input input matric
comput node base ptr learnabl node
matrix elem type smooth gradient
size min minibatch size size max minibatch size

happen automat reduc learn rate
min minibatch size max minibatch size

max minibatch size


size trial minibatch size
is first iter
epoch criterion base criterion

increas minibatch size factor sqrt step
minibatch size tune factor sqrtf

size last tri trial minibatch size
epoch criterion last tri trial epoch criterion
trial minibatch size float min minibatch size
trial minibatch size float max minibatch size
trial minibatch size float minibatch size tune factor

round mbsize someth meaning
trial minibatch size round to multipl of64 trial minibatch size float

fprintf stderr
logprintf stderr adapt minibatch search evalu trial minibatch size rang
trial minibatch size round to multipl of64 min minibatch size round to multipl of64 max minibatch size

vector epoch criterion epoch eval error evalu node size epoch criterion infin
epoch criterion epoch criterion epoch criterion infin

train minibatch observ epoch criterion increas
minibatch iter
train one mini epoch and reload model ref net ref node epoch number
num frame to use in search train set data reader
learn rate per sampl trial minibatch size featur node
label node criterion node
evalu node input matric
learnabl node smooth gradient
epoch criterion epoch eval error
is first iter base adapt minibatch search adapt minibatch search

is first iter

first iter base criterion
result train one mini epoch and reload model
base criterion epoch criterion
last tri trial minibatch size trial minibatch size
last tri trial epoch criterion base criterion
is first iter

logprintf stderr adapt minibatch search comput base criterion base criterion averag

epoch criterion is nan
epoch criterion averag base criterion averag minibatch search criterion error margin

soon criterion measur error start larger
criterion start stop
todo sensit margin base percentag
base criterion




last tri trial minibatch size trial minibatch size
last tri trial epoch criterion epoch criterion
trial minibatch size float minibatch size tune factor max minibatch size

logprintf stderr adapt minibatch search keep search epoch criterion base criterion
epoch criterion averag base criterion averag



logprintf stderr adapt minibatch search search success minibatch size epoch criterion base criterion
last tri trial minibatch size last tri trial epoch criterion averag base criterion averag

last tri trial minibatch size


train small subset epoch purpos automat size tune
elem type
elem type train one mini epoch and reload model comput network ptr
comput network ptr ref net
comput node base ptr ref node epoch number
size epoch size i data reader train set data reader
learn rate per sampl
size minibatch size
vector comput node base ptr featur node
vector comput node base ptr label node
vector comput node base ptr criterion node
vector comput node base ptr evalu node
stream minibatch input input matric
comput node base ptr learnabl node
matrix elem type smooth gradient
epoch criterion epoch criterion
vector epoch criterion epoch eval error
prefix msg

train one epoch ref net ref node epoch number epoch size
train set data reader learn rate per sampl minibatch size featur node
label node criterion node evalu node
input matric learnabl node smooth gradient
epoch criterion epoch eval error
prefix msg

logprintf stderr finish mini epoch learn rate select train loss per sampl epoch criterion averag

epoch eval error size
logprintf stderr eval err per sampl avg learn rate per sampl epoch eval error averag learn rate per sampl


logprintf stderr eval err per sampl
size epoch eval error size
logprintf stderr epoch eval error averag
logprintf stderr avg learn rate per sampl learn rate per sampl


back came
base model epoch epoch number
reread persist paramet elem type get model name for epoch base model epoch

dummi learn rate
dummi prev criterion
size dummi total train sampl seen use
size dummi minibatch size
load check point info base model epoch
dummi total train sampl seen
dummi learn rate
smooth gradient
dummi prev criterion
dummi minibatch size


attemp comput error signal whole utter
neural network featur current workaround
forward sequenc train allow
process utter time onli use kaldi2 reader
todo move forward support reader
elem type
elem type attempt utter deriv featur comput network ptr
i data reader train set data reader
vector comput node base ptr featur node
stream minibatch input input matric

train set data reader
vector vector pair wstring size utt info
p mb layout make share mb layout
todo get minibatch into network
train set data reader get minibatch copi utt info input matric p mb layout

comput network bump eval time stamp featur node

output node output node
output node
logic error output node found

bugbug issu thi longer correct multipl input layout
train set data reader copi mb layout to get mb layout ptr of network
forward prop output node evalu first output
train set data reader set net output utt info
dynam pointer cast comput node elem type output node valu
p mb layout



helper pretti print
gener pad float or exp format pad size precis valu

format
buffer

sprintf format precis
sprintf buffer format valu

strlen buffer

buffer buffer

sprintf format pad size precis
format


sprintf format pad size precis
format


elem type
elem type sgd trace file restrict stream is prepend timestamp restrict format

result
trace level

arg
start arg format
is prepend timestamp

prependt stream


result vfprintf stream format arg
arg

result


elem type
elem type init dist grad agg num eval node trace level

get parallel method parallel method data parallel sgd

dist grad agg nullptr

ifdef quantiz gradient aggreg
dist grad agg all reduc dist grad aggreg elem type num gradient bit zero threshold for1 bit use quantiz for self stripe buffer async gradient aggreg trace level sync stat trace

num gradient bit elem type

runtim error gradient quantiz unsupport cntk binari built without quantiz gradient aggreg support


dist grad agg simpl dist grad aggreg elem type buffer async gradient aggreg sync stat trace
quantiz gradient aggreg


grad header nullptr

grad header dist grad header creat num eval node




elem type
elem type init model aggreg handler trace level

get parallel method parallel method model averag sgd

ifndef blockwis model updat filter
p masgd helper

p masgd helper make share basic model averag sgd elem type trace level








updat weight s version updat weight
sinc want access method
elem type
elem type updat weight s elem type matrix elem type function valu
matrix elem type gradient valu
matrix elem type smooth gradient
learn rate per sampl
momentum per sampl
size actual mb size
l2 reg weight
l1 reg weight
need ave multipli
use nesterov momentum

simpl linear instead linear scale
momentum momentum per mb momentum per sampl actual mb size
dumpoutput
logprintf stderr learn rate per sampl momentum actual mb size
learn rate per sampl momentum actual mb size
logprintf stderr grad updat type gradient updat nois std
grad updat type gradient updat nois std
gradient valu print gradient input
smooth gradient print smooth gradient input


make actual mb size valid valu
actual mb size

clip gradient prevent outlier
clip gradient gradient valu actual mb size

gradient updat type adp type grad updat type
nois std gradient updat nois std
matrix elem type sgd updat nois deviceid type function valu get devic id
nois std

gradient structur sinc gradient spars
sgd updat nois set valu gradient valu

reset valu random
sgd updat nois set gaussian random valu elem type nois std


regular
l2 reg weight

multipli actual mb size invari minibatch size sinc learn rate sampl
matrix elem type scale and add elem type l2 reg weight actual mb size function valu gradient valu


adp type gradient updat type

smooth gradient normal grad gradient valu function valu
elem type learn rate per sampl elem type momentum use nesterov momentum

adp type gradient updat type ada grad
adp type gradient updat type rm prop gradient valu get matrix type matrix type spars
adp type gradient updat type fs ada grad gradient valu get matrix type matrix type spars

rmsprop spars implement adagrad

ave multipli smooth gradient adagrad gradient valu need ave multipli
matrix elem type scale and add elem type learn rate per sampl ave multipli gradient valu function valu

adp type gradient updat type fs ada grad

smooth gradient fs adagrad actual mb size gradient valu function valu elem type learn rate per sampl elem type momentum

adp type gradient updat type rm prop

ave multipli smooth gradient rm prop gradient valu elem type gamma
elem type elem type
elem type elem type need ave multipli
matrix elem type scale and add elem type learn rate per sampl ave multipli gradient valu function valu


nois std

matrix elem type scale and add sgd updat nois function valu


regular proxim gradient descent method
l1 reg weight

multipli actual mb size invari minibatch size sinc learn rate sampl
function valu inplac soft threshold elem type learn rate per sampl l1 reg weight actual mb size


dumpoutput
function valu print paramet updat





updat weight updat weight
elem type
elem type updat weight comput node base ptr node
matrix elem type smooth gradient
learn rate per sampl
momentum per sampl
size actual mb size
l2 reg weight l1 reg weight
need ave multipli
use nesterov momentum

dumpoutput
logprintf stderr updat node node name

node is paramet updat requir
logic error updat weight call learnabl comput node learn rate multipli

node depend learn rate per sampl learn rate per sampl node get learn rate multipli
updat weight s dynam pointer cast comput node elem type node valu dynam pointer cast comput node elem type node gradient
smooth gradient node depend learn rate per sampl momentum per sampl
actual mb size l2 reg weight l1 reg weight
need ave multipli use nesterov momentum
node bump eval time stamp


elem type
elem type clip gradient matrix elem type gradient size actual mb size

clip threshold per sampl numer limit infin

max gradient per mb clip threshold per sampl actual mb size
gradient clip with truncat
gradient inplac truncat elem type max gradient per mb


norm2 normal
gradient norm gradient frobeniu norm
gradient norm max gradient per mb

norm factor max gradient per mb gradient norm
gradient elem type norm factor





elem type
elem type save check point info size epoch size total sampl seen
learn rate per sampl
matrix elem type smooth gradient
prev criterion
size minibatch size

parallel train main node save checkpoint prevent
parallel train node collid write file
nullptr is main node

wstring check point file name get check point file name for epoch epoch
save temporari file renam check point file name
thi standard trick avoid havign corrupt checkpoint file process die write
wstring temp file name check point file name


file fstream temp file name file option file option binari file option file option write
fstream put marker file marker file marker begin section b version
fstream size current cntk checkpoint version
fstream put marker file marker file marker end section e version

fstream put marker file marker file marker begin section bckp
fstream put marker file marker file marker begin section b learn rate
fstream total sampl seen learn rate per sampl prev criterion
fstream put marker file marker file marker end section e learn rate

fstream put marker file marker file marker begin section b minibatch size
fstream minibatch size
fstream put marker file marker file marker end section e minibatch size

fstream put marker file marker file marker begin section b gradient

smooth gradient iter smooth gradient smooth gradient iter smooth gradient smooth gradient iter

matrix elem type smooth gradient smooth gradient iter
fstream smooth gradient


fstream put marker file marker file marker end section e gradient

fstream put marker file marker file marker end section eckp

ensur written
fstream flush


renam or die temp file name check point file name



elem type
elem type tri load check point info size epoch number
size total sampl seen
learn rate per sampl
matrix elem type smooth gradient
prev criterion
size minibatch size

grace handl checkpoint file miss
thi mean user want train older model model checkpoint info anymor
thi valid featur previou model mb size control
check point file name get check point file name for epoch epoch number
fexist check point file name

initi noth
total sampl seen
learn rate per sampl numer limit quiet must overwritten
prev criterion
minibatch size mb size epoch number

logprintf stderr warn checkpoint file miss learn paramet initi



load check point info epoch number total sampl seen learn rate per sampl smooth gradient prev criterion minibatch size



elem type
elem type load check point info size epoch number
size total sampl seen
learn rate per sampl
matrix elem type smooth gradient
prev criterion
size minibatch size

check point file name get check point file name for epoch epoch number
file fstream check point file name
file option file option binari file option file option read

version info
size ckp version cntk checkpoint version version info found version
fstream tri get marker file marker file marker begin section b version

fstream ckp version
fstream get marker file marker file marker end section e version


fstream get marker file marker file marker begin section bckp

fstream get marker file marker file marker begin section b learn rate
fstream total sampl seen learn rate per sampl prev criterion
fstream get marker file marker file marker end section e learn rate

fstream tri get marker file marker file marker begin section b minibatch size

fstream minibatch size
fstream get marker file marker file marker end section e minibatch size

legaci file

minibatch size mb size epoch number


fstream get marker file marker file marker begin section b gradient

smooth gradient iter smooth gradient smooth gradient iter smooth gradient smooth gradient iter

matrix elem type smooth gradient smooth gradient iter
fstream smooth gradient

fstream get marker file marker file marker end section e gradient

fstream get marker file marker file marker end section eckp


elem type
wstring elem type get check point file name for epoch epoch

get model name for epoch epoch


elem type
wstring elem type get model name for epoch epoch b last model

epoch1 base epoch
epoch1 base max epoch b last model

model path



wstring msra strfun wstrprintf model path epoch1 base




noth exist
elem type todo need
elem type determin start epoch make mode

make mode

alway start scratch



first epoch

wstring cur epoch file get model name for epoch max epoch
max epoch

wstring prev epoch file get model name for epoch

msra file fuptod cur epoch file prev epoch file

first epoch




cur epoch file prev epoch file


first epoch max epoch
logprintf stderr final model exist get model name for epoch first epoch

first epoch


defin epsilon

probe automat gradient comput random input
elem type
elem type gradient check comput network ptr
vector comput node base ptr criterion node
comput node base ptr learnabl node
npo

scope network oper mode mode guard network oper mode train

start evalu minibatch loop criterion node npo

vector err msg todo these creat actual return count

gradient check
node iter learnabl node node iter learnabl node node iter

comput node ptr node dynam pointer cast comput node elem type node iter
wstrtmp 2048

size itri itri size node valu get num element itri

support spars matrix
irow fmod rand node valu get num row
icol fmod rand node valu get num col
irow irow
icol icol

fprintf stderr
logprintf stderr node node name

e org node valu irow icol
node valu transfer to devic if not there get devic id

node bump eval time stamp

forward prop criterion node npo
backprop criterion node npo

node gradient get matrix type matrix type spars




mb eval cri
criterion node scalar
todo valu use
criterion node npo get00 element
e grad err node gradient irow icol
node gradient transfer to devic if not there get devic id

e po e org epsilon
e neg e org epsilon

node valu irow icol elem type e po
node valu transfer to devic if not there get devic id

node bump eval time stamp
forward prop criterion node npo
criterion node scalar

mb eval cri po criterion node npo get00 element todo make get00 element comput node base

node valu irow icol elem type e neg
node valu transfer to devic if not there get devic id

node bump eval time stamp
forward prop criterion node npo

criterion node scalar
mb eval cri neg criterion node npo get00 element

back origin paramet valu
node valu irow icol elem type e org
node valu transfer to devic if not there get devic id

check consist
e grad num mb eval cri po mb eval cri neg e po e neg
threshold

ceil log10 fab e grad err
fab e grad num
gradient check sig digit
diff fab e grad err e grad num
wrong isnan diff diff threshold
wrong

fprintf stderr
logprintf stderr numer gradient error gradient
node node name e grad num e grad err
sprintf wstrtmp numer gradient error gradient
node node name e grad num e grad err
err msg push back wstrtmp




err msg






sgd param


adapt reg type pars adapt reg type wstring

equal ci equal ci none adapt reg type
equal ci equal ci kl reg adapt reg type

invalid argument pars adapt reg type invalid adapt regular type valid valu none


gradient updat type pars grad updat type wstring

equal ci equal ci none gradient updat type
equal ci adagrad gradient updat type ada grad
equal ci rm prop gradient updat type rm prop
equal ci fs adagrad gradient updat type fs ada grad
legaci deprec
equal ci normal equal ci simpl gradient updat type
invalid argument pars grad updat type invalid gradient updat type valid valu none adagrad rm prop fs adagrad


parallel method pars parallel method wstring

equal ci equal ci none parallel method
equal ci data parallel sgd parallel method data parallel sgd
equal ci model averag sgd parallel method model averag sgd
invalid argument pars parallel method invalid parallel method valid valu none data parallel sgd model averag sgd


learn rate search algorithm pars learn rate search type wstring

equal ci equal ci none learn rate search algorithm
equal ci search befor epoch learn rate search algorithm search befor epoch
equal ci adjust after epoch learn rate search algorithm adjust after epoch
legaci deprec
equal ci befor epoch equal ci learn rate search algorithm search befor epoch
equal ci after epoch equal ci learn rate search algorithm adjust after epoch
invalid argument auto adjust lr invalid learn rate search valid valu none search befor epoch adjust after epoch


config record type
sgd param sgd param config record type config sgd size sizeof elem type

floatargvector learn rate per mb config sgd learn rate per mb config record type array floatargvector

floatargvector learn rate per sampl config sgd learn rate per sampl config record type array floatargvector

execut engin valu config sgd execut engin synchron

auto adjust paramet
config record type config aalr config sgd auto adjust config record type record
auto learn rate search type pars learn rate search type config aalr auto adjust lr
reduc learn rate if improv less than config aalr reduc learn rate if improv less than
continu reduc config aalr continu reduc
learn rate adjust interv config aalr learn rate adjust interv size
learn rate adjust interv size learn rate adjust interv minimum interv epoch
learn rate decreas factor config aalr learn rate decreas factor
increas learn rate if improv more than config aalr increas learn rate if improv more than numer limit infin
learn rate increas factor config aalr learn rate increas factor

auto adjust auto adjust minibatch paramet
auto adjust minibatch config aalr auto adjust minibatch
minibatch size tune frequenc config aalr minibatch size tune frequenc size
minibatch size tune max config aalr minibatch size tune max size 1048576
minibatch search criterion error margin config aalr minibatch search criterion error margin size

minibatch use search
learn rate it typic
total minibatch epoch
num mini batch4 lr search config aalr num mini batch4 lr search config record type array intargvector vector

num prev learn rate config aalr num prev learn rate size
num best search epoch config aalr num best search epoch size
load best model config aalr load best model
use cv set control lr if cv exist config aalr use cv set control lr if cv exist
use eval criterion control lr config aalr use eval criterion control lr

todo mb size truncat specifi differ truncat bptt
mb size total sampl model updat happen
truncat truncat length
mb size config sgd minibatch size config record type array intargvector vector
truncat config sgd truncat
max sampl in ram config sgd max sampl in ram size size
num submini batch config sgd num subminibatch size

sampl epoch mean sampl epoch
epoch size config sgd epoch size size
sampl epoch mean sampl epoch
epoch size
epoch size request data size
max comput epoch size epoch size

total epoch
max epoch config sgd max epoch

note momentum best specifi size agnost fashion
becaus momentum sampl close handi logarithm specif
momentum as time constant specifi time constant filter momentum realli
convert typic momentum valu use size momentum as time constant
common configur momentum size momentum as time constant 2429
floatargvector momentum per mb config sgd momentum per mb config record type array floatargvector
floatargvector momentum per sampl config sgd momentum per sampl config record type array floatargvector
floatargvector momentum as time constant config sgd momentum as time constant config record type array floatargvector
use nesterov momentum config sgd use nag

max temp mem size in sampl for cnn config sgd max temp mem size in sampl for cnn size

trace level config sgd trace level
num m bs to show result config sgd num m bs to show result size
first m bs to show result config sgd first m bs to show result size
num m bs to cuda profil config sgd num m bs to cuda profil size

gradient clip with truncat config sgd gradient clip with truncat
clip threshold per sampl config sgd clip threshold per sampl numer limit infin

sequenc train paramet
h smooth weight config sgd h smooth weight
frame drop thresh config sgd frame drop thresh
do refer align config sgd do refer align
seq gammar calc use mbr config sgd seq gammar use mbr
seq gammar calc amf config sgd seq gammar amf
seq gammar calc lmf config sgd seq gammar lmf
seq gammar calcb mmi factor config sgd seq gammar bmmi factor
seq gammar calc wp config sgd seq gammar word pen

dropout rate config sgd dropout rate config record type array doubleargvector vector
batch normal time constant config sgd batch normal time constant config record type array doubleargvector vector
batch normal blend time constant config sgd batch normal blend time constant config record type array doubleargvector vector

gradient updat type grad updat type pars grad updat type config sgd grad updat type
gaussian nois injec std config sgd gaussian nois inject std
grad type m type grad updat type
grad type m gaussian nois inject std gaussian nois injec std

extract rm prop paramet config exist default reason valu
config sgd
config sgd
config sgd
config sgd
gamma config sgd gamma

need ave multipli config sgd norm with ave multipli
l2 reg weight config sgd l2 reg weight
l1 reg weight config sgd l1 reg weight

backward support futur setup grad updat type ada grad instead
use adagrad
use adagrad config sgd use adagrad
use adagrad

grad updat type gradient updat type ada grad
grad type m type grad updat type


adapt reg type pars adapt reg type config sgd adapt reg type
adapt reg weight config sgd adapt reg weight

gradient check setup
do gradient check config sgd gradientcheck
gradient check sig digit config sgd sig fig todo

do gradient check sizeof elem type

logic error gradient check need precis


use all data for pre comput node config sgd use all data for pre comput node

consist check
size mb size size

epoch size request data size epoch size mb size

invalid argument epoch size must larger mbsize



auto learn rate search type learn rate search algorithm
learn rate per sampl size learn rate per mb size

invalid argument auto learn rate search type must specifi learn rate per sampl learn rate per mb paramet


learn rate per sampl size learn rate per mb size

invalid argument specifi learn rate per sampl learn rate per mb pleas comment


learn rate per sampl size

learn rate param learn rate per sampl
learn rate specifi for mb size intargvector

learn rate per mb size actual mean specifi minibatch size

learn rate param learn rate per mb
learn rate specifi for mb size mb size


momentum per sampl size momentum per mb size momentum as time constant size

invalid argument specifi momentum per sampl momentum per mb momentum as time constant pleas specifi


momentum per sampl size note noon would ever momentum as time constant instead

momentum param momentum per sampl
momentum specifi for mb size intargvector

momentum as time constant size

vector momentum per sampl vec
momentum as time constant size

mom tc momentum as time constant
mom ps mom tc mom tc
momentum per sampl vec push back mom ps

momentum param momentum per sampl vec
momentum specifi for mb size intargvector

momentum per mb size

momentum param momentum per mb
momentum specifi for mb size mb size

momentum per mb

momentum param floatargvector
momentum specifi for mb size mb size

use nesterov momentum use nesterov momentum

momentum param size

momentum param momentum param

invalid argument momentum paramet must



learn rate decreas factor learn rate increas factor

invalid argument learn rate increas factor must learn rate decreas factor must


size dropout rate size

dropout rate dropout rate

invalid argument dropout rate must



adapt reg weight adapt reg weight
invalid argument adapt reg weight must

min learn rate

need adapt regular

bugbug pass init
do unit test config sgd unit test

parallel train
parallel method parallel method
num gradient bit
zero threshold for1 bit
buffer async gradient aggreg
enabl distribut mb read
parallel start epoch num
n frame between ma sync 40000 frame

config sgd exist parallel train

config record type config parallel train config sgd parallel train config record type record
parallel method pars parallel method config parallel train parallel method none
parallel start epoch num config parallel train parallel start epoch epoch number intern base
enabl distribut mb read config parallel train distribut mb read
sync stat trace config parallel train sync perf stat

config parallel train exist data parallel sgd

config record type config data parallel sgd config parallel train data parallel sgd config record type record
size default gradient bit sizeof elem type
num gradient bit config data parallel sgd gradient bit default gradient bit
zero threshold for1 bit config data parallel sgd use zero threshold for1 bit quantiz
buffer async gradient aggreg config data parallel sgd use buffer async gradient aggreg
num gradient bit num gradient bit sizeof elem type

invalid argument gradient bit must rang precis rang precis



config parallel train exist model averag sgd

config record type config masgd config parallel train model averag sgd config record type record
n frame between ma sync config masgd sync frequenc in frame size 40000




size get size of precis scriptabl object i config record ptr configp

wstring precis configp precis
precis

precis


runtim error invalid valu precis must precis


sgd param sgd param scriptabl object i config record ptr configp
sgd param configp get size of precis configp



scriptabl object system
scriptabl object configur runtim type regist add float doubl regist sgd optim sgd optim


stdafx sourc file includ standard includ
cntk eval test compil header
stdafx contain compil inform

stdafx

todo refer addit header need stdafx
file
cntk eval test defin entri point consol applic


stdafx
eval
data reader
config
microsoft cntk

process command
elem type
do command config paramet config root

config array command config root command train
config paramet config config root command
config paramet reader config config reader
reader config insert trace level config trace level

config array minibatch size config minibatch size
intargvector mb size arr minibatch size
size mb size 20000 mb size arr
size epoch size config epoch size
epoch size

epoch size request data size


config paramet config featur reader config featur
size dim featur config featur
config paramet config label reader config label
size dim label config label label dim
config paramet config sgd config
wstring model path config sgd model path

stream minibatch input input matric
stream minibatch input output matric
wstring input name featur
wstring output name
devic id
matrix make share matrix elem type dim featur mb size devic id
mb layout ptr p mb layout make share mb layout
input matric add input input name matrix p mb layout tensor shape dim featur
output matric add input output name make share matrix elem type dim label mb size devic id p mb layout tensor shape dim label

wstring vector elem type input
wstring vector elem type output
vector elem type input input name vector elem type dim featur mb size
output output name vector elem type dim label mb size

eval elem type config

data reader make share data reader reader config
str path model path model path
creat network str path
data reader start minibatch loop mb size epoch size
start evalu minibatch loop output name
data reader get minibatch input matric


size data size size elem type
matrix
size mat size matrix get num element elem type
memcpi data size mat size
evalu input output



wmain argc wchar argv



config paramet config
config paramet pars command line argc argv config

command param want
wstring logpath config stderr
config array command config command train

dump config info
fprintf stderr command
command size

fprintf stderr command


command
config precis
accept precis backward compat
config exist
config
fprintf stderr nprecis

do command config

do command config

runtim error invalid precis specifi

except

fprintf stderr except occur
microsoft cntk debug util print call stack
ifdef debug
debug break





fprintf stderr unknown error occur
microsoft cntk debug util print call stack
ifdef debug
debug break






copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common reader test helper

microsoft cntk

microsoft cntk test

fixtur specif
an4 reader fixtur reader fixtur

an4 reader fixtur
reader fixtur
cntk extern testdata sourc directori speech an4 corpu
thi test use extern part cntk repositori environ variabl cntk extern testdata sourc directori must point extern test locat refer set cntk window document




speech reader fixtur test
some differ thu differ fixtur
boost fixtur test suit reader test suit an4 reader fixtur

boost auto test case htkmlf reader simpl data loop1

helper run reader test
test data path config htkmlf reader simpl data loop1 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop1 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop2

helper run reader test
test data path config htkmlf reader simpl data loop2 config cntk
test data path control htkmlf reader simpl data loop2 control
test data path control htkmlf reader simpl data loop2 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop3

helper run reader test
test data path config htkmlf reader simpl data loop3 config cntk
test data path control htkmlf reader simpl data loop3 control
test data path control htkmlf reader simpl data loop3 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop4

helper run reader test
test data path config htkmlf reader simpl data loop4 config cntk
test data path control htkmlf reader simpl data loop4 control
test data path control htkmlf reader simpl data loop4 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop5

helper run reader test
test data path config htkmlf reader simpl data loop5 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop5 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop6

helper run reader test
test data path config htkmlf reader simpl data loop6 config cntk
test data path control htkmlf reader simpl data loop6 control
test data path control htkmlf reader simpl data loop6 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop7

helper run reader test with except invalid argument
test data path config htkmlf reader simpl data loop7 config cntk
simpl test
reader



boost auto test case htkmlf reader simpl data loop8

helper run reader test
test data path config htkmlf reader simpl data loop8 config cntk
test data path control htkmlf reader simpl data loop4 control
test data path control htkmlf reader simpl data loop8 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop9

helper run reader test
test data path config htkmlf reader simpl data loop9 config cntk
test data path control htkmlf reader simpl data loop9 control
test data path control htkmlf reader simpl data loop9 output
simpl test
reader
2000








boost auto test case htkmlf reader simpl data loop10

helper run reader test
test data path config htkmlf reader simpl data loop10 config cntk
test data path control htkmlf reader simpl data loop10 control
test data path control htkmlf reader simpl data loop10 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop11

helper run reader test
test data path config htkmlf reader simpl data loop11 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop11 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop12

helper run reader test
test data path config htkmlf reader simpl data loop12 config cntk
test data path control htkmlf reader simpl data loop2 control
test data path control htkmlf reader simpl data loop12 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop13

helper run reader test
test data path config htkmlf reader simpl data loop13 config cntk
test data path control htkmlf reader simpl data loop3 control
test data path control htkmlf reader simpl data loop13 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop14

helper run reader test
test data path config htkmlf reader simpl data loop14 config cntk
test data path control htkmlf reader simpl data loop4 control
test data path control htkmlf reader simpl data loop14 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop16

helper run reader test
test data path config htkmlf reader simpl data loop16 config cntk
test data path control htkmlf reader simpl data loop6 control
test data path control htkmlf reader simpl data loop16 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop19

helper run reader test
test data path config htkmlf reader simpl data loop19 config cntk
test data path control htkmlf reader simpl data loop9 control
test data path control htkmlf reader simpl data loop19 output
simpl test
reader
2000








boost auto test case htkmlf reader simpl data loop20

helper run reader test
test data path config htkmlf reader simpl data loop20 config cntk
test data path control htkmlf reader simpl data loop10 control
test data path control htkmlf reader simpl data loop20 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop21

helper run reader test
test data path config htkmlf reader simpl data loop21 config cntk
test data path control htkmlf reader simpl data loop21 control
test data path control htkmlf reader simpl data loop21 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop21

helper run reader test
test data path config htkmlf reader simpl data loop21 config cntk
test data path control htkmlf reader simpl data loop21 control
test data path control htkmlf reader simpl data loop21 output
simpl test
reader









boost auto test case htkmlf reader simpl data loop22

helper run reader test
test data path config htkmlf reader simpl data loop22 config cntk
test data path control htkmlf reader simpl data loop22 control
test data path control htkmlf reader simpl data loop22 output
simpl test
reader
5000








boost auto test case experiment htkmlf reader simpl data loop1

helper run reader test
test data path config experiment htkmlf reader simpl data loop1 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop1 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop5

helper run reader test
test data path config experiment htkmlf reader simpl data loop5 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop5 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop11

helper run reader test
test data path config experiment htkmlf reader simpl data loop11 config cntk
test data path control htkmlf reader simpl data loop1 control
test data path control htkmlf reader simpl data loop11 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop21

helper run reader test
test data path config experiment htkmlf reader simpl data loop21 config cntk
test data path control htkmlf reader simpl data loop21 control
test data path control htkmlf reader simpl data loop21 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop21

helper run reader test
test data path config experiment htkmlf reader simpl data loop21 config cntk
test data path control htkmlf reader simpl data loop21 control
test data path control htkmlf reader simpl data loop21 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop4

helper run reader test
test data path config experiment htkmlf reader simpl data loop4 config cntk
test data path control experiment htkmlf reader simpl data loop4 control
test data path control experiment htkmlf reader simpl data loop4 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop8

helper run reader test
test data path config experiment htkmlf reader simpl data loop8 config cntk
test data path control htkmlf reader simpl data loop4 control
test data path control htkmlf reader simpl data loop8 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop14

helper run reader test
test data path config experiment htkmlf reader simpl data loop14 config cntk
test data path control htkmlf reader simpl data loop4 control
test data path control htkmlf reader simpl data loop14 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop9

helper run reader test
test data path config experiment htkmlf reader simpl data loop9 config cntk
test data path control experiment htkmlf reader simpl data loop9 control
test data path control experiment htkmlf reader simpl data loop9 output
simpl test
reader
2000








boost auto test case experiment htkmlf reader simpl data loop19

helper run reader test
test data path config experiment htkmlf reader simpl data loop19 config cntk
test data path control experiment htkmlf reader simpl data loop9 control
test data path control experiment htkmlf reader simpl data loop19 output
simpl test
reader
2000








boost auto test case experiment htkmlf reader simpl data loop10

helper run reader test
test data path config experiment htkmlf reader simpl data loop10 config cntk
test data path control htkmlf reader simpl data loop10 control
test data path control htkmlf reader simpl data loop10 output
simpl test
reader









boost auto test case experiment htkmlf reader simpl data loop20

helper run reader test
test data path config experiment htkmlf reader simpl data loop20 config cntk
test data path control htkmlf reader simpl data loop10 control
test data path control htkmlf reader simpl data loop20 output
simpl test
reader










boost auto test suit





copyright microsoft right reserv
licens licens licens file project root full licens inform


stdafx

no random
data deseri
block random
numer
random

microsoft cntk

microsoft cntk test

boost auto test suit reader lib test

mock chunk chunk


size chunk begin
size chunk end
vector
tensor shape ptr sampl layout


mock chunk size chunk begin size chunk end vector
chunk begin chunk begin
chunk end chunk end

sampl layout make share tensor shape

chunk begin chunk end
chunk end size


get sequenc size sequenc id vector sequenc data ptr result

chunk begin sequenc id
sequenc id chunk end

make share dens sequenc data
sequenc id
number of sampl
sampl layout sampl layout
result push back


mock chunk


mock deseri i data deseri



size num chunk
size num sequenc per chunk
vector sequenc descript descript
vector
vector stream descript ptr stream
tensor shape ptr sampl layout
vector chunk descript ptr chunk descript


mock deseri size num chunk size num sequenc per chunk vector
num chunk num chunk
num sequenc per chunk num sequenc per chunk
sampl layout make share tensor shape


size num sequenc num chunk num sequenc per chunk
descript reserv num sequenc
size num sequenc

size num sequenc

descript push back sequenc descript


num sequenc per chunk





size num chunk

chunk descript push back make share chunk descript chunk descript

num sequenc per chunk
num sequenc per chunk



stream push back make share stream descript stream descript
input

storag type dens
element type tfloat
sampl layout





vector stream descript ptr get stream descript

stream


chunk ptr get chunk size chunk id

chunk id num chunk
size chunk begin chunk id num sequenc per chunk
size chunk end chunk begin num sequenc per chunk
share chunk chunk make share mock chunk chunk begin chunk end
chunk


get sequenc descript by key key type sequenc descript

logic error implement


chunk descript get chunk descript

chunk descript


get sequenc for chunk size chunk id vector sequenc descript descript

size chunk id num sequenc per chunk chunk id num sequenc per chunk

descript push back sequenc descript


chunk id






mock deseri mock deseri
mock deseri mock deseri


boost auto test case block random instanti

vector
mock deseri make share mock deseri

random make share block random size mock deseri block random decim mode chunk


boost auto test case block random one epoch

vector
iota
mock deseri make share mock deseri

random make share block random size mock deseri block random decim mode chunk

epoch configur epoch configur
epoch configur number of worker
epoch configur worker rank
epoch configur minibatch size in sampl
epoch configur total epoch size in sampl size
epoch configur epoch index
random start epoch epoch configur

vector expect
boost check equal size expect size
vector actual
size

sequenc sequenc random get next sequenc
boost check equal sequenc size size
size

reinterpret cast dens sequenc data sequenc
boost check equal number of sampl
actual push back

boost check equal sequenc end of epoch size

boost check equal collect expect expect
actual actual


boost auto test case block random one epoch with chunks1

vector
iota
mock deseri make share mock deseri

random make share block random mock deseri block random decim mode chunk

epoch configur epoch configur
epoch configur number of worker
epoch configur worker rank
epoch configur minibatch size in sampl
epoch configur total epoch size in sampl size
epoch configur epoch index
random start epoch epoch configur

vector expect
boost check equal size expect size
vector actual
size

sequenc sequenc random get next sequenc
boost check equal sequenc size size
size

reinterpret cast dens sequenc data sequenc
boost check equal number of sampl
actual push back

boost check equal sequenc end of epoch size

boost check equal collect expect expect
actual actual


boost auto test case block random one epoch with chunks2

vector
iota

mock deseri make share mock deseri

random make share block random mock deseri block random decim mode chunk

epoch configur epoch configur
epoch configur number of worker
epoch configur worker rank
epoch configur minibatch size in sampl
epoch configur total epoch size in sampl size
epoch configur epoch index
random start epoch epoch configur

vector expect



boost check equal size expect size
vector actual
size

sequenc sequenc random get next sequenc
boost check equal sequenc size size
size

reinterpret cast dens sequenc data sequenc
boost check equal number of sampl
actual push back

boost check equal sequenc end of epoch size

boost check equal collect expect expect
actual actual


boost auto test case block random chao monkey

seed
num chunk
num sequenc per chunk
window size
vector num chunk num sequenc per chunk
iota
mt19937 seed
uniform distribut distr

mock deseri make share mock deseri num chunk num sequenc per chunk

random make share block random window size mock deseri block random decim mode chunk



epoch configur epoch configur
epoch configur number of worker distr


epoch configur worker rank distr

epoch configur number of worker epoch configur worker rank

epoch configur minibatch size in sampl care
epoch configur total epoch size in sampl size distr
epoch configur epoch index distr
random start epoch epoch configur

sampl to get
epoch configur total epoch size in sampl sampl to get

sampl to get distr
sequenc sequenc random get next sequenc sampl to get




boost auto test case block random one epoch legaci random

vector
iota
mock deseri make share mock deseri

random make share block random
size
mock deseri
block random decim mode sequenc


epoch configur epoch configur
epoch configur number of worker
epoch configur worker rank
epoch configur minibatch size in sampl
epoch configur total epoch size in sampl size
epoch configur epoch index
random start epoch epoch configur

vector expect
boost check equal size expect size
vector actual
size

sequenc sequenc random get next sequenc
boost check equal sequenc size size


reinterpret cast dens sequenc data sequenc
boost check equal number of sampl
actual push back


boost check equal sequenc end of epoch size

boost check equal collect expect expect
actual actual


boost auto test case no random one epoch

vector
iota
mock deseri make share mock deseri

random make share no random mock deseri

epoch configur epoch configur
epoch configur number of worker
epoch configur worker rank
epoch configur minibatch size in sampl
epoch configur total epoch size in sampl size
epoch configur epoch index
random start epoch epoch configur

note no random epoch return

vector actual
size

sequenc sequenc random get next sequenc
boost check equal sequenc size size
size

reinterpret cast dens sequenc data sequenc
boost check equal number of sampl
actual push back


boost check equal sequenc end of epoch size


boost check equal collect
actual actual


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ

defin boost test modul reader test
stdafx

copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common reader test helper

microsoft cntk

microsoft cntk test

imag reader fixtur reader fixtur

imag reader fixtur
reader fixtur data




boost fixtur test suit reader test suit imag reader fixtur

boost auto test case imag reader simpl

helper run reader test
test data path config imag reader simpl config cntk
test data path control imag reader simpl control
test data path control imag reader simpl output
simpl test
reader









boost auto test case imag reader bad map

boost requir except
helper run reader test
test data path config imag reader bad map config cntk
test data path control imag reader simpl control
test data path control imag reader simpl output
simpl test
reader







runtim error
runtim error invalid file format must contain delimit column line file imag reader bad map


boost auto test case imag reader bad label

boost requir except
helper run reader test
test data path config imag reader bad label config cntk
test data path control imag reader simpl control
test data path control imag reader simpl output
simpl test
reader







runtim error
runtim error cannot pars label valu line second column file imag reader bad label


boost auto test case imag reader label out of rang

boost requir except
helper run reader test
test data path config imag reader label out of rang config cntk
test data path control imag reader simpl control
test data path control imag reader simpl output
simpl test
reader







runtim error
runtim error imag imag invalid expect label dimens line file imag reader label out of rang


boost auto test case imag reader zip

helper run reader test
test data path config imag reader zip config cntk
test data path control imag reader zip control
test data path control imag reader zip output
test
reader









boost auto test case imag reader zip miss file

boost requir except
helper run reader test
test data path config imag reader zip miss config cntk
test data path control imag reader zip control
test data path control imag reader zip output
zip miss test
reader







runtim error
runtim error fail file info miss librari error unknown error


boost auto test case imag reader multi view

helper run reader test
test data path config imag reader multi view config cntk
test data path control imag reader multi view control
test data path control imag reader multi view output
multi view test
reader









boost auto test suit


copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common reader test helper

microsoft cntk

microsoft cntk test

uci reader fixtur reader fixtur

uci reader fixtur
reader fixtur data




boost fixtur test suit reader test suit uci reader fixtur

boost auto test case uci fast reader simpl data loop

helper run reader test
test data path config uci fast reader simpl data loop config cntk
test data path control uci fast reader simpl data loop control
test data path control uci fast reader simpl data loop output
simpl test
reader









boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common reader test helper

microsoft cntk

microsoft cntk test

cntk text format reader fixtur reader fixtur

cntk text format reader fixtur
reader fixtur data




boost fixtur test suit reader test suit cntk text format reader fixtur

boost auto test case cntk text format reader simpl dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader simpl dens
test data path control cntk text format reader simpl dens output
simpl
reader
1000 epoch size
size
epoch







boost auto test case cntk text format reader mnist dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader mnist dens
test data path control cntk text format reader mnist dens output
mnist
reader
1000 epoch size
1000 size
epoch






singl sampl sequenc
boost auto test case cntk text format reader dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader dens
test data path control cntk text format reader dens output

reader
epoch size
size
epoch

label




sequenc sampl
boost auto test case cntk text format reader dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader dens
test data path control cntk text format reader dens output

reader
epoch size
size
epoch

label




sequenc sampl
boost auto test case cntk text format reader 1x10 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 1x10 dens
test data path control cntk text format reader 1x10 dens output
1x10
reader
epoch size
size
epoch

label




ident singl sampl sequenc
boost auto test case cntk text format reader 10x1 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 10x1 dens
test data path control cntk text format reader 10x1 dens output
10x1
reader
epoch size
size
epoch
featur input
label input




ident singl sampl sequenc
boost auto test case cntk text format reader 1x10 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 10x1 dens
test data path control cntk text format reader 10x1 dens output
10x1
reader
epoch size
size
epoch
featur input
label input




sequenc sampl random
boost auto test case cntk text format reader 10x10 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 10x10 dens
test data path control cntk text format reader 10x10 dens output
10x10
reader
epoch size
size
epoch

label




ident singl sampl sequenc
boost auto test case cntk text format reader 100x1 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 100x1 dens
test data path control cntk text format reader 100x1 dens output
100x1
reader
epoch size
size
epoch






ident singl sampl sequenc
boost auto test case cntk text format reader 100x1 dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 100x1 dens
test data path control cntk text format reader 100x1 dens output
100x1
reader
epoch size
size
epoch






sequenc sampl sampl total
boost auto test case cntk text format reader 50x20 jag sequenc dens

helper run reader test
test data path config cntk text format reader dens cntk
test data path control cntk text format reader 50x20 jag sequenc dens
test data path control cntk text format reader 50x20 jag sequenc dens output
50x20 jag sequenc
reader
epoch size
size
epoch






singl sampl sequenc
boost auto test case cntk text format reader spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader spars
test data path control cntk text format reader spars output

reader
epoch size
size
epoch

label





sequenc sampl
boost auto test case cntk text format reader spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader spars
test data path control cntk text format reader spars output

reader
epoch size
size
epoch

label





sequenc sampl
boost auto test case cntk text format reader 1x10 spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader 1x10 spars
test data path control cntk text format reader 1x10 spars output
1x10
reader
epoch size
size
epoch

label






sequenc sampl random
boost auto test case cntk text format reader 10x10 spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader 10x10 spars
test data path control cntk text format reader 10x10 spars output
10x10
reader
epoch size
size
epoch

label





sequenc sampl input stream random
boost auto test case cntk text format reader spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader spars
test data path control cntk text format reader spars output

reader
epoch size
size
epoch

label





sequenc sampl input stream
random valu sampl random
boost auto test case cntk text format reader 20x10 jag sampl spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader 20x10 jag sampl spars
test data path control cntk text format reader 20x10 jag sampl spars output
20x10 jag sampl
reader
epoch size
size
epoch

label





sequenc sampl sampl total
boost auto test case cntk text format reader 50x20 jag sequenc spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader 50x20 jag sequenc spars
test data path control cntk text format reader 50x20 jag sequenc spars output
50x20 jag sequenc
reader
epoch size
size
epoch







sequenc sampl valu sampl
4887 sampl total
boost auto test case cntk text format reader 100x100 jag spars

helper run reader test
test data path config cntk text format reader spars cntk
test data path control cntk text format reader 100x100 jag spars
test data path control cntk text format reader 100x100 jag spars output
100x100 jag
reader
4887 epoch size
4887 size
epoch








boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
math perform test compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

math perform test defin entri point consol applic

stdafx
defin nominmax
window
chrono
iostream
vector
matrix
cpu matrix
sequenc
microsoft cntk


elem type
set to init state valu for reset seg matrix elem type sentenc begin
size n stream elem type init state valu matrix elem type newprevst

matrix elem type col seg sentenc begin get devic id
col seg resiz n stream n stream
size n state row newprevst get num row

n stream sentenc begin get num row

state init state valu segment


matrix elem type col po sentenc begin get devic id
col po set valu sentenc begin
col po inplac truncat bottom minibatch pack flag sequenc start todo flag longer exist test probabl longer appli
matrix elem type scale elem type col po
col po minibatch pack flag todo flag longer exist test probabl longer appli
col seg set diagon valu col po
matrix elem type one sentenc begin get devic id
one resiz n state row n stream
one set valu elem type
state valu reset
matrix elem type multipli and weight add init state valu one col seg newprevst init state valu


elem type
rnn forward prop srp matrix elem type function valu size m nbr matrix elem type past activ matrix elem type input function valu matrix elem type col begin matrix elem type need to comput

size ncol function valu get num col
size ntime ncol m nbr
matrix elem type function valu column slice m nbr
matrix elem type deviceid type function valu get devic id

size ntime


past activ column slice m nbr

input function valu column slice m nbr

need to comput column slice get00 element

matrix elem type col seg past activ deviceid type function valu get devic id
matrix elem type col seg deviceid type function valu get devic id
col seg resiz m nbr m nbr
col seg set valu
col seg past activ set valu col begin
col seg past activ inplac truncat bottom minibatch pack flag sequenc start todo flag longer exist test probabl longer appli
col seg set diagon valu col seg past activ
matrix elem type multipli col seg
elem type init state valu elem type
set to init state valu for reset seg elem type col begin m nbr init state valu




elem type
old rnn forward prop srp matrix elem type function valu size m nbr matrix elem type past activ matrix elem type input function valu

size ncol function valu get num col
size ntime ncol m nbr
size time idx in seq time idx in seq ntime time idx in seq

size m nbr

reset

time idx in seq

reset

old rnn forward prop srp elem type time idx in seq reset elem type function valu past activ input function valu m nbr




elem type
old rnn forward prop srp size time idx in seq delay reset elem type activ matrix elem type function valu matrix elem type past activ matrix elem type input function valu size index in batch size m nbr

delay

function valu get num row input function valu get num row
function valu get num col input function valu get num col
function valu resiz input function valu get num row
input function valu get num col

i past index time idx in seq delay m nbr
i past index

function valu i past index past activ get num col
point past activ previou mninibatch

matrix elem type function valu column slice time idx in seq m nbr index in batch
matrix elem type deviceid type function valu get devic id

reset
set valu activ


i past index
past activ column slice index in batch

input function valu column slice index in batch
set valu




reset state

elem type
test rnn forward prop srp size n row size n col 1000 size m nbr deviceid type devic id

matrix elem type function valu devic id
matrix elem type col begin devic id
matrix elem type past activ devic id
matrix elem type input function valu devic id
matrix elem type need to comput devic id

function valu resiz n row n col
col begin resiz m nbr
past activ resiz n row n col
input function valu resiz n row n col
need to comput resiz n col m nbr
need to comput set valu
need to comput column slice set valu
start clock
rnn forward prop srp elem type function valu m nbr past activ input function valu col begin need to comput
clock
cout test rnn forward prop srp start clock second endl



reset state use statement also support sentenc within minibatch

elem type
test old rnn forward prop srp size n row size n col 1000 size m nbr deviceid type devic id

matrix elem type function valu devic id
matrix elem type col begin devic id
matrix elem type past activ devic id
matrix elem type input function valu devic id

function valu resiz n row n col
col begin resiz m nbr
past activ resiz n row n col
input function valu resiz n row n col
start clock
old rnn forward prop srp elem type function valu m nbr past activ input function valu
clock
cout test old rnn forward prop srp start clock second endl


elem type
random initi cpu matrix cpu matrix elem type

coord

rand rand



elem type
random initi matrix matrix elem type

coord

rand rand



elem type
multipli and weight add test

cout test cpu matrix endl
cout endl
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
start clock
cpu matrix elem type multipli and weight add
clock
cout matrix start clock second endl
cout endl

cout test matrix endl
matrix elem type size size
random initi matrix elem type
matrix elem type size size
random initi matrix elem type
matrix elem type size size
start g clock
matrix elem type multipli and weight add
end g clock
cout matrix end g start g clock second endl


elem type
add multipli and inplac sigmoid test

cout test cpu matrix endl
cout endl
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
start clock

inplac sigmoid
clock
cout matrix start clock second endl
cout endl

cout test matrix endl
matrix elem type size size
random initi matrix elem type
matrix elem type size size
random initi matrix elem type
matrix elem type size size
random initi matrix elem type
matrix elem type size size
start g clock

inplac sigmoid
end g clock
cout matrix end g start g clock second endl


elem type
column slice mult and add test deviceid type devic id

cout test matrix endl

matrix elem type size size devic id
set uniform random valu

matrix elem type size size devic id
set uniform random valu

matrix elem type size size devic id
matrix elem type size size devic id

start g clock
matrix elem type multipli and add
end g clock
cout multipli and add directli end g start g clock second endl

start g clock


matrix elem type column slice
matrix elem type column slice
matrix elem type multipli and add

end g clock
cout multipli and add with column slice end g start g clock second endl

start g clock


matrix elem type column slice
matrix elem type column slice
matrix elem type multipli and add

end g clock
cout multipli and add with column slice end g start g clock second endl

matrix elem type
start g clock


assign column slice
assign column slice
matrix elem type multipli and add

end g clock
cout multipli and add with assign column slice end g start g clock second endl

start g clock


matrix elem type column slice
matrix elem type column slice
assign sigmoid of

end g clock
cout assign sigmoid of with column slice end g start g clock second endl

start g clock


assign column slice
assign column slice
assign sigmoid of

end g clock
cout assign sigmoid of with assign column slice end g start g clock second endl


elem type
squar multipli and add10 time avg test count

cout test cpu matrix endl
cout endl


count

cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
random initi cpu matrix elem type
cpu matrix elem type
start clock
cpu matrix elem type multipli and weight add
clock
start clock










cout test matrix endl

count

matrix elem type size size
random initi matrix elem type
matrix elem type size size
random initi matrix elem type
matrix elem type size size
start g clock
matrix elem type multipli and weight add
end g clock
end g start g clock










cout base count run endl
cout averag time cpu matrix second endl
cout averag time matrix second endl
cout cpu matrix matrix ratio second endl


elem type
mand s test count dev id

elem type elem type count
count
rand rand

elem type data1 elem type 1024 4096
1024 4096
data1 rand rand

elem type data2 elem type 1024 4096
1024 4096
data2 rand rand

elem type data3 elem type 1024
1024
data3 rand rand

cout test matrix endl
matrix elem type 1024 4096 data1 dev id
matrix elem type 4096 1024 data2 dev id
matrix elem type 1024 data3 dev id
matrix elem type 1024 1024 dev id

start g clock
count

matrix elem type multipli and weight add


end g clock
val m end g start g clock count
cout matrix alpha beta val m second endl

cout test cpu matrix endl
cpu matrix elem type 1024 4096 data1
cpu matrix elem type 4096 1024 data2
cpu matrix elem type 1024 data3
cpu matrix elem type 1024 1024

start c clock
count

cpu matrix elem type multipli and weight add


end c clock
val mc end c start c clock count
cout cpu matrix alpha beta val mc second endl


data1
data2
data3


wmain

column slice mult and add test 2048 2048

test rnn forward prop srp

test old rnn forward prop srp

mand s test

cout endl matrix squar multipli and weight add10 time avg test endl
squar multipli and add10 time avg test 4096

cout endl matrix add multipli and inplac sigmoid test endl
add multipli and inplac sigmoid test
add multipli and inplac sigmoid test
add multipli and inplac sigmoid test 1100 1000 1200
add multipli and inplac sigmoid test 11000 10000 1200

cout endl matrix multipli and weight add test endl
multipli and weight add test
multipli and weight add test
multipli and weight add test 1100 1000 1200
multipli and weight add test 11000 10000 12000




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
algorithm

random
numer
sourc math matrix
sourc math cpu matrix
sourc math gpu matrix
sourc math batch normal engin
sourc math cu dnn factori
common

microsoft cntk test

vector
bn eng batch norm engin

vector tupl tensor shape size gener bn test config

vector tupl tensor shape size
review alexeyk test batch cu dnn support baselin
exp avg factor
blend factor

activ spatial
size

size

size

size 2048

push back make tupl tensor shape exp avg factor blend factor




spatial
size

size

size

size

push back make tupl tensor shape exp avg factor blend factor




perf test similar first layer re net
push back make tupl tensor shape exp avg factor blend factor
next test fail cu dnn discov report nvidia fix prod
push back make tupl tensor shape 2048 exp avg factor blend factor
push back make tupl tensor shape 2048 exp avg factor blend factor


test run mean
exp avg factor
push back make tupl tensor shape exp avg factor
push back make tupl tensor shape exp avg factor

test tensor expans cu dnn support tensor
push back make tupl tensor shape exp avg factor



boost auto test suit batch normal suit

boost auto test case batch normal forward

mt19937
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice


base devic id
devic id

gener bn test config

in out t
size batch size
spatial
exp avg
blend factor cu dnn support blend factor train
cudnn epsilon

eng cudnn bn eng creat base devic id in out t spatial imag layout kind batch norm engin kind cu dnn
eng cntk bn eng creat devic id in out t spatial imag layout kind batch norm engin kind cntk

size crow in out t get num element
size ccol batch size

crow ccol
gener
singl matrix crow ccol devic id matrix flag normal
singl matrix crow ccol base devic id matrix flag normal

size crow scale bia spatial in out t in out t get num element
resiz crow scale bia

gener
singl matrix scale crow scale bia devic id matrix flag normal
singl matrix scale b crow scale bia base devic id matrix flag normal
gener
singl matrix bia crow scale bia devic id matrix flag normal
singl matrix bia b crow scale bia base devic id matrix flag normal

singl matrix run mean buf devic id
singl matrix run mean init mat run mean buf crow scale bia
singl matrix run mean b run mean deep clone base devic id
singl matrix run inv std dev buf devic id
singl matrix run inv std dev init mat run inv std dev buf crow scale bia
singl matrix run inv std dev b run inv std dev deep clone base devic id

singl matrix save mean buf devic id
singl matrix save mean init mat save mean buf crow scale bia
singl matrix save mean b save mean deep clone base devic id
singl matrix save inv std dev buf devic id
singl matrix save inv std dev init mat save inv std dev buf crow scale bia
singl matrix save inv std dev b save inv std dev deep clone base devic id

singl matrix out buf devic id
singl matrix init mat out buf crow ccol
singl matrix out b deep clone base devic id

cuda timer time1
time1 start
eng cntk forward scale bia exp avg blend factor run mean run inv std dev save mean save inv std dev
time1 stop

cuda timer time2
time2 start
eng cudnn forward scale b bia b exp avg blend factor run mean b run inv std dev b out b save mean b save inv std dev b
time2 stop

stringstream tmsg
tmsg in out tensor in out t
spatial spatial
exp avg exp avg
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag ha nan msg nan
boost requir messag check equal out b emsg rel err ab err emsg
boost requir messag count nan out buf crow ccol msg not nan
review alexeyk case test numer stabil

boost requir messag run mean ha nan run mean run mean msg nan
boost requir messag check equal run mean run mean b emsg rel err ab err run mean emsg
boost requir messag count nan run mean buf crow scale bia run mean msg not nan

boost requir messag run inv std dev ha nan run inv std dev run inv std dev msg nan
boost requir messag check equal run inv std dev run inv std dev b emsg rel err ab err run inv std dev emsg
boost requir messag count nan run inv std dev buf crow scale bia run inv std dev msg not nan

boost requir messag save mean ha nan save mean save mean msg nan
boost requir messag check equal save mean save mean b emsg rel err ab err save mean emsg
boost requir messag count nan save mean buf crow scale bia save mean msg not nan

boost requir messag save inv std dev ha nan save inv std dev save inv std dev msg nan
boost requir messag check equal save inv std dev save inv std dev b emsg rel err ab err save inv std dev emsg
boost requir messag count nan save inv std dev buf crow scale bia save inv std dev msg not nan


ifndef debug
elaps cntk time1 elaps
elaps cudnn time2 elaps
check perform current version cu dnn significanlti slower cntk implement
optim case vector size batch size cntk implement faster cu dnn
product version
crow ccol

conserv estim
speedup
boost requir messag speedup elaps cntk elaps cudnn
cntk implement elaps cntk must faster cu dnn elaps cudnn least speedup chang tmsg








boost auto test case batch normal forward infer cpu

is cu dnn support


mt19937
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice


devic id
cudnn devic id devic id devic id
fact conv fact creat cudnn devic id conv fact engin type cu dnn imag layout kind
eng cudnn fact creat conv engin cudnn devic id imag layout kind batch norm impl cu dnn
test fact conv fact creat devic id conv fact engin type auto imag layout kind
eng cntk test fact creat conv engin devic id imag layout kind batch norm impl cntk
gener bn test config fact

move
spatial

size crow
size ccol

crow
gener
singl matrix crow ccol devic id matrix flag normal
singl matrix in exp crow ccol cudnn devic id matrix flag normal

tensor4 d ptr scale bia t spatial fact creat tensor fact creat tensor
size crow scale bia scale bia t scale bia t scale bia t
resiz crow scale bia

gener
singl matrix scale crow scale bia devic id matrix flag normal
singl matrix scale exp crow scale bia cudnn devic id matrix flag normal
gener
singl matrix bia crow scale bia devic id matrix flag normal
singl matrix bia exp crow scale bia cudnn devic id matrix flag normal

gener
singl matrix run mean crow scale bia devic id matrix flag normal
singl matrix run mean exp crow scale bia cudnn devic id matrix flag normal
gener
singl matrix run inv std dev crow scale bia devic id matrix flag normal
singl matrix run inv std dev exp crow scale bia cudnn devic id matrix flag normal

singl matrix out buf devic id
singl matrix init mat out buf crow ccol
singl matrix out exp crow ccol copi to array cudnn devic id matrix flag normal

cuda timer time1
time1 start
eng cntk normal batch infer scale bia t scale bia spatial run mean run inv std dev
time1 stop

cuda timer time2
time2 start
eng cudnn normal batch infer in exp scale bia t scale exp bia exp spatial run mean exp run inv std dev exp out exp
time2 stop

stringstream tmsg
tmsg tensor spatial spatial
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag ha nan msg nan
boost requir messag check equal out exp emsg rel err ab err emsg
boost requir messag count nan out buf crow ccol msg not nan



boost auto test case batch normal backward

mt19937
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice


base devic id
devic id

gener bn test config

in out t
size batch size
spatial

eng cudnn bn eng creat base devic id in out t spatial imag layout kind batch norm engin kind cu dnn
eng cntk bn eng creat devic id in out t spatial imag layout kind batch norm engin kind cntk

size crow in out t get num element
size ccol batch size

crow ccol
gener
singl matrix crow ccol devic id matrix flag normal
singl matrix crow ccol base devic id matrix flag normal

gener
singl matrix crow ccol devic id matrix flag normal
singl matrix crow ccol base devic id matrix flag normal

size crow scale bia spatial in out t in out t get num element
resiz crow scale bia

gener
singl matrix scale crow scale bia devic id matrix flag normal
singl matrix scale b crow scale bia base devic id matrix flag normal

gener
singl matrix save mean crow scale bia devic id matrix flag normal
singl matrix save mean b crow scale bia base devic id matrix flag normal

gener
singl matrix save inv std dev crow scale bia devic id matrix flag normal
singl matrix save inv std dev b crow scale bia base devic id matrix flag normal

singl matrix d scale buf devic id
singl matrix d scale init mat d scale buf crow scale bia
singl matrix d scale b d scale deep clone base devic id
singl matrix d bia buf devic id
singl matrix d bia init mat d bia buf crow scale bia
singl matrix d bia b d bia deep clone base devic id

singl matrix dx buf devic id
singl matrix init mat dx buf crow ccol
singl matrix deep clone base devic id

cuda timer time1
time1 start
eng cntk backward scale save mean save inv std dev d scale d bia
time1 stop

cuda timer time2
time2 start
eng cudnn backward scale b save mean b save inv std dev b d scale b d bia b
time2 stop

stringstream tmsg
tmsg in out tensor in out t
spatial spatial
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag ha nan msg nan
boost requir messag check equal emsg rel err ab err emsg
boost requir messag count nan dx buf crow ccol msg not nan
review alexeyk case test numer stabil

boost requir messag d scale ha nan d scale d scale msg nan
boost requir messag check equal d scale d scale b emsg rel err ab err d scale emsg
boost requir messag count nan d scale buf crow scale bia d scale msg not nan

boost requir messag d bia ha nan d bia d bia msg nan
boost requir messag check equal d bia d bia b emsg rel err ab err d bia emsg
boost requir messag count nan d bia buf crow scale bia d bia msg not nan


ifndef debug
elaps cntk time1 elaps
elaps cudnn time2 elaps
check perform current version cu dnn significanlti slower cntk implement
optim case vector size batch size cntk implement faster cu dnn
product version
crow ccol

conserv estim
speedup
boost requir messag speedup elaps cntk elaps cudnn
cntk implement elaps cntk must faster cu dnn elaps cudnn least speedup chang tmsg







boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ

defin boost test modul math test
stdafx

copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
math
crtdef
sourc math matrix
sourc math cpu matrix

microsoft cntk

microsoft cntk test

size valu
size valu
size valu

boost auto test suit cpu matrix suit

boost fixtur test case matrix multipli test random seed fixtur

part multipli ident matrix
singl matrix matrix a singl matrix random gaussian devic id zero increment counter
singl matrix matrix b singl matrix devic id zero
singl matrix matrix c matrix a matrix b
coord matrix a

boost check equal matrix a matrix c


singl matrix matrix0 devic id zero
matrix0
matrix0
matrix0
matrix0
matrix0
matrix0
matrix0
matrix0
matrix0

part compar octav exampl
singl matrix matrix1 devic id zero
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
matrix1
singl matrix matrix2 matrix0 matrix1
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2
boost check equal matrix2


boost fixtur test case matrix multipli and plu and minu random seed fixtur

part multipli ident matrix
singl matrix matrix a singl matrix random gaussian devic id zero increment counter
singl matrix matrix b singl matrix devic id zero
singl matrix matrix b1 singl matrix random uniform devic id zero increment counter
singl matrix matrix b2 singl matrix random uniform devic id zero increment counter
singl matrix matrix a matrix b matrix b1 matrix b2
coord matrix a

boost check equal matrix a matrix b1 matrix b2


part compar cpu matrix result
todo split separ test
cpu matrix cpu matrix1 cpu matrix random uniform 1024 increment counter
cpu matrix cpu matrix2 cpu matrix random uniform 1024 increment counter
cpu matrix cpu matrix3 cpu matrix random uniform 1024 1024 increment counter
cpu matrix copi cpu matrix3 cpu matrix3
cpu matrix multipli and add cpu matrix1 cpu matrix2 cpu matrix3

singl matrix singl matrix1 1024 cpu matrix1 buffer matrix flag normal
singl matrix singl matrix2 1024 cpu matrix2 buffer matrix flag normal
singl matrix singl matrix3 1024 1024 copi cpu matrix3 buffer matrix flag normal
singl matrix multipli and add singl matrix1 singl matrix2 singl matrix3
coord singl matrix3

boost check fab singl matrix3 cpu matrix3 epsilon float5 e4


todo split separ test
singl matrix singl matrix4 singl matrix one devic id zero
singl matrix singl matrix5 singl matrix one devic id zero
singl matrix5
singl matrix scale and add singl matrix5 singl matrix4
coord singl matrix4



boost check equal singl matrix4



boost check equal singl matrix4




boost fixtur test case matrix scale and add random seed fixtur

seed rand
singl matrix singl matrix a singl matrix random uniform 1024 devic id zero 2312f seed
singl matrix singl matrix b singl matrix random uniform 1024 devic id zero 2312f seed
singl matrix singl matrix c singl matrix b deep clone
alpha 34213f
singl matrix scale and add alpha singl matrix a singl matrix c
coord singl matrix c

boost check fabsf singl matrix c alpha singl matrix a singl matrix b epsilon float e5


test
todo split separ test
singl matrix singl matrix a1 singl matrix random uniform 1024 devic id zero 2312f seed
singl matrix singl matrix b1 singl matrix random uniform 1024 devic id zero 2312f seed
singl matrix singl matrix c1 singl matrix b1 deep clone
beta 4654f
singl matrix scale and add alpha singl matrix a1 beta singl matrix c1 alpha beta
coord singl matrix c1

boost check fabsf singl matrix c1 alpha singl matrix a1 beta singl matrix b1 epsilon float e5


test columnwis
todo split separ test
singl matrix singl matrix a2 singl matrix random uniform 1024 devic id zero 2312f seed
singl matrix singl matrix b2 singl matrix random uniform 1024 devic id zero 2312f seed column
singl matrix singl matrix c2 singl matrix b2 deep clone
beta one
singl matrix scale and add alpha singl matrix a2 beta one singl matrix c2 alpha beta
coord singl matrix c2

singl matrix c2
alpha singl matrix a2 beta one singl matrix b2
boost check fabsf epsilon float e5



boost fixtur test case matrix scale and add random seed fixtur

seed rand
doubl matrix matrix a doubl matrix random uniform 1024 devic id zero 2312 seed
doubl matrix matrix b doubl matrix random uniform 1024 devic id zero 2312 seed
doubl matrix matrix c matrix b deep clone
alpha 34213f
doubl matrix scale and add alpha matrix a matrix c
coord matrix c

boost check fabsf cast matrix c alpha matrix a matrix b epsilon doubl e11


test
todo split separ test
doubl matrix matrix a1 doubl matrix random uniform 1024 devic id zero 2312f seed
doubl matrix matrix b1 doubl matrix random uniform 1024 devic id zero 2312f seed
doubl matrix matrix c1 matrix b1 deep clone
beta 4654f
doubl matrix scale and add alpha matrix a1 beta matrix c1 alpha beta
coord matrix c1

boost check fabsf cast matrix c1 alpha matrix a1 beta matrix b1 epsilon doubl e11


test columnwis
todo split separ test
doubl matrix matrix a2 doubl matrix random uniform 1024 devic id zero 2312 seed
doubl matrix matrix b2 doubl matrix random uniform 1024 devic id zero 2312 seed column
doubl matrix matrix c2 matrix b2 deep clone
beta one
doubl matrix scale and add alpha matrix a2 beta one matrix c2 alpha beta
coord matrix c2

cast matrix c2
cast alpha matrix a2 beta one matrix b2
boost check fabsf epsilon doubl e11



boost fixtur test case matrix norm random seed fixtur

singl matrix matrix0 valu valu devic id zero
matrix0
matrix0
matrix0
matrix0
matrix0
matrix0

singl matrix matrix3 devic id zero
matrix0 vector norm1 matrix3
singl matrix matrix2 valu valu devic id zero
matrix2
matrix2
matrix2
boost check matrix3 is equal to matrix2

matrix0 vector norm1 matrix3
matrix2 resiz
matrix2
matrix2
boost check matrix3 is equal to matrix2

matrix0 vector norm2 matrix3
matrix2 resiz
matrix2 1231f
matrix2 3852f
matrix2 7082f
boost check matrix3 is equal to matrix2 epsilon float5 e4

matrix0 vector norm2 matrix3
matrix2 resiz
matrix2 7417f
matrix2 7750f
boost check matrix3 is equal to matrix2 epsilon float5 e4

singl matrix matrix00 valu valu devic id zero
matrix00
matrix00
matrix00
matrix00
matrix00
matrix00
singl matrix matrix1 devic id zero
matrix00 vector max matrix1 matrix3
matrix2 resiz
matrix2
matrix2
matrix2
boost check matrix3 is equal to matrix2 epsilon float e4

matrix00 vector max matrix1 matrix3
matrix2 resiz
matrix2
matrix2
boost check matrix3 is equal to matrix2 epsilon float e4

matrix0 vector norm inf matrix3
matrix2 resiz
matrix2
matrix2
matrix2
boost check matrix3 is equal to matrix2 epsilon float e4

matrix0 vector norm inf matrix3
matrix2 resiz
matrix2
matrix2
boost check matrix3 is equal to matrix2

matrix00
matrix00
matrix00
matrix00
matrix00
matrix00
boost check equal matrix00 matrix norm inf

boost check matrix0 frobeniu norm 5394f epsilon float e4
boost check matrix0 matrix norm inf epsilon float e4
boost check equal matrix00 matrix norm1

matrix matrix a matrix 4096 devic id zero
boost check equal 4096 matrix a matrix norm0

matrix matrix b matrix devic id zero
boost check equal matrix b matrix norm0


boost fixtur test case matrix inner product of matric random seed fixtur

singl matrix vector1 valu valu devic id zero
vector1
vector1
vector1
vector1
vector1
vector1
singl matrix vector2 valu valu devic id zero
vector2
vector2
vector2
vector2
vector2
vector2
singl matrix inner product of matric vector1 vector2
boost check equal


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
algorithm

random
numer
sourc math matrix
sourc math cpu matrix
sourc math gpu matrix
sourc math convolut engin
sourc math cu dnn factori
common

microsoft cntk test

vector

conv eng convolut engin

are equal max rel error max ab error

diff
diff max ab error

largest
diff largest max rel error

are equal max rel error max ab error

diff
diff max ab error

largest
diff largest max rel error


size count nan singl matrix

size
coord

isnan




return vector engin config paramet kind devic max temp mem size in sampl
vector tupl convolut engin kind deviceid type size get test engin config

vector tupl convolut engin kind deviceid type size
refer engin engin temp memori
push back make tupl convolut engin kind refer
push back make tupl convolut engin kind refer

gemm engin implement use temp memori
push back make tupl convolut engin kind gemm
push back make tupl convolut engin kind gemm
push back make tupl convolut engin kind gemm



vector convolv geometri ptr gener conv test config

vector convolv geometri ptr
review alexeyk test case even dimens kernel there corner case cu dnn support essenti neg pad
size

size

size

size

size map count

size stride

note must share channel dimens otherwis geometri cu dnn compat cu dnn fail
push back make share convolv geometri tensor shape
tensor shape tensor shape map count tensor shape stride stride
convolv geometri bool vec
convolv geometri bool vec
tensor shape tensor shape






debug
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape

simpl convolut
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape
exampl convolut repres tensor refer engin
requir tensor engin
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape

push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape

convolut shortcut re net
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape



vector convolv geometri ptr gener pool test config

vector convolv geometri ptr
size

size

size

size

size stride

note must alway autopad otherwis might configur
neg pad cu dnn support
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape stride stride
convolv geometri bool vec
convolv geometri bool vec
tensor shape tensor shape





debug
ordinari pool
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape
overlap pad
push back make share convolv geometri tensor shape
tensor shape tensor shape tensor shape
convolv geometri bool vec convolv geometri bool vec
tensor shape tensor shape



boost auto test suit convolut suit

boost auto test case convolut forward

mt19937
uniform distribut batch size g
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice deep clone


base devic id
eng cfg get test engin config

eng kind eng cfg
devic id eng cfg
max temp mem eng cfg
gener conv test config

base eng conv eng creat base devic id imag layout kind pool kind convolut engin kind cu dnn
test eng conv eng creat devic id imag layout kind max temp mem pool kind eng kind

size batch size g

resiz input shape get num element
gener
singl matrix input shape get num element devic id matrix flag normal
singl matrix input shape get num element base devic id matrix flag normal

size map count get map count input shape get rank
resiz kernel shape get num element map count
gener
singl matrix kernel map count kernel shape get num element devic id matrix flag normal
singl matrix kernel b map count kernel shape get num element base devic id matrix flag normal

size crow out output shape get num element
singl matrix out buf devic id
singl matrix init mat out buf crow out
singl matrix out b deep clone base devic id

singl matrix workspac devic id
singl matrix workspac b base devic id

test eng forward kernel workspac
base eng forward kernel b out b workspac b

stringstream tmsg
tmsg geometri batch devic devic id max temp mem max temp mem
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag ha nan msg nan
boost requir messag check equal out b emsg rel err ab err emsg
boost requir messag count nan out buf crow out msg not nan




boost auto test case convolut backward data

mt19937
uniform distribut batch size g
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice deep clone


base devic id
eng cfg get test engin config

eng kind eng cfg
devic id eng cfg
max temp mem eng cfg
gener conv test config

base eng conv eng creat base devic id imag layout kind pool kind convolut engin kind cu dnn
test eng conv eng creat devic id imag layout kind max temp mem pool kind eng kind

size batch size g

resiz output shape get num element
gener
singl matrix src grad output shape get num element devic id matrix flag normal
singl matrix src grad b output shape get num element base devic id matrix flag normal

size map count get map count input shape get rank
resiz kernel shape get num element map count
gener
singl matrix kernel map count kernel shape get num element devic id matrix flag normal
singl matrix kernel b map count kernel shape get num element base devic id matrix flag normal

size crow grad input shape get num element
singl matrix grad buf devic id
singl matrix grad init mat grad buf crow grad
singl matrix grad b grad deep clone base devic id

singl matrix workspac devic id
singl matrix workspac b base devic id

test eng backward data src grad kernel grad workspac
base eng backward data src grad b kernel b grad b workspac b

stringstream tmsg
tmsg geometri batch devic devic id
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag grad ha nan grad grad msg nan
boost requir messag check equal grad grad b emsg rel err ab err grad emsg
boost requir messag count nan grad buf crow grad grad msg not nan




boost auto test case convolut backward kernel

mt19937
uniform distribut batch size g
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice


base devic id
eng cfg get test engin config

eng kind eng cfg
devic id eng cfg
max temp mem eng cfg
gener conv test config

base eng conv eng creat base devic id imag layout kind pool kind convolut engin kind cu dnn
test eng conv eng creat devic id imag layout kind max temp mem pool kind eng kind

size batch size g

resiz input shape get num element
gener
singl matrix input shape get num element devic id matrix flag normal
singl matrix input shape get num element base devic id matrix flag normal

resiz output shape get num element
gener
singl matrix grad output shape get num element devic id matrix flag normal
singl matrix grad b output shape get num element base devic id matrix flag normal

size map count get map count input shape get rank
resiz kernel shape get num element map count
gener
singl matrix kernel buf devic id
singl matrix kernel init mat kernel buf map count kernel shape get num element
singl matrix kernel b kernel deep clone base devic id

singl matrix workspac devic id
singl matrix workspac b base devic id

test eng backward kernel grad kernel workspac
base eng backward kernel grad b kernel b workspac b

stringstream tmsg
tmsg geometri batch devic devic id
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag kernel ha nan kernel kernel msg nan
boost requir messag check equal kernel kernel b emsg rel err ab err kernel emsg
boost requir messag count nan kernel buf kernel get num element kernel msg not nan




boost auto test case pool forward

mt19937
uniform distribut batch size g
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice deep clone


base devic id
eng kind convolut engin kind refer
kind pool kind pool kind averag

devic id

gener pool test config

base eng conv eng creat base devic id imag layout kind kind convolut engin kind cu dnn
test eng conv eng creat devic id imag layout kind kind eng kind

size batch size g

resiz input shape get num element
gener
singl matrix input shape get num element devic id matrix flag normal
singl matrix input shape get num element base devic id matrix flag normal

size crow out output shape get num element
singl matrix out buf devic id
singl matrix init mat out buf crow out
singl matrix out b deep clone base devic id

test eng forward pool
base eng forward pool out b

stringstream tmsg
tmsg geometri pool kind batch devic devic id
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag ha nan msg nan
boost requir messag check equal out b emsg rel err ab err emsg
boost requir messag count nan out buf crow out msg not nan





boost auto test case pool backward

mt19937
uniform distribut batch size g
normal distribut

init mat singl matrix size size singl matrix

resiz
fill numer limit quiet
gener
set valu get devic id
center slice
column slice


base devic id
eng kind convolut engin kind refer
kind pool kind pool kind averag

devic id

gener pool test config

base eng conv eng creat base devic id imag layout kind kind convolut engin kind cu dnn
test eng conv eng creat devic id imag layout kind kind eng kind

size batch size g

size crow in input shape get num element
resiz crow in
gener
singl matrix crow in base devic id matrix flag normal
singl matrix crow in devic id matrix flag normal

size crow out output shape get num element
resiz crow out
gener
singl matrix src grad b crow out base devic id matrix flag normal
singl matrix src grad crow out devic id matrix flag normal
gener replac anyway
singl matrix out b crow out base devic id matrix flag normal
singl matrix crow out devic id matrix flag normal

test eng forward pool
base eng forward pool out b

singl matrix grad buf devic id
singl matrix grad init mat grad buf crow in
singl matrix grad b grad deep clone base devic id

test eng backward pool src grad grad
base eng backward pool out b src grad b grad b

stringstream tmsg
tmsg geometri pool kind batch devic devic id
equal tmsg
msg nan na ns tmsg
msg not nan buffer overflow underflow tmsg

rel err
ab err
emsg

boost requir messag grad ha nan grad grad msg nan
boost requir messag check equal grad grad b emsg rel err ab err grad emsg
boost requir messag count nan grad buf crow in grad msg not nan





boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx

devic id zero

epsilon float e4 0001f
epsilon float e3 001f
epsilon float e2
epsilon float e1
epsilon float5 e4 0005f
epsilon float e5 00001f
epsilon doubl e11 00000000001

copyright microsoft right reserv
licens licens licens file project root full licens inform

gpu matrix unit test

stdafx
sourc math gpu matrix

microsoft cntk

microsoft cntk test

boost auto test suit gpu matrix suit

boost fixtur test case gpu matrix constructor no flag random seed fixtur

todo consid split sever test
gpu matrix devic id zero
boost check is empti

gpu matrix devic id zero
boost check equal get num row
boost check equal get num col
boost check equal get num element


set valu devic id zero

uniqu result copi to array
boost check equal collect result result

gpu matrix m1 copi
boost check is equal to m1 copi


boost fixtur test case gpu matrix constructor flag normal random seed fixtur


gpu matrix devic id zero matrix flag normal

uniqu result copi to array
boost check equal collect result result


boost fixtur test case gpu matrix ident and zero random seed fixtur

todo consid split separ test
size
gpu matrix gpu matrix size devic id zero
uniqu result0 copi to array

size

size

boost check close result0 size



gpu matrix gpu matrix zero size size devic id zero
uniqu result1 copi to array
size

size

boost check close result1 size




boost fixtur test case gpu matrix element wise oper random seed fixtur


row
col

gpu matrix row col devic id zero
set valu
gpu matrix row col devic id zero
gpu matrix row col devic id zero

test element wise power
alpha
gpu matrix element wise power alpha
set valu alpha
boost check is equal to epsilon float e4

alpha 234f
gpu matrix element wise power alpha
set valu alpha
boost check is equal to epsilon float e4

test element wise absolut valu
set valu
assign ab of
set valu
boost check is equal to

todo element wise oper


boost fixtur test case gpu matrix inplac oper random seed fixtur


row
col

gpu matrix row col devic id zero
gpu matrix row col devic id zero

set valu
inplac exp
set valu
boost check is equal to epsilon float e4

set valu
inplac log
set valu
boost check is equal to epsilon float e4

set valu
inplac tanh
set valu tanh
boost check is equal to epsilon float e4

set valu
inplac ab
set valu
boost check is equal to epsilon float e4

set valu
inplac sqrt
set valu sqrt
boost check is equal to epsilon float e4

set valu
inplac sigmoid
set valu
boost check is equal to epsilon float e4

todo inplac oper test compar result


boost fixtur test case gpu matrix add and sub random seed fixtur

array0
gpu matrix devic id zero array0 matrix flag normal

array1
gpu matrix devic id zero array1 matrix flag normal

array2
gpu matrix devic id zero array2 matrix flag normal

array cr
gpu matrix devic id zero array cr matrix flag normal
gpu matrix devic id zero array cr matrix flag normal
gpu matrix devic id zero array cr matrix flag normal

gpu matrix
boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to

assign differ of
boost check is equal to


boost fixtur test case gpu matrix norm random seed fixtur




gpu matrix devic id zero matrix flag normal

gpu matrix devic id zero
vector norm1



gpu matrix devic id zero matrix flag normal
boost check is equal to

vector norm1
resiz


set valu get comput devic id matrix flag normal
boost check is equal to

vector norm2
resiz
1231f
3852f
7082f
set valu get comput devic id matrix flag normal
boost check is equal to epsilon float5 e4

vector norm2
resiz
7417f
7750f
set valu get comput devic id matrix flag normal
boost check is equal to epsilon float5 e4







gpu matrix devic id zero matrix flag normal

gpu matrix devic id zero
vector max
resiz



set valu get comput devic id matrix flag normal
boost check is equal to

vector max
resiz


set valu get comput devic id matrix flag normal
boost check is equal to

vector norm inf
resiz



set valu get comput devic id matrix flag normal
boost check is equal to

vector norm inf
resiz


set valu get comput devic id matrix flag normal
boost check is equal to







set valu get comput devic id matrix flag normal
boost check equal matrix norm inf

boost check frobeniu norm 5394 epsilon float e4
boost check matrix norm inf epsilon float e4
boost check equal matrix norm1

gpu matrix gpu matrix 4096 devic id zero
boost check equal 4096 matrix norm0

gpu matrix gpu matrix devic id zero
boost check equal matrix norm0


boost fixtur test case gpu matrix random uniform random seed fixtur

035f
high 035f
gpu matrix random uniform devic id zero high increment counter
uniqu result copi to array



boost check result high
boost check result



boost fixtur test case gpu matrix column slice random seed fixtur




gpu matrix devic id zero matrix flag normal
gpu matrix devic id zero matrix flag normal

gpu matrix column slice
boost check is equal to

array3
gpu matrix devic id zero array3 matrix flag normal

column slice
boost check is equal to


boost fixtur test case gpu matrix row slice random seed fixtur

array0





gpu matrix devic id zero array0 matrix flag normal

array1


gpu matrix devic id zero array1 matrix flag normal

gpu matrix devic id zero
assign row slice valu of
boost check is equal to

array3





gpu matrix devic id zero array3 matrix flag normal


add to row slice valu of
boost check is equal to

add with row slice valu of
array4


gpu matrix devic id zero array4 matrix flag normal
boost check is equal to


boost fixtur test case gpu matrix khatri rao product random seed fixtur

array a
8147f 9058f 1270f 9134f
6324f 0975f 2785f 5469f
9575f 9649f 1576f 9706f
gpu matrix devic id zero array a

array b
9572f 4854f 8003f 1419f
4218f 9157f 7922f 9595f
gpu matrix devic id zero array b

array d
7798f 8670f 1215f 3954f
4396f 0616f 7310f 5061f
0781f 1296f 0897f 0138f
1175f 2307f 4038f 2550f
5008f 8768f 7644f 1249f
7689f 9258f 1512f 9313f
gpu matrix devic id zero array d

gpu matrix devic id zero
assign khatri rao product of
boost check is equal to epsilon float e4


boost fixtur test case gpu matrix add column reshap product of random seed fixtur

test column wise reshap product use comput khatri rao product gradient
array a
6557f 0357f
8491f 9340f
6787f 7577f
7431f 3922f
6555f 1712f
7060f 0318f

gpu matrix devic id zero array a

array b
2769f 0462f
0971f 8235f
6948f 3171f
gpu matrix devic id zero array b

array d0
2867f 1266f
2913f 4520f
gpu matrix devic id zero array d0

array d1
2657f 3636f
0923f 6416f
gpu matrix devic id zero array d1

gpu matrix devic id zero
set valu
add column reshap product of
boost check is equal to epsilon float e4

set valu
add column reshap product of
boost check is equal to epsilon float e4


boost fixtur test case gpu matrix inner product random seed fixtur




gpu matrix devic id zero matrix flag normal

gpu matrix devic id zero devic id zero
assign inner product of
assign vector norm2 of
inplac sqrt
boost check is equal to

assign inner product of
assign vector norm2 of
inplac sqrt
boost check is equal to


boost fixtur test case gpu matrix assign repeat of random seed fixtur

array0



gpu matrix devic id zero array0 matrix flag normal

gpu matrix devic id zero
assign repeat of
boost check is equal to

array2






gpu matrix devic id zero array2 matrix flag normal

assign repeat of
boost check is equal to


boost fixtur test case gpu matrix row element oper random seed fixtur

gpu matrix gpu matrix random uniform devic id zero increment counter
gpu matrix gpu matrix random uniform devic id zero increment counter

gpu matrix devic id zero
set valu
row element multipli with
row element divid by

boost check is equal to epsilon float e4


boost fixtur test case gpu matrix column element oper random seed fixtur

gpu matrix gpu matrix random uniform devic id zero increment counter
gpu matrix gpu matrix random uniform devic id zero increment counter

gpu matrix devic id zero
set valu
column element multipli with
column element divid by

boost check is equal to epsilon float e4


boost fixtur test case gpu matrix curand seed float random seed fixtur


high
seed use
seed ignor 4711

current gpu matrix implement use

gpu matrix reset curand object seed use function
gpu matrix random uniform devic id zero high seed ignor

gpu matrix reset curand object seed use function
gpu matrix random uniform devic id zero high seed ignor

boost check is equal to


boost fixtur test case gpu matrix curand seed doubl random seed fixtur


high
seed use
seed ignor 4711

current gpu matrix implement use

gpu matrix reset curand object seed use function
gpu matrix random uniform devic id zero high seed ignor

gpu matrix reset curand object seed use function
gpu matrix random uniform devic id zero high seed ignor

boost check is equal to


temporarili disabl
boost fixtur test case gpu matrix larg inequ random seed fixtur

row 33553921
col

gpu matrix zero row col devic id zero
gpu matrix one row col devic id zero

boost check is equal to epsilon float e5



boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common includ basic
sourc math cpu matrix
sourc math gpu matrix
common includ fileutil
common includ file
to do file directli includ common librari futur possibl
common file
common fileutil



microsoft cntk

microsoft cntk test

boost auto test suit cpu matrix suit

boost fixtur test case cpu matrix file write read random seed fixtur

cpu matrix matrix cpu cpu matrix random uniform increment counter
cpu matrix matrix cpu copi matrix cpu

wstring file name cpu mcpu
file file cpu file name cpu file option text file option read write

file cpu matrix cpu
file cpu set posit

cpu matrix matrix cpu read
file cpu matrix cpu read

boost check matrix cpu copi is equal to matrix cpu read epsilon float e5


boost fixtur test case matrix file write read random seed fixtur

test matrix dens mode
matrix matrix matrix random uniform devic id zero increment counter
matrix matrix copi matrix deep clone

wstring file name
file file file name file option text file option read write

file matrix
file set posit

matrix matrix read devic id zero
file matrix read

boost check matrix read is equal to matrix copi epsilon float e5

test matrix spars mode
matrix matrix spars matrix random uniform devic id zero increment counter
matrix matrix spars copi matrix spars deep clone

matrix spars switch to matrix type matrix type spars matrix format spars csr

wstring filenam spars
file file spars filenam spars file option text file option read write

file spars matrix spars
file spars set posit

matrix matrix spars read devic id zero
file spars matrix spars read

boost check matrix type spars matrix spars read get matrix type
boost check matrix spars read is equal to matrix spars copi epsilon float e5


boost auto test suit

boost auto test suit gpu matrix suit

boost fixtur test case gpu matrix file write read random seed fixtur

gpu matrix matrix gpu gpu matrix random uniform devic id zero increment counter
gpu matrix matrix gpu copi matrix gpu

wstring filenam gpu mgpu
file file gpu filenam gpu file option text file option read write

file gpu matrix gpu
file gpu set posit

gpu matrix matrix gpu read devic id zero
file gpu matrix gpu read

boost check matrix gpu copi is equal to matrix gpu read epsilon float e5


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

gpu spars matrix unit test

stdafx
math
crtdef
sourc math gpu spars matrix

microsoft cntk

todo move warn suppress stdafx necessari
pragma warn disabl 4244 4245 4305 convers truncat care test project

microsoft cntk test




row count
col count
size row count col count

boost auto test suit gpu matrix suit

boost fixtur test case gpu spars matrix constructor and initi random seed fixtur

gpu spars matrix devic id zero
boost check is empti

set matrix from csr format size row count col count
boost check equal row count get num row
boost check equal col count get num col
boost check is empti

gpu spars matrix
boost check equal row count get num row
boost check equal col count get num col
boost check is empti

gpu spars matrix
boost check equal row count get num row
boost check equal col count get num col
boost check is empti


boost fixtur test case gpu spars matrix scale and add random seed fixtur








cast rand
cast rand


gpu matrix dens matrix a devic id zero matrix flag matrix flag normal
gpu matrix dens matrix b devic id zero matrix flag matrix flag normal

gpu spars matrix spars matrix a devic id zero
spars matrix a set valu dens matrix a
gpu spars matrix spars matrix b devic id zero
spars matrix b set valu dens matrix b

gpu spars matrix spars matrix c devic id zero
alpha
beta
gpu spars matrix scale and add alpha spars matrix a beta spars matrix b spars matrix c

gpu spars matrix scale alpha spars matrix c

gpu matrix dens matrix c spars matrix c copi to dens matrix
uniqu dens matrix c copi to array


boost check equal alpha alpha beta



boost fixtur test case gpu spars dens plu spars random seed fixtur

gpu spars matrix spars matrix devic id zero

spars matrix set matrix from csr format size row count col count

gpu matrix dens matrix b gpu matrix random uniform row count col count devic id zero increment counter
gpu matrix result matrix dens matrix b get num row dens matrix b get num col devic id zero

alpha
beta

gpu spars matrix scale and add alpha spars matrix beta dens matrix b result matrix
gpu matrix scale and add alpha spars matrix copi to dens matrix dens matrix b

boost check dens matrix b is equal to result matrix epsilon float e5


boost fixtur test case gpu spars elementwis time dens random seed fixtur

gpu spars matrix devic id zero
set matrix from csr format size row count col count

gpu matrix gpu matrix random uniform row count col count devic id zero increment counter

gpu matrix product gpu spars matrix element product of

gpu matrix dens product devic id zero
dens product assign element product of copi to dens matrix

boost check product is equal to dens product


boost fixtur test case gpu spars time dens random seed fixtur

gpu spars matrix devic id zero
boost check is empti
set matrix from csr format size row count col count
boost check equal row count get num row
boost check equal col count get num col
boost check is empti

gpu matrix gpu matrix col count devic id zero
gpu matrix result gpu matrix one row count col count devic id zero

gpu spars matrix multipli and weight add result

result copi to array
cpu matrix ccpu row count col count matrix flag matrix flag normal


boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu
boost check equal ccpu



todo comment temporarili test underli code need fix

boost fixtur test case gpu dens time spars random seed fixtur

gpu spars matrix spars matrix a matrix format spars csr
boost check spars matrix a is empti

spars matrix a set matrix from csr format size row count col count
boost check equal row count spars matrix a get num row
boost check equal col count spars matrix a get num col
boost check spars matrix a is empti

gpu spars matrix spars transpos a spars matrix a transpos
gpu matrix dens transpos a spars transpos a copi to dens matrix

arr a time transpos a

gpu matrix row count row count devic id zero arr a time transpos a matrix flag matrix flag normal
gpu matrix cre row count row count devic id zero
gpu spars matrix multipli spars matrix a dens transpos a cre
boost check cre is equal to

arr at time matrix a
gpu matrix cet1 col count col count devic id zero arr at time matrix a matrix flag matrix flag normal
gpu matrix cres1 col count col count devic id zero
gpu spars matrix multipli dens transpos a spars matrix a cres1
boost check cres1 is equal to cet1

gpu matrix matrix b gpu matrix random uniform row count col count row count devic id zero increment counter
gpu matrix matrix c size col count devic id zero
gpu spars matrix multipli matrix b spars matrix a matrix c

gpu matrix transpos b matrix b transpos
gpu spars matrix transpos a spars matrix a transpos
gpu matrix transpos c col count size devic id zero
gpu spars matrix multipli transpos a transpos b transpos c
gpu matrix twice transpos c transpos c transpos

boost check twice transpos c is equal to matrix c epsilon float e4


boost fixtur test case gpu spars time spars random seed fixtur

gpu spars matrix matrix a
boost check matrix a is empti
matrix a set matrix from csr format size row count col count

gpu spars matrix transpos a matrix a transpos

gpu spars matrix product
gpu spars matrix multipli transpos a matrix a product

expect product
product copi to dens matrix copi to array
boost check equal collect expect product expect product






boost fixtur test case gpu spars element wise random seed fixtur

gpu spars matrix matrix a devic id zero
boost check matrix a is empti
matrix a set matrix from csr format size row count col count

gpu spars matrix power matrix devic id zero
some power
power matrix resiz as and copi index from matrix a
matrix a element wise power some power matrix a power matrix

nullptr
nullptr
nullptr
size
power matrix get matrix from csr format

index index size index

powf index some power
boost check fabsf index epsilon float e3







boost fixtur test case gpu spars is equal random seed fixtur

gpu spars matrix first matrix devic id zero
first matrix set matrix from csr format size row count col count

gpu spars matrix second matrix devic id zero
second matrix set matrix from csr format size row count col count
boost check second matrix is equal to first matrix

gpu spars matrix empti matrix devic id zero
boost check empti matrix is equal to first matrix


boost fixtur test case gpu spars dens convers random seed fixtur

gpu spars matrix spars matrix a devic id zero
boost check spars matrix a is empti
spars matrix a set matrix from csr format size row count col count
boost check equal row count spars matrix a get num row
boost check equal col count spars matrix a get num col
boost check spars matrix a is empti

gpu matrix dens matrix a spars matrix a copi to dens matrix
boost check equal row count dens matrix a get num row
boost check equal col count dens matrix a get num col

dens matrix a copi to array
cpu matrix cpu matrix dens matrix a get num row dens matrix a get num col matrix flag matrix flag normal


boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix
boost check equal cpu matrix

gpu spars matrix spars matrix b devic id zero
spars matrix b set valu dens matrix a
gpu matrix dens matrix b spars matrix b copi to dens matrix
dens matrix b copi to array
cpu matrix cpu matrix b dens matrix b get num row dens matrix b get num col matrix flag matrix flag normal


boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b
boost check equal cpu matrix b


boost fixtur test case gpu spars transpos random seed fixtur

gpu spars matrix spars matrix devic id zero
boost check spars matrix is empti
spars matrix set matrix from csr format size row count col count

gpu spars matrix transpos matrix a spars matrix transpos
gpu spars matrix inplac tranpos matrix spars matrix
inplac tranpos matrix inplac transpos
boost check inplac tranpos matrix is equal to transpos matrix a

gpu spars matrix tranpos matrix b spars matrix transpos
gpu spars matrix assign transpos matrix devic id zero
assign transpos matrix assign transpos of tranpos matrix b
boost check assign transpos matrix is equal to spars matrix

spars matrix inplac transpos
boost check assign transpos matrix is equal to spars matrix

spars matrix inplac transpos
boost check assign transpos matrix is equal to spars matrix


boost fixtur test case gpu spars norm test random seed fixtur

gpu spars matrix matrix devic id zero
boost check matrix is empti
matrix set matrix from csr format size row count col count

frobeniu matrix frobeniu norm
boost check fabsf 882f frobeniu epsilon float e4

ninf matrix matrix norm inf
boost check equal ninf

matrix matrix norm1
boost check equal


boost fixtur test case gpu spars matrix inner product random seed fixtur

gpu spars matrix matrix op1 devic id zero
boost check matrix op1 is empti
matrix op1 set matrix from csr format size row count col count

gpu matrix matrix op2 gpu matrix random uniform row count col count devic id zero increment counter
gpu spars matrix inner product of matric matrix op1 matrix op2
gpu matrix inner product of matric matrix op1 copi to dens matrix matrix op2
boost check fabsf epsilon float e5


boost fixtur test case gpu spars matrix column slice random seed fixtur

valu
gpu matrix dens a devic id zero valu matrix flag matrix flag normal
gpu spars matrix spars a devic id zero matrix format matrix format spars csc
spars a set valu dens a

gpu matrix slice column1 dens a column slice
gpu matrix dens column1 spars a column slice copi column slice to dens
boost check slice column1 is equal to dens column1 epsilon float e4

gpu matrix slice column2 dens a column slice
gpu matrix spars column2 spars a column slice copi column slice to dens
boost check slice column2 is equal to spars column2 epsilon float e4

boost check slice column1 is equal to spars column2 epsilon float e4
boost check slice column2 is equal to dens column1 epsilon float e4


boost fixtur test case gpu spars matrix copi column slice to dens random seed fixtur

valu
gpu matrix dens a devic id zero valu matrix flag matrix flag normal
gpu spars matrix spars a devic id zero matrix format matrix format spars csc
spars a set valu dens a

gpu matrix slice column1 dens a column slice
gpu matrix dens column1 spars a copi column slice to dens
boost check slice column1 is equal to dens column1 epsilon float e4

gpu matrix slice column2 dens a column slice
gpu matrix spars column2 spars a copi column slice to dens
boost check slice column2 is equal to spars column2 epsilon float e4

boost check slice column1 is equal to spars column2 epsilon float e4
boost check slice column2 is equal to dens column1 epsilon float e4


boost fixtur test case gpu spars matrix1 d convolut fix init random seed fixtur

zero pad
horizont subsampl
vertic subsampl
input width
input height
input channel
kernel width
kernel height input height
output width zero pad input width input width kernel width input width kernel width horizont subsampl
output height input height
output channel
batch size
output channel
kernel width input channel
input width input channel
batch size
alpha
beta

weight
valu
gpu matrix dens matrix a weight matrix flag normal

gpu matrix dens matrix b valu matrix flag normal

gpu spars matrix spars matrix b devic id zero matrix format spars csc
gpu matrix dens matrix temp devic id zero resiz automat
gpu matrix result matrix base devic id zero resiz automat
gpu matrix result matrix exp devic id zero resiz automat

spars matrix b set valu dens matrix b

dens matrix temp assign pack convolut input dens matrix b
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl zero pad

gpu matrix multipli and weight add alpha dens matrix a dens matrix temp beta result matrix base
result matrix base reshap output width output channel batch size

gpu spars matrix convolv and weight add alpha dens matrix a spars matrix b beta result matrix exp input channel horizont subsampl zero pad

boost check result matrix exp is equal to result matrix base epsilon float e5


boost fixtur test case gpu spars matrix1 d convolut random init random seed fixtur

transpos a

transpos b

zero pad todo there discrep pad need

input channel

horizont subsampl

vertic subsampl
input width
input height
kernel width
kernel height input height
output width zero pad input width input width kernel width input width kernel width horizont subsampl
output height input height
output channel
batch size
output channel
kernel width input channel
input width input channel
batch size
alpha
beta transpos b
gpu matrix dens matrix a gpu matrix random uniform devic id zero increment counter
gpu matrix dens matrix b gpu matrix random uniform devic id zero increment counter
gpu matrix dens matrix at devic id zero
gpu matrix dens matrix bt devic id zero
gpu spars matrix spars matrix b devic id zero matrix format spars csc
gpu matrix dens matrix temp devic id zero resiz automat
gpu matrix result matrix base output channel batch size output width output height devic id zero
gpu matrix result matrix exp output width output height output channel batch size devic id zero

transpos a

dens matrix at assign transpos of dens matrix a


transpos b

dens matrix bt assign transpos of dens matrix b
spars matrix b set valu dens matrix bt



spars matrix b set valu dens matrix b


dens matrix temp assign pack convolut input dens matrix b
input width input height input channel
output width output height output channel
kernel width kernel height horizont subsampl vertic subsampl zero pad

gpu matrix multipli and weight add alpha dens matrix a dens matrix temp beta result matrix base
result matrix base reshap output width output channel batch size

gpu spars matrix convolv and weight add alpha transpos a dens matrix at dens matrix a transpos a spars matrix b transpos b beta result matrix exp input channel horizont subsampl zero pad

boost check result matrix exp is equal to result matrix base epsilon float e2







boost fixtur test case gpu spars matrix1 d convolut backprop random seed fixtur

in channel
in width
in height
batch size
kernel width
kernel height in height
horizont subsampl
vertic subsampl
zero pad
out channel
out width zero pad in width horizont subsampl in width kernel width in width kernel width horizont subsampl
out height in height
random init lower bound
random init upper bound
matrix output gradient sub batch matrix random uniform out channel batch size out width devic id zero random init lower bound random init upper bound increment counter
matrix input sub batch matrix random uniform in channel in width batch size devic id zero random init lower bound random init upper bound increment counter
matrix temp matrix devic id zero
matrix input gradient values1 matrix zero out channel in channel kernel width devic id zero
matrix input gradient values2 matrix zero out channel in channel kernel width devic id zero

baselin
temp matrix resiz kernel width kernel height in channel out width out height batch size
temp matrix assign pack convolut input input sub batch
in width in height in channel out width out height out channel
kernel width kernel height horizont subsampl vertic subsampl zero pad
matrix multipli and add output gradient sub batch temp matrix input gradient values1

optim code path convolut spars
matrix input sub batch spars reorder batch size in width in channel devic id zero matrix type spars matrix format matrix format spars csc
input sub batch switch to matrix type matrix type spars matrix format matrix format spars csc
input sub batch reshap in channel batch size in width
input sub batch inplac transpos
matrix tensor shuffl scale and add input sub batch in width batch size in channel input sub batch spars reorder input sub batch spars reorder

matrix output gradient sub batch reshap matrix zero out channel batch size out width devic id zero
matrix output gradient sub batch reorder matrix zero batch size out width out channel devic id zero
output gradient sub batch reshap output gradient sub batch transpos
matrix tensor shuffl scale and add output gradient sub batch reshap out width batch size out channel output gradient sub batch reorder output gradient sub batch reorder

input gradient values2 reshap out channel kernel width in channel
matrix convolv and weight add output gradient sub batch reorder input sub batch spars reorder input gradient values2 batch size horizont subsampl zero pad
input gradient values2 reshap out channel in channel kernel width

boost check input gradient values2 is equal to input gradient values1 epsilon float e2


boost fixtur test case gpu spars matrix reshap random seed fixtur

old row count
old col count
new row count
new col count
gpu matrix dens matrix a gpu matrix random uniform old row count old col count devic id zero increment counter
gpu matrix dens matrix b dens matrix a
gpu matrix dens matrix c new row count new col count devic id zero
gpu spars matrix spars matrix devic id zero matrix format spars csc

dens matrix b reshap new row count new col count

spars matrix set valu dens matrix a
spars matrix reshap new row count new col count
spars matrix copi to dens matrix dens matrix c

boost check dens matrix c is equal to dens matrix b epsilon float e5
boost check dens matrix c is equal to dens matrix a epsilon float e5
boost check spars matrix is valid


boost fixtur test case gpu spars tensor shuffl scale and add random seed fixtur

size
gpu matrix dens matrix a gpu matrix random uniform devic id zero increment counter
gpu matrix dens matrix b devic id zero
gpu matrix dens matrix c devic id zero
gpu spars matrix spars matrix a devic id zero matrix format spars csc
gpu spars matrix spars matrix b devic id zero matrix format spars csc
spars matrix a set valu dens matrix a

gpu matrix tensor shuffl scale and add dens matrix a dens matrix b dens matrix b
gpu spars matrix tensor shuffl scale and add spars matrix a spars matrix b spars matrix b
spars matrix b copi to dens matrix dens matrix c

boost check dens matrix c is equal to dens matrix b epsilon float e5
boost check spars matrix b is valid


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
crtdef
sourc math cpu spars matrix

microsoft cntk

microsoft cntk test

cpu doubl spars matrix spars matrix
cpu doubl matrix dens matrix

boost auto test suit cpu matrix suit

boost fixtur test case cpu spars matrix column slice random seed fixtur

size
size
dens matrix
spars matrix matrix format matrix format spars csc

set uniform random valu increment counter

coord

set valu


size start
size num col
dens matrix column slice start num col
dens matrix column slice start num col copi column slice to dens num col

boost check is equal to epsilon float e4


boost fixtur test case cpu spars matrix copi column slice to dens random seed fixtur

size
size
dens matrix
spars matrix matrix format matrix format spars csc

set uniform random valu increment counter

coord

set valu


size start
size num col
dens matrix column slice start num col
dens matrix copi column slice to dens start num col

boost check is equal to epsilon float e4


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
file
memori


sourc math matrix quantiz impl
sourc math cuda page lock mem alloc
sourc math valu quantiz

microsoft cntk

defin debug output path matrix quantiz test

redirect std err and std out creat debug out

creat debug out

ifdef debug output path
w string log path debug output path

wstring log path

fprintf stderr redirect stderr file log path
make share file log path file option write file option text
dup2 fileno
runtim error unexpect failur redirect stdout file
dup2 fileno
runtim error unexpect failur redirect stderr file
setvbuf stderr ionbf 16384 unbuff
f kept keep around get chang



microsoft cntk test

ifdef debug output path
creat debug out

creat debug out

singl precis toler epsilon float e4
doubl precis toler 00000001
singl precis gpu quantiz toler epsilon float e3

elem type
refer cpu quantiz
size num bit
size num row
size num col
elem type in matrix
elem type prev residu matrix
elem type prev out matrix
elem type out matrix
elem type out residu matrix
zero threshold for1 bit

quantiz word helper elem type valu type q word val
quantiz word helper elem type valu type sign q word val sign

just valu num bit full size elem type
num bit elem type

size num col

num row

flat idx num row
elem type in matrix flat idx prev residu matrix flat idx
out matrix flat idx prev out matrix flat idx
out residu matrix flat idx





size num col

elem type mean
zero threshold for1 bit num bit

elem type cast elem type
num row

size flat idx num row
in matrix flat idx prev residu matrix flat idx

mean num row


elem type radiu
elem type new mean
elem type quanti min
elem type quanti max
num bit

calcul mean0 mean1 column
elem type mean0 sum
elem type mean1 sum
num0
num1
num row

size flat idx num row
elem type in matrix flat idx prev residu matrix flat idx
mean

mean0 sum
num0



mean1 sum
num1



zero threshold for1 bit

minim error jointli across posit neg number make thing
symmetr around mean zero tie side
elem type devacc0 num0 mean mean0 sum
elem type devacc1 mean1 sum num1 mean

deviat tie consist mean
elem type devacc0 devacc1 num row
radiu cast elem type
new mean mean



happen zero column exist mean0
num0

num0

num1

num1


elem type mean0 mean0 sum num0
elem type mean1 mean1 sum num1

new mean cast elem type mean0 mean1
radiu cast elem type mean1 new mean


quanti min new mean radiu
quanti max new mean radiu




linearli quantiz stddev standard deviat
elem type stddev
elem type varacc
num row

size flat idx num row
elem type in matrix flat idx prev residu matrix flat idx
varacc mean mean


elem type stddev sqrt varacc num row
quanti min mean stddev stddev
quanti max mean stddev stddev


elem type q factor
elem type u factor
q word val rang size cast q word val num bit

must protect interv quantiz futil emit
quanti max quanti min rang size

q factor u factor cast elem type



q factor rang size quanti max quanti min
u factor quanti max quanti min rang size


num row

flat idx num row
elem type in matrix flat idx prev residu matrix flat idx
elem type q val

num bit

mean

q val new mean cast elem type radiu



q val new mean cast elem type radiu




q word val sign result
quanti min

result

quanti max

result cast q word val sign rang size



result cast q word val sign quanti min q factor


q val cast q word val result cast elem type u factor quanti min


out matrix flat idx prev out matrix flat idx q val
out residu matrix flat idx q val




elem type
test run quantiz
size num bit
size num row
size num col
elem type rang low
elem type rang high
seed
num iter
devic id
zero threshold for1 bit

verifi all zero func matrix elem type matrix

uniqu elem type cpu matrix matrix copi to array
size num matrix elem matrix get num element

size num matrix elem

boost check equal cpu matrix cast elem type



uniqu mem alloc alloc devic id cpudevic nullptr cuda page lock mem alloc devic id

matrix elem type in matrix num row num col devic id
uniqu matrix quantiz impl elem type quantiz matrix quantiz impl elem type creat devic id use async
matrix elem type residu matrix num row num col devic id

verifi initi residu compris zero
verifi all zero func residu matrix
matrix elem type out matrix num row num col devic id
verifi out matrix initi zero
verifi all zero func out matrix

iter num iter num num iter iter num

in matrix matrix elem type random uniform num row num col devic id rang low rang high seed iter num

uniqu elem type gpu in matrix in matrix copi to array
uniqu elem type gpu prev residu matrix residu matrix copi to array
uniqu elem type gpu prev out matrix out matrix copi to array

size num row to print
size num col to print
creat debug out

peek onli
size num row to peek
size num col to peek
peek onli

num row to print num row to peek num row
num col to print num col to peek num col



num row to print num row
num col to print num col


in matrix print input matrix num row to print num col to print
residu matrix print residu matrix num row to print num col to print
out matrix print output matrix num row to print num col to print


quantiz matrix elem type temp cpu quantiz buffer num row num col num bit cpudevic alloc
quantiz quantiz async in matrix residu matrix temp cpu quantiz buffer residu matrix zero threshold for1 bit
quantiz wait quantiz async done

creat debug out

temp cpu quantiz buffer print quantiz matrix num row to print num col to print
residu matrix print residu matrix num row to print num col to print


quantiz unquant async temp cpu quantiz buffer out matrix iter num
quantiz wait unquant async done

creat debug out

out matrix print unquant output matrix num row to print num col to print


verifi quantiz result
uniqu elem type gpu new residu matrix residu matrix copi to array
uniqu elem type gpu new out matrix out matrix copi to array

elem type precis toler elem type valu cast elem type doubl precis toler singl precis toler
elem type toler
num bit elem type

toler rang high rang low precis toler


size num matrix elem in matrix get num element
size num matrix elem

boost check fab gpu in matrix gpu prev residu matrix gpu prev out matrix gpu new residu matrix gpu new out matrix toler


size num incorrect allow
elem type valu devic id

allow small incorrect result comput
singl precis sinc rare case valu
quantiz differ integ result differ larger
allow toler
num incorrect allow cast size cast size num matrix elem singl precis gpu quantiz toler


verifi refer quantiz
size num incorrect out valu
size num incorrect residu valu
uniqu elem type ref new out matrix elem type num matrix elem
uniqu elem type ref new residu matrix elem type num matrix elem

refer cpu quantiz num bit num row num col
gpu in matrix gpu prev residu matrix gpu prev out matrix ref new out matrix ref new residu matrix zero threshold for1 bit
size num matrix elem

fab gpu new out matrix ref new out matrix toler

num incorrect out valu
num incorrect out valu num incorrect allow

boost check fab gpu new out matrix ref new out matrix toler



fab gpu new residu matrix ref new residu matrix toler

num incorrect residu valu
num incorrect residu valu num incorrect allow

boost check fab gpu new residu matrix ref new residu matrix toler






elem type
test quantiz devic id size num row size num col rang low rang high seed num iter

test quantiz power size
max num bit elem type
size num bit num bit max num bit num bit num bit

test quantiz without zero threshold for1 bit set


zero threshold for1 bit

zero threshold for1 bit test applic
num bit zero threshold for1 bit




test run quantiz elem type num bit num row num col rang low rang high seed num iter devic id zero threshold for1 bit




boost auto test suit gpu matrix suit

boost fixtur test case gpu matrix1 bit quantiz float random seed fixtur

redirect std err and std out creat debug out

test quantiz devic id zero 2015
test quantiz devic id zero 005f 005f 2115
test quantiz devic id zero 00001f 00001f 2215
test quantiz devic id zero 2315
test quantiz devic id zero 2415
test quantiz devic id zero 2515
test quantiz devic id zero 2615
test quantiz devic id zero 2715
test quantiz devic id zero 2815
test quantiz devic id zero 2915


boost fixtur test case gpu matrix1 bit quantiz doubl random seed fixtur

redirect std err and std out creat debug out

test quantiz devic id zero 2015
test quantiz devic id zero 005f 005f 2115
test quantiz devic id zero 00001f 00001f 2215
test quantiz devic id zero 2315
test quantiz devic id zero 2415
test quantiz devic id zero 2515
test quantiz devic id zero 2615
test quantiz devic id zero 2715
test quantiz devic id zero 2815
test quantiz devic id zero 2915


boost auto test suit

boost auto test suit cpu matrix suit

boost fixtur test case cpu matrix1 bit quantiz float random seed fixtur

redirect std err and std out creat debug out

test quantiz cpudevic 2015
test quantiz cpudevic 005f 005f 2115
test quantiz cpudevic 00001f 00001f 2215
test quantiz cpudevic 2315
test quantiz cpudevic 2415
test quantiz cpudevic 2515
test quantiz cpudevic 2615
test quantiz cpudevic 2715
test quantiz cpudevic 2815
test quantiz cpudevic 2915


boost fixtur test case cpu matrix1 bit quantiz doubl random seed fixtur

redirect std err and std out creat debug out

test quantiz cpudevic 2015
test quantiz cpudevic 005f 005f 2115
test quantiz cpudevic 00001f 00001f 2215
test quantiz cpudevic 2315
test quantiz cpudevic 2415
test quantiz cpudevic 2515
test quantiz cpudevic 2615
test quantiz cpudevic 2715
test quantiz cpudevic 2815
test quantiz cpudevic 2915



origin test case paramet

test quantiz 2015
test quantiz 005f 005f 2115
test quantiz 00001f 00001f 2215
test quantiz 2315
test quantiz 2415
test quantiz 2515
test quantiz 2615
test quantiz 2715
test quantiz 2815
test quantiz 2915


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
sourc math cpu matrix

microsoft cntk

microsoft cntk test

cpu doubl matrix d matrix
cpu singl matrix s matrix

todo consid librari boost
14159265358979323846264338327950288419716939937510

boost auto test suit cpu matrix suit

boost fixtur test case cpu matrix constructor no flag random seed fixtur

d matrix
boost check is empti

resiz
boost check is empti
boost check equal get num row
boost check equal get num col
boost check equal get num element



boost check equal
boost check equal

d matrix
boost check is equal to


boost fixtur test case cpu matrix constructor flag normal random seed fixtur


s matrix matrix flag normal
boost check equal
boost check equal
boost check equal
boost check equal
boost check equal
boost check equal


boost fixtur test case cpu matrix constructor format row major random seed fixtur


d matrix matrix format row major
boost check equal
boost check equal
boost check equal
boost check equal
boost check equal
boost check equal


boost fixtur test case cpu matrix add and sub random seed fixtur

d matrix







d matrix







d matrix







d matrix



d matrix




d matrix


d matrix
boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to

assign differ of
boost check is equal to


boost fixtur test case cpu matrix multipli and div random seed fixtur

d matrix







d matrix







todo consid separ reshap test
d matrix
reshap







d matrix





d matrix
boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to

d matrix multipli and weight add
boost check is equal to

reshap
d matrix multipli and weight add




boost check is equal to

d matrix multipli and weight add

1104
2184
2724
boost check is equal to

d matrix multipli and weight add
resiz









boost check is equal to


boost fixtur test case cpu matrix element oper random seed fixtur

todo consid split larg test
d matrix







d matrix m0 invers
m0 invers
m0 invers
m0 invers
m0 invers
m0 invers
m0 invers

d matrix







d matrix
assign element product of m0 invers
boost check is equal to epsilon float e4


d matrix





1296
boost check is equal to

set valu

boost check is equal to

set valu
element multipli with m0 invers
boost check is equal to

set valu
element invers
boost check is equal to m0 invers

7311
8808
9526
9820
9933
9975
assign element divis of
element multipli with m0 invers
boost check is equal to epsilon float e4

set valu
inplac sigmoid
7311
8808
9526
9820
9933
9975
boost check is equal to epsilon float e4

set valu
inplac tanh
7616
9640
9951
9993
9999
0000
boost check is equal to epsilon float e4

set valu
inplac log softmax
inplac exp
0474
0474
0474
9526
9526
9526
boost check is equal to epsilon float e4

set valu
inplac log softmax
inplac exp
0900
2447
6652
0900
2447
6652
boost check is equal to epsilon float e4

set valu
inplac hardmax






boost check is equal to epsilon float e4

set valu
inplac hardmax






boost check is equal to epsilon float e4

set valu
inplac sqrt

4142
7321

2361
4495
boost check is equal to epsilon float e4

set valu
inplac exp
7183
3891
0855
5982
4132
4288
boost check is equal to epsilon float e4

inplac log
boost check is equal to epsilon float e4

set valu
inplac truncat bottom






boost check is equal to

set valu
inplac truncat top






boost check is equal to

d matrix trig
trig
trig
trig
trig
trig
trig

d matrix
set valu trig

d matrix expect
expect
expect
expect
expect
expect
expect

inplac cosin
boost check is equal to expect epsilon float e4

set valu trig
assign cosin of trig
boost check is equal to expect epsilon float e4

d matrix neg sine
neg sine set valu trig

d matrix neg sine expect
neg sine expect
neg sine expect
neg sine expect
neg sine expect
neg sine expect
neg sine expect

neg sine inplac neg sine
boost check neg sine is equal to neg sine expect epsilon float e4

neg sine set valu trig
neg sine assign neg sine of trig
boost check neg sine is equal to neg sine expect epsilon float e4


boost fixtur test case cpu matrix norm random seed fixtur

d matrix







d matrix m result
vector norm1 m result
d matrix



boost check m result is equal to

vector norm1 m result
resiz


boost check m result is equal to

vector norm2 m result
resiz
1231
3852
7082
boost check m result is equal to epsilon float e4

vector norm2 m result
resiz
7417
7750
boost check m result is equal to epsilon float e4

vector norm inf m result
resiz



boost check m result is equal to epsilon float e4

vector norm inf m result
resiz


boost check m result is equal to

boost check frobeniu norm 5394 epsilon float e4
boost check matrix norm inf epsilon float e4

d matrix
vector max m result
resiz



boost check m result is equal to epsilon float e4

vector max m result
resiz


boost check m result is equal to epsilon float e4

vector min m result
resiz



boost check m result is equal to epsilon float e4

vector min m result
resiz


boost check m result is equal to epsilon float e4


boost fixtur test case cpu matrix set valu random seed fixtur

d matrix




d matrix
set diagon valu
boost check is equal to epsilon float e4

d matrix



set diagon valu
boost check is equal to epsilon float e4

set uniform random valu increment counter
coord

boost check


resiz
set gaussian random valu increment counter
boost check close sum of element cast get num element


boost fixtur test case cpu matrix transpos random seed fixtur

d matrix







d matrix







d matrix transpos
boost check is equal to epsilon float e4

assign transpos of
boost check is equal to epsilon float e4


boost fixtur test case cpu matrix column slice random seed fixtur

d matrix







d matrix





d matrix column slice
boost check is equal to epsilon float e4






column slice
boost check is equal to epsilon float e4

todo fail access violat least desktop machin pkranen
size
reduc size
size
size
size

d matrix
set uniform random valu increment counter

d matrix
set uniform random valu increment counter

d matrix
set uniform random valu increment counter

d matrix
set valu

d matrix multipli and add



d matrix col mb column slice
d matrix col mc column slice
d matrix multipli and add col mb col mc


boost check is equal to epsilon float e4


boost fixtur test case cpu khatri rao product random seed fixtur

d matrix
8147
9134
2785
9649
9058
6324
5469
1576
1270
0975
9575
9706

d matrix
9572
8003
4218
7922
4854
1419
9157
9595

d matrix
7798
7310
1175
7644
8670
5061
2307
1249
1215
0781
4038
7689
3954
1296
2550
9258
4396
0897
5008
1512
0616
0138
8768
9313

d matrix
assign khatri rao product of
boost check is equal to epsilon float e4


boost fixtur test case cpu add column reshap product of random seed fixtur

d matrix
6557
7431
0357
3922
8491
6555
9340
1712
6787
7060
7577
0318

d matrix
2769
8235
0462
6948
0971
3171

d matrix
2867
2913
1266
4520

d matrix
2657
0923
3636
6416

d matrix
set valu
add column reshap product of
boost check is equal to epsilon float e4

set valu
add column reshap product of
boost check is equal to epsilon float e4


boost fixtur test case cpu matrix row slice and stack random seed fixtur

d matrix
















d matrix







d matrix
assign row slice valu of
boost check is equal to epsilon float e4

d matrix

















add to row slice valu of
boost check is equal to epsilon float e4

add with row slice valu of
d matrix






boost check is equal to epsilon float e4


boost fixtur test case cpu assign repeat of random seed fixtur

d matrix







d matrix
assign repeat of
boost check is equal to epsilon float e4

d matrix





































assign repeat of
boost check is equal to epsilon float e4


boost fixtur test case cpu row element oper random seed fixtur

d matrix d matrix random uniform increment counter
d matrix d matrix random uniform increment counter

d matrix
set valu
row element multipli with
row element divid by

boost check is equal to epsilon float e4


boost fixtur test case cpu column element oper random seed fixtur

d matrix d matrix random uniform increment counter
d matrix d matrix random uniform increment counter

d matrix
set valu
column element multipli with
column element divid by

boost check is equal to epsilon float e4


boost fixtur test case cpu matrix seed float random seed fixtur


high
seed 4711

cpu matrix random uniform high seed
cpu matrix random uniform high seed

boost check is equal to


boost fixtur test case cpu matrix seed doubl random seed fixtur


high
seed 4711

cpu matrix random uniform high seed
cpu matrix random uniform high seed

boost check is equal to


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

gpu matrix cuda bla librari test

stdafx
sourc math gpu matrix

microsoft cntk

microsoft cntk test

boost auto test suit gpu matrix suit

boost fixtur test case gpu bla multipli and weight add random seed fixtur

alpha
beta
gpu matrix devic id zero
set valu
gpu matrix devic id zero
set valu
gpu matrix devic id zero
set valu

alpha beta
gpu matrix multipli and weight add alpha beta

gpu matrix devic id zero
set valu
boost check is equal to epsilon float e4


boost fixtur test case gpu bla scale random seed fixtur

scale
gpu matrix devic id zero
set valu
gpu matrix scale scale

gpu matrix devic id zero
set valu
boost check is equal to epsilon float e4


boost fixtur test case gpu bla inner product random seed fixtur

gpu matrix devic id zero
gpu matrix devic id zero
gpu matrix devic id zero
set valu
set valu
set valu

gpu matrix inner product
gpu matrix devic id zero
set valu
boost check is equal to epsilon float e4

gpu matrix inner product
boost check is equal to transpos epsilon float e4


todo test cuda bla method

boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
sourc math matrix
sourc math cpu matrix
sourc math helper

defin idx2 c base index

defin signum
defin signumz signum

microsoft cntk

microsoft cntk test

boost auto test suit matrix unit test

boost fixtur test case matrix constructor random seed fixtur

singl matrix
singl matrix
singl matrix cpudevic
singl matrix

boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col

boost check equal get devic id devic id zero
boost check equal get devic id devic id zero
boost check equal get devic id cpudevic
boost check equal get devic id devic id zero


boost fixtur test case matrix move test1 random seed fixtur

move requir
singl matrix devic id zero
singl matrix devic id zero
resiz

boost check equal get num row
boost check equal get num col
boost check equal get devic id devic id zero
boost check equal get devic id devic id zero

swap
boost check equal get num row
boost check equal get num col
boost check equal get devic id devic id zero
boost check equal get devic id devic id zero


boost fixtur test case matrix move test2 random seed fixtur

potenti move requir
singl matrix devic id zero
singl matrix devic id zero
resiz
boost check equal get num row
boost check equal get num col
boost check equal get devic id
boost check equal get devic id

move whole matrix
boost check equal get devic id

swap swap prefer devic present
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col
boost check equal get devic id
boost check equal get devic id


boost fixtur test case matrix deep copi random seed fixtur

thi deep copi move
singl matrix devic id zero
singl matrix devic id zero

resiz
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col

set valu
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col

resiz
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col


boost check equal

set valu
boost check equal get num row
boost check equal get num col
boost check equal get num row
boost check equal get num col


boost fixtur test case matrix init zero random seed fixtur

singl matrix singl matrix zero devic id zero
boost check equal get num row
boost check equal get num col
coord

boost check equal



boost fixtur test case matrix init eye random seed fixtur

singl matrix singl matrix devic id zero
boost check equal get num row
boost check equal get num col

coord



boost check equal



boost check equal




boost fixtur test case matrix init one random seed fixtur

singl matrix singl matrix one devic id zero
boost check equal get num row
boost check equal get num col
coord

boost check equal



boost fixtur test case matrix init gaussian rand random seed fixtur

singl matrix singl matrix random gaussian devic id zero increment counter
boost check equal get num row
boost check equal get num col


coord






coord



sqrt

boost check fab epsilon float e1
boost check fab epsilon float e1


boost fixtur test case matrix init random uniform random seed fixtur


high
singl matrix singl matrix random uniform devic id zero high increment counter
small

coord

boost check
boost check high


small






boost check small
boost check


boost fixtur test case matrix init random uniform seed random seed fixtur


high
singl matrix singl matrix random uniform 1024 devic id zero high increment counter
coord

boost check
boost check high


singl matrix singl matrix random uniform 1024 increment counter
boost check is equal to


boost fixtur test case matrix set valu method random seed fixtur

set valu elem type
singl matrix devic id zero
boost check equal get num row
boost check equal get num col
boost check equal get num element
3451f
set valu
coord

boost check equal


set valu matrix elem type deep copi from
singl matrix devic id zero
set valu
coord

boost check equal


set valu size num row size num col elem type p array src is col major
arr vector 99912

arr vector
set valu get devic id matrix flag normal

singl matrix devic id zero
set valu get devic id
coord

boost check equal idx2 c
boost check equal idx2 c


singl matrix bbbb singl matrix zero devic id zero
bbbb set column


boost check equal bbbb


set diagon valu elem type
singl matrix devic id zero
00332f
set diagon valu
coord


boost check equal

boost check equal


set diagon valu matrix elem type vector
singl matrix devic id zero
val1 324f
set valu val1
set diagon valu
coord


boost check equal val1

boost check equal


singl matrix devic id zero
singl matrix devic id zero
val2
transpos
set valu val2
set diagon valu
coord


boost check equal val2

boost check equal



boost fixtur test case matrix transpos test random seed fixtur

singl matrix singl matrix random gaussian devic id zero increment counter
boost check equal get num row
boost check equal get num col

singl matrix transpos

boost check equal get num row
boost check equal get num col

coord

boost check equal



boost fixtur test case matrix multi and div random seed fixtur

singl matrix devic id zero







singl matrix devic id zero







singl matrix devic id zero
reshap







singl matrix devic id zero





singl matrix
boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to

singl matrix multipli and weight add
boost check is equal to

reshap
singl matrix multipli and weight add




boost check is equal to

singl matrix multipli and weight add

1104
2184
2724
boost check is equal to

singl matrix multipli and weight add
resiz









boost check is equal to

multipl arbitrari matrix matrix

singl matrix devic id zero







singl matrix singl matrix devic id zero

singl matrix
boost check is equal to

boost check is equal to

inplac ab


singl matrix devic id zero






boost check is equal to


boost fixtur test case matrix transpos random seed fixtur

singl matrix devic id zero







singl matrix devic id zero







singl matrix transpos
boost check is equal to epsilon float e4

assign transpos of
boost check is equal to epsilon float e4


boost fixtur test case matrix add and sub random seed fixtur

singl matrix devic id zero







singl matrix devic id zero







singl matrix devic id zero







singl matrix
boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to


boost check is equal to
singl matrix singl matrix devic id zero


boost check is equal to


boost check is equal to

singl matrix deep clone

boost check is equal to

singl matrix singl matrix devic id zero

inplac ab

boost check is equal to


boost check is equal to


boost fixtur test case matrix element op random seed fixtur

singl matrix devic id zero







singl matrix devic id zero

cast
cast
cast
cast
cast

singl matrix devic id zero







singl matrix devic id zero
assign element product of
boost check is equal to epsilon float e4

singl matrix singl matrix zero devic id zero
set valu add element product of
boost check is equal to epsilon float e4


singl matrix devic id zero





1296
boost check is equal to epsilon float e3

set valu

boost check is equal to epsilon float e3

set valu
element multipli with
boost check is equal to epsilon float e3

set valu
element invers
boost check is equal to epsilon float e3

7311f
8808f
9526f
9820f
9933f
9975f
assign element divis of
element multipli with
boost check is equal to epsilon float e4

set valu
inplac sigmoid
7311f
8808f
9526f
9820f
9933f
9975f
boost check is equal to epsilon float e4

set valu
inplac tanh
7616f
9640f
9951f
9993f
9999f
0000f
boost check is equal to epsilon float e4

set valu
inplac log softmax
inplac exp
0474f
0474f
0474f
9526f
9526f
9526f
boost check is equal to epsilon float e4

set valu
inplac log softmax
inplac exp
0900f
2447f
6652f
0900f
2447f
6652f
boost check is equal to epsilon float e4

set valu
inplac hardmax






boost check is equal to epsilon float e4

set valu
inplac sqrt

4142f
7321f

2361f
4495f
boost check is equal to epsilon float e4

set valu
inplac exp
7183f
3891f
0855f
5982f
4132f
4288f
boost check is equal to epsilon float e4

set valu
inplac exp
7183f
3891f
0855f
5982f
4132f
4288f
boost check is equal to epsilon float e4

inplac log
boost check is equal to epsilon float e4

set valu
inplac truncat bottom






boost check is equal to epsilon float e3

set valu
inplac truncat top






boost check is equal to epsilon float e3


boost fixtur test case matrix column element multipli random seed fixtur

cpu matrix mcpu cpu matrix random uniform 1024 increment counter
cpu matrix acpu cpu matrix one
cpu matrix mcpu copi mcpu

mcpu column element multipli with acpu
boost check mcpu copi is equal to mcpu epsilon float e4

matrix matrix random uniform 1024 devic id zero increment counter
matrix matrix one devic id zero
matrix m copi deep clone

column element multipli with
boost check m copi is equal to epsilon float e4

cpu matrix cpu matrix random uniform 1024 increment counter
cpu matrix cpu matrix random uniform increment counter
column element multipli with

matrix get num row get num col buffer matrix flag normal
matrix get num row get num col buffer matrix flag normal
column element multipli with

coord

boost check fab epsilon float e5



boost fixtur test case matrix assign x of random seed fixtur

assign differ of
matrix matrix random uniform 1024 devic id zero increment counter
matrix matrix random uniform 1024 devic id zero increment counter
matrix devic id zero

assign differ of
coord

boost check equal

transfer to devic if not there devic id zero
transfer to devic if not there devic id zero
transfer to devic if not there devic id zero


assign differ of
coord

boost check equal

transfer to devic if not there devic id zero
transfer to devic if not there devic id zero
transfer to devic if not there devic id zero

assign differ of
coord

boost check equal

transfer to devic if not there devic id zero
transfer to devic if not there devic id zero
transfer to devic if not there devic id zero

assign differ of
coord

boost check equal


transfer to devic if not there devic id zero
transfer to devic if not there devic id zero
transfer to devic if not there devic id zero

assign element product of
assign element product of
coord

boost check equal

transfer to devic if not there devic id zero
transfer to devic if not there devic id zero
transfer to devic if not there devic id zero

add element product of
matrix copi deep clone
add element product of
coord

boost check equal copi


assign sigmoid of
cpu matrix cpu matrix random uniform 1024 increment counter
cpu matrix cpu matrix random uniform 1024 increment counter
matrix get num row get num col buffer matrix flag normal
matrix get num row get num col buffer matrix flag normal
assign sigmoid of
assign sigmoid of
coord

boost check fab epsilon float e5


assign sign of
matrix matrix random uniform devic id zero increment counter
matrix devic id zero
assign sign of
coord


expect signumz
actual
boost check equal expect actual


matrix matrix random uniform devic id zero increment counter
matrix deep clone
add sign of
coord


boost check equal signumz


assign truncat bottom
matrix devic id zero





matrix devic id zero
assign truncat bottom of
boost check equal
boost check equal
boost check equal
boost check equal

matrix devic id zero
assign truncat top of
boost check equal
boost check equal
boost check equal
boost check equal


boost fixtur test case matrix sum of element random seed fixtur

matrix matrix one 1024
sum of element
boost check equal 1024

cpu matrix mcpu cpu matrix one 1024
sum cpu mcpu sum of element
boost check equal 1024 sum cpu

matrix matrix one devic id zero

sum1 sum of element
boost check equal sum1

matrix matrix one devic id zero

sum2 sum of element
boost check equal sum2


boost fixtur test case matrix column slice random seed fixtur


f array

matrix f array matrix flag normal

matrix f array matrix flag normal

matrix column slice
boost check is equal to epsilon float e4

matrix f array matrix flag normal

column slice
boost check is equal to epsilon float e4

size

matrix devic id zero
set uniform random valu increment counter

matrix devic id zero
set uniform random valu increment counter

matrix devic id zero
set uniform random valu increment counter

matrix devic id zero
set valu

matrix multipli and add



matrix col bg column slice
matrix col cg column slice
matrix multipli and add col bg col cg

boost check is equal to epsilon float e4


boost fixtur test case matrix khatri rao product random seed fixtur







f array
f array 8147f
f array 9134f
f array 2785f
f array 9649f
f array 9058f
f array 6324f
f array 5469f
f array 1576f
f array 1270f
f array 0975f
f array 9575f
f array 9706f
matrix f array devic id zero

f array 9572f
f array 8003f
f array 4218f
f array 7922f
f array 4854f
f array 1419f
f array 9157f
f array 9595f
matrix f array devic id zero

f array 7798f
f array 7310f
f array 1175f
f array 7644f
f array 8670f
f array 5061f
f array 2307f
f array 1249f
f array 1215f
f array 0781f
f array 4038f
f array 7689f
f array 3954f
f array 1296f
f array 2550f
f array 9258f
f array 4396f
f array 0897f
f array 5008f
f array 1512f
f array 0616f
f array 0138f
f array 8768f
f array 9313f
matrix f array devic id zero

matrix devic id zero
assign khatri rao product of
boost check is equal to epsilon float e4


boost fixtur test case matrix add column reshap product of random seed fixtur





f array
f array 6557f
f array 7431f
f array 0357f
f array 3922f
f array 8491f
f array 6555f
f array 9340f
f array 1712f
f array 6787f
f array 7060f
f array 7577f
f array 0318f
matrix f array devic id zero

f array 2769f
f array 8235f
f array 0462f
f array 6948f
f array 0971f
f array 3171f
matrix f array devic id zero

f array 2867f
f array 2913f
f array 1266f
f array 4520f
matrix f array devic id zero

f array 2657f
f array 0923f
f array 3636f
f array 6416f
matrix f array devic id zero

matrix devic id zero
set valu
add column reshap product of
boost check is equal to epsilon float e4

set valu
add column reshap product of
boost check is equal to epsilon float e4


boost fixtur test case matrix copi random seed fixtur

size crow
size ccol
matric store column major matrix




matrix src m crow ccol matrix flag normal devic id zero
test full copi
cpu matrix actual m crow ccol
src m copi section actual m get num row actual m get num col actual m data actual m get num row

vector expect


boost check actual m is equal to cpu matrix actual m get num row actual m get num col expect matrix flag normal

test tile copi
actual m resiz crow ccol
actual m set valu numer limit quiet
src m copi section actual m get num row actual m get num col actual m data actual m get num row

expect
boost check actual m is equal to cpu matrix actual m get num row actual m get num col expect matrix flag normal


boost fixtur test case matrix ha element random seed fixtur

devic id cpudevic devic id zero

size size
size
singl matrix size devic id matrix flag normal
boost check singl matrix ha element
boost check singl matrix ha element

qnan numer limit quiet
boost check singl matrix ha element qnan
po inf numer limit infin
boost check singl matrix ha element po inf

qnan
boost check singl matrix ha element qnan

po inf
boost check singl matrix ha element po inf



boost fixtur test case matrix vector max random seed fixtur

matric store column major matrix




expect idx



expect val



devic id cpudevic devic id zero

matrix exp idx expect idx devic id matrix flag normal
matrix exp val expect val devic id matrix flag normal

matrix actual devic id matrix flag normal
matrix actual idx devic id
matrix actual val devic id

top k
actual vector max actual idx actual val top k
boost check actual idx is equal to exp idx
boost check actual val is equal to exp val



boost fixtur test case matrix assign num of diff random seed fixtur

label

matric store column major matrix
top k result




devic id cpudevic devic id zero

matrix label devic id matrix flag normal
matrix top k re top k result devic id matrix flag normal

matrix actual devic id
actual assign num of diff top k re

expect diff
boost check equal expect diff actual get00 element


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

test spars dens matrix interact

stdafx
sourc math matrix

microsoft cntk

microsoft cntk test

origin dimens 4096 2048
test fail larg dimens matrix spars element wise power
reduc
size dim1
size dim2 2048
size dim3

boost auto test suit gpu matrix suit

boost fixtur test case matrix chang mode between dens and spars random seed fixtur

thi test fail cuda
matrix devic id zero
assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter

matrix norm0
boost check equal matrix type dens get matrix type

switch to matrix type matrix type spars matrix format spars csr
boost check equal matrix type spars get matrix type

matrix norm0
boost check equal

switch to matrix type matrix type dens matrix format dens
boost check equal matrix type dens get matrix type


boost fixtur test case matrix spars time dens random seed fixtur

dens
matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter

matrix m aspars becom spars
matrix m aspars m adens deep clone
m aspars switch to matrix type matrix type spars matrix format spars csr

dens
matrix matrix random gaussian dim2 dim3 devic id zero increment counter
matrix matrix random gaussian dim1 dim3 devic id zero increment counter
matrix deep clone

alpha
beta
transpos a transpos b

dens dens
matrix multipli and weight add alpha m adens transpos a transpos b beta

spars dens
matrix multipli and weight add alpha m aspars transpos a transpos b beta

boost check is equal to epsilon float e4


boost fixtur test case matrix dens time spars random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter

matrix m aspars m adens deep clone
m aspars switch to matrix type matrix type spars matrix format spars csc

matrix matrix random gaussian dim2 dim1 devic id zero increment counter
matrix matrix random gaussian dim2 dim2 devic id zero increment counter
matrix deep clone

transpos a transpos b
alpha
beta
matrix multipli and weight add alpha transpos a m adens transpos b beta
matrix multipli and weight add alpha transpos a m aspars transpos b beta

boost check is equal to epsilon float e4

alpha
beta
matrix multipli and weight add alpha transpos a m adens transpos b beta
matrix multipli and weight add alpha transpos a m aspars transpos b beta

boost check is equal to epsilon float e4


boost fixtur test case cpu matrix dens time spars random seed fixtur

todo test fail larg dimens
size dim1 dim2
matrix m adens cpudevic
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter

matrix m aspars m adens deep clone
m aspars switch to matrix type matrix type spars matrix format spars csc

matrix matrix random gaussian dim2 dim1 cpudevic increment counter
matrix matrix random gaussian dim2 dim2 cpudevic increment counter
matrix deep clone

transpos a transpos b
alpha
beta
matrix multipli and weight add alpha transpos a m adens transpos b beta
matrix multipli and weight add alpha transpos a m aspars transpos b beta

boost check is equal to epsilon float e4

alpha
beta
matrix multipli and weight add alpha transpos a m adens transpos b beta
matrix multipli and weight add alpha transpos a m aspars transpos b beta

boost check is equal to epsilon float e4


boost fixtur test case cpu matrix dens time spars as spars random seed fixtur


todo comment temporarili sinc is equal to implement
matrix m adens cpudevic
m adens assign truncat bottom of matrix random uniform dim1 dim2 increment counter

matrix m aspars m adens
m aspars switch to matrix type matrix type spars matrix format spars csc

matrix matrix random gaussian dim1 dim2 increment counter cpudevic
matrix matrix random gaussian dim1 dim1 increment counter cpudevic
matrix m dblock cpudevic
m dblock switch to matrix type matrix type spars matrix format spars block col

alpha
beta
transpos a transpos b
matrix multipli and weight add alpha transpos a m aspars transpos b beta m dblock
matrix multipli and weight add alpha transpos a m aspars transpos b beta

todo is equal to implement spars block matrix
spars block matrix also implement
m dblock switch to matrix type matrix type dens matrix format dens
boost check m dblock is equal to epsilon float e4



boost fixtur test case matrix spars time spars random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m aspars m adens deep clone
m aspars switch to matrix type matrix type spars matrix format spars csr

matrix m bdens devic id zero
m bdens assign truncat bottom of matrix random uniform dim2 dim1 devic id zero increment counter
matrix m bspars m bdens deep clone
m bspars switch to matrix type matrix type spars matrix format spars csr

matrix m cdens devic id zero
m cdens assign truncat bottom of matrix random uniform dim1 dim1 devic id zero increment counter
matrix m cspars m cdens deep clone
m cspars switch to matrix type matrix type spars matrix format spars csr

transpos a transpos b
alpha
beta

matrix multipli and weight add alpha m adens transpos a m bdens transpos b beta m cdens
matrix multipli and weight add alpha m aspars transpos a m bspars transpos b beta m cspars
m cspars switch to matrix type matrix type dens matrix format dens
boost check m cspars is equal to m cdens epsilon float e4

todo soon beta multipli and weight add fail stack overflow also first test line
alpha
beta
m cspars switch to matrix type matrix type spars matrix format spars csr
matrix multipli and weight add alpha m adens transpos a m bdens transpos b beta m cdens
matrix multipli and weight add alpha m aspars transpos a m bspars transpos b beta m cspars
m cspars switch to matrix type matrix type dens matrix format dens
boost check m cspars is equal to m cdens epsilon float e4


boost fixtur test case matrix spars plu spars random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m aspars m adens deep clone

matrix m bdens devic id zero
m bdens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m bspars m bdens deep clone

alpha rand rand
matrix scale and add alpha m adens m bdens

m aspars switch to matrix type matrix type spars matrix format spars csr
m bspars switch to matrix type matrix type spars matrix format spars csr
matrix scale and add alpha m aspars m bspars

m bspars switch to matrix type matrix type dens matrix format dens
boost check m bspars is equal to m bdens epsilon float e4


boost fixtur test case matrix dens plu spars random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter

matrix m bdens devic id zero
m bdens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m bspars m bdens deep clone

alpha rand rand
matrix scale and add alpha m adens m bdens

m bspars switch to matrix type matrix type spars matrix format spars csr
matrix scale and add alpha m adens m bspars

m bspars switch to matrix type matrix type dens matrix format dens
boost check m bspars is equal to m bdens epsilon float e4


boost fixtur test case matrix spars plu dens random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m aspars m adens deep clone

matrix m bdens devic id zero
m bdens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m bdens deep clone

alpha rand rand
matrix scale and add alpha m adens m bdens

m aspars switch to matrix type matrix type spars matrix format spars csr
matrix scale and add alpha m aspars

boost check is equal to m bdens epsilon float e4


boost fixtur test case matrix spars element wise power random seed fixtur

matrix m adens devic id zero
m adens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m aspars m adens deep clone
m aspars switch to matrix type matrix type spars matrix format spars csr

matrix m bdens devic id zero
m bdens assign truncat bottom of matrix random uniform dim1 dim2 devic id zero increment counter
matrix m bspars m bdens deep clone
m bspars switch to matrix type matrix type spars matrix format spars csr

m adens
m aspars

todo randomli fail
boost check m aspars is equal to m adens epsilon float e3
boost check m adens is equal to m aspars epsilon float e3

m bdens assign element power of m adens
m bspars assign element power of m aspars

boost check m bspars is equal to m bdens epsilon float e3
boost check m bdens is equal to m bspars epsilon float e3
boost check


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx

sourc math cpu matrix
sourc math gpu matrix

microsoft cntk

random seed fixtur counter

fixtur begin test creat
increment counter test seed
explicitli specifi random oper
random seed fixtur random seed fixtur

gpu matrix reset curand object function
gpu matrix reset curand object function

counter


random seed fixtur increment counter

counter


copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
sourc math matrix
sourc math helper

microsoft cntk

microsoft cntk test

boost auto test suit gpu matrix suit

requir
boost fixtur test case matrix data synchron default behavior test for constructor random seed fixtur

singl matrix matrix a1 devic id zero
boost check equal current data locat matrix a1 get current matrix locat
boost check equal matrix a1 get num col
boost check equal matrix a1 get num row

singl matrix matrix a2 cpudevic
boost check equal current data locat matrix a2 get current matrix locat
boost check equal matrix a2 get num col
boost check equal matrix a2 get num row

singl matrix matrix a3 devic id zero
boost check equal current data locat matrix a3 get current matrix locat
boost check equal matrix a3 get num col
boost check equal matrix a3 get num row


singl matrix matrix a4 devic id zero matrix flag normal
boost check equal current data locat matrix a4 get current matrix locat
boost check equal matrix a4 get num col
boost check equal matrix a4 get num row

singl matrix matrix a5 cpudevic matrix flag normal
boost check equal current data locat matrix a5 get current matrix locat
boost check equal matrix a5 get num col
boost check equal matrix a5 get num row


requir
boost fixtur test case matrix data synchron access pattern and transfer test random seed fixtur


singl matrix matrix a devic id zero matrix flag normal
boost check equal current data locat matrix a get current matrix locat

get valu call leav matrix both state
matrix a get valu
boost check equal current data locat both matrix a get current matrix locat
coord matrix a

matrix a get valu
boost check equal current data locat both matrix a get current matrix locat


singl matrix matrix b matrix flag normal
boost check equal current data locat matrix b get current matrix locat

leav state write valid
matrix b
boost check equal current data locat matrix b get current matrix locat
matrix b
boost check equal current data locat matrix b get current matrix locat
coord matrix b

matrix b
matrix b
boost check equal current data locat matrix b get current matrix locat


matrix b transfer from devic to devic cpudevic devic id zero
boost check equal current data locat both matrix b get current matrix locat
matrix b transfer from devic to devic devic id zero cpudevic
boost check equal current data locat both matrix b get current matrix locat
matrix b transfer from devic to devic cpudevic devic id zero
boost check equal current data locat matrix b get current matrix locat
matrix b transfer from devic to devic devic id zero cpudevic
boost check equal current data locat matrix b get current matrix locat


requir
boost fixtur test case matrix data synchron gravit toward prefer devic random seed fixtur

singl matrix matrix a singl matrix random gaussian devic id zero increment counter
singl matrix matrix b singl matrix devic id zero

boost check equal current data locat matrix a get current matrix locat
boost check equal current data locat matrix b get current matrix locat

current matrix locat read valu matrix
matrix a
boost check equal current data locat matrix a get current matrix locat
matrix b
boost check equal current data locat matrix b get current matrix locat

singl matrix matrix c matrix a matrix b
boost check equal current data locat matrix a get current matrix locat
boost check equal current data locat matrix b get current matrix locat
boost check equal current data locat matrix c get current matrix locat


boost auto test suit



copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx
common network test helper

microsoft cntk

microsoft cntk test

fixtur specif oper
oper fixtur data fixtur

oper fixtur
data fixtur data




speech reader fixtur test
boost fixtur test suit network test suit oper fixtur

boost auto test case network oper plu

helper run network test
config network oper plu cntk config
control network oper plu control control
output output




copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ

defin boost test modul network test
stdafx
mpi wrapper

todo global
microsoft cntk mpi wrapper nullptr

todo temporari mechan enabl memori share
node output valu matric thi away
share readi enabl
share node valu matric

copyright microsoft right reserv
licens licens licens file project root full licens inform

stdafx sourc file includ standard includ
file test compil header
stdafx contain compil inform


stdafx

todo refer addit header need stdafx
file

copyright microsoft right reserv
licens licens licens file project root full licens inform

file test defin entri point consol applic


stdafx
basic
fileutil
file test
file
matrix

microsoft cntk

matrix file write and read

cpu matrix cpu matrix random uniform
cpu matrix mcopi
wstring filenam temp
file file filenam file option unicod file option read write
file
cpu matrix
file set posit
file
mcopi is equal to
fprintf stderr matrix read write


test file
filenam file open read
test file api tchar filenam option



file test file test
file file filenam option
option file option write

file file test

option file option read


file set posit rewind begin
file get line
file set posit rewind begin
file file test
file test file test2
file test file test2
fprintf stderr success comparison serial class match

fprintf stderr failur comparison serial class match
matrix file write and read


except

fprintf stderr except



tmain argc tchar argv

msra util command line arg argc argv
option file option null
arg arg

wchar arg shift




option file option type

fprintf stderr onli file allow


option file option text



option file option type

fprintf stderr onli file allow


option file option unicod



option file option type

fprintf stderr onli file allow


option file option binari



option file option read



option file option write


fprintf stderr invalid option valid option n file type text text file unicod unicod text file binari binari file n oper read read file pass write write file given overwrit exist




option file option type

option file option text
fprintf stderr file specifi text

option file option read write

option file option read write
fprintf stderr read write specifi read write

wchar filenam
wchar arg shift arg shift

filenam

filenam

fprintf stderr filenam expect option


test file api filenam option




microsoft cntk

file test file test


wchar
123456
0xfbadf00d
0xace
longlong 0xaddedbadbeef
int64 0xfeedfacef00d
size 0xbadfadfacad
singl 23456789e 012f
8765432109876548e

strcpi sampl string charact zero termin
wstr wchar
wcscpi wstr wide sampl string wide charact zero termin
append string sampl string
wstring append wstring sampl string wide
vector long push back vector support
vector long push back
vector long push back


compar file test object
file test file test test2

file test test1
compar
compar compar test2
compar compar wchar test2 wchar
compar compar test2
compar compar test2
compar compar test2
compar compar longlong test2 longlong
compar compar int64 test2 int64
compar compar size test2 size
compar compar singl test2 singl
compar compar test2
compar compar strcmp test2
compar compar wcscmp wstr test2 wstr
compar compar test2
compar compar wstring test2 wstring
compar compar vector long size test2 vector long size
compar vector long size

compar compar vector long test2 vector long

compar


file test file test



wstr
wstr


file file stream file test test

stream put marker file marker begin section begin file test
stream test test wchar
stream test test test
stream test longlong
stream test int64
stream test size
stream test singl test
stream write string test
stream write string test wstr
stream test test wstring
stream test vector long
stream put marker file marker end section end file test
stream


file file stream file test test

stream get marker file marker begin section begin file test
stream test test wchar
stream test
stream test
stream test
stream test longlong
stream test int64
stream test size
stream test singl test
test
test
stream read string test
test wstr
test wstr wchar
stream read string test wstr
stream test
stream test wstring
stream test vector long
stream get marker file marker end section end file test
stream


